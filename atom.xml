<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æˆ‘çš„åšå®¢</title>
  
  
  <link href="https://yuanxw.github.io/atom.xml" rel="self"/>
  
  <link href="https://yuanxw.github.io/"/>
  <updated>2025-09-03T15:46:38.158Z</updated>
  <id>https://yuanxw.github.io/</id>
  
  <author>
    <name>Panda Yuan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Arthasè¯Šæ–­**å·¥å…·(ä¸ƒ)**Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰profilerå‘½ä»¤ç”Ÿæˆç«ç„°å›¾</title>
    <link href="https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%B8%83)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89profiler%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90%E7%81%AB%E7%84%B0%E5%9B%BE/"/>
    <id>https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%B8%83)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89profiler%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90%E7%81%AB%E7%84%B0%E5%9B%BE/</id>
    <published>2023-03-06T16:00:00.000Z</published>
    <updated>2025-09-03T15:46:38.158Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasè¯Šæ–­å·¥å…·-ä¸ƒ-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰profilerå‘½ä»¤ç”Ÿæˆç«ç„°å›¾"><a href="#Arthasè¯Šæ–­å·¥å…·-ä¸ƒ-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰profilerå‘½ä»¤ç”Ÿæˆç«ç„°å›¾" class="headerlink" title="Arthasè¯Šæ–­å·¥å…·(ä¸ƒ)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰profilerå‘½ä»¤ç”Ÿæˆç«ç„°å›¾"></a><strong>Arthasè¯Šæ–­</strong>å·¥å…·(ä¸ƒ)<strong>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰profilerå‘½ä»¤ç”Ÿæˆç«ç„°å›¾</strong></h1><h2 id="1-profilerå‘½ä»¤"><a href="#1-profilerå‘½ä»¤" class="headerlink" title="1. profilerå‘½ä»¤"></a>1. <strong>profilerå‘½ä»¤</strong></h2><p><code>profiler</code>Â å‘½ä»¤æ”¯æŒç”Ÿæˆåº”ç”¨çƒ­ç‚¹çš„ç«ç„°å›¾ã€‚æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¸æ–­çš„é‡‡æ ·ï¼Œç„¶åæŠŠæ”¶é›†åˆ°çš„é‡‡æ ·ç»“æœç”Ÿæˆç«ç„°å›¾ã€‚</p><p><code>profiler</code>Â å‘½ä»¤åŸºæœ¬è¿è¡Œç»“æ„æ˜¯Â <code>profiler action [actionArg]</code></p><p><code>profiler</code>Â å‘½ä»¤çš„æ ¼å¼åŸºæœ¬ä¸ä¸Šæ¸¸é¡¹ç›®Â <a href="https://github.com/async-profiler/async-profiler"><strong>async-profileråœ¨æ–°çª—å£æ‰“å¼€</strong></a>Â ä¿æŒä¸€è‡´ï¼Œè¯¦ç»†çš„ä½¿ç”¨æ–¹å¼å¯å‚è€ƒä¸Šæ¸¸é¡¹ç›®çš„ READMEã€Github Disscussions ä»¥åŠå…¶ä»–æ–‡æ¡£èµ„æ–™</p><aside>ğŸ’¡<p>ä½¿ç”¨<a href="https://github.com/jvm-profiling-tools/async-profiler"><strong>async-profileråœ¨æ–°çª—å£æ‰“å¼€</strong></a>ç”Ÿæˆç«ç„°å›¾</p></aside><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>action</em></td><td>è¦æ‰§è¡Œçš„æ“ä½œ</td></tr><tr><td><em>actionArg</em></td><td>å±æ€§åæ¨¡å¼</td></tr><tr><td>[i:]</td><td>é‡‡æ ·é—´éš”ï¼ˆå•ä½ï¼šnsï¼‰ï¼ˆé»˜è®¤å€¼ï¼š10â€™000â€™000ï¼Œå³ 10 msï¼‰</td></tr><tr><td>[f:]</td><td>å°†è¾“å‡ºè½¬å‚¨åˆ°æŒ‡å®šè·¯å¾„</td></tr><tr><td>[d:]</td><td>è¿è¡Œè¯„æµ‹æŒ‡å®šç§’</td></tr><tr><td>[e:]</td><td>è¦è·Ÿè¸ªå“ªä¸ªäº‹ä»¶ï¼ˆcpu, alloc, lock, cache-misses ç­‰ï¼‰ï¼Œé»˜è®¤æ˜¯ cpu</td></tr></tbody></table><h2 id="2-å¯åŠ¨-profiler-å‘½ä»¤"><a href="#2-å¯åŠ¨-profiler-å‘½ä»¤" class="headerlink" title="2. å¯åŠ¨ profiler å‘½ä»¤"></a><strong>2. å¯åŠ¨ profiler å‘½ä»¤</strong></h2><aside>ğŸ’¡<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„æ˜¯ cpu çš„ç«ç„°å›¾ï¼Œå³ event ä¸º<code>cpu</code>ã€‚å¯ä»¥ç”¨<code>--event</code>å‚æ•°æŒ‡å®šå…¶ä»–æ€§èƒ½åˆ†ææ¨¡å¼ï¼Œè§ä¸‹æ–‡</p></aside><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ profiler start</span><br><span class="line">Profiling started</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-è·å–å·²é‡‡é›†çš„-sample-çš„æ•°é‡"><a href="#3-è·å–å·²é‡‡é›†çš„-sample-çš„æ•°é‡" class="headerlink" title="3. è·å–å·²é‡‡é›†çš„ sample çš„æ•°é‡"></a><strong>3. è·å–å·²é‡‡é›†çš„ sample çš„æ•°é‡</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ profiler getSamples </span><br><span class="line">34</span><br></pre></td></tr></table></figure><h2 id="4-æŸ¥çœ‹-profiling-çŠ¶æ€"><a href="#4-æŸ¥çœ‹-profiling-çŠ¶æ€" class="headerlink" title="4. æŸ¥çœ‹ profiling çŠ¶æ€"></a><strong>4. æŸ¥çœ‹ profiling çŠ¶æ€</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ profiler status</span><br><span class="line">Profiling is running <span class="keyword">for</span> 230 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-æŸ¥çœ‹-profiler-è‡ªèº«çš„å†…å­˜å ç”¨"><a href="#5-æŸ¥çœ‹-profiler-è‡ªèº«çš„å†…å­˜å ç”¨" class="headerlink" title="5. æŸ¥çœ‹ profiler è‡ªèº«çš„å†…å­˜å ç”¨"></a><strong>5. æŸ¥çœ‹ profiler è‡ªèº«çš„å†…å­˜å ç”¨</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ profiler meminfo </span><br><span class="line">Call trace storage:   10244 KB</span><br><span class="line">  Flight recording:       0 KB</span><br><span class="line">      Dictionaries:      72 KB</span><br><span class="line">        Code cache:   12685 KB</span><br><span class="line">------------------------------</span><br><span class="line">             Total:   23001 KB</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-åœæ­¢-profiler"><a href="#6-åœæ­¢-profiler" class="headerlink" title="6. åœæ­¢ profiler"></a><strong>6. åœæ­¢ profiler</strong></h2><ul><li><strong>ç”Ÿæˆç«ç„°å›¾æ ¼å¼ç»“æœ</strong></li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç»“æœæ˜¯Â <a href="https://github.com/BrendanGregg/FlameGraph"><strong>Flame Graphåœ¨æ–°çª—å£æ‰“å¼€</strong></a>Â æ ¼å¼çš„Â <code>html</code>Â æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨Â <code>-o</code>Â æˆ–Â <code>--format</code>Â å‚æ•°æŒ‡å®šå…¶ä»–å†…å®¹æ ¼å¼ï¼ŒåŒ…æ‹¬ flatã€tracesã€collapsedã€flamegraphã€treeã€jfrã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åœæ­¢é‡‡é›†æ•°æ®ï¼Œå¹¶ç”Ÿæˆç«ç„°å›¾</span></span><br><span class="line">[arthas@8161]$ profiler stop --format flamegraph</span><br><span class="line">OK</span><br><span class="line">profiler output file: /usr/local/software/arthas/arthas-output/20250607-110904.html</span><br><span class="line"></span><br><span class="line"><span class="comment">## é€€å‡ºarthas</span></span><br><span class="line">[arthas@8161]$ stop</span><br><span class="line">Resetting all enhanced classes ...</span><br><span class="line">Affect(class count: 1 , method count: 0) cost <span class="keyword">in</span> 74 ms, listenerId: 0</span><br><span class="line">Arthas Server is going to shutdown...</span><br><span class="line">[arthas@8161]$ session (95b458b7-9c4b-4201-a619-de2dae2e85a7) is closed because server is going to shutdown.</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¸‹è½½ç«ç„°å›¾</span></span><br><span class="line">[root@localhost arthas]# sz /usr/local/software/arthas/arthas-output/20250607-110904.html</span><br></pre></td></tr></table></figure><p><img src="/images/arthas/chapter7/image.png" alt="image.png"></p><p><img src="/images/arthas/chapter7/image1.png" alt="image.png"></p><ol><li>arthas ç«ç„°å›¾é¢œè‰²è¯´æ˜ï¼š<ul><li>ç»¿è‰²ï¼š java ä»£ç </li><li>é»„è‰²ï¼š jvm c++ ä»£ç </li><li>çº¢è‰²ï¼š ç”¨æˆ·æ€ c ä»£ç </li><li>æ©™è‰²ï¼š å†…æ ¸æ€ c ä»£ç </li></ul></li><li>arthas ç«ç„°å›¾x-yè½´<ul><li>xè½´ä»£è¡¨çš„ä¸æ˜¯æ—¶é—´ï¼Œè€Œæ˜¯é‡‡æ ·æ€»é‡</li><li>yè½´ä»£è¡¨æ–¹æ³•çš„è°ƒç”¨æ ˆæ·±åº¦ï¼Œå€˜è‹¥æ–¹æ³•è°ƒç”¨å¾—è¶Šå¤šï¼Œç«ç„°è¶Šé«˜ï¼Œé¡¶éƒ¨çš„æ ˆå°±æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•</li></ul></li><li>æ ˆå®½å«ä¹‰ï¼ˆCPUæ—¶é—´ï¼‰<ul><li>å®½åº¦å¯ä»¥ç†è§£ä¸ºCPUé‡‡æ ·ç‡çš„å æ¯”ï¼Œè¶Šå®½ä»£è¡¨å½“å‰æ ˆåœ¨é‡‡æ ·æ•°ä¸­å æ¯”é«˜ï¼Œå…¶å¯èƒ½ä¸ºä¸‰ç§å«ä¹‰<br> è¯¥å‡½æ•°è¿è¡Œæ—¶é—´é•¿<br> è¯¥å‡½æ•°è¢«è°ƒç”¨æ¬¡æ•°å¤š</li></ul></li><li>å¹³é¡¶ç°è±¡ï¼ˆä¸€å®šè¦æ ¼å¤–æ³¨æ„ï¼‰<ul><li>å¹³é¡¶ç°è±¡æ˜¯ç”±äºå½“å‰ç¨‹åºçš„é‡‡æ ·æ•°åœ¨æ€»é‡‡æ ·æ•°ä¸­å ç”¨è¿‡é«˜å¯¼è‡´çš„ï¼Œå‡ºç°è¿™ç§ç°è±¡éœ€è¦ç‰¹æ„å…³æ³¨ä¸€ä¸‹ç¨‹åºå…·ä½“çš„è°ƒç”¨æ ˆï¼Œé‡‡æ ·æ¯”ä¾‹å ç”¨ç‡è¿‡é«˜ï¼Œå³ä»£è¡¨æ–¹æ³•åœ¨CPUä¸­çš„å ç”¨ç‡è¿‡é«˜</li></ul></li></ol><p><strong>æ€»ç»“</strong>ï¼š</p><p>ç«ç„°å›¾åªæ˜¯ç”¨äºè¾…åŠ©ç¨‹åºåˆ†æå®šä½é—®é¢˜ï¼ŒæŸ¥çœ‹ç¨‹åºåœ¨é‡‡æ ·æœŸé—´çš„å¤§è‡´æƒ…å†µï¼Œå®é™…åœºæ™¯è¿˜éœ€ç»“åˆCPUå ç”¨ç‡ã€æŸ¥çœ‹JVMçš„DUMPå¿«ç…§ç­‰æ–¹å¼è¿›è¡Œå®šä½</p><ul><li>ç«ç„°å›¾çš„é¡¶éƒ¨ä»£è¡¨CPUæ¶ˆè€—æœ€é«˜çš„æ–¹æ³•ï¼Œè¶Šå¾€ä¸‹æ–¹æ³•çš„æ¶ˆè€—è¶Šä½ã€‚å®½åº¦è¿‡å®½çš„æ–¹æ³•è¡¨ç¤ºå…¶è¢«è°ƒç”¨é¢‘ç¹æˆ–è‡ªèº«æ‰§è¡Œæ—¶é—´é•¿ï¼Œæ˜¯æ€§èƒ½ç“¶é¢ˆçš„å€™é€‰ç‚¹ã€‚</li><li>é€šè¿‡è§‚å¯Ÿç«ç„°å›¾ï¼Œä½ å¯ä»¥è¯†åˆ«å‡ºå“ªäº›æ–¹æ³•å ç”¨CPUæœ€å¤šï¼Œè¿›è€Œé’ˆå¯¹æ€§åœ°ä¼˜åŒ–è¿™äº›â€œçƒ­ç‚¹â€æ–¹æ³•ï¼Œæå‡ç¨‹åºæ€§èƒ½ã€‚</li></ul><h2 id="7-profiler-æ”¯æŒçš„-events"><a href="#7-profiler-æ”¯æŒçš„-events" class="headerlink" title="7. profiler æ”¯æŒçš„ events"></a><strong>7. profiler æ”¯æŒçš„ events</strong></h2><p>åœ¨ä¸åŒçš„å¹³å°ï¼Œä¸åŒçš„ OS ä¸‹é¢ï¼Œæ”¯æŒçš„ events å„æœ‰ä¸åŒã€‚æ¯”å¦‚åœ¨ centosä¸‹é¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ profiler list</span><br><span class="line">Basic events:</span><br><span class="line">  cpu</span><br><span class="line">  alloc</span><br><span class="line">  nativemem</span><br><span class="line">  lock</span><br><span class="line">  wall</span><br><span class="line">  itimer</span><br><span class="line">  ctimer</span><br><span class="line">Java method calls:</span><br><span class="line">  ClassName.methodName</span><br><span class="line">Perf events:</span><br><span class="line">  cpu-clock</span><br><span class="line">  page-faults</span><br><span class="line">  context-switches</span><br><span class="line">  cycles</span><br><span class="line">  instructions</span><br><span class="line">  cache-references</span><br><span class="line">  cache-misses</span><br><span class="line">  branch-instructions</span><br><span class="line">  branch-misses</span><br><span class="line">  bus-cycles</span><br><span class="line">  L1-dcache-load-misses</span><br><span class="line">  LLC-load-misses</span><br><span class="line">  dTLB-load-misses</span><br><span class="line">  rNNN</span><br><span class="line">  pmu/event-descriptor/</span><br><span class="line">  mem:breakpoint</span><br><span class="line">  trace:tracepoint</span><br><span class="line">  kprobe:func</span><br><span class="line">  uprobe:path</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">profilerå‘½ä»¤æ”¯æŒç”Ÿæˆåº”ç”¨çƒ­ç‚¹çš„ç«ç„°å›¾ã€‚æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä¸æ–­çš„é‡‡æ ·ï¼Œç„¶åæŠŠæ”¶é›†åˆ°çš„é‡‡æ ·ç»“æœç”Ÿæˆç«ç„°å›¾ã€‚</summary>
    
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/tags/Arthas/"/>
    
    <category term="Arthasè¯Šæ–­å·¥å…·" scheme="https://yuanxw.github.io/tags/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Arthasè¯Šæ–­**å·¥å…·(å…­)**Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰optionså…¨å±€å¼€å…³</title>
    <link href="https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E5%85%AD)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89options%E5%85%A8%E5%B1%80%E5%BC%80%E5%85%B3/"/>
    <id>https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E5%85%AD)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89options%E5%85%A8%E5%B1%80%E5%BC%80%E5%85%B3/</id>
    <published>2023-03-05T16:00:00.000Z</published>
    <updated>2025-09-03T15:43:43.781Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasè¯Šæ–­å·¥å…·-å…­-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰optionså…¨å±€å¼€å…³"><a href="#Arthasè¯Šæ–­å·¥å…·-å…­-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰optionså…¨å±€å¼€å…³" class="headerlink" title="Arthasè¯Šæ–­å·¥å…·(å…­)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰optionså…¨å±€å¼€å…³"></a><strong>Arthasè¯Šæ–­</strong>å·¥å…·(å…­)<strong>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰optionså…¨å±€å¼€å…³</strong></h1><h2 id="1-optionså‘½ä»¤"><a href="#1-optionså‘½ä»¤" class="headerlink" title="1. optionså‘½ä»¤"></a>1. options<strong>å‘½ä»¤</strong></h2><p>å…¨å±€å¼€å…³</p><table><thead><tr><th>åç§°</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>unsafe</td><td>false</td><td>æ˜¯å¦æ”¯æŒå¯¹ç³»ç»Ÿçº§åˆ«çš„ç±»è¿›è¡Œå¢å¼ºï¼Œæ‰“å¼€è¯¥å¼€å…³å¯èƒ½å¯¼è‡´æŠŠ JVM ææŒ‚ï¼Œè¯·æ…é‡é€‰æ‹©ï¼</td></tr><tr><td>dump</td><td>false</td><td>æ˜¯å¦æ”¯æŒè¢«å¢å¼ºäº†çš„ç±» dump åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ‰“å¼€å¼€å…³ï¼Œclass æ–‡ä»¶ä¼šè¢« dump åˆ°<code>/$&#123;application working dir&#125;/arthas-class-dump/</code>ç›®å½•ä¸‹ï¼Œå…·ä½“ä½ç½®è¯¦è§æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>batch-re-transform</td><td>true</td><td>æ˜¯å¦æ”¯æŒæ‰¹é‡å¯¹åŒ¹é…åˆ°çš„ç±»æ‰§è¡Œ retransform æ“ä½œ</td></tr><tr><td>json-format</td><td>false</td><td>æ˜¯å¦æ”¯æŒ json åŒ–çš„è¾“å‡º</td></tr><tr><td>disable-sub-class</td><td>false</td><td>æ˜¯å¦ç¦ç”¨å­ç±»åŒ¹é…ï¼Œé»˜è®¤åœ¨åŒ¹é…ç›®æ ‡ç±»çš„æ—¶å€™ä¼šé»˜è®¤åŒ¹é…åˆ°å…¶å­ç±»ï¼Œå¦‚æœæƒ³ç²¾ç¡®åŒ¹é…ï¼Œå¯ä»¥å…³é—­æ­¤å¼€å…³</td></tr><tr><td>support-default-method</td><td>true</td><td>æ˜¯å¦æ”¯æŒåŒ¹é…åˆ° default methodï¼Œ é»˜è®¤ä¼šæŸ¥æ‰¾ interfaceï¼ŒåŒ¹é…é‡Œé¢çš„ default methodã€‚å‚è€ƒÂ <a href="https://github.com/alibaba/arthas/issues/1105"><strong>#1105åœ¨æ–°çª—å£æ‰“å¼€</strong></a></td></tr><tr><td>save-result</td><td>false</td><td>æ˜¯å¦æ‰“å¼€æ‰§è¡Œç»“æœå­˜æ—¥å¿—åŠŸèƒ½ï¼Œæ‰“å¼€ä¹‹åæ‰€æœ‰å‘½ä»¤çš„è¿è¡Œç»“æœéƒ½å°†ä¿å­˜åˆ°<code>~/logs/arthas-cache/result.log</code>ä¸­</td></tr><tr><td>job-timeout</td><td>1d</td><td>å¼‚æ­¥åå°ä»»åŠ¡çš„é»˜è®¤è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œä»»åŠ¡è‡ªåŠ¨åœæ­¢ï¼›æ¯”å¦‚è®¾ç½® 1d, 2h, 3m, 25sï¼Œåˆ†åˆ«ä»£è¡¨å¤©ã€å°æ—¶ã€åˆ†ã€ç§’</td></tr><tr><td>print-parent-fields</td><td>true</td><td>æ˜¯å¦æ‰“å°åœ¨ parent class é‡Œçš„ filed</td></tr><tr><td>verbose</td><td>false</td><td>æ˜¯å¦æ‰“å°æ›´å¤šè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>strict</td><td>true</td><td>æ˜¯å¦å¯ç”¨ strict æ¨¡å¼</td></tr></tbody></table><ul><li><strong>æŸ¥çœ‹æ‰€æœ‰çš„ options</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ options</span><br><span class="line"> LEVEL              TYPE                NAME                                  VALUE              SUMMARY                                                   DESCRIPTION                                                                                                        </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 0                  boolean             unsafe                                <span class="literal">false</span>              Option to support system-level class                      This option enables to proxy functionality of JVM classes. Due to serious security risk a JVM crash is possibly be </span><br><span class="line">                                                                                                                                                            introduced. Do not activate it unless you are able to manage.                                                     </span><br><span class="line"> 1                  boolean             dump                                  <span class="literal">false</span>              Option to dump the enhanced classes                       This option enables the enhanced classes to be dumped to external file <span class="keyword">for</span> further de-compilation and analysis.    </span><br><span class="line"> 1                  boolean             batch-re-transform                    <span class="literal">true</span>               Option to support batch reTransform Class                 This options enables to reTransform classes with batch mode.                                                       </span><br><span class="line"> 2                  boolean             json-format                           <span class="literal">false</span>              Option to support JSON format of object output            This option enables to format object output with JSON when -x option selected.                                     </span><br><span class="line"> 1                  boolean             disable-sub-class                     <span class="literal">false</span>              Option to control include sub class when class matching   This option <span class="built_in">disable</span> to include sub class when matching class.                                                      </span><br><span class="line"> 1                  boolean             support-default-method                <span class="literal">true</span>               Option to control include default method <span class="keyword">in</span> interface wh  This option <span class="built_in">disable</span> to include default method <span class="keyword">in</span> interface when matching class.                                    </span><br><span class="line">                                                                                                 en class matching                                                                                                                                                            </span><br><span class="line"> 1                  boolean             save-result                           <span class="literal">false</span>              Option to <span class="built_in">print</span> <span class="built_in">command</span><span class="string">&#x27;s result to log file              This option enables to save each command&#x27;</span>s result to <span class="built_in">log</span> file, <span class="built_in">which</span> path is <span class="variable">$&#123;user.home&#125;</span>/logs/arthas-cache/result </span><br><span class="line">                                                                                                                                                           .<span class="built_in">log</span>.                                                                                                              </span><br><span class="line"> 2                  String              job-timeout                           1d                 Option to job <span class="built_in">timeout</span>                                     This option setting job <span class="built_in">timeout</span>,The unit can be d, h, m, s <span class="keyword">for</span> day, hour, minute, second. 1d is one day <span class="keyword">in</span> default </span><br><span class="line"> 1                  boolean             print-parent-fields                   <span class="literal">true</span>               Option to <span class="built_in">print</span> all fileds <span class="keyword">in</span> parent class                This option enables <span class="built_in">print</span> files <span class="keyword">in</span> parent class, default value <span class="literal">true</span>.                                               </span><br><span class="line"> 1                  boolean             verbose                               <span class="literal">false</span>              Option to <span class="built_in">print</span> verbose information                       This option enables <span class="built_in">print</span> verbose information, default value <span class="literal">false</span>.                                                </span><br><span class="line"> 1                  boolean             strict                                <span class="literal">true</span>               Option to strict mode                                     By default, strict mode is <span class="literal">true</span>, not allowed to <span class="built_in">set</span> object properties. Want to <span class="built_in">set</span> object properties, execute `opt </span><br><span class="line">                                                                                                                                                           ions strict <span class="literal">false</span>`  </span><br></pre></td></tr></table></figure><ul><li><strong>è·å– option çš„å€¼</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">json-format job-timeout </span><br><span class="line">[arthas@8161]$ options json-format </span><br><span class="line"> LEVEL              TYPE                NAME                                  VALUE              SUMMARY                                                   DESCRIPTION                                                                                                        </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 2                  boolean             json-format                           <span class="literal">false</span>              Option to support JSON format of object output            This option enables to format object output with JSON when -x option selected.                                     </span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">optionså…¨å±€å¼€å…³</summary>
    
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/tags/Arthas/"/>
    
    <category term="Arthasè¯Šæ–­å·¥å…·" scheme="https://yuanxw.github.io/tags/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Arthasè¯Šæ–­**å·¥å…·(äº”)**Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰monitor/watch/trace/stack/ttç›¸å…³å‘½ä»¤</title>
    <link href="https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%BA%94)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89monitor%20watch%20trace%20stack/"/>
    <id>https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%BA%94)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89monitor%20watch%20trace%20stack/</id>
    <published>2023-03-04T16:00:00.000Z</published>
    <updated>2025-09-03T15:42:07.893Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasè¯Šæ–­å·¥å…·-äº”-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰monitor-watch-trace-stack-ttç›¸å…³å‘½ä»¤"><a href="#Arthasè¯Šæ–­å·¥å…·-äº”-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰monitor-watch-trace-stack-ttç›¸å…³å‘½ä»¤" class="headerlink" title="Arthasè¯Šæ–­å·¥å…·(äº”)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰monitor&#x2F;watch&#x2F;trace&#x2F;stack&#x2F;ttç›¸å…³å‘½ä»¤"></a><strong>Arthasè¯Šæ–­</strong>å·¥å…·(äº”)<strong>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰monitor&#x2F;watch&#x2F;trace&#x2F;stack&#x2F;ttç›¸å…³å‘½ä»¤</strong></h1><h2 id="1-monitorå‘½ä»¤"><a href="#1-monitorå‘½ä»¤" class="headerlink" title="1. monitorå‘½ä»¤"></a>1. <strong>monitorå‘½ä»¤</strong></h2><p>æ–¹æ³•æ‰§è¡Œç›‘æ§</p><p>å¯¹åŒ¹é…Â <code>class-pattern</code>ï¼<code>method-pattern</code>ï¼<code>condition-express</code>çš„ç±»ã€æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œç›‘æ§ã€‚</p><p><code>monitor</code>Â å‘½ä»¤æ˜¯ä¸€ä¸ªéå®æ—¶è¿”å›å‘½ä»¤.</p><p>å®æ—¶è¿”å›å‘½ä»¤æ˜¯è¾“å…¥ä¹‹åç«‹å³è¿”å›ï¼Œè€Œéå®æ—¶è¿”å›çš„å‘½ä»¤ï¼Œåˆ™æ˜¯ä¸æ–­çš„ç­‰å¾…ç›®æ ‡ Java è¿›ç¨‹è¿”å›ä¿¡æ¯ï¼Œç›´åˆ°ç”¨æˆ·è¾“å…¥Â <code>Ctrl+C</code>Â ä¸ºæ­¢ã€‚</p><p>æœåŠ¡ç«¯æ˜¯ä»¥ä»»åŠ¡çš„å½¢å¼åœ¨åå°è·‘ä»»åŠ¡ï¼Œæ¤å…¥çš„ä»£ç éšç€ä»»åŠ¡çš„ä¸­æ­¢è€Œä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä»»åŠ¡å…³é—­åï¼Œä¸ä¼šå¯¹åŸæœ‰æ€§èƒ½äº§ç”Ÿå¤ªå¤§å½±å“ï¼Œè€Œä¸”åŸåˆ™ä¸Šï¼Œä»»ä½• Arthas å‘½ä»¤ä¸ä¼šå¼•èµ·åŸæœ‰ä¸šåŠ¡é€»è¾‘çš„æ”¹å˜ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><p>æ–¹æ³•æ‹¥æœ‰ä¸€ä¸ªå‘½åå‚æ•°Â <code>[c:]</code>ï¼Œæ„æ€æ˜¯ç»Ÿè®¡å‘¨æœŸï¼ˆcycle of outputï¼‰ï¼Œæ‹¥æœ‰ä¸€ä¸ªæ•´å‹çš„å‚æ•°å€¼</p><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td><code>[c:]</code></td><td>ç»Ÿè®¡å‘¨æœŸï¼Œé»˜è®¤å€¼ä¸º 120 ç§’</td></tr><tr><td>[b]</td><td>åœ¨<strong>æ–¹æ³•è°ƒç”¨ä¹‹å‰</strong>è®¡ç®— condition-express</td></tr><tr><td><code>[m &lt;arg&gt;]</code></td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º<code>[maxMatch &lt;arg&gt;]</code></td></tr></tbody></table><ul><li><strong>ç›‘æ§çš„ç»´åº¦è¯´æ˜</strong></li></ul><table><thead><tr><th>ç›‘æ§é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>timestamp</td><td>æ—¶é—´æˆ³</td></tr><tr><td>class</td><td>Java ç±»</td></tr><tr><td>method</td><td>æ–¹æ³•ï¼ˆæ„é€ æ–¹æ³•ã€æ™®é€šæ–¹æ³•ï¼‰</td></tr><tr><td>total</td><td>è°ƒç”¨æ¬¡æ•°</td></tr><tr><td>success</td><td>æˆåŠŸæ¬¡æ•°</td></tr><tr><td>fail</td><td>å¤±è´¥æ¬¡æ•°</td></tr><tr><td>rt</td><td>å¹³å‡ RT</td></tr><tr><td>fail-rate</td><td>å¤±è´¥ç‡</td></tr></tbody></table><ul><li>ç›‘æ§<code>demo.MathGame primeFactors</code>ï¼Œæ¯5ç§’è¿”å›ä¸€ä¸ªç»“æœ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ monitor demo.MathGame primeFactors -c 5</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 204 ms, listenerId: 1</span><br><span class="line"> timestamp                                 class                                                         method                                                        total                success              fail                avg-rt(ms)           fail-rate           </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 2025-06-07 05:32:53.378                   demo.MathGame                                                 primeFactors                                                  5                    1                    4                   3.12                 80.00%              </span><br><span class="line"></span><br><span class="line"> timestamp                                 class                                                         method                                                        total                success              fail                avg-rt(ms)           fail-rate           </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 2025-06-07 05:32:58.441                   demo.MathGame                                                 primeFactors                                                  5                    0                    5                   0.17                 100.00%             </span><br><span class="line"></span><br><span class="line"> timestamp                                 class                                                         method                                                        total                success              fail                avg-rt(ms)           fail-rate           </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 2025-06-07 05:33:02.655                   demo.MathGame                                                 primeFactors                                                  4                    3                    1                   0.16                 25.00%              </span><br><span class="line"></span><br><span class="line"> timestamp                                 class                                                         method                                                        total                success              fail                avg-rt(ms)           fail-rate           </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 2025-06-07 05:33:07.664                   demo.MathGame                                                 primeFactors                                                  5                    2                    3                   0.96                 60.00%              </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-watchå‘½ä»¤"><a href="#2-watchå‘½ä»¤" class="headerlink" title="2. watchå‘½ä»¤"></a>2. <strong>watchå‘½ä»¤</strong></h2><p>å‡½æ•°æ‰§è¡Œæ•°æ®è§‚æµ‹</p><p>è®©ä½ èƒ½æ–¹ä¾¿çš„è§‚å¯Ÿåˆ°æŒ‡å®šå‡½æ•°çš„è°ƒç”¨æƒ…å†µã€‚èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ä¸ºï¼š<code>è¿”å›å€¼</code>ã€<code>æŠ›å‡ºå¼‚å¸¸</code>ã€<code>å…¥å‚</code>ï¼Œé€šè¿‡ç¼–å†™ OGNL è¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><p>watch çš„å‚æ•°æ¯”è¾ƒå¤šï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒèƒ½åœ¨ 4 ä¸ªä¸åŒçš„åœºæ™¯è§‚å¯Ÿå¯¹è±¡</p><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>method-pattern</em></td><td>å‡½æ•°åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>express</em></td><td>è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œé»˜è®¤å€¼ï¼š<code>&#123;params, target, returnObj&#125;</code></td></tr><tr><td><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td>[b]</td><td>åœ¨<strong>å‡½æ•°è°ƒç”¨ä¹‹å‰</strong>è§‚å¯Ÿ</td></tr><tr><td>[e]</td><td>åœ¨<strong>å‡½æ•°å¼‚å¸¸ä¹‹å</strong>è§‚å¯Ÿ</td></tr><tr><td>[s]</td><td>åœ¨<strong>å‡½æ•°è¿”å›ä¹‹å</strong>è§‚å¯Ÿ</td></tr><tr><td>[f]</td><td>åœ¨<strong>å‡½æ•°ç»“æŸä¹‹å</strong>(æ­£å¸¸è¿”å›å’Œå¼‚å¸¸è¿”å›)è§‚å¯Ÿ</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td>[x:]</td><td>æŒ‡å®šè¾“å‡ºç»“æœçš„å±æ€§éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 1ï¼Œæœ€å¤§å€¼æ˜¯ 4</td></tr><tr><td><code>[m &lt;arg&gt;]</code></td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º<code>[maxMatch &lt;arg&gt;]</code>ã€‚</td></tr></tbody></table><p>è¿™é‡Œé‡ç‚¹è¦è¯´æ˜çš„æ˜¯è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œè§‚å¯Ÿè¡¨è¾¾å¼çš„æ„æˆä¸»è¦ç”± ognl è¡¨è¾¾å¼ç»„æˆï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™<code>&quot;&#123;params,returnObj&#125;&quot;</code>ï¼Œåªè¦æ˜¯ä¸€ä¸ªåˆæ³•çš„ ognl è¡¨è¾¾å¼ï¼Œéƒ½èƒ½è¢«æ­£å¸¸æ”¯æŒã€‚</p><p>è§‚å¯Ÿçš„ç»´åº¦ä¹Ÿæ¯”è¾ƒå¤šï¼Œä¸»è¦ä½“ç°åœ¨å‚æ•°Â <code>advice</code>Â çš„æ•°æ®ç»“æ„ä¸Šã€‚<code>Advice</code>Â å‚æ•°æœ€ä¸»è¦æ˜¯å°è£…äº†é€šçŸ¥èŠ‚ç‚¹çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¯·å‚è€ƒ<a href="https://arthas.aliyun.com/doc/advice-class.html"><strong>è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</strong></a>ä¸­å…³äºè¯¥èŠ‚ç‚¹çš„æè¿°ã€‚</p><ul><li>ç‰¹æ®Šç”¨æ³•è¯·å‚è€ƒï¼š<a href="https://github.com/alibaba/arthas/issues/71"><strong>https://github.com/alibaba/arthas/issues/71</strong></a></li><li>OGNL è¡¨è¾¾å¼å®˜ç½‘ï¼š<a href="https://commons.apache.org/dormant/commons-ognl/language-guide.html"><strong>https://commons.apache.org/dormant/commons-ognl/language-guide.html</strong></a></li></ul><p><strong>ç‰¹åˆ«è¯´æ˜</strong>ï¼š</p><ul><li>watch å‘½ä»¤å®šä¹‰äº† 4 ä¸ªè§‚å¯Ÿäº‹ä»¶ç‚¹ï¼Œå³Â <code>b</code>Â å‡½æ•°è°ƒç”¨å‰ï¼Œ<code>e</code>Â å‡½æ•°å¼‚å¸¸åï¼Œ<code>s</code>Â å‡½æ•°è¿”å›åï¼Œ<code>f</code>Â å‡½æ•°ç»“æŸå</li><li>4 ä¸ªè§‚å¯Ÿäº‹ä»¶ç‚¹Â <code>b</code>ã€<code>e</code>ã€<code>s</code>Â é»˜è®¤å…³é—­ï¼Œ<code>f</code>Â é»˜è®¤æ‰“å¼€ï¼Œå½“æŒ‡å®šè§‚å¯Ÿç‚¹è¢«æ‰“å¼€åï¼Œåœ¨ç›¸åº”äº‹ä»¶ç‚¹ä¼šå¯¹è§‚å¯Ÿè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼å¹¶è¾“å‡º</li><li>è¿™é‡Œè¦æ³¨æ„<code>å‡½æ•°å…¥å‚</code>å’Œ<code>å‡½æ•°å‡ºå‚</code>çš„åŒºåˆ«ï¼Œæœ‰å¯èƒ½åœ¨ä¸­é—´è¢«ä¿®æ”¹å¯¼è‡´å‰åä¸ä¸€è‡´ï¼Œé™¤äº†Â <code>b</code>Â äº‹ä»¶ç‚¹Â <code>params</code>Â ä»£è¡¨å‡½æ•°å…¥å‚å¤–ï¼Œå…¶ä½™äº‹ä»¶éƒ½ä»£è¡¨å‡½æ•°å‡ºå‚</li><li>å½“ä½¿ç”¨Â <code>b</code>Â æ—¶ï¼Œç”±äºè§‚å¯Ÿäº‹ä»¶ç‚¹æ˜¯åœ¨å‡½æ•°è°ƒç”¨å‰ï¼Œæ­¤æ—¶è¿”å›å€¼æˆ–å¼‚å¸¸å‡ä¸å­˜åœ¨</li><li>åœ¨ watch å‘½ä»¤çš„ç»“æœé‡Œï¼Œä¼šæ‰“å°å‡º<code>location</code>ä¿¡æ¯ã€‚<code>location</code>æœ‰ä¸‰ç§å¯èƒ½å€¼ï¼š<code>AtEnter</code>ï¼Œ<code>AtExit</code>ï¼Œ<code>AtExceptionExit</code>ã€‚å¯¹åº”å‡½æ•°å…¥å£ï¼Œå‡½æ•°æ­£å¸¸ returnï¼Œå‡½æ•°æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h3 id="2-1-è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°ã€this-å¯¹è±¡å’Œè¿”å›å€¼"><a href="#2-1-è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°ã€this-å¯¹è±¡å’Œè¿”å›å€¼" class="headerlink" title="2.1 è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°ã€this å¯¹è±¡å’Œè¿”å›å€¼"></a><strong>2.1 è§‚å¯Ÿå‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„å‚æ•°ã€this å¯¹è±¡å’Œè¿”å›å€¼</strong></h3><p>è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œé»˜è®¤å€¼æ˜¯<code>&#123;params, target, returnObj&#125;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">8161</span>]$ watch demo.MathGame primeFactors -x <span class="number">2</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(<span class="keyword">class</span> <span class="title class_">count</span>: <span class="number">1</span> , method count: <span class="number">1</span>) cost in <span class="number">73</span> ms, listenerId: <span class="number">2</span></span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">05</span>:<span class="number">51</span>:<span class="number">10.663</span>; [cost=<span class="number">1.</span>015159ms] result=<span class="meta">@ArrayList</span>[</span><br><span class="line">    <span class="meta">@Object</span>[][</span><br><span class="line">        <span class="meta">@Integer</span>[-<span class="number">93162</span>],</span><br><span class="line">    ],</span><br><span class="line">    <span class="meta">@MathGame</span>[</span><br><span class="line">        random=<span class="meta">@Random</span>[java.util.Random@51efea79],</span><br><span class="line">        illegalArgumentCount=<span class="meta">@Integer</span>[<span class="number">2327</span>],</span><br><span class="line">    ],</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">05</span>:<span class="number">48</span>:<span class="number">55.377</span>; [cost=<span class="number">0.</span>064295ms] result=<span class="meta">@ArrayList</span>[</span><br><span class="line">    <span class="meta">@Object</span>[][</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">1</span>],</span><br><span class="line">    ],</span><br><span class="line">    <span class="meta">@MathGame</span>[</span><br><span class="line">        random=<span class="meta">@Random</span>[java.util.Random@51efea79],</span><br><span class="line">        illegalArgumentCount=<span class="meta">@Integer</span>[<span class="number">2256</span>],</span><br><span class="line">    ],</span><br><span class="line">    <span class="meta">@ArrayList</span>[</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">2</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">2</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">2</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">2</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">2</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">2</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">2</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">3</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">13</span>],</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">41</span>],</span><br><span class="line">    ],</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä¸Šé¢çš„ç»“æœé‡Œï¼Œè¯´æ˜å‡½æ•°è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡ç»“æœæ˜¯<code>location=AtExceptionExit</code>ï¼Œè¯´æ˜å‡½æ•°æŠ›å‡ºå¼‚å¸¸äº†ï¼Œå› æ­¤<code>returnObj</code>æ˜¯ null</li><li>åœ¨ç¬¬äºŒæ¬¡ç»“æœé‡Œæ˜¯<code>location=AtExit</code>ï¼Œè¯´æ˜å‡½æ•°æ­£å¸¸è¿”å›ï¼Œå› æ­¤å¯ä»¥çœ‹åˆ°<code>returnObj</code>ç»“æœæ˜¯ä¸€ä¸ª ArrayList</li></ul><h3 id="2-2-è°ƒæ•´-xçš„å€¼ï¼Œè§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼"><a href="#2-2-è°ƒæ•´-xçš„å€¼ï¼Œè§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼" class="headerlink" title="2.2 è°ƒæ•´-xçš„å€¼ï¼Œè§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼"></a><strong>2.2 è°ƒæ•´<code>-x</code>çš„å€¼ï¼Œè§‚å¯Ÿå…·ä½“çš„å‡½æ•°å‚æ•°å€¼</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">8161</span>]$ watch demo.MathGame primeFactors <span class="string">&quot;&#123;params,target&#125;&quot;</span> -x <span class="number">3</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(<span class="keyword">class</span> <span class="title class_">count</span>: <span class="number">1</span> , method count: <span class="number">1</span>) cost in <span class="number">69</span> ms, listenerId: <span class="number">4</span></span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">05</span>:<span class="number">52</span>:<span class="number">36.258</span>; [cost=<span class="number">0.</span>313869ms] result=<span class="meta">@ArrayList</span>[</span><br><span class="line">    <span class="meta">@Object</span>[][</span><br><span class="line">        <span class="meta">@Integer</span>[-<span class="number">162367</span>],</span><br><span class="line">    ],</span><br><span class="line">    <span class="meta">@MathGame</span>[</span><br><span class="line">        random=<span class="meta">@Random</span>[</span><br><span class="line">            serialVersionUID=<span class="meta">@Long</span>[<span class="number">3905348978240129619</span>],</span><br><span class="line">            seed=<span class="meta">@AtomicLong</span>[<span class="number">175065596875740</span>],</span><br><span class="line">            multiplier=<span class="meta">@Long</span>[<span class="number">25214903917</span>],</span><br><span class="line">            addend=<span class="meta">@Long</span>[<span class="number">11</span>],</span><br><span class="line">            mask=<span class="meta">@Long</span>[<span class="number">281474976710655</span>],</span><br><span class="line">            DOUBLE_UNIT=<span class="meta">@Double</span>[<span class="number">1.1102230246251565E-16</span>],</span><br><span class="line">            BadBound=<span class="meta">@String</span>[bound must be positive],</span><br><span class="line">            BadRange=<span class="meta">@String</span>[bound must be greater than origin],</span><br><span class="line">            BadSize=<span class="meta">@String</span>[size must be non-negative],</span><br><span class="line">            seedUniquifier=<span class="meta">@AtomicLong</span>[-<span class="number">2942033378085796212</span>],</span><br><span class="line">            nextNextGaussian=<span class="meta">@Double</span>[<span class="number">0.0</span>],</span><br><span class="line">            haveNextNextGaussian=<span class="meta">@Boolean</span>[<span class="literal">false</span>],</span><br><span class="line">            serialPersistentFields=<span class="meta">@ObjectStreamField</span>[][isEmpty=<span class="literal">false</span>;size=<span class="number">3</span>],</span><br><span class="line">            unsafe=<span class="meta">@Unsafe</span>[jdk.internal.misc.Unsafe@5419f379],</span><br><span class="line">            seedOffset=<span class="meta">@Long</span>[<span class="number">24</span>],</span><br><span class="line">        ],</span><br><span class="line">        illegalArgumentCount=<span class="meta">@Integer</span>[<span class="number">2371</span>],</span><br><span class="line">    ],</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">05</span>:<span class="number">52</span>:<span class="number">37.298</span>; [cost=<span class="number">0.</span>214619ms] result=<span class="meta">@ArrayList</span>[</span><br><span class="line">    <span class="meta">@Object</span>[][</span><br><span class="line">        <span class="meta">@Integer</span>[<span class="number">1</span>],</span><br><span class="line">    ],</span><br><span class="line">    <span class="meta">@MathGame</span>[</span><br><span class="line">        random=<span class="meta">@Random</span>[</span><br><span class="line">            serialVersionUID=<span class="meta">@Long</span>[<span class="number">3905348978240129619</span>],</span><br><span class="line">            seed=<span class="meta">@AtomicLong</span>[<span class="number">102106958650551</span>],</span><br><span class="line">            multiplier=<span class="meta">@Long</span>[<span class="number">25214903917</span>],</span><br><span class="line">            addend=<span class="meta">@Long</span>[<span class="number">11</span>],</span><br><span class="line">            mask=<span class="meta">@Long</span>[<span class="number">281474976710655</span>],</span><br><span class="line">            DOUBLE_UNIT=<span class="meta">@Double</span>[<span class="number">1.1102230246251565E-16</span>],</span><br><span class="line">            BadBound=<span class="meta">@String</span>[bound must be positive],</span><br><span class="line">            BadRange=<span class="meta">@String</span>[bound must be greater than origin],</span><br><span class="line">            BadSize=<span class="meta">@String</span>[size must be non-negative],</span><br><span class="line">            seedUniquifier=<span class="meta">@AtomicLong</span>[-<span class="number">2942033378085796212</span>],</span><br><span class="line">            nextNextGaussian=<span class="meta">@Double</span>[<span class="number">0.0</span>],</span><br><span class="line">            haveNextNextGaussian=<span class="meta">@Boolean</span>[<span class="literal">false</span>],</span><br><span class="line">            serialPersistentFields=<span class="meta">@ObjectStreamField</span>[][isEmpty=<span class="literal">false</span>;size=<span class="number">3</span>],</span><br><span class="line">            unsafe=<span class="meta">@Unsafe</span>[jdk.internal.misc.Unsafe@5419f379],</span><br><span class="line">            seedOffset=<span class="meta">@Long</span>[<span class="number">24</span>],</span><br><span class="line">        ],</span><br><span class="line">        illegalArgumentCount=<span class="meta">@Integer</span>[<span class="number">2371</span>],</span><br><span class="line">    ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="2-3-æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­"><a href="#2-3-æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­" class="headerlink" title="2.3 æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­"></a><strong>2.3 æ¡ä»¶è¡¨è¾¾å¼çš„ä¾‹å­</strong></h3><ul><li>åªæœ‰æ»¡è¶³æ¡ä»¶çš„è°ƒç”¨ï¼Œæ‰ä¼šæœ‰å“åº”ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">8161</span>]$ watch demo.MathGame primeFactors <span class="string">&quot;&#123;params[0],target&#125;&quot;</span> <span class="string">&quot;params[0]&lt;0&quot;</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(<span class="keyword">class</span> <span class="title class_">count</span>: <span class="number">1</span> , method count: <span class="number">1</span>) cost in <span class="number">70</span> ms, listenerId: <span class="number">5</span></span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">05</span>:<span class="number">57</span>:<span class="number">45.251</span>; [cost=<span class="number">0.</span>640813ms] result=<span class="meta">@ArrayList</span>[</span><br><span class="line">    <span class="meta">@Integer</span>[-<span class="number">152032</span>],</span><br><span class="line">    <span class="meta">@MathGame</span>[demo.MathGame@589838eb],</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">05</span>:<span class="number">57</span>:<span class="number">49.265</span>; [cost=<span class="number">0.</span>09171ms] result=<span class="meta">@ArrayList</span>[</span><br><span class="line">    <span class="meta">@Integer</span>[-<span class="number">106952</span>],</span><br><span class="line">    <span class="meta">@MathGame</span>[demo.MathGame@589838eb],</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">05</span>:<span class="number">57</span>:<span class="number">50.271</span>; [cost=<span class="number">0.</span>058582ms] result=<span class="meta">@ArrayList</span>[</span><br><span class="line">    <span class="meta">@Integer</span>[-<span class="number">181262</span>],</span><br><span class="line">    <span class="meta">@MathGame</span>[demo.MathGame@589838eb],</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-traceå‘½ä»¤"><a href="#3-traceå‘½ä»¤" class="headerlink" title="3. traceå‘½ä»¤"></a>3. <strong>traceå‘½ä»¤</strong></h2><p>æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶</p><p><code>trace</code>Â å‘½ä»¤èƒ½ä¸»åŠ¨æœç´¢Â <code>class-pattern</code>ï¼<code>method-pattern</code>Â å¯¹åº”çš„æ–¹æ³•è°ƒç”¨è·¯å¾„ï¼Œæ¸²æŸ“å’Œç»Ÿè®¡æ•´ä¸ªè°ƒç”¨é“¾è·¯ä¸Šçš„æ‰€æœ‰æ€§èƒ½å¼€é”€å’Œè¿½è¸ªè°ƒç”¨é“¾è·¯ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td><code>[n:]</code></td><td>å‘½ä»¤æ‰§è¡Œæ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º 100ã€‚</td></tr><tr><td><code>#cost</code></td><td>æ–¹æ³•æ‰§è¡Œè€—æ—¶ï¼Œå•ä½æ¯«ç§’</td></tr><tr><td><code>[m &lt;arg&gt;]</code></td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º<code>[maxMatch &lt;arg&gt;]</code>ã€‚</td></tr></tbody></table><p>è¿™é‡Œé‡ç‚¹è¦è¯´æ˜çš„æ˜¯<code>æ¡ä»¶è¡¨è¾¾å¼</code>ï¼Œ<code>æ¡ä»¶è¡¨è¾¾å¼</code>çš„æ„æˆä¸»è¦ç”± ognl è¡¨è¾¾å¼ç»„æˆï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™<code>&quot;params[0]&lt;0&quot;</code>ï¼Œåªè¦æ˜¯ä¸€ä¸ªåˆæ³•çš„ ognl è¡¨è¾¾å¼ï¼Œéƒ½èƒ½è¢«æ­£å¸¸æ”¯æŒã€‚</p><p>è¯·å‚è€ƒ<a href="https://arthas.aliyun.com/doc/advice-class.html"><strong>è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</strong></a>ä¸­å…³äºè¯¥èŠ‚ç‚¹çš„æè¿°ã€‚</p><ul><li>ç‰¹æ®Šç”¨æ³•è¯·å‚è€ƒï¼š<a href="https://github.com/alibaba/arthas/issues/71"><strong>https://github.com/alibaba/arthas/issues/71</strong></a></li><li>OGNL è¡¨è¾¾å¼å®˜ç½‘ï¼š<a href="https://commons.apache.org/dormant/commons-ognl/language-guide.html"><strong>https://commons.apache.org/dormant/commons-ognl/language-guide.html</strong></a></li></ul><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åªæƒ³çœ‹åˆ°æŸä¸ªæ–¹æ³•çš„ rt å¤§äºæŸä¸ªæ—¶é—´ä¹‹åçš„ trace ç»“æœï¼Œç°åœ¨ Arthas å¯ä»¥æŒ‰ç…§æ–¹æ³•æ‰§è¡Œçš„è€—æ—¶æ¥è¿›è¡Œè¿‡æ»¤äº†ï¼Œä¾‹å¦‚<code>trace *StringUtils isBlank &#39;#cost&gt;100&#39;</code>è¡¨ç¤ºå½“æ‰§è¡Œæ—¶é—´è¶…è¿‡ 100ms çš„æ—¶å€™ï¼Œæ‰ä¼šè¾“å‡º trace çš„ç»“æœã€‚</p><p>watch&#x2F;stack&#x2F;trace è¿™ä¸ªä¸‰ä¸ªå‘½ä»¤éƒ½æ”¯æŒ<code>#cost</code></p><aside>ğŸ’¡<ul><li><strong>æ³¨æ„äº‹é¡¹</strong><ol><li><p><code>trace</code>Â èƒ½æ–¹ä¾¿çš„å¸®åŠ©ä½ å®šä½å’Œå‘ç°å›  RT é«˜è€Œå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ç¼ºé™·ï¼Œä½†å…¶æ¯æ¬¡åªèƒ½è·Ÿè¸ªä¸€çº§æ–¹æ³•çš„è°ƒç”¨é“¾è·¯ã€‚</p><p> å‚è€ƒï¼š<a href="https://github.com/alibaba/arthas/issues/597"><strong>Trace å‘½ä»¤çš„å®ç°åŸç†åœ¨æ–°çª—å£æ‰“å¼€</strong></a></p></li><li><p>3.3.0 ç‰ˆæœ¬åï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ Trace åŠŸèƒ½ï¼Œä¸æ–­å¢åŠ æ–°çš„åŒ¹é…ç±»ï¼Œå‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ã€‚</p></li><li><p>ç›®å‰ä¸æ”¯æŒÂ <code>trace java.lang.Thread getName</code>ï¼Œå‚è€ƒ issue:Â <a href="https://github.com/alibaba/arthas/issues/1610"><strong>#1610åœ¨æ–°çª—å£æ‰“å¼€</strong></a>Â ï¼Œè€ƒè™‘åˆ°ä¸æ˜¯éå¸¸å¿…è¦åœºæ™¯ï¼Œä¸”ä¿®å¤æœ‰ä¸€å®šéš¾åº¦ï¼Œå› æ­¤å½“å‰æš‚ä¸ä¿®å¤</p></li></ol></li></ul></aside><h3 id="3-1-traceä¸å¸¦å‚æ•°å‘½ä»¤"><a href="#3-1-traceä¸å¸¦å‚æ•°å‘½ä»¤" class="headerlink" title="3.1 traceä¸å¸¦å‚æ•°å‘½ä»¤"></a><strong>3.1 traceä¸å¸¦å‚æ•°å‘½ä»¤</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">8161</span>]$ trace demo.MathGame run</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(<span class="keyword">class</span> <span class="title class_">count</span>: <span class="number">1</span> , method count: <span class="number">1</span>) cost in <span class="number">100</span> ms, listenerId: <span class="number">6</span></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">06</span>:<span class="number">02</span>:<span class="number">53.872</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">1.</span>431047ms] demo.MathGame:run()</span><br><span class="line">        +---[<span class="number">17.69</span>% <span class="number">0.</span>25315ms ] demo.MathGame:primeFactors() #<span class="number">24</span></span><br><span class="line">        `---[<span class="number">38.56</span>% <span class="number">0.</span>551755ms ] demo.MathGame:print() #<span class="number">25</span></span><br><span class="line"></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">06</span>:<span class="number">02</span>:<span class="number">54.895</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">0.</span>421141ms] demo.MathGame:run()</span><br><span class="line">        `---[<span class="number">42.03</span>% <span class="number">0.</span>177003ms ] demo.MathGame:primeFactors() #<span class="number">24</span> [<span class="keyword">throws</span> Exception]</span><br><span class="line"></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> <span class="number">06</span>:<span class="number">02</span>:<span class="number">55.897</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">0.</span>108631ms] demo.MathGame:run()</span><br><span class="line">        +---[<span class="number">21.72</span>% <span class="number">0.</span>023592ms ] demo.MathGame:primeFactors() #<span class="number">24</span></span><br><span class="line">        `---[<span class="number">49.07</span>% <span class="number">0.</span>053301ms ] demo.MathGame:print() #<span class="number">25</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœé‡Œçš„Â <code>#24</code>ï¼Œè¡¨ç¤ºåœ¨ run å‡½æ•°é‡Œï¼Œåœ¨æºæ–‡ä»¶çš„ç¬¬<code>24</code>è¡Œè°ƒç”¨äº†<code>primeFactors()</code>å‡½æ•°ã€‚</p><h3 id="3-2-traceå¸¦å‚æ•°å‘½ä»¤"><a href="#3-2-traceå¸¦å‚æ•°å‘½ä»¤" class="headerlink" title="3.2 traceå¸¦å‚æ•°å‘½ä»¤"></a><strong>3.2 traceå¸¦å‚æ•°å‘½ä»¤</strong></h3><ul><li><code>-skipJDKMethod &lt;value&gt;</code>Â skip jdk method trace, default value true.</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œtrace ä¸ä¼šåŒ…å« jdk é‡Œçš„å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœå¸Œæœ› trace jdk é‡Œçš„å‡½æ•°ï¼Œéœ€è¦æ˜¾å¼è®¾ç½®<code>--skipJDKMethod false</code>ã€‚</p><ul><li>å¦‚æœæ–¹æ³•è°ƒç”¨çš„æ¬¡æ•°å¾ˆå¤šï¼Œé‚£ä¹ˆå¯ä»¥ç”¨-nå‚æ•°æŒ‡å®šæ•æ‰ç»“æœçš„æ¬¡æ•°ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­é‡Œï¼Œæ•æ‰åˆ°ä¸€æ¬¡è°ƒç”¨å°±é€€å‡ºå‘½ä»¤ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[arthas@<span class="number">8161</span>]$ trace --skipJDKMethod <span class="literal">false</span> demo.MathGame run -n <span class="number">3</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(<span class="keyword">class</span> <span class="title class_">count</span>: <span class="number">1</span> , method count: <span class="number">1</span>) cost in <span class="number">108</span> ms, listenerId: <span class="number">9</span></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> 09:<span class="number">33</span>:<span class="number">22.964</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    +---[<span class="number">0.</span>040626ms] java.util.Random:nextInt() #<span class="number">23</span></span><br><span class="line">    +---[<span class="number">0.</span>152629ms] demo.MathGame:primeFactors() #<span class="number">24</span></span><br><span class="line">    +---[<span class="number">0.</span>032551ms] demo.MathGame:print() #<span class="number">25</span></span><br><span class="line">    `---[<span class="number">3.</span>440639ms] demo.MathGame:run()</span><br><span class="line">        +---[<span class="number">9.98</span>% <span class="number">0.</span>343288ms ] java.util.Random:nextInt() #<span class="number">23</span></span><br><span class="line">        +---[<span class="number">17.64</span>% <span class="number">0.</span>607089ms ] demo.MathGame:primeFactors() #<span class="number">24</span> [<span class="keyword">throws</span> Exception]</span><br><span class="line">        +---[<span class="number">0.64</span>% <span class="number">0.</span>021935ms ] java.lang.StringBuilder:&lt;init&gt;() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">7.40</span>% <span class="number">0.</span>254695ms ] java.lang.String:format() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">1.37</span>% min=<span class="number">0.</span>01411ms,max=<span class="number">0.</span>03298ms,total=<span class="number">0.</span>04709ms,count=<span class="number">2</span>] java.lang.StringBuilder:append() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">1.20</span>% <span class="number">0.</span>041169ms ] java.lang.Exception:getMessage() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">0.64</span>% <span class="number">0.</span>022185ms ] java.lang.StringBuilder:toString() #<span class="number">28</span></span><br><span class="line">        `---[<span class="number">16.69</span>% <span class="number">0.</span>574324ms ] java.io.PrintStream:println() #<span class="number">28</span></span><br><span class="line"></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> 09:<span class="number">33</span>:<span class="number">25.119</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">1.</span>504503ms] demo.MathGame:run()</span><br><span class="line">        +---[<span class="number">1.70</span>% <span class="number">0.</span>025535ms ] java.util.Random:nextInt() #<span class="number">23</span></span><br><span class="line">        +---[<span class="number">5.34</span>% <span class="number">0.</span>080385ms ] demo.MathGame:primeFactors() #<span class="number">24</span> [<span class="keyword">throws</span> Exception]</span><br><span class="line">        +---[<span class="number">0.97</span>% <span class="number">0.</span>01455ms ] java.lang.StringBuilder:&lt;init&gt;() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">3.14</span>% <span class="number">0.</span>04719ms ] java.lang.String:format() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">1.90</span>% min=<span class="number">0.</span>014215ms,max=<span class="number">0.</span>01436ms,total=<span class="number">0.</span>028575ms,count=<span class="number">2</span>] java.lang.StringBuilder:append() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">7.98</span>% <span class="number">0.</span>12012ms ] java.lang.Exception:getMessage() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">0.88</span>% <span class="number">0.</span>013255ms ] java.lang.StringBuilder:toString() #<span class="number">28</span></span><br><span class="line">        `---[<span class="number">25.35</span>% <span class="number">0.</span>381384ms ] java.io.PrintStream:println() #<span class="number">28</span></span><br><span class="line"></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> 09:<span class="number">33</span>:<span class="number">26.136</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">0.</span>357443ms] demo.MathGame:run()</span><br><span class="line">        +---[<span class="number">2.92</span>% <span class="number">0.</span>01043ms ] java.util.Random:nextInt() #<span class="number">23</span></span><br><span class="line">        +---[<span class="number">12.37</span>% <span class="number">0.</span>044215ms ] demo.MathGame:primeFactors() #<span class="number">24</span> [<span class="keyword">throws</span> Exception]</span><br><span class="line">        +---[<span class="number">1.46</span>% <span class="number">0.</span>00521ms ] java.lang.StringBuilder:&lt;init&gt;() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">9.13</span>% <span class="number">0.</span>032649ms ] java.lang.String:format() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">2.90</span>% min=<span class="number">0.</span>004825ms,max=<span class="number">0.</span>00555ms,total=<span class="number">0.</span>010375ms,count=<span class="number">2</span>] java.lang.StringBuilder:append() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">1.49</span>% <span class="number">0.</span>00532ms ] java.lang.Exception:getMessage() #<span class="number">28</span></span><br><span class="line">        +---[<span class="number">1.34</span>% <span class="number">0.</span>004785ms ] java.lang.StringBuilder:toString() #<span class="number">28</span></span><br><span class="line">        `---[<span class="number">18.75</span>% <span class="number">0.</span>067035ms ] java.io.PrintStream:println() #<span class="number">28</span></span><br><span class="line"></span><br><span class="line">Command execution times exceed limit: <span class="number">3</span>, so command will exit. You can set it with -n option.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-3-æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤"><a href="#3-3-æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤" class="headerlink" title="3.3 æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤"></a><strong>3.3 æ ¹æ®è°ƒç”¨è€—æ—¶è¿‡æ»¤</strong></h3><p>åªä¼šå±•ç¤ºè€—æ—¶å¤§äº 2ms çš„è°ƒç”¨è·¯å¾„ï¼Œæœ‰åŠ©äºåœ¨æ’æŸ¥é—®é¢˜çš„æ—¶å€™ï¼Œåªå…³æ³¨å¼‚å¸¸æƒ…å†µ</p><aside>ğŸ’¡<ul><li>æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Œæ²¡é”™ï¼Œåœ¨ JProfiler ç­‰æ”¶è´¹è½¯ä»¶ä¸­ä½ æ›¾ç»è§è¯†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œè¿™é‡Œä½ å°†å¯ä»¥é€šè¿‡å‘½ä»¤å°±èƒ½æ‰“å°å‡ºæŒ‡å®šè°ƒç”¨è·¯å¾„ã€‚ å‹æƒ…æé†’ä¸‹ï¼Œ<code>trace</code>Â åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æœ¬èº«æ˜¯ä¼šæœ‰ä¸€å®šçš„æ€§èƒ½å¼€é”€ï¼Œåœ¨ç»Ÿè®¡çš„æŠ¥å‘Šä¸­å¹¶æœªåƒ JProfiler ä¸€æ ·é¢„å…ˆå‡å»å…¶è‡ªèº«çš„ç»Ÿè®¡å¼€é”€ã€‚æ‰€ä»¥è¿™ç»Ÿè®¡å‡ºæ¥æœ‰äº›è®¸çš„ä¸å‡†ï¼Œæ¸²æŸ“è·¯å¾„ä¸Šè°ƒç”¨çš„ç±»ã€æ–¹æ³•è¶Šå¤šï¼Œæ€§èƒ½åå·®è¶Šå¤§ã€‚ä½†è¿˜æ˜¯èƒ½è®©ä½ çœ‹æ¸…ä¸€äº›äº‹æƒ…çš„ã€‚</li><li>[12.033735ms] çš„å«ä¹‰ï¼Œ<code>12.033735</code>Â çš„å«ä¹‰æ˜¯ï¼šå½“å‰èŠ‚ç‚¹åœ¨å½“å‰æ­¥éª¤çš„è€—æ—¶ï¼Œå•ä½ä¸ºæ¯«ç§’</li><li>[0,0,0ms,11]xxx:yyy() [throws Exception]ï¼Œå¯¹è¯¥æ–¹æ³•ä¸­ç›¸åŒçš„æ–¹æ³•è°ƒç”¨è¿›è¡Œäº†åˆå¹¶ï¼Œ<code>0,0,0ms,11</code>Â è¡¨ç¤ºæ–¹æ³•è°ƒç”¨è€—æ—¶ï¼Œ<code>min,max,total,count</code>ï¼›<code>throws Exception</code>Â è¡¨æ˜è¯¥æ–¹æ³•è°ƒç”¨ä¸­å­˜åœ¨å¼‚å¸¸è¿”å›</li><li>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç»Ÿè®¡ä¸å‡†ç¡®çš„é—®é¢˜ï¼Œå°±æ˜¯æ‰€æœ‰æ–¹æ³•è€—æ—¶åŠ èµ·æ¥å¯èƒ½ä¼šå°äºè¯¥ç›‘æµ‹æ–¹æ³•çš„æ€»è€—æ—¶ï¼Œè¿™ä¸ªæ˜¯ç”±äº Arthas æœ¬èº«çš„é€»è¾‘ä¼šæœ‰ä¸€å®šçš„è€—æ—¶</aside></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">8161</span>]$ trace demo.MathGame run <span class="string">&#x27;#cost &gt; 0.5&#x27;</span> -n <span class="number">3</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(<span class="keyword">class</span> <span class="title class_">count</span>: <span class="number">1</span> , method count: <span class="number">1</span>) cost in <span class="number">87</span> ms, listenerId: <span class="number">12</span></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> 09:<span class="number">36</span>:<span class="number">31.428</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">0.</span>575073ms] demo.MathGame:run()</span><br><span class="line">        `---[<span class="number">56.12</span>% <span class="number">0.</span>322722ms ] demo.MathGame:primeFactors() #<span class="number">24</span> [<span class="keyword">throws</span> Exception]</span><br><span class="line"></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> 09:<span class="number">36</span>:<span class="number">33.467</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">2.</span>125056ms] demo.MathGame:run()</span><br><span class="line">        +---[<span class="number">65.45</span>% <span class="number">1.</span>390877ms ] demo.MathGame:primeFactors() #<span class="number">24</span></span><br><span class="line">        `---[<span class="number">23.98</span>% <span class="number">0.</span>509524ms ] demo.MathGame:print() #<span class="number">25</span></span><br><span class="line"></span><br><span class="line">`---ts=<span class="number">2025</span>-<span class="number">06</span>-<span class="number">07</span> 09:<span class="number">36</span>:<span class="number">37.491</span>;thread_name=main;id=<span class="number">1</span>;is_daemon=<span class="literal">false</span>;priority=<span class="number">5</span>;TCCL=jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c</span><br><span class="line">    `---[<span class="number">7.</span>300126ms] demo.MathGame:run()</span><br><span class="line">        +---[<span class="number">99.21</span>% <span class="number">7.</span>242667ms ] demo.MathGame:primeFactors() #<span class="number">24</span></span><br><span class="line">        `---[<span class="number">0.44</span>% <span class="number">0.</span>031904ms ] demo.MathGame:print() #<span class="number">25</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-stackå‘½ä»¤"><a href="#4-stackå‘½ä»¤" class="headerlink" title="4. stackå‘½ä»¤"></a>4. <strong>stackå‘½ä»¤</strong></h2><p>è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„</p><p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªæ–¹æ³•è¢«æ‰§è¡Œï¼Œä½†è¿™ä¸ªæ–¹æ³•è¢«æ‰§è¡Œçš„è·¯å¾„éå¸¸å¤šï¼Œæˆ–è€…ä½ æ ¹æœ¬å°±ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯ä»é‚£é‡Œè¢«æ‰§è¡Œäº†ï¼Œæ­¤æ—¶ä½ éœ€è¦çš„æ˜¯ stack å‘½ä»¤ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>condition-express</em></td><td>æ¡ä»¶è¡¨è¾¾å¼</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td><code>[n:]</code></td><td>æ‰§è¡Œæ¬¡æ•°é™åˆ¶</td></tr><tr><td><code>[m &lt;arg&gt;]</code></td><td>æŒ‡å®š Class æœ€å¤§åŒ¹é…æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 50ã€‚é•¿æ ¼å¼ä¸º<code>[maxMatch &lt;arg&gt;]</code>ã€‚</td></tr></tbody></table><aside>ğŸ’¡<p>è¿™é‡Œé‡ç‚¹è¦è¯´æ˜çš„æ˜¯è§‚å¯Ÿè¡¨è¾¾å¼ï¼Œè§‚å¯Ÿè¡¨è¾¾å¼çš„æ„æˆä¸»è¦ç”± ognl è¡¨è¾¾å¼ç»„æˆï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™<code>&quot;&#123;params,returnObj&#125;&quot;</code>ï¼Œåªè¦æ˜¯ä¸€ä¸ªåˆæ³•çš„ ognl è¡¨è¾¾å¼ï¼Œéƒ½èƒ½è¢«æ­£å¸¸æ”¯æŒã€‚</p><p>è§‚å¯Ÿçš„ç»´åº¦ä¹Ÿæ¯”è¾ƒå¤šï¼Œä¸»è¦ä½“ç°åœ¨å‚æ•°Â <code>advice</code>Â çš„æ•°æ®ç»“æ„ä¸Šã€‚<code>Advice</code>Â å‚æ•°æœ€ä¸»è¦æ˜¯å°è£…äº†é€šçŸ¥èŠ‚ç‚¹çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><p>è¯·å‚è€ƒ<a href="https://arthas.aliyun.com/doc/advice-class.html"><strong>è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</strong></a>ä¸­å…³äºè¯¥èŠ‚ç‚¹çš„æè¿°ã€‚</p><ul><li><p>ç‰¹æ®Šç”¨æ³•è¯·å‚è€ƒï¼š<a href="https://github.com/alibaba/arthas/issues/71"><strong>https://github.com/alibaba/arthas/issues/71</strong></a></p></li><li><p>OGNL è¡¨è¾¾å¼å®˜ç½‘ï¼š<a href="https://commons.apache.org/dormant/commons-ognl/language-guide.html"><strong>https://commons.apache.org/dormant/commons-ognl/language-guide.html</strong></a></p></aside></li><li><p><strong>ä½¿ç”¨æ¡ˆä¾‹</strong></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä½¿ç”¨stackå‘½ä»¤è·Ÿè¸ªprimeFactorsæ–¹æ³•</span></span><br><span class="line">[arthas@8161]$ stack demo.MathGame primeFactors</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 88 ms, listenerId: 14</span><br><span class="line">ts=2025-06-07 09:53:24.073;thread_name=main;<span class="built_in">id</span>=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c</span><br><span class="line">    @demo.MathGame.primeFactors()</span><br><span class="line">        at demo.MathGame.run(MathGame.java:24)</span><br><span class="line">        at demo.MathGame.main(null:16)</span><br><span class="line"></span><br><span class="line">ts=2025-06-07 09:53:25.077;thread_name=main;<span class="built_in">id</span>=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c</span><br><span class="line">    @demo.MathGame.primeFactors()</span><br><span class="line">        at demo.MathGame.run(MathGame.java:24)</span><br><span class="line">        at demo.MathGame.main(null:16)</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä½¿ç”¨OGNLè¡¨è¾¾å¼ï¼Œè¿‡æ»¤ç¬¬ä¸€ä¸ªå‚æ•°å€¼å°äº0çš„æ–¹æ³•è°ƒç”¨æƒ…å†µï¼Œå¹¶ä¸”åªæ‰“å°ä¸¤ä¸ªä¿¡æ¯æ•°æ®</span></span><br><span class="line">[arthas@8161]$ stack demo.MathGame primeFactors <span class="string">&#x27;params[0]&lt;0&#x27;</span> -n 2</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 85 ms, listenerId: 15</span><br><span class="line">ts=2025-06-07 09:53:57.220;thread_name=main;<span class="built_in">id</span>=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c</span><br><span class="line">    @demo.MathGame.primeFactors()</span><br><span class="line">        at demo.MathGame.run(MathGame.java:24)</span><br><span class="line">        at demo.MathGame.main(null:16)</span><br><span class="line"></span><br><span class="line">ts=2025-06-07 09:53:58.223;thread_name=main;<span class="built_in">id</span>=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c</span><br><span class="line">    @demo.MathGame.primeFactors()</span><br><span class="line">        at demo.MathGame.run(MathGame.java:24)</span><br><span class="line">        at demo.MathGame.main(null:16)</span><br><span class="line"></span><br><span class="line">Command execution <span class="built_in">times</span> exceed <span class="built_in">limit</span>: 2, so <span class="built_in">command</span> will <span class="built_in">exit</span>. You can <span class="built_in">set</span> it with -n option.</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä½¿ç”¨OGNLè¡¨è¾¾å¼ï¼Œè¿‡æ»¤è€—æ—¶å¤§äº2æ¯«ç§’çš„ä¿¡æ¯</span></span><br><span class="line">[arthas@8161]$ stack demo.MathGame primeFactors <span class="string">&#x27;#cost&gt;2&#x27;</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 84 ms, listenerId: 17</span><br><span class="line">ts=2025-06-07 09:56:40.903;thread_name=main;<span class="built_in">id</span>=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c</span><br><span class="line">    @demo.MathGame.primeFactors()</span><br><span class="line">        at demo.MathGame.run(MathGame.java:24)</span><br><span class="line">        at demo.MathGame.main(null:16)</span><br><span class="line"></span><br><span class="line">ts=2025-06-07 09:56:44.919;thread_name=main;<span class="built_in">id</span>=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c</span><br><span class="line">    @demo.MathGame.primeFactors()</span><br><span class="line">        at demo.MathGame.run(MathGame.java:24)</span><br><span class="line">        at demo.MathGame.main(null:16)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-ttå‘½ä»¤"><a href="#5-ttå‘½ä»¤" class="headerlink" title="5. ttå‘½ä»¤"></a>5. <strong>ttå‘½ä»¤</strong></h2><p>æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹</p><p><code>watch</code>Â è™½ç„¶å¾ˆæ–¹ä¾¿å’Œçµæ´»ï¼Œä½†éœ€è¦æå‰æƒ³æ¸…æ¥šè§‚å¯Ÿè¡¨è¾¾å¼çš„æ‹¼å†™ï¼Œè¿™å¯¹æ’æŸ¥é—®é¢˜è€Œè¨€è¦æ±‚å¤ªé«˜ï¼Œå› ä¸ºå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šé—®é¢˜å‡ºè‡ªäºä½•æ–¹ï¼Œåªèƒ½é è››ä¸é©¬è¿¹è¿›è¡ŒçŒœæµ‹ã€‚</p><p>è¿™ä¸ªæ—¶å€™å¦‚æœèƒ½è®°å½•ä¸‹å½“æ—¶æ–¹æ³•è°ƒç”¨çš„æ‰€æœ‰å…¥å‚å’Œè¿”å›å€¼ã€æŠ›å‡ºçš„å¼‚å¸¸ä¼šå¯¹æ•´ä¸ªé—®é¢˜çš„æ€è€ƒä¸åˆ¤æ–­éå¸¸æœ‰å¸®åŠ©ã€‚</p><p>äºæ˜¯ä¹ï¼ŒTimeTunnel å‘½ä»¤å°±è¯ç”Ÿäº†ã€‚</p><aside>ğŸ’¡<ol><li>tt å‘½ä»¤çš„å®ç°æ˜¯ï¼šæŠŠå‡½æ•°çš„å…¥å‚&#x2F;è¿”å›å€¼ç­‰ï¼Œä¿å­˜åˆ°ä¸€ä¸ª<code>Map&lt;Integer, TimeFragment&gt;</code>é‡Œï¼Œé»˜è®¤çš„å¤§å°æ˜¯ 100ã€‚</li><li>tt ç›¸å…³åŠŸèƒ½åœ¨ä½¿ç”¨å®Œä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œå¦åˆ™é•¿æ—¶é—´å¯èƒ½å¯¼è‡´OOMã€‚é€€å‡º arthas ä¸ä¼šè‡ªåŠ¨æ¸…é™¤ tt çš„ç¼“å­˜ map</aside></li></ol><ul><li>å‘½ä»¤å‚æ•°è§£æ<ul><li><p><code>t</code></p><p>  tt å‘½ä»¤æœ‰å¾ˆå¤šä¸ªä¸»å‚æ•°ï¼Œ<code>-t</code>Â å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚è¿™ä¸ªå‚æ•°çš„è¡¨æ˜å¸Œæœ›è®°å½•ä¸‹ç±»Â <code>*Test</code>Â çš„Â <code>print</code>Â æ–¹æ³•çš„æ¯æ¬¡æ‰§è¡Œæƒ…å†µã€‚</p></li><li><p><code>n 3</code></p><p>  å½“ä½ æ‰§è¡Œä¸€ä¸ªè°ƒç”¨é‡ä¸é«˜çš„æ–¹æ³•æ—¶å¯èƒ½ä½ è¿˜èƒ½æœ‰è¶³å¤Ÿçš„æ—¶é—´ç”¨Â <code>CTRL+C</code>Â ä¸­æ–­ tt å‘½ä»¤è®°å½•çš„è¿‡ç¨‹ï¼Œä½†å¦‚æœé‡åˆ°è°ƒç”¨é‡éå¸¸å¤§çš„æ–¹æ³•ï¼Œç¬é—´å°±èƒ½å°†ä½ çš„ JVM å†…å­˜æ’‘çˆ†ã€‚</p><p>  æ­¤æ—¶ä½ å¯ä»¥é€šè¿‡Â <code>-n</code>Â å‚æ•°æŒ‡å®šä½ éœ€è¦è®°å½•çš„æ¬¡æ•°ï¼Œå½“è¾¾åˆ°è®°å½•æ¬¡æ•°æ—¶ Arthas ä¼šä¸»åŠ¨ä¸­æ–­ tt å‘½ä»¤çš„è®°å½•è¿‡ç¨‹ï¼Œé¿å…äººå·¥æ“ä½œæ— æ³•åœæ­¢çš„æƒ…å†µã€‚</p></li><li><p><code>m 1</code></p><p>  é€šè¿‡Â <code>-m</code>Â å‚æ•°æŒ‡å®š Class åŒ¹é…çš„æœ€å¤§æ•°é‡ï¼Œé˜²æ­¢åŒ¹é…åˆ°çš„ Class æ•°é‡å¤ªå¤šå¯¼è‡´ JVM æŒ‚èµ·ï¼Œé»˜è®¤å€¼æ˜¯ 50ã€‚</p></li></ul></li></ul><h3 id="5-1-æ‰§è¡Œå‘½ä»¤ï¼štt-t-demo-MathGame-primeFactors"><a href="#5-1-æ‰§è¡Œå‘½ä»¤ï¼štt-t-demo-MathGame-primeFactors" class="headerlink" title="5.1 æ‰§è¡Œå‘½ä»¤ï¼štt -t demo.MathGame primeFactors"></a>5.1 æ‰§è¡Œå‘½ä»¤ï¼štt -t demo.MathGame primeFactors</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ tt -t demo.MathGame primeFactors</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 85 ms, listenerId: 18</span><br><span class="line"> INDEX            TIMESTAMP                                 COST(ms)             IS-RET          IS-EXP           OBJECT                         CLASS                                                          METHOD                                                        </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000             2025-06-07 10:07:44.617                   0.227622             <span class="literal">false</span>           <span class="literal">true</span>             0x589838eb                     MathGame                                                       primeFactors                                                  </span><br><span class="line"> 1001             2025-06-07 10:07:45.621                   0.07812              <span class="literal">false</span>           <span class="literal">true</span>             0x589838eb                     MathGame                                                       primeFactors                                                  </span><br><span class="line"> 1002             2025-06-07 10:07:46.623                   0.091644             <span class="literal">false</span>           <span class="literal">true</span>             0x589838eb                     MathGame                                                       primeFactors                                                  </span><br><span class="line"> 1003             2025-06-07 10:07:47.628                   3.676343             <span class="literal">true</span>            <span class="literal">false</span>            0x589838eb                     MathGame                                                       primeFactors                                                  </span><br><span class="line"> 1004             2025-06-07 10:07:48.631                   0.05122              <span class="literal">false</span>           <span class="literal">true</span>             0x589838eb                     MathGame                                                       primeFactors  </span><br></pre></td></tr></table></figure><ul><li>è¡¨æ ¼å­—æ®µè¯´æ˜</li></ul><table><thead><tr><th>è¡¨æ ¼å­—æ®µ</th><th>å­—æ®µè§£é‡Š</th></tr></thead><tbody><tr><td>INDEX</td><td>æ—¶é—´ç‰‡æ®µè®°å½•ç¼–å·ï¼Œæ¯ä¸€ä¸ªç¼–å·ä»£è¡¨ç€ä¸€æ¬¡è°ƒç”¨ï¼Œåç»­ tt è¿˜æœ‰å¾ˆå¤šå‘½ä»¤éƒ½æ˜¯åŸºäºæ­¤ç¼–å·æŒ‡å®šè®°å½•æ“ä½œï¼Œéå¸¸é‡è¦ã€‚</td></tr><tr><td>TIMESTAMP</td><td>æ–¹æ³•æ‰§è¡Œçš„æœ¬æœºæ—¶é—´ï¼Œè®°å½•äº†è¿™ä¸ªæ—¶é—´ç‰‡æ®µæ‰€å‘ç”Ÿçš„æœ¬æœºæ—¶é—´</td></tr><tr><td>COST(ms)</td><td>æ–¹æ³•æ‰§è¡Œçš„è€—æ—¶</td></tr><tr><td>IS-RET</td><td>æ–¹æ³•æ˜¯å¦ä»¥æ­£å¸¸è¿”å›çš„å½¢å¼ç»“æŸ</td></tr><tr><td>IS-EXP</td><td>æ–¹æ³•æ˜¯å¦ä»¥æŠ›å¼‚å¸¸çš„å½¢å¼ç»“æŸ</td></tr><tr><td>OBJECT</td><td>æ‰§è¡Œå¯¹è±¡çš„<code>hashCode()</code>ï¼Œæ³¨æ„ï¼Œæ›¾ç»æœ‰äººè¯¯è®¤ä¸ºæ˜¯å¯¹è±¡åœ¨ JVM ä¸­çš„å†…å­˜åœ°å€ï¼Œä½†å¾ˆé—æ†¾ä»–ä¸æ˜¯ã€‚ä½†ä»–èƒ½å¸®åŠ©ä½ ç®€å•çš„æ ‡è®°å½“å‰æ‰§è¡Œæ–¹æ³•çš„ç±»å®ä½“</td></tr><tr><td>CLASS</td><td>æ‰§è¡Œçš„ç±»å</td></tr><tr><td>METHOD</td><td>æ‰§è¡Œçš„æ–¹æ³•å</td></tr></tbody></table><ul><li><p>æ¡ä»¶è¡¨è¾¾å¼</p><p>  ä¸çŸ¥é“å¤§å®¶æ˜¯å¦æœ‰åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»¥ä¸‹å›°æƒ‘</p><ul><li>Arthas ä¼¼ä¹å¾ˆéš¾åŒºåˆ†å‡ºé‡è½½çš„æ–¹æ³•</li><li>æˆ‘åªéœ€è¦è§‚å¯Ÿç‰¹å®šå‚æ•°ï¼Œä½†æ˜¯ tt å´å…¨éƒ¨éƒ½ç»™æˆ‘è®°å½•äº†ä¸‹æ¥</li></ul><p>  æ¡ä»¶è¡¨è¾¾å¼ä¹Ÿæ˜¯ç”¨Â <code>OGNL</code>Â æ¥ç¼–å†™ï¼Œæ ¸å¿ƒçš„åˆ¤æ–­å¯¹è±¡ä¾ç„¶æ˜¯Â <code>Advice</code>Â å¯¹è±¡ã€‚é™¤äº†Â <code>tt</code>Â å‘½ä»¤ä¹‹å¤–ï¼Œ<code>watch</code>ã€<code>trace</code>ã€<code>stack</code>Â å‘½ä»¤ä¹Ÿéƒ½æ”¯æŒæ¡ä»¶è¡¨è¾¾å¼ã€‚  </p></li><li><p>è§£å†³æ–¹æ³•é‡è½½</p><p>  <code>tt -t *Test print params.length==1</code></p><p>  é€šè¿‡åˆ¶å®šå‚æ•°ä¸ªæ•°çš„å½¢å¼è§£å†³ä¸åŒçš„æ–¹æ³•ç­¾åï¼Œå¦‚æœå‚æ•°ä¸ªæ•°ä¸€æ ·ï¼Œä½ è¿˜å¯ä»¥è¿™æ ·å†™</p><p>  <code>tt -t *Test print &#39;params[1] instanceof Integer&#39;</code></p></li><li><p>è§£å†³æŒ‡å®šå‚æ•°</p><p>  <code>tt -t *Test print params[0].mobile==&quot;13989838402&quot;</code></p></li><li><p>æ„æˆæ¡ä»¶è¡¨è¾¾å¼çš„Â <code>Advice</code>Â å¯¹è±¡</p><p>  å‰è¾¹çœ‹åˆ°äº†å¾ˆå¤šæ¡ä»¶è¡¨è¾¾å¼ä¸­ï¼Œéƒ½ä½¿ç”¨äº†Â <code>params[0]</code>ï¼Œæœ‰å…³è¿™ä¸ªå˜é‡çš„ä»‹ç»ï¼Œè¯·å‚è€ƒ<a href="https://arthas.aliyun.com/doc/advice-class.html"><strong>è¡¨è¾¾å¼æ ¸å¿ƒå˜é‡</strong></a></p></li></ul><h3 id="5-2-æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯"><a href="#5-2-æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯" class="headerlink" title="5.2 æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯"></a>5.2 <strong>æŸ¥çœ‹è°ƒç”¨ä¿¡æ¯</strong></h3><p>å¯¹äºå…·ä½“ä¸€ä¸ªæ—¶é—´ç‰‡çš„ä¿¡æ¯è€Œè¨€ï¼Œä½ å¯ä»¥é€šè¿‡Â <code>-i</code>Â å‚æ•°åè¾¹è·Ÿç€å¯¹åº”çš„Â <code>INDEX</code>Â ç¼–å·æŸ¥çœ‹åˆ°ä»–çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ tt -i 1004</span><br><span class="line"> INDEX            1004                                                                                                                                                                                                                                                        </span><br><span class="line"> GMT-CREATE       2025-06-07 10:07:48.631                                                                                                                                                                                                                                     </span><br><span class="line"> COST(ms)         0.05122                                                                                                                                                                                                                                                     </span><br><span class="line"> OBJECT           0x589838eb                                                                                                                                                                                                                                                  </span><br><span class="line"> CLASS            demo.MathGame                                                                                                                                                                                                                                               </span><br><span class="line"> METHOD           primeFactors                                                                                                                                                                                                                                                </span><br><span class="line"> IS-RETURN        <span class="literal">false</span>                                                                                                                                                                                                                                                       </span><br><span class="line"> IS-EXCEPTION     <span class="literal">true</span>                                                                                                                                                                                                                                                        </span><br><span class="line"> PARAMETERS[0]    @Integer[-67793]                                                                                                                                                                                                                                            </span><br><span class="line"> THROW-EXCEPTION  java.lang.IllegalArgumentException: number is: -67793, need &gt;= 2                                                                                                                                                                                            </span><br><span class="line">                  at demo.MathGame.primeFactors(MathGame.java:46)                                                                                                                                                                                                            </span><br><span class="line">                  at demo.MathGame.run(MathGame.java:24)                                                                                                                                                                                                                     </span><br><span class="line">                  at demo.MathGame.main(Unknown Source)                                                                                                                                                                                                                      </span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 3 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-3-é‡åšä¸€æ¬¡è°ƒç”¨"><a href="#5-3-é‡åšä¸€æ¬¡è°ƒç”¨" class="headerlink" title="5.3 é‡åšä¸€æ¬¡è°ƒç”¨"></a><strong>5.3 é‡åšä¸€æ¬¡è°ƒç”¨</strong></h3><p>å½“ä½ ç¨ç¨åšäº†ä¸€äº›è°ƒæ•´ä¹‹åï¼Œä½ å¯èƒ½éœ€è¦å‰ç«¯ç³»ç»Ÿé‡æ–°è§¦å‘ä¸€æ¬¡ä½ çš„è°ƒç”¨ï¼Œæ­¤æ—¶å¾—æ±‚çˆ·çˆ·å‘Šå¥¶å¥¶çš„éœ€è¦å‰ç«¯é…åˆè”è°ƒçš„åŒå­¦å†æ¬¡å‘èµ·ä¸€æ¬¡è°ƒç”¨ã€‚è€Œæœ‰äº›åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªè°ƒç”¨ä¸æ˜¯è¿™ä¹ˆå¥½è§¦å‘çš„ã€‚</p><p><code>tt</code>Â å‘½ä»¤ç”±äºä¿å­˜äº†å½“æ—¶è°ƒç”¨çš„æ‰€æœ‰ç°åœºä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±ä¸»åŠ¨å¯¹ä¸€ä¸ªÂ <code>INDEX</code>Â ç¼–å·çš„æ—¶é—´ç‰‡è‡ªä¸»å‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œä»è€Œè§£æ”¾ä½ çš„æ²Ÿé€šæˆæœ¬ã€‚æ­¤æ—¶ä½ éœ€è¦Â <code>-p</code>Â å‚æ•°ã€‚é€šè¿‡Â <code>--replay-times</code>Â æŒ‡å®š è°ƒç”¨æ¬¡æ•°ï¼Œé€šè¿‡Â <code>--replay-interval</code>Â æŒ‡å®šå¤šæ¬¡è°ƒç”¨é—´éš”(å•ä½ ms, é»˜è®¤ 1000ms)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ tt -i 1004 -p</span><br><span class="line"> RE-INDEX         1004                                                                                                                                                                                                                                                        </span><br><span class="line"> GMT-REPLAY       2025-06-07 10:15:36.439                                                                                                                                                                                                                                     </span><br><span class="line"> OBJECT           0x589838eb                                                                                                                                                                                                                                                  </span><br><span class="line"> CLASS            demo.MathGame                                                                                                                                                                                                                                               </span><br><span class="line"> METHOD           primeFactors                                                                                                                                                                                                                                                </span><br><span class="line"> PARAMETERS[0]    @Integer[-67793]                                                                                                                                                                                                                                            </span><br><span class="line"> IS-RETURN        <span class="literal">false</span>                                                                                                                                                                                                                                                       </span><br><span class="line"> IS-EXCEPTION     <span class="literal">true</span>                                                                                                                                                                                                                                                        </span><br><span class="line"> THROW-EXCEPTION  java.lang.IllegalArgumentException: number is: -67793, need &gt;= 2                                                                                                                                                                                            </span><br><span class="line">                  at demo.MathGame.primeFactors(MathGame.java:46)                                                                                                                                                                                                            </span><br><span class="line">                  at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)                                                                                                                                                                          </span><br><span class="line">                  at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)                                                                                                                                                        </span><br><span class="line">                  at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)                                                                                                                                                </span><br><span class="line">                  at java.base/java.lang.reflect.Method.invoke(Method.java:566)                                                                                                                                                                                              </span><br><span class="line">                  at com.taobao.arthas.core.advisor.ArthasMethod.invoke(ArthasMethod.java:155)                                                                                                                                                                               </span><br><span class="line">                  at com.taobao.arthas.core.command.monitor200.TimeTunnelCommand.processPlay(TimeTunnelCommand.java:517)                                                                                                                                                     </span><br><span class="line">                  at com.taobao.arthas.core.command.monitor200.TimeTunnelCommand.process(TimeTunnelCommand.java:278)                                                                                                                                                         </span><br><span class="line">                  at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.process(AnnotatedCommandImpl.java:82)                                                                                                                                                    </span><br><span class="line">                  at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.access<span class="variable">$100</span>(AnnotatedCommandImpl.java:18)                                                                                                                                                 </span><br><span class="line">                  at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl<span class="variable">$ProcessHandler</span>.handle(AnnotatedCommandImpl.java:111)                                                                                                                                     </span><br><span class="line">                  at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl<span class="variable">$ProcessHandler</span>.handle(AnnotatedCommandImpl.java:108)                                                                                                                                     </span><br><span class="line">                  at com.taobao.arthas.core.shell.system.impl.ProcessImpl<span class="variable">$CommandProcessTask</span>.run(ProcessImpl.java:385)                                                                                                                                                       </span><br><span class="line">                  at java.base/java.util.concurrent.Executors<span class="variable">$RunnableAdapter</span>.call(Executors.java:515)                                                                                                                                                                       </span><br><span class="line">                  at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)                                                                                                                                                                                      </span><br><span class="line">                  at java.base/java.util.concurrent.ScheduledThreadPoolExecutor<span class="variable">$ScheduledFutureTask</span>.run(ScheduledThreadPoolExecutor.java:304)                                                                                                                                </span><br><span class="line">                  at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)                                                                                                                                                               </span><br><span class="line">                  at java.base/java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:628)                                                                                                                                                               </span><br><span class="line">                  at java.base/java.lang.Thread.run(Thread.java:834)                                                                                                                                                                                                         </span><br><span class="line">Time fragment[1004] successfully replayed 1 <span class="built_in">times</span>.</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ–¹æ³•æ‰§è¡Œç›‘æ§</summary>
    
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/tags/Arthas/"/>
    
    <category term="Arthasè¯Šæ–­å·¥å…·" scheme="https://yuanxw.github.io/tags/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Arthasè¯Šæ–­å·¥å…·(å››)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰class/classloaderç›¸å…³å‘½ä»¤</title>
    <link href="https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E5%9B%9B)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89class%20classloader%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"/>
    <id>https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E5%9B%9B)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89class%20classloader%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</id>
    <published>2023-03-03T16:00:00.000Z</published>
    <updated>2025-09-03T15:50:11.076Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasè¯Šæ–­å·¥å…·-å››-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰class-classloaderç›¸å…³å‘½ä»¤"><a href="#Arthasè¯Šæ–­å·¥å…·-å››-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰class-classloaderç›¸å…³å‘½ä»¤" class="headerlink" title="Arthasè¯Šæ–­å·¥å…·(å››)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰class&#x2F;classloaderç›¸å…³å‘½ä»¤"></a>Arthasè¯Šæ–­å·¥å…·(å››)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰class&#x2F;classloaderç›¸å…³å‘½ä»¤</h1><h2 id="1-scå‘½ä»¤"><a href="#1-scå‘½ä»¤" class="headerlink" title="1. scå‘½ä»¤"></a>1. <strong>scå‘½ä»¤</strong></h2><p>æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯ï¼Œ</p><p>â€œSearch-Classâ€ çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Class ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤æ”¯æŒçš„å‚æ•°æœ‰Â <code>[d]</code>ã€<code>[E]</code>ã€<code>[f]</code>Â å’ŒÂ <code>[x:]</code>ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td>[d]</td><td>è¾“å‡ºå½“å‰ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªç±»æ‰€åŠ è½½çš„åŸå§‹æ–‡ä»¶æ¥æºã€ç±»çš„å£°æ˜ã€åŠ è½½çš„ ClassLoader ç­‰è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœä¸€ä¸ªç±»è¢«å¤šä¸ª ClassLoader æ‰€åŠ è½½ï¼Œåˆ™ä¼šå‡ºç°å¤šæ¬¡</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td>[f]</td><td>è¾“å‡ºå½“å‰ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼ˆéœ€è¦é…åˆå‚æ•°-d ä¸€èµ·ä½¿ç”¨ï¼‰</td></tr><tr><td>[x:]</td><td>æŒ‡å®šè¾“å‡ºé™æ€å˜é‡æ—¶å±æ€§çš„éå†æ·±åº¦ï¼Œé»˜è®¤ä¸º 0ï¼Œå³ç›´æ¥ä½¿ç”¨Â <code>toString</code>Â è¾“å‡º</td></tr><tr><td><code>[c:]</code></td><td>æŒ‡å®š class çš„ ClassLoader çš„ hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td><code>[n:]</code></td><td>å…·æœ‰è¯¦ç»†ä¿¡æ¯çš„åŒ¹é…ç±»çš„æœ€å¤§æ•°é‡ï¼ˆé»˜è®¤ä¸º 100ï¼‰</td></tr><tr><td><code>[cs &lt;arg&gt;]</code></td><td>æŒ‡å®š class çš„ ClassLoader#toString() è¿”å›å€¼ã€‚é•¿æ ¼å¼<code>[classLoaderStr &lt;arg&gt;]</code></td></tr></tbody></table><ul><li><p><strong>æç¤º</strong></p><ol><li>class-pattern æ”¯æŒå…¨é™å®šåï¼Œå¦‚ com.taobao.test.AAAï¼Œä¹Ÿæ”¯æŒ com&#x2F;taobao&#x2F;test&#x2F;AAA è¿™æ ·çš„æ ¼å¼ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬ä»å¼‚å¸¸å †æ ˆé‡Œé¢æŠŠç±»åæ‹·è´è¿‡æ¥çš„æ—¶å€™ï¼Œä¸éœ€è¦åœ¨æ‰‹åŠ¨æŠŠ<code>/</code>æ›¿æ¢ä¸º<code>.</code>å•¦ã€‚</li><li>sc é»˜è®¤å¼€å¯äº†å­ç±»åŒ¹é…åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å½“å‰ç±»çš„å­ç±»ä¹Ÿä¼šè¢«æœç´¢å‡ºæ¥ï¼Œæƒ³è¦ç²¾ç¡®çš„åŒ¹é…ï¼Œè¯·æ‰“å¼€<code>options disable-sub-class true</code>å¼€å…³</li></ol></li><li><p><strong>ä½¿ç”¨å‚è€ƒ</strong></p><ul><li>æ¨¡ç³Šæœç´¢</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ sc demo.*</span><br><span class="line">demo.MathGame</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 17 ms.</span><br></pre></td></tr></table></figure><ul><li>æ‰“å°ç±»çš„è¯¦ç»†ä¿¡æ¯</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ sc -d demo.MathGame</span><br><span class="line"> class-info        demo.MathGame                                                                                                                                                                                                                                              </span><br><span class="line"> code-source       /usr/local/software/arthas/math-game.jar                                                                                                                                                                                                                   </span><br><span class="line"> name              demo.MathGame                                                                                                                                                                                                                                              </span><br><span class="line"> isInterface       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnnotation      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isEnum            <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnonymousClass  <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isArray           <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isLocalClass      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isMemberClass     <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isPrimitive       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isSynthetic       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> simple-name       MathGame                                                                                                                                                                                                                                                   </span><br><span class="line"> modifier          public                                                                                                                                                                                                                                                     </span><br><span class="line"> annotation                                                                                                                                                                                                                                                                   </span><br><span class="line"> interfaces                                                                                                                                                                                                                                                                   </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                                                                                                                                         </span><br><span class="line"> class-loader      +-jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c                                                                                                                                                                                                 </span><br><span class="line">                     +-jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@38755edd                                                                                                                                                                                          </span><br><span class="line"> classLoaderHash   4b85612c                                                                                                                                                                                                                                                   </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 21 ms.</span><br></pre></td></tr></table></figure><ul><li>æ‰“å°å‡ºç±»çš„ Field ä¿¡æ¯</li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ sc -d -f demo.MathGame</span><br><span class="line"> class-info        demo.MathGame                                                                                                                                                                                                                                              </span><br><span class="line"> code-source       /usr/local/software/arthas/math-game.jar                                                                                                                                                                                                                   </span><br><span class="line"> name              demo.MathGame                                                                                                                                                                                                                                              </span><br><span class="line"> isInterface       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnnotation      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isEnum            <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnonymousClass  <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isArray           <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isLocalClass      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isMemberClass     <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isPrimitive       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isSynthetic       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> simple-name       MathGame                                                                                                                                                                                                                                                   </span><br><span class="line"> modifier          public                                                                                                                                                                                                                                                     </span><br><span class="line"> annotation                                                                                                                                                                                                                                                                   </span><br><span class="line"> interfaces                                                                                                                                                                                                                                                                   </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                                                                                                                                         </span><br><span class="line"> class-loader      +-jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c                                                                                                                                                                                                 </span><br><span class="line">                     +-jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@38755edd                                                                                                                                                                                          </span><br><span class="line"> classLoaderHash   4b85612c                                                                                                                                                                                                                                                   </span><br><span class="line"> fields            name     random                                                                                                                                                                                                                                            </span><br><span class="line">                   <span class="built_in">type</span>     java.util.Random                                                                                                                                                                                                                                  </span><br><span class="line">                   modifier private,static                                                                                                                                                                                                                                    </span><br><span class="line">                   value    java.util.Random@464dde8d                                                                                                                                                                                                                         </span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">                   name     illegalArgumentCount                                                                                                                                                                                                                              </span><br><span class="line">                   <span class="built_in">type</span>     int                                                                                                                                                                                                                                               </span><br><span class="line">                   modifier private                                                                                                                                                                                                                                           </span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 23 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h2 id="2-sm-å‘½ä»¤"><a href="#2-sm-å‘½ä»¤" class="headerlink" title="2. sm å‘½ä»¤"></a>2. <strong>sm å‘½ä»¤</strong></h2><p>æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯ï¼Œâ€œSearch-Methodâ€ çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½äº† Class ä¿¡æ¯çš„æ–¹æ³•ä¿¡æ¯ã€‚</p><p><code>sm</code>Â å‘½ä»¤åªèƒ½çœ‹åˆ°ç”±å½“å‰ç±»æ‰€å£°æ˜ (declaring) çš„æ–¹æ³•ï¼Œçˆ¶ç±»åˆ™æ— æ³•çœ‹åˆ°ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><em>method-pattern</em></td><td>æ–¹æ³•åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td>[d]</td><td>å±•ç¤ºæ¯ä¸ªæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr><tr><td><code>[c:]</code></td><td>æŒ‡å®š class çš„ ClassLoader çš„ hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td><code>[n:]</code></td><td>å…·æœ‰è¯¦ç»†ä¿¡æ¯çš„åŒ¹é…ç±»çš„æœ€å¤§æ•°é‡ï¼ˆé»˜è®¤ä¸º 100ï¼‰</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">7339</span>]$ sm java.lang.String</span><br><span class="line">java.lang.String &lt;init&gt;([B)V</span><br><span class="line">java.lang.String &lt;init&gt;([BII)V</span><br><span class="line">java.lang.String &lt;init&gt;([BLjava/nio/charset/Charset;)V</span><br><span class="line">java.lang.String &lt;init&gt;([BLjava/lang/String;)V</span><br><span class="line">java.lang.String &lt;init&gt;([BIILjava/nio/charset/Charset;)V</span><br><span class="line">java.lang.String &lt;init&gt;([CIILjava/lang/Void;)V</span><br><span class="line">java.lang.String &lt;init&gt;(Ljava/lang/AbstractStringBuilder;Ljava/lang/Void;)V</span><br><span class="line">java.lang.String &lt;init&gt;(Ljava/lang/StringBuilder;)V</span><br><span class="line">java.lang.String &lt;init&gt;(Ljava/lang/StringBuffer;)V</span><br><span class="line">java.lang.String &lt;init&gt;([BB)V</span><br><span class="line">java.lang.String &lt;init&gt;([CII)V</span><br><span class="line">java.lang.String &lt;init&gt;([C)V</span><br><span class="line">java.lang.String &lt;init&gt;(Ljava/lang/String;)V</span><br><span class="line">java.lang.String &lt;init&gt;()V</span><br><span class="line">java.lang.String &lt;init&gt;([BIILjava/lang/String;)V</span><br><span class="line">java.lang.String &lt;init&gt;([BI)V</span><br><span class="line">java.lang.String &lt;init&gt;([BIII)V</span><br><span class="line">java.lang.String &lt;init&gt;([III)V</span><br><span class="line">java.lang.String <span class="title function_">value</span><span class="params">()</span>[B</span><br><span class="line">java.lang.String <span class="title function_">equals</span><span class="params">(Ljava/lang/Object;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">length</span><span class="params">()</span>I</span><br><span class="line">java.lang.String <span class="title function_">toString</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">hashCode</span><span class="params">()</span>I</span><br><span class="line">java.lang.String <span class="title function_">getChars</span><span class="params">(II[CI)</span>V</span><br><span class="line">java.lang.String <span class="title function_">compareTo</span><span class="params">(Ljava/lang/String;)</span>I</span><br><span class="line">java.lang.String <span class="title function_">compareTo</span><span class="params">(Ljava/lang/Object;)</span>I</span><br><span class="line">java.lang.String <span class="title function_">indexOf</span><span class="params">(Ljava/lang/String;I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">indexOf</span><span class="params">(I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">indexOf</span><span class="params">([BBILjava/lang/String;I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">indexOf</span><span class="params">(II)</span>I</span><br><span class="line">java.lang.String <span class="title function_">indexOf</span><span class="params">(Ljava/lang/String;)</span>I</span><br><span class="line">java.lang.String <span class="title function_">checkIndex</span><span class="params">(II)</span>V</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">(I)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">(F)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">(Z)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">(J)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">(D)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">(Ljava/lang/Object;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">(C)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">([C)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">valueOf</span><span class="params">([CII)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">coder</span><span class="params">()</span>B</span><br><span class="line">java.lang.String <span class="title function_">rangeCheck</span><span class="params">([CII)</span>Ljava/lang/Void;</span><br><span class="line">java.lang.String <span class="title function_">codePoints</span><span class="params">()</span>Ljava/util/stream/IntStream;</span><br><span class="line">java.lang.String <span class="title function_">isEmpty</span><span class="params">()</span>Z</span><br><span class="line">java.lang.String <span class="title function_">charAt</span><span class="params">(I)</span>C</span><br><span class="line">java.lang.String <span class="title function_">codePointAt</span><span class="params">(I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">codePointBefore</span><span class="params">(I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">codePointCount</span><span class="params">(II)</span>I</span><br><span class="line">java.lang.String <span class="title function_">offsetByCodePoints</span><span class="params">(II)</span>I</span><br><span class="line">java.lang.String <span class="title function_">getBytes</span><span class="params">(Ljava/nio/charset/Charset;)</span>[B</span><br><span class="line">java.lang.String <span class="title function_">getBytes</span><span class="params">(II[BI)</span>V</span><br><span class="line">java.lang.String <span class="title function_">getBytes</span><span class="params">(Ljava/lang/String;)</span>[B</span><br><span class="line">java.lang.String <span class="title function_">getBytes</span><span class="params">()</span>[B</span><br><span class="line">java.lang.String <span class="title function_">getBytes</span><span class="params">([BIB)</span>V</span><br><span class="line">java.lang.String <span class="title function_">contentEquals</span><span class="params">(Ljava/lang/StringBuffer;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">contentEquals</span><span class="params">(Ljava/lang/CharSequence;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">nonSyncContentEquals</span><span class="params">(Ljava/lang/AbstractStringBuilder;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">equalsIgnoreCase</span><span class="params">(Ljava/lang/String;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">compareToIgnoreCase</span><span class="params">(Ljava/lang/String;)</span>I</span><br><span class="line">java.lang.String <span class="title function_">regionMatches</span><span class="params">(ZILjava/lang/String;II)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">regionMatches</span><span class="params">(ILjava/lang/String;II)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">startsWith</span><span class="params">(Ljava/lang/String;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">startsWith</span><span class="params">(Ljava/lang/String;I)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">endsWith</span><span class="params">(Ljava/lang/String;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">lastIndexOf</span><span class="params">(I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">lastIndexOf</span><span class="params">([BBILjava/lang/String;I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">lastIndexOf</span><span class="params">(Ljava/lang/String;I)</span>I</span><br><span class="line">java.lang.String <span class="title function_">lastIndexOf</span><span class="params">(Ljava/lang/String;)</span>I</span><br><span class="line">java.lang.String <span class="title function_">lastIndexOf</span><span class="params">(II)</span>I</span><br><span class="line">java.lang.String <span class="title function_">substring</span><span class="params">(II)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">substring</span><span class="params">(I)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">subSequence</span><span class="params">(II)</span>Ljava/lang/CharSequence;</span><br><span class="line">java.lang.String <span class="title function_">concat</span><span class="params">(Ljava/lang/String;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">replace</span><span class="params">(Ljava/lang/CharSequence;Ljava/lang/CharSequence;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">replace</span><span class="params">(CC)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">matches</span><span class="params">(Ljava/lang/String;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">contains</span><span class="params">(Ljava/lang/CharSequence;)</span>Z</span><br><span class="line">java.lang.String <span class="title function_">replaceFirst</span><span class="params">(Ljava/lang/String;Ljava/lang/String;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">replaceAll</span><span class="params">(Ljava/lang/String;Ljava/lang/String;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">split</span><span class="params">(Ljava/lang/String;)</span>[Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">split</span><span class="params">(Ljava/lang/String;I)</span>[Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">join</span><span class="params">(Ljava/lang/CharSequence;[Ljava/lang/CharSequence;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">join</span><span class="params">(Ljava/lang/CharSequence;Ljava/lang/Iterable;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">toLowerCase</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">toLowerCase</span><span class="params">(Ljava/util/Locale;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">toUpperCase</span><span class="params">(Ljava/util/Locale;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">toUpperCase</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">trim</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">strip</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">stripLeading</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">stripTrailing</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">isBlank</span><span class="params">()</span>Z</span><br><span class="line">java.lang.String <span class="title function_">indexOfNonWhitespace</span><span class="params">()</span>I</span><br><span class="line">java.lang.String <span class="title function_">lines</span><span class="params">()</span>Ljava/util/stream/Stream;</span><br><span class="line">java.lang.String <span class="title function_">chars</span><span class="params">()</span>Ljava/util/stream/IntStream;</span><br><span class="line">java.lang.String <span class="title function_">toCharArray</span><span class="params">()</span>[C</span><br><span class="line">java.lang.String <span class="title function_">format</span><span class="params">(Ljava/lang/String;[Ljava/lang/Object;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">format</span><span class="params">(Ljava/util/Locale;Ljava/lang/String;[Ljava/lang/Object;)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">copyValueOf</span><span class="params">([CII)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">copyValueOf</span><span class="params">([C)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">intern</span><span class="params">()</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">repeat</span><span class="params">(I)</span>Ljava/lang/String;</span><br><span class="line">java.lang.String <span class="title function_">isLatin1</span><span class="params">()</span>Z</span><br><span class="line">java.lang.String <span class="title function_">checkOffset</span><span class="params">(II)</span>V</span><br><span class="line">java.lang.String <span class="title function_">checkBoundsOffCount</span><span class="params">(III)</span>V</span><br><span class="line">java.lang.String <span class="title function_">checkBoundsBeginEnd</span><span class="params">(III)</span>V</span><br><span class="line">java.lang.String <span class="title function_">valueOfCodePoint</span><span class="params">(I)</span>Ljava/lang/String;</span><br><span class="line">Affect(row-cnt:<span class="number">108</span>) cost in <span class="number">29</span> ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>å±•ç¤ºæ¯ä¸ªæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ sm -d java.lang.String toString</span><br><span class="line"> declaring-class  java.lang.String                                                                                                                                                                                                                                            </span><br><span class="line"> method-name      toString                                                                                                                                                                                                                                                    </span><br><span class="line"> modifier         public                                                                                                                                                                                                                                                      </span><br><span class="line"> annotation                                                                                                                                                                                                                                                                   </span><br><span class="line"> parameters                                                                                                                                                                                                                                                                   </span><br><span class="line"> <span class="built_in">return</span>           java.lang.String                                                                                                                                                                                                                                            </span><br><span class="line"> exceptions                                                                                                                                                                                                                                                                   </span><br><span class="line"> classLoaderHash  null                                                                                                                                                                                                                                                        </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 14 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-jad-å‘½ä»¤"><a href="#3-jad-å‘½ä»¤" class="headerlink" title="3. jad å‘½ä»¤"></a>3. <strong>jad å‘½ä»¤</strong></h2><p>åç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç </p><p><code>jad</code>Â å‘½ä»¤å°† JVM ä¸­å®é™…è¿è¡Œçš„ class çš„ byte code åç¼–è¯‘æˆ java ä»£ç ï¼Œä¾¿äºä½ ç†è§£ä¸šåŠ¡é€»è¾‘ï¼›å¦‚éœ€æ‰¹é‡ä¸‹è½½æŒ‡å®šåŒ…çš„ç›®å½•çš„ class å­—èŠ‚ç å¯ä»¥å‚è€ƒÂ <a href="https://arthas.aliyun.com/doc/dump.html"><strong>dump</strong></a>ã€‚</p><ul><li>åœ¨ Arthas Console ä¸Šï¼Œåç¼–è¯‘å‡ºæ¥çš„æºç æ˜¯å¸¦è¯­æ³•é«˜äº®çš„ï¼Œé˜…è¯»æ›´æ–¹ä¾¿</li><li>å½“ç„¶ï¼Œåç¼–è¯‘å‡ºæ¥çš„ java ä»£ç å¯èƒ½ä¼šå­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œä½†ä¸å½±å“ä½ è¿›è¡Œé˜…è¯»ç†è§£</li><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><code>[c:]</code></td><td>ç±»æ‰€å± ClassLoader çš„ hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹é…</td></tr></tbody></table><ul><li><strong>ä½¿ç”¨å‚è€ƒ</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">5167</span>]$ jad demo.MathGame </span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨çš„ç±»åŠ è½½å™¨</span></span><br><span class="line">ClassLoader:                                                                                                                                                                                                                                                                  </span><br><span class="line">+-jdk.internal.loader.ClassLoaders$AppClassLoader@4b85612c                                                                                                                                                                                                                    </span><br><span class="line">  +-jdk.internal.loader.ClassLoaders$PlatformClassLoader<span class="meta">@f98fa20</span>                                                                                                                                                                                                              </span><br><span class="line"></span><br><span class="line"><span class="comment">// Main Classçš„ä½ç½®åœ¨math-game.jaræ–‡ä»¶ä¸­</span></span><br><span class="line">Location:                                                                                                                                                                                                                                                                     </span><br><span class="line">/usr/local/software/arthas/math-game.jar                                                                                                                                                                                                                                      </span><br><span class="line"></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * Decompiled with CFR.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">package</span> demo;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line">       <span class="keyword">import</span> java.util.List;</span><br><span class="line">       <span class="keyword">import</span> java.util.Random;</span><br><span class="line">       <span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathGame</span> &#123;</span><br><span class="line">           <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">           <span class="keyword">private</span> <span class="type">int</span> <span class="variable">illegalArgumentCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       </span><br><span class="line">           <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">primeFactors</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line"><span class="comment">/*44*/</span>         <span class="keyword">if</span> (number &lt; <span class="number">2</span>) &#123;</span><br><span class="line"><span class="comment">/*45*/</span>             ++<span class="built_in">this</span>.illegalArgumentCount;</span><br><span class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;number is: &quot;</span> + number + <span class="string">&quot;, need &gt;= 2&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               ArrayList&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"><span class="comment">/*50*/</span>         <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">/*51*/</span>         <span class="keyword">while</span> (i &lt;= number) &#123;</span><br><span class="line"><span class="comment">/*52*/</span>             <span class="keyword">if</span> (number % i == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">/*53*/</span>                 result.add(i);</span><br><span class="line"><span class="comment">/*54*/</span>                 number /= i;</span><br><span class="line"><span class="comment">/*55*/</span>                 i = <span class="number">2</span>;</span><br><span class="line">                       <span class="keyword">continue</span>;</span><br><span class="line">                   &#125;</span><br><span class="line"><span class="comment">/*57*/</span>             ++i;</span><br><span class="line">               &#125;</span><br><span class="line"><span class="comment">/*61*/</span>         <span class="keyword">return</span> result;</span><br><span class="line">           &#125;</span><br><span class="line">       </span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">               <span class="type">MathGame</span> <span class="variable">game</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MathGame</span>();</span><br><span class="line">               <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">/*16*/</span>             game.run();</span><br><span class="line"><span class="comment">/*17*/</span>             TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       </span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">/*23*/</span>             <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> random.nextInt() / <span class="number">10000</span>;</span><br><span class="line"><span class="comment">/*24*/</span>             List&lt;Integer&gt; primeFactors = <span class="built_in">this</span>.primeFactors(number);</span><br><span class="line"><span class="comment">/*25*/</span>             MathGame.print(number, primeFactors);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="comment">/*28*/</span>             System.out.println(String.format(<span class="string">&quot;illegalArgumentCount:%3d, &quot;</span>, <span class="built_in">this</span>.illegalArgumentCount) + e.getMessage());</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       </span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> number, List&lt;Integer&gt; primeFactors)</span> &#123;</span><br><span class="line">               <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(number + <span class="string">&quot;=&quot;</span>);</span><br><span class="line"><span class="comment">/*34*/</span>         <span class="keyword">for</span> (<span class="type">int</span> factor : primeFactors) &#123;</span><br><span class="line"><span class="comment">/*35*/</span>             sb.append(factor).append(<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">               &#125;</span><br><span class="line"><span class="comment">/*37*/</span>         <span class="keyword">if</span> (sb.charAt(sb.length() - <span class="number">1</span>) == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">/*38*/</span>             sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">               &#125;</span><br><span class="line"><span class="comment">/*40*/</span>         System.out.println(sb);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"><span class="comment">// è€—æ—¶1238 ms.</span></span><br><span class="line">Affect(row-cnt:<span class="number">1</span>) cost in <span class="number">1238</span> ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-mcå‘½ä»¤"><a href="#4-mcå‘½ä»¤" class="headerlink" title="4. mcå‘½ä»¤"></a>4. mc<strong>å‘½ä»¤</strong></h2><p>Memory Compiler&#x2F;å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘<code>.java</code>æ–‡ä»¶ç”Ÿæˆ<code>.class</code>ã€‚é»˜è®¤ä½ç½®åœ¨arthasä½ç½®</p><p>å¯ä»¥é€šè¿‡<code>-d</code>å‘½ä»¤æŒ‡å®šè¾“å‡ºç›®å½•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥çœ‹Hello.javaçš„å†…å®¹</span></span><br><span class="line">[arthas@<span class="number">7339</span>]$ cat /usr/local/software/arthas/Hello.java </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨mcå‘½ä»¤ç¼–è¯‘æ–‡ä»¶</span></span><br><span class="line">[arthas@<span class="number">7339</span>]$ mc -d /usr/local/software/arthas/output /usr/local/software/arthas/Hello.java </span><br><span class="line">Memory compiler output:</span><br><span class="line">/usr/local/software/arthas/output/Hello.<span class="keyword">class</span></span><br><span class="line"><span class="title class_">Affect</span>(row-cnt:<span class="number">1</span>) cost in <span class="number">738</span> ms.</span><br></pre></td></tr></table></figure><h2 id="5-redefineå‘½ä»¤"><a href="#5-redefineå‘½ä»¤" class="headerlink" title="5.redefineå‘½ä»¤"></a>5.<strong>redefineå‘½ä»¤</strong></h2><p>åŠ è½½å¤–éƒ¨çš„<code>.class</code>æ–‡ä»¶ï¼Œredefine jvm å·²åŠ è½½çš„ç±»ã€‚</p><ul><li>redefine çš„ class ä¸èƒ½ä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤ç±»çš„ field å’Œ methodï¼ŒåŒ…æ‹¬æ–¹æ³•å‚æ•°ã€æ–¹æ³•åç§°åŠè¿”å›å€¼</li><li>å¦‚æœ mc å¤±è´¥ï¼Œå¯ä»¥åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒç¼–è¯‘å¥½ class æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°ç›®æ ‡ç³»ç»Ÿï¼Œä½¿ç”¨ redefine çƒ­åŠ è½½ class</li><li>ç›®å‰ redefine å’Œ watch&#x2F;trace&#x2F;jad&#x2F;tt ç­‰å‘½ä»¤å†²çªï¼Œä»¥åé‡æ–°å®ç° redefine åŠŸèƒ½ä¼šè§£å†³æ­¤é—®é¢˜</li></ul><aside>ğŸ’¡<p>æ³¨æ„ï¼Œ redefine åçš„åŸæ¥çš„ç±»ä¸èƒ½æ¢å¤ï¼Œredefine æœ‰å¯èƒ½å¤±è´¥ï¼ˆæ¯”å¦‚å¢åŠ äº†æ–°çš„ fieldï¼‰ï¼Œå‚è€ƒ jdk æœ¬èº«çš„æ–‡æ¡£ã€‚</p><p><code>reset</code>å‘½ä»¤å¯¹<code>redefine</code>çš„ç±»æ— æ•ˆã€‚å¦‚æœæƒ³é‡ç½®ï¼Œéœ€è¦<code>redefine</code>åŸå§‹çš„å­—èŠ‚ç ã€‚</p><p><code>redefine</code>å‘½ä»¤å’Œ<code>jad</code>&#x2F;<code>watch</code>&#x2F;<code>trace</code>&#x2F;<code>monitor</code>&#x2F;<code>tt</code>ç­‰å‘½ä»¤ä¼šå†²çªã€‚æ‰§è¡Œå®Œ<code>redefine</code>ä¹‹åï¼Œå¦‚æœå†æ‰§è¡Œä¸Šé¢æåˆ°çš„å‘½ä»¤ï¼Œåˆ™ä¼šæŠŠ<code>redefine</code>çš„å­—èŠ‚ç é‡ç½®ã€‚ åŸå› æ˜¯ jdk æœ¬èº« redefine å’Œ Retransform æ˜¯ä¸åŒçš„æœºåˆ¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤ç§æœºåˆ¶æ¥æ›´æ–°å­—èŠ‚ç ï¼Œåªæœ‰æœ€åä¿®æ”¹çš„ä¼šç”Ÿæ•ˆã€‚</p></aside><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>[c:]</td><td>ClassLoader çš„ hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr></tbody></table><p>æ¡ˆä¾‹ï¼š</p><ul><li>ä½¿ç”¨jadåç¼–è¯‘demo.MathGameè¾“å‡ºåˆ°&#x2F;root&#x2F;MathGame.java</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## jad å‘½ä»¤åç¼–è¯‘</span></span><br><span class="line">[arthas@7339]$ jad demo.MathGame --source-only &gt; /root/MathGame.java</span><br><span class="line">redirect output file will be: /root/MathGame.java</span><br></pre></td></tr></table></figure><ul><li>æ‰“å¼€æ–°çš„çª—å£ï¼Œä½¿ç”¨vim æ¥ä¿®æ”¹æºç </li></ul><p>vim &#x2F;root&#x2F;MathGame.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * Decompiled with CFR.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line">       <span class="keyword">import</span> java.util.List;</span><br><span class="line">       <span class="keyword">import</span> java.util.Random;</span><br><span class="line">       <span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathGame</span> &#123;</span><br><span class="line">           <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">           <span class="keyword">private</span> <span class="type">int</span> <span class="variable">illegalArgumentCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">primeFactors</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line"><span class="comment">/*44*/</span>         <span class="keyword">if</span> (number &lt; <span class="number">2</span>) &#123;</span><br><span class="line"><span class="comment">/*45*/</span>             ++<span class="built_in">this</span>.illegalArgumentCount;</span><br><span class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;number is: &quot;</span> + number + <span class="string">&quot;, need &gt;= 2&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               ArrayList&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"><span class="comment">/*50*/</span>         <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">/*51*/</span>         <span class="keyword">while</span> (i &lt;= number) &#123;</span><br><span class="line"><span class="comment">/*52*/</span>             <span class="keyword">if</span> (number % i == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">/*53*/</span>                 result.add(i);</span><br><span class="line"><span class="comment">/*54*/</span>                 number /= i;</span><br><span class="line"><span class="comment">/*55*/</span>                 i = <span class="number">2</span>;</span><br><span class="line">                       <span class="keyword">continue</span>;</span><br><span class="line">                   &#125;</span><br><span class="line"><span class="comment">/*57*/</span>             ++i;</span><br><span class="line">               &#125;</span><br><span class="line"><span class="comment">/*61*/</span>         <span class="keyword">return</span> result;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">               <span class="type">MathGame</span> <span class="variable">game</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MathGame</span>();</span><br><span class="line">               <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">/*16*/</span>             game.run();</span><br><span class="line"><span class="comment">/*17*/</span>             TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line">                   System.out.println(<span class="string">&quot;åœ¨mainæ–¹æ³•å¾ªç¯ä½“å†…æ‰§è¡Œ&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;åœ¨runæ–¹æ³•ä¸­æ‰§è¡Œ&quot;</span>);</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">/*23*/</span>             <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> random.nextInt() / <span class="number">10000</span>;</span><br><span class="line"><span class="comment">/*24*/</span>             List&lt;Integer&gt; primeFactors = <span class="built_in">this</span>.primeFactors(number);</span><br><span class="line"><span class="comment">/*25*/</span>             MathGame.print(number, primeFactors);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"><span class="comment">/*28*/</span>             System.out.println(String.format(<span class="string">&quot;illegalArgumentCount:%3d, &quot;</span>, <span class="built_in">this</span>.illegalArgumentCount) + e.getMessage());</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> number, List&lt;Integer&gt; primeFactors)</span> &#123;</span><br><span class="line">               <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(number + <span class="string">&quot;=&quot;</span>);</span><br><span class="line"><span class="comment">/*34*/</span>         <span class="keyword">for</span> (<span class="type">int</span> factor : primeFactors) &#123;</span><br><span class="line"><span class="comment">/*35*/</span>             sb.append(factor).append(<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">               &#125;</span><br><span class="line"><span class="comment">/*37*/</span>         <span class="keyword">if</span> (sb.charAt(sb.length() - <span class="number">1</span>) == <span class="string">&#x27;*&#x27;</span>) &#123;</span><br><span class="line"><span class="comment">/*38*/</span>             sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">               &#125;</span><br><span class="line"><span class="comment">/*40*/</span>         System.out.println(sb);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><ul><li>mc å‘½ä»¤æ¥å†…å­˜ç¼–è¯‘ä¿®æ”¹è¿‡çš„ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">7339</span>]$ mc /root/MathGame.java -d /root</span><br><span class="line">Memory compiler output:</span><br><span class="line">/root/demo/MathGame.<span class="keyword">class</span></span><br><span class="line"><span class="title class_">Affect</span>(row-cnt:<span class="number">1</span>) cost in <span class="number">253</span> ms.</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨redefineå‘½ä»¤åŠ è½½æ–°å­—èŠ‚ç æ–‡ä»¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[arthas@<span class="number">7339</span>]$ redefine /root/demo/MathGame.<span class="keyword">class</span> </span><br><span class="line"><span class="title class_">redefine</span> success, size: <span class="number">1</span>, classes:</span><br><span class="line">demo.MathGame</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œç»“æœ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">190754</span>=<span class="number">2</span>*<span class="number">127</span>*<span class="number">751</span></span><br><span class="line"><span class="number">160050</span>=<span class="number">2</span>*<span class="number">3</span>*<span class="number">5</span>*<span class="number">5</span>*<span class="number">11</span>*<span class="number">97</span></span><br><span class="line"><span class="number">171397</span>=<span class="number">101</span>*<span class="number">1697</span></span><br><span class="line"><span class="number">69692</span>=<span class="number">2</span>*<span class="number">2</span>*<span class="number">7</span>*<span class="number">19</span>*<span class="number">131</span></span><br><span class="line">illegalArgumentCount:<span class="number">8140</span>, number is: -<span class="number">77511</span>, need &gt;= <span class="number">2</span></span><br><span class="line">illegalArgumentCount:<span class="number">8141</span>, number is: -<span class="number">126748</span>, need &gt;= <span class="number">2</span></span><br><span class="line"><span class="number">75490</span>=<span class="number">2</span>*<span class="number">5</span>*<span class="number">7549</span></span><br><span class="line">illegalArgumentCount:<span class="number">8142</span>, number is: -<span class="number">125543</span>, need &gt;= <span class="number">2</span></span><br><span class="line">illegalArgumentCount:<span class="number">8143</span>, number is: -<span class="number">125902</span>, need &gt;= <span class="number">2</span></span><br><span class="line"><span class="number">87103</span>=<span class="number">87103</span></span><br><span class="line"><span class="number">73353</span>=<span class="number">3</span>*<span class="number">7</span>*<span class="number">7</span>*<span class="number">499</span></span><br><span class="line"><span class="number">189859</span>=<span class="number">189859</span></span><br><span class="line">åœ¨runæ–¹æ³•ä¸­æ‰§è¡Œ</span><br><span class="line"><span class="number">28098</span>=<span class="number">2</span>*<span class="number">3</span>*<span class="number">3</span>*<span class="number">7</span>*<span class="number">223</span></span><br><span class="line">åœ¨runæ–¹æ³•ä¸­æ‰§è¡Œ</span><br><span class="line">illegalArgumentCount:<span class="number">8144</span>, number is: -<span class="number">45234</span>, need &gt;= <span class="number">2</span></span><br><span class="line">åœ¨runæ–¹æ³•ä¸­æ‰§è¡Œ</span><br><span class="line"><span class="number">78004</span>=<span class="number">2</span>*<span class="number">2</span>*<span class="number">19501</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/source/images/arthas/chapter4/image.png" alt="image.png"></p><h2 id="6-dumpå‘½ä»¤"><a href="#6-dumpå‘½ä»¤" class="headerlink" title="6. dumpå‘½ä»¤"></a>6. <strong>dumpå‘½ä»¤</strong></h2><p>dump å·²åŠ è½½ç±»çš„ bytecode åˆ°ç‰¹å®šç›®å½•ï¼Œ</p><p>dump å‘½ä»¤å°† JVM ä¸­å®é™…è¿è¡Œçš„ class çš„ byte code dump åˆ°æŒ‡å®šç›®å½•ï¼Œé€‚ç”¨åœºæ™¯æ‰¹é‡ä¸‹è½½æŒ‡å®šåŒ…ç›®å½•çš„ class å­—èŠ‚ç ï¼›å¦‚éœ€åç¼–è¯‘å•ä¸€ç±»ã€å®æ—¶æŸ¥çœ‹ç±»ä¿¡æ¯ï¼Œå¯å‚è€ƒÂ <a href="https://arthas.aliyun.com/doc/jad.html"><strong>jad</strong></a>ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>class-pattern</em></td><td>ç±»åè¡¨è¾¾å¼åŒ¹é…</td></tr><tr><td><code>[c:]</code></td><td>ç±»æ‰€å± ClassLoader çš„ hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td><code>[d:]</code></td><td>è®¾ç½®ç±»æ–‡ä»¶çš„ç›®æ ‡ç›®å½•</td></tr><tr><td>[E]</td><td>å¼€å¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œé»˜è®¤ä¸ºé€šé…ç¬¦åŒ¹</td></tr></tbody></table><p>dump java.lang.String</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ dump java.lang.String</span><br><span class="line"> HASHCODE  CLASSLOADER  LOCATION                                                                                                                                                                                                                                              </span><br><span class="line"> null                   /root/logs/arthas/classdump/java/lang/String.class                                                                                                                                                                                                    </span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 45 ms.</span><br><span class="line"></span><br><span class="line">[arthas@8161]$ dump demo.*</span><br><span class="line"> HASHCODE  CLASSLOADER                                                       LOCATION                                                                                                                                                                                         </span><br><span class="line"> 4b85612c  +-jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c        /root/logs/arthas/classdump/jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>-4b85612c/demo/MathGame.class                                                                                         </span><br><span class="line">             +-jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@17bb5c0                                                                                                                                                                                                   </span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 22 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-classloaderå‘½ä»¤"><a href="#7-classloaderå‘½ä»¤" class="headerlink" title="7. classloaderå‘½ä»¤"></a>7. <strong>classloaderå‘½ä»¤</strong></h2><p>æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯</p><p><code>classloader</code>Â å‘½ä»¤å°† JVM ä¸­æ‰€æœ‰çš„ classloader çš„ä¿¡æ¯ç»Ÿè®¡å‡ºæ¥ï¼Œå¹¶å¯ä»¥å±•ç¤ºç»§æ‰¿æ ‘ï¼Œurls ç­‰ã€‚</p><p>å¯ä»¥è®©æŒ‡å®šçš„ classloader å» getResourcesï¼Œæ‰“å°å‡ºæ‰€æœ‰æŸ¥æ‰¾åˆ°çš„ resources çš„ urlã€‚å¯¹äº<code>ResourceNotFoundException</code>æ¯”è¾ƒæœ‰ç”¨ã€‚</p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td>[l]</td><td>æŒ‰ç±»åŠ è½½å®ä¾‹è¿›è¡Œç»Ÿè®¡</td></tr><tr><td>[t]</td><td>æ‰“å°æ‰€æœ‰ ClassLoader çš„ç»§æ‰¿æ ‘</td></tr><tr><td>[a]</td><td>åˆ—å‡ºæ‰€æœ‰ ClassLoader åŠ è½½çš„ç±»ï¼Œè¯·è°¨æ…ä½¿ç”¨</td></tr><tr><td><code>[c:]</code></td><td>ClassLoader çš„ hashcode</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td><code>[c: r:]</code></td><td>ç”¨ ClassLoader å»æŸ¥æ‰¾ resource</td></tr><tr><td><code>[c: load:]</code></td><td>ç”¨ ClassLoader å»åŠ è½½æŒ‡å®šçš„ç±»</td></tr></tbody></table><ul><li><p><strong>ä½¿ç”¨å‚è€ƒ</strong></p><ul><li><strong>æŒ‰ç±»åŠ è½½ç±»å‹æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</strong></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ classloader</span><br><span class="line"> name                                                  numberOfInstances  loadedCountTotal                                                                                                                                                                                    </span><br><span class="line"> com.taobao.arthas.agent.ArthasClassloader             2                  4420                                                                                                                                                                                                </span><br><span class="line"> BootstrapClassLoader                                  1                  3487                                                                                                                                                                                                </span><br><span class="line"> jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>  1                  60                                                                                                                                                                                                  </span><br><span class="line"> jdk.internal.reflect.DelegatingClassLoader            21                 21                                                                                                                                                                                                  </span><br><span class="line"> jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>       1                  4                                                                                                                                                                                                   </span><br><span class="line">Affect(row-cnt:5) cost <span class="keyword">in</span> 10 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>æŒ‰ç±»åŠ è½½å®ä¾‹æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯</strong></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ classloader -l</span><br><span class="line"> name                                                          loadedCount  <span class="built_in">hash</span>      parent                                                                                                                                                                                  </span><br><span class="line"> BootstrapClassLoader                                          3487         null      null                                                                                                                                                                                    </span><br><span class="line"> com.taobao.arthas.agent.ArthasClassloader@369500c6            2696         369500c6  jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@17bb5c0                                                                                                                            </span><br><span class="line"> com.taobao.arthas.agent.ArthasClassloader@6489d91             1727         6489d91   jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@17bb5c0                                                                                                                            </span><br><span class="line"> jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c      4            4b85612c  jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@17bb5c0                                                                                                                            </span><br><span class="line"> jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@17bb5c0  60           17bb5c0   null                                                                                                                                                                                    </span><br><span class="line">Affect(row-cnt:5) cost <span class="keyword">in</span> 10 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>æŸ¥çœ‹ ClassLoader çš„ç»§æ‰¿æ ‘</strong></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ classloader -t</span><br><span class="line">+-BootstrapClassLoader                                                                                                                                                                                                                                                        </span><br><span class="line">+-jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@17bb5c0                                                                                                                                                                                                                </span><br><span class="line">  +-com.taobao.arthas.agent.ArthasClassloader@369500c6                                                                                                                                                                                                                        </span><br><span class="line">  +-com.taobao.arthas.agent.ArthasClassloader@6489d91                                                                                                                                                                                                                         </span><br><span class="line">  +-jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c                                                                                                                                                                                                                  </span><br><span class="line">Affect(row-cnt:5) cost <span class="keyword">in</span> 13 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>æŸ¥çœ‹ URLClassLoader å®é™…çš„ urls</strong></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ classloader -c 369500c6</span><br><span class="line">file:/root/.arthas/lib/4.0.5/arthas/arthas-core.jar                                                                                                                                                                                                                           </span><br><span class="line">Affect(row-cnt:2) cost <span class="keyword">in</span> 1 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>ä½¿ç”¨ ClassLoader å»æŸ¥æ‰¾ resource</strong></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ classloader -c 369500c6  -r META-INF/MANIFEST.MF</span><br><span class="line"> jar:file:/root/.arthas/lib/4.0.5/arthas/arthas-core.jar!/META-INF/MANIFEST.MF                                                                                                                                                                                                </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 1 ms.</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>ä¹Ÿå¯ä»¥å°è¯•æŸ¥æ‰¾ç±»çš„ class æ–‡ä»¶</strong></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ classloader -c 369500c6   -r java/lang/String.class</span><br><span class="line"> jrt:/java.base/java/lang/String.class                                                                                                                                                                                                                                        </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 1 ms.</span><br></pre></td></tr></table></figure><ul><li><strong>ä½¿ç”¨ ClassLoader å»åŠ è½½ç±»</strong></li></ul>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[arthas@8161]$ classloader -c 369500c6 --load java.lang.String</span><br><span class="line">load class success.</span><br><span class="line"> class-info        java.lang.String                                                                                                                                                                                                                                           </span><br><span class="line"> code-source                                                                                                                                                                                                                                                                  </span><br><span class="line"> name              java.lang.String                                                                                                                                                                                                                                           </span><br><span class="line"> isInterface       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnnotation      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isEnum            <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnonymousClass  <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isArray           <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isLocalClass      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isMemberClass     <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isPrimitive       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isSynthetic       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> simple-name       String                                                                                                                                                                                                                                                     </span><br><span class="line"> modifier          final,public                                                                                                                                                                                                                                               </span><br><span class="line"> annotation                                                                                                                                                                                                                                                                   </span><br><span class="line"> interfaces        java.io.Serializable,java.lang.Comparable,java.lang.CharSequence                                                                                                                                                                                           </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                                                                                                                                         </span><br><span class="line"> class-loader                                                                                                                                                                                                                                                                 </span><br><span class="line"> classLoaderHash   null  </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> [arthas@8161]$ classloader -c 4b85612c --load demo.MathGame</span><br><span class="line">load class success.</span><br><span class="line"> class-info        demo.MathGame                                                                                                                                                                                                                                              </span><br><span class="line"> code-source       /usr/local/software/arthas/math-game.jar                                                                                                                                                                                                                   </span><br><span class="line"> name              demo.MathGame                                                                                                                                                                                                                                              </span><br><span class="line"> isInterface       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnnotation      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isEnum            <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isAnonymousClass  <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isArray           <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isLocalClass      <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isMemberClass     <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isPrimitive       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> isSynthetic       <span class="literal">false</span>                                                                                                                                                                                                                                                      </span><br><span class="line"> simple-name       MathGame                                                                                                                                                                                                                                                   </span><br><span class="line"> modifier          public                                                                                                                                                                                                                                                     </span><br><span class="line"> annotation                                                                                                                                                                                                                                                                   </span><br><span class="line"> interfaces                                                                                                                                                                                                                                                                   </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                                                                                                                                         </span><br><span class="line"> class-loader      +-jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c                                                                                                                                                                                                 </span><br><span class="line">                     +-jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@17bb5c0                                                                                                                                                                                           </span><br><span class="line"> classLoaderHash   4b85612c   </span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯ï¼Œâ€œSearch-Classâ€ çš„ç®€å†™ï¼Œè¿™ä¸ªå‘½ä»¤èƒ½æœç´¢å‡ºæ‰€æœ‰å·²ç»åŠ è½½åˆ° JVM ä¸­çš„ Class ä¿¡æ¯ï¼Œè¿™ä¸ªå‘½ä»¤æ”¯æŒçš„å‚æ•°æœ‰Â `[d]`ã€`[E]`ã€`[f]`Â å’ŒÂ `[x:]`</summary>
    
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/tags/Arthas/"/>
    
    <category term="Arthasè¯Šæ–­å·¥å…·" scheme="https://yuanxw.github.io/tags/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Arthasè¯Šæ–­**å·¥å…·(ä¸‰)**Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰JVMç›¸å…³å‘½ä»¤</title>
    <link href="https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%B8%89)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89JVM%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"/>
    <id>https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%B8%89)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89JVM%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</id>
    <published>2023-03-02T16:00:00.000Z</published>
    <updated>2025-09-03T15:39:16.605Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasè¯Šæ–­å·¥å…·-ä¸‰-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰JVMç›¸å…³å‘½ä»¤"><a href="#Arthasè¯Šæ–­å·¥å…·-ä¸‰-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰JVMç›¸å…³å‘½ä»¤" class="headerlink" title="Arthasè¯Šæ–­å·¥å…·(ä¸‰)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰JVMç›¸å…³å‘½ä»¤"></a><strong>Arthasè¯Šæ–­</strong>å·¥å…·(ä¸‰)<strong>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰JVMç›¸å…³å‘½ä»¤</strong></h1><h2 id="1-jvmå‘½ä»¤"><a href="#1-jvmå‘½ä»¤" class="headerlink" title="1. jvmå‘½ä»¤"></a>1. jvm<strong>å‘½ä»¤</strong></h2><p>æŸ¥çœ‹å½“å‰ JVM ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ jvm</span><br><span class="line"> RUNTIME                                                                                                                                                                                                                                                                      </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MACHINE-NAME                                                                 5167@localhost.localdomain                                        </span><br><span class="line"> JVM-START-TIME                                                               2025-06-06 05:55:57                                               </span><br><span class="line"> MANAGEMENT-SPEC-VERSION                                                      2.0                                                               </span><br><span class="line"> SPEC-NAME                                                                    Java Virtual Machine Specification                                </span><br><span class="line"> SPEC-VENDOR                                                                  Oracle Corporation                                                </span><br><span class="line"> SPEC-VERSION                                                                 11                                                                </span><br><span class="line"> VM-NAME                                                                      Java HotSpot(TM) 64-Bit Server VM                                 </span><br><span class="line"> VM-VENDOR                                                                    Oracle Corporation                                                </span><br><span class="line"> VM-VERSION                                                                   11.0.16.1+1-LTS-1                                                 </span><br><span class="line"> INPUT-ARGUMENTS                                                              []                                                                </span><br><span class="line"> CLASS-PATH                                                                   math-game.jar                                                     </span><br><span class="line"> BOOT-CLASS-PATH                                                                                                                                </span><br><span class="line"> LIBRARY-PATH                                                                 /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib            </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CLASS-LOADING                                                                                                                                  </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> LOADED-CLASS-COUNT                                                           6215                                                              </span><br><span class="line"> TOTAL-LOADED-CLASS-COUNT                                                     6272                                                              </span><br><span class="line"> UNLOADED-CLASS-COUNT                                                         57                                                                </span><br><span class="line"> IS-VERBOSE                                                                   <span class="literal">false</span>                                                             </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COMPILATION                                                                                                                                    </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> NAME                                                                         HotSpot 64-Bit Tiered Compilers                                   </span><br><span class="line"> TOTAL-COMPILE-TIME                                                           22523                                                             </span><br><span class="line"> [<span class="keyword">time</span> (ms)]                                                                                                                                    </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> GARBAGE-COLLECTORS                                                                                                                             </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> G1 Young Generation                                                          name : G1 Young Generation                                        </span><br><span class="line"> [count/time (ms)]                                                            collectionCount : 7                                               </span><br><span class="line">                                                                              collectionTime : 182                                              </span><br><span class="line"> G1 Old Generation                                                            name : G1 Old Generation                                          </span><br><span class="line"> [count/time (ms)]                                                            collectionCount : 0                                               </span><br><span class="line">                                                                              collectionTime : 0                                                </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY-MANAGERS                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CodeCacheManager                                                             CodeHeap <span class="string">&#x27;non-nmethods&#x27;</span>                                           </span><br><span class="line">                                                                              CodeHeap <span class="string">&#x27;profiled nmethods&#x27;</span>                                      </span><br><span class="line">                                                                              CodeHeap <span class="string">&#x27;non-profiled nmethods&#x27;</span>                                  </span><br><span class="line"> Metaspace Manager                                                            Metaspace                                                         </span><br><span class="line">                                                                              Compressed Class Space                                            </span><br><span class="line"> G1 Young Generation                                                          G1 Eden Space                                                     </span><br><span class="line">                                                                              G1 Survivor Space                                                 </span><br><span class="line">                                                                              G1 Old Gen                                                        </span><br><span class="line"> G1 Old Generation                                                            G1 Eden Space                                                     </span><br><span class="line">                                                                              G1 Survivor Space                                                 </span><br><span class="line">                                                                              G1 Old Gen                                                        </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY                                                                                                                                         </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> HEAP-MEMORY-USAGE                                                            init : 130023424(124.0 MiB)                                       </span><br><span class="line"> [memory <span class="keyword">in</span> bytes]                                                            used : 40942912(39.0 MiB)                                         </span><br><span class="line">                                                                              committed : 130023424(124.0 MiB)                                  </span><br><span class="line">                                                                              max : 2051014656(1.9 GiB)                                         </span><br><span class="line"> NO-HEAP-MEMORY-USAGE                                                         init : 7667712(7.3 MiB)                                           </span><br><span class="line"> [memory <span class="keyword">in</span> bytes]                                                            used : 60157088(57.4 MiB)                                         </span><br><span class="line">                                                                              committed : 63004672(60.1 MiB)                                    </span><br><span class="line">                                                                              max : -1(-1 B)                                                    </span><br><span class="line"> PENDING-FINALIZE-COUNT                                                       0                                                                 </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OPERATING-SYSTEM                                                                                                                               </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OS                                                                           Linux                                                             </span><br><span class="line"> ARCH                                                                         amd64                                                             </span><br><span class="line"> PROCESSORS-COUNT                                                             4                                                                 </span><br><span class="line"> LOAD-AVERAGE                                                                 0.0                                                               </span><br><span class="line"> VERSION                                                                      3.10.0-957.el7.x86_64                                             </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> THREAD                                                                                                                                         </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COUNT                                                                        20                                                                </span><br><span class="line"> DAEMON-COUNT                                                                 19                                                                </span><br><span class="line"> PEAK-COUNT                                                                   20                                                                </span><br><span class="line"> STARTED-COUNT                                                                27                                                                </span><br><span class="line"> DEADLOCK-COUNT                                                               0                                                                 </span><br><span class="line">                                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> FILE-DESCRIPTOR                                                                                                                                </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MAX-FILE-DESCRIPTOR-COUNT                                                    -1                                                                </span><br><span class="line"> OPEN-FILE-DESCRIPTOR-COUNT                                                   -1                                                                </span><br></pre></td></tr></table></figure><ul><li><strong>THREAD ç›¸å…³</strong><ul><li>COUNT: JVM å½“å‰æ´»è·ƒçš„çº¿ç¨‹æ•°</li><li>DAEMON-COUNT: JVM å½“å‰æ´»è·ƒçš„å®ˆæŠ¤çº¿ç¨‹æ•°</li><li>PEAK-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ›¾ç»æ´»ç€çš„æœ€å¤§çº¿ç¨‹æ•°</li><li>STARTED-COUNT: ä» JVM å¯åŠ¨å¼€å§‹æ€»å…±å¯åŠ¨è¿‡çš„çº¿ç¨‹æ¬¡æ•°</li><li>DEADLOCK-COUNT: JVM å½“å‰æ­»é”çš„çº¿ç¨‹æ•°</li></ul></li><li><strong>æ–‡ä»¶æè¿°ç¬¦ç›¸å…³</strong><ul><li>MAX-FILE-DESCRIPTOR-COUNTï¼šJVM è¿›ç¨‹æœ€å¤§å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</li><li>OPEN-FILE-DESCRIPTOR-COUNTï¼šJVM å½“å‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°</li></ul></li></ul><h2 id="2-sysprop-å‘½ä»¤"><a href="#2-sysprop-å‘½ä»¤" class="headerlink" title="2. sysprop å‘½ä»¤"></a>2. <strong>sysprop å‘½ä»¤</strong></h2><p>æŸ¥çœ‹å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§(<code>System Property</code>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ sysprop </span><br><span class="line"> KEY                                                   VALUE                                                                                                                                                                                                                  </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> awt.toolkit                                           sun.awt.X11.XToolkit                                                                                                                                                                                                   </span><br><span class="line"> java.specification.version                            11                                                                                                                                                                                                                     </span><br><span class="line"> sun.cpu.isalist                                                                                                                                                                                                                                                              </span><br><span class="line"> sun.jnu.encoding                                      UTF-8                                                                                                                                                                                                                  </span><br><span class="line"> java.class.path                                       math-game.jar                                                                                                                                                                                                          </span><br><span class="line"> java.vm.vendor                                        Oracle Corporation                                                                                                                                                                                                     </span><br><span class="line"> sun.arch.data.model                                   64                                                                                                                                                                                                                     </span><br><span class="line"> java.vendor.url                                       https://openjdk.java.net/                                                                                                                                                                                              </span><br><span class="line"> user.timezone                                         America/New_York                                                                                                                                                                                                       </span><br><span class="line"> os.name                                               Linux                                                                                                                                                                                                                  </span><br><span class="line"> java.vm.specification.version                         11                                                                                                                                                                                                                     </span><br><span class="line"> sun.java.launcher                                     SUN_STANDARD                                                                                                                                                                                                           </span><br><span class="line"> user.country                                          US                                                                                                                                                                                                                     </span><br><span class="line"> sun.boot.library.path                                 /usr/local/software/jdk-11.0.16.1/lib                                                                                                                                                                                  </span><br><span class="line"> sun.java.command                                      math-game.jar                                                                                                                                                                                                          </span><br><span class="line"> jdk.debug                                             release                                                                                                                                                                                                                </span><br><span class="line"> sun.cpu.endian                                        little                                                                                                                                                                                                                 </span><br><span class="line"> user.home                                             /root                                                                                                                                                                                                                  </span><br><span class="line"> user.language                                         en                                                                                                                                                                                                                     </span><br><span class="line"> java.specification.vendor                             Oracle Corporation                                                                                                                                                                                                     </span><br><span class="line"> java.version.date                                     2022-08-18                                                                                                                                                                                                             </span><br><span class="line"> java.home                                             /usr/local/software/jdk-11.0.16.1                                                                                                                                                                                      </span><br><span class="line"> file.separator                                        /                                                                                                                                                                                                                      </span><br><span class="line"> java.vm.compressedOopsMode                            32-bit                                                                                                                                                                                                                 </span><br><span class="line"> line.separator                                                                                                                                                                                                                                                               </span><br><span class="line"> java.specification.name                               Java Platform API Specification                                                                                                                                                                                        </span><br><span class="line"> java.vm.specification.vendor                          Oracle Corporation                                                                                                                                                                                                     </span><br><span class="line"> java.awt.graphicsenv                                  sun.awt.X11GraphicsEnvironment                                                                                                                                                                                         </span><br><span class="line"> sun.management.compiler                               HotSpot 64-Bit Tiered Compilers                                                                                                                                                                                        </span><br><span class="line"> java.runtime.version                                  11.0.16.1+1-LTS-1                                                                                                                                                                                                      </span><br><span class="line"> user.name                                             root                                                                                                                                                                                                                   </span><br><span class="line"> path.separator                                        :                                                                                                                                                                                                                      </span><br><span class="line"> os.version                                            3.10.0-957.el7.x86_64                                                                                                                                                                                                  </span><br><span class="line"> java.runtime.name                                     Java(TM) SE Runtime Environment                                                                                                                                                                                        </span><br><span class="line"> file.encoding                                         UTF-8                                                                                                                                                                                                                  </span><br><span class="line"> java.vm.name                                          Java HotSpot(TM) 64-Bit Server VM                                                                                                                                                                                      </span><br><span class="line"> java.vendor.version                                   18.9                                                                                                                                                                                                                   </span><br><span class="line"> java.vendor.url.bug                                   https://bugreport.java.com/bugreport/                                                                                                                                                                                  </span><br><span class="line"> java.io.tmpdir                                        /tmp                                                                                                                                                                                                                   </span><br><span class="line"> java.version                                          11.0.16.1                                                                                                                                                                                                              </span><br><span class="line"> user.dir                                              /usr/local/software/arthas                                                                                                                                                                                             </span><br><span class="line"> os.arch                                               amd64                                                                                                                                                                                                                  </span><br><span class="line"> java.vm.specification.name                            Java Virtual Machine Specification                                                                                                                                                                                     </span><br><span class="line"> java.awt.printerjob                                   sun.print.PSPrinterJob                                                                                                                                                                                                 </span><br><span class="line"> sun.os.patch.level                                    unknown                                                                                                                                                                                                                </span><br><span class="line"> java.library.path                                     /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib                                                                                                                                                                 </span><br><span class="line"> java.vendor                                           Oracle Corporation                                                                                                                                                                                                     </span><br><span class="line"> java.vm.info                                          mixed mode                                                                                                                                                                                                             </span><br><span class="line"> java.vm.version                                       11.0.16.1+1-LTS-1                                                                                                                                                                                                      </span><br><span class="line"> sun.io.unicode.encoding                               UnicodeLittle                                                                                                                                                                                                          </span><br><span class="line"> java.class.version                                    55.0  </span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æŸä¸€ä¸ªç³»ç»Ÿå±æ€§</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ sysprop file.encoding</span><br><span class="line"> KEY                                                   VALUE                                                                                                                                                                                                                  </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> file.encoding                                         UTF-8                                                                                                                                                                                                                  </span><br><span class="line">[arthas@5167]$ </span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹æŸä¸€ä¸ªå±æ€§</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ sysprop production.mode <span class="literal">true</span></span><br><span class="line">Successfully changed the system property.</span><br><span class="line"> KEY                                                   VALUE                                                                                                                                                                                                                  </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> production.mode                                       <span class="literal">true</span>                                                                                                                                                                                                                   </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-sysprop-å‘½ä»¤"><a href="#3-sysprop-å‘½ä»¤" class="headerlink" title="3. sysprop å‘½ä»¤"></a>3. <strong>sysprop å‘½ä»¤</strong></h2><p>æŸ¥çœ‹å½“å‰ JVM çš„ç³»ç»Ÿå±æ€§(<code>System Property</code>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ sysenv </span><br><span class="line"> KEY                                                   VALUE                                                                                                                                                                                                                  </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CLASSPATH                                             .:/usr/local/software/jdk-11.0.16.1/lib/dt.jar:/usr/local/software/jdk-11.0.16.1/lib/tools.jar                                                                                                                         </span><br><span class="line"> HISTCONTROL                                           ignoredups                                                                                                                                                                                                             </span><br><span class="line"> HISTSIZE                                              1000                                                                                                                                                                                                                   </span><br><span class="line"> HOME                                                  /root                                                                                                                                                                                                                  </span><br><span class="line"> HOSTNAME                                              localhost.localdomain                                                                                                                                                                                                  </span><br><span class="line"> JAVA_HOME                                             /usr/local/software/jdk-11.0.16.1                                                                                                                                                                                      </span><br><span class="line"> LANG                                                  en_US.UTF-8                                                                                                                                                                                                            </span><br><span class="line"> LESSOPEN                                              ||/usr/bin/lesspipe.sh %s                                                                                                                                                                                              </span><br><span class="line"> LOGNAME                                               root                                                                                                                                                                                                                   </span><br><span class="line"> LS_COLORS                                             rs=0:di=01;34:<span class="built_in">ln</span>=01;36:mh=00:pi=40;33:so=01;35:<span class="keyword">do</span>=01;35:bd=40;33;01:<span class="built_in">cd</span>=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01 </span><br><span class="line">                                                       ;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:* </span><br><span class="line">                                                       .bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:* </span><br><span class="line">                                                       .cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01 </span><br><span class="line">                                                       ;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.<span class="built_in">rm</span>=01;35:*.rmvb=01;35:*.fl </span><br><span class="line">                                                       c=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mi </span><br><span class="line">                                                       d=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:                                                                          </span><br><span class="line"> MAIL                                                  /var/spool/mail/root                                                                                                                                                                                                   </span><br><span class="line"> OLDPWD                                                /usr/local/software                                                                                                                                                                                                    </span><br><span class="line"> PATH                                                  /usr/local/software/jdk-11.0.16.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin                                                                                                                      </span><br><span class="line"> PWD                                                   /usr/local/software/arthas                                                                                                                                                                                             </span><br><span class="line"> SELINUX_LEVEL_REQUESTED                                                                                                                                                                                                                                                      </span><br><span class="line"> SELINUX_ROLE_REQUESTED                                                                                                                                                                                                                                                       </span><br><span class="line"> SELINUX_USE_CURRENT_RANGE                                                                                                                                                                                                                                                    </span><br><span class="line"> SHELL                                                 /bin/bash                                                                                                                                                                                                              </span><br><span class="line"> SHLVL                                                 1                                                                                                                                                                                                                      </span><br><span class="line"> SSH_CLIENT                                            192.168.3.74 2421 22                                                                                                                                                                                                   </span><br><span class="line"> SSH_CONNECTION                                        192.168.3.74 2421 192.168.3.125 22                                                                                                                                                                                     </span><br><span class="line"> SSH_TTY                                               /dev/pts/2                                                                                                                                                                                                             </span><br><span class="line"> TERM                                                  xterm                                                                                                                                                                                                                  </span><br><span class="line"> USER                                                  root                                                                                                                                                                                                                   </span><br><span class="line"> XDG_RUNTIME_DIR                                       /run/user/0                                                                                                                                                                                                            </span><br><span class="line"> XDG_SESSION_ID                                        25                                                                                                                                                                                                                     </span><br><span class="line"> _                                                     /usr/local/software/jdk-11.0.16.1/bin/java </span><br></pre></td></tr></table></figure><ul><li><strong>æŸ¥çœ‹å•ä¸ªç¯å¢ƒå˜é‡</strong></li></ul><p>sysenv JAVA_HOME</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ sysenv JAVA_HOME</span><br><span class="line"> KEY                                                   VALUE                                                                                                                                                                                                                  </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> JAVA_HOME                                             /usr/local/software/jdk-11.0.16.1 </span><br></pre></td></tr></table></figure><h2 id="4-vmoptionå‘½ä»¤"><a href="#4-vmoptionå‘½ä»¤" class="headerlink" title="4. vmoptionå‘½ä»¤"></a>4. <strong>vmoptionå‘½ä»¤</strong></h2><p>æŸ¥çœ‹ï¼Œæ›´æ–° VM è¯Šæ–­ç›¸å…³çš„å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ vmoption </span><br><span class="line"> KEY                                                                 VALUE                                                              ORIGIN                                                              WRITEABLE                                                         </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> HeapDumpBeforeFullGC                                                <span class="literal">false</span>                                                              DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> HeapDumpAfterFullGC                                                 <span class="literal">false</span>                                                              DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> HeapDumpOnOutOfMemoryError                                          <span class="literal">false</span>                                                              DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> HeapDumpPath                                                                                                                           DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> PrintClassHistogram                                                 <span class="literal">false</span>                                                              DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> MinHeapFreeRatio                                                    40                                                                 DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> MaxHeapFreeRatio                                                    70                                                                 DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> PrintConcurrentLocks                                                <span class="literal">false</span>                                                              DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> CMSAbortablePrecleanWaitMillis                                      100                                                                DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> CMSWaitDuration                                                     2000                                                               DEFAULT                                                             <span class="literal">true</span>                                                              </span><br><span class="line"> CMSTriggerInterval                                                  -1                                                                 DEFAULT                                                             <span class="literal">true</span>                                                              </span><br></pre></td></tr></table></figure><ul><li><strong>æ›´æ–°æŒ‡å®šçš„ option</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ vmoption HeapDumpBeforeFullGC <span class="literal">true</span></span><br><span class="line">Successfully updated the vm option.</span><br><span class="line"> NAME                  BEFORE-VALUE  AFTER-VALUE                                                                                                                                                                                                                              </span><br><span class="line">-------------------------------------------------                                                                                                                                                                                                                             </span><br><span class="line"> HeapDumpBeforeFullGC  <span class="literal">false</span>         <span class="literal">true</span>   </span><br></pre></td></tr></table></figure><h2 id="5-getstatic-å‘½ä»¤"><a href="#5-getstatic-å‘½ä»¤" class="headerlink" title="5. getstatic å‘½ä»¤"></a>5. getstatic <strong>å‘½ä»¤</strong></h2><p>é€šè¿‡ getstatic å‘½ä»¤å¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹ç±»çš„é™æ€å±æ€§ã€‚ä½¿ç”¨æ–¹æ³•ä¸º<code>getstatic class_name field_name</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[arthas@7339]$ getstatic demo.MathGame random</span><br><span class="line">field: random</span><br><span class="line">@Random[</span><br><span class="line">    serialVersionUID=@Long[3905348978240129619],</span><br><span class="line">    seed=@AtomicLong[279863952692122],</span><br><span class="line">    multiplier=@Long[25214903917],</span><br><span class="line">    addend=@Long[11],</span><br><span class="line">    mask=@Long[281474976710655],</span><br><span class="line">    DOUBLE_UNIT=@Double[1.1102230246251565E-16],</span><br><span class="line">    BadBound=@String[bound must be positive],</span><br><span class="line">    BadRange=@String[bound must be greater than origin],</span><br><span class="line">    BadSize=@String[size must be non-negative],</span><br><span class="line">    seedUniquifier=@AtomicLong[-2942033378085796212],</span><br><span class="line">    nextNextGaussian=@Double[0.0],</span><br><span class="line">    haveNextNextGaussian=@Boolean[<span class="literal">false</span>],</span><br><span class="line">    serialPersistentFields=@ObjectStreamField[][isEmpty=<span class="literal">false</span>;size=3],</span><br><span class="line">    unsafe=@Unsafe[jdk.internal.misc.Unsafe@1004ff20],</span><br><span class="line">    seedOffset=@Long[24],</span><br><span class="line">]</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 29 ms.</span><br></pre></td></tr></table></figure><h2 id="6-ognlå‘½ä»¤"><a href="#6-ognlå‘½ä»¤" class="headerlink" title="6. ognlå‘½ä»¤"></a>6. ognl<strong>å‘½ä»¤</strong></h2><p>æ‰§è¡Œ ognl è¡¨è¾¾å¼ï¼Œä» 3.0.5 ç‰ˆæœ¬å¢åŠ </p><ul><li><strong>å‚æ•°è¯´æ˜</strong></li></ul><table><thead><tr><th>å‚æ•°åç§°</th><th>å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td><em>express</em></td><td>æ‰§è¡Œçš„è¡¨è¾¾å¼</td></tr><tr><td><code>[c:]</code></td><td>æ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ hashcodeï¼Œé»˜è®¤å€¼æ˜¯ SystemClassLoader</td></tr><tr><td><code>[classLoaderClass:]</code></td><td>æŒ‡å®šæ‰§è¡Œè¡¨è¾¾å¼çš„ ClassLoader çš„ class name</td></tr><tr><td>[x]</td><td>ç»“æœå¯¹è±¡çš„å±•å¼€å±‚æ¬¡ï¼Œé»˜è®¤å€¼ 1</td></tr></tbody></table><ul><li><strong>ä½¿ç”¨å‚è€ƒ</strong></li><li>OGNL ç‰¹æ®Šç”¨æ³•è¯·å‚è€ƒï¼š<a href="https://github.com/alibaba/arthas/issues/71"><strong>https://github.com/alibaba/arthas/issues/71</strong></a></li><li>OGNL è¡¨è¾¾å¼å®˜æ–¹æŒ‡å—ï¼š<a href="https://commons.apache.org/dormant/commons-ognl/language-guide.html"><strong>https://commons.apache.org/dormant/commons-ognl/language-guide.html</strong></a></li></ul><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## java.lang.System.out.printlnn(&quot;hello&quot;) æ–¹æ³•æ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line">[arthas@7339]$ ognl <span class="string">&#x27;@java.lang.System@out.println(&quot;hello&quot;)&#x27;</span></span><br><span class="line">null</span><br><span class="line"></span><br><span class="line"><span class="comment">## java.lang.System.currentTimeMillis()è¿”å›å€¼ä¸ºLongç±»å‹</span></span><br><span class="line">[arthas@7339]$ ognl <span class="string">&#x27;@java.lang.System@currentTimeMillis()&#x27;</span></span><br><span class="line">@Long[1749270125080]</span><br><span class="line"></span><br><span class="line"><span class="comment">## è·å–é™æ€å˜é‡å±æ€§</span></span><br><span class="line">[arthas@7339]$ ognl <span class="string">&#x27;@demo.MathGame@random&#x27;</span></span><br><span class="line">@Random[</span><br><span class="line">    serialVersionUID=@Long[3905348978240129619],</span><br><span class="line">    seed=@AtomicLong[66121191540312],</span><br><span class="line">    multiplier=@Long[25214903917],</span><br><span class="line">    addend=@Long[11],</span><br><span class="line">    mask=@Long[281474976710655],</span><br><span class="line">    DOUBLE_UNIT=@Double[1.1102230246251565E-16],</span><br><span class="line">    BadBound=@String[bound must be positive],</span><br><span class="line">    BadRange=@String[bound must be greater than origin],</span><br><span class="line">    BadSize=@String[size must be non-negative],</span><br><span class="line">    seedUniquifier=@AtomicLong[-2942033378085796212],</span><br><span class="line">    nextNextGaussian=@Double[0.0],</span><br><span class="line">    haveNextNextGaussian=@Boolean[<span class="literal">false</span>],</span><br><span class="line">    serialPersistentFields=@ObjectStreamField[][isEmpty=<span class="literal">false</span>;size=3],</span><br><span class="line">    unsafe=@Unsafe[jdk.internal.misc.Unsafe@1004ff20],</span><br><span class="line">    seedOffset=@Long[24],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">## è·å–JVMç¯å¢ƒå˜é‡ä¸­çš„å±æ€§å€¼ï¼ŒæŠŠè·å–åˆ°çš„ç»“æœï¼Œåˆ†åˆ«èµ‹å€¼ç»™value1,value2ã€‚æœ€åå†å°†value1&amp;value2çš„å€¼æ”¾å…¥ArrayListé›†ä¸­ï¼Œæœ€åæ‰“å°ArrayListç»“æœã€‚</span></span><br><span class="line">[arthas@7339]$ ognl <span class="string">&#x27;#value1=@System@getProperty(&quot;java.home&quot;), #value2=@System@getProperty(&quot;java.runtime.name&quot;), &#123;#value1, #value2&#125;&#x27;</span></span><br><span class="line">@ArrayList[</span><br><span class="line">    @String[/usr/local/software/jdk-11.0.16.1],</span><br><span class="line">    @String[Java(TM) SE Runtime Environment],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æŸ¥çœ‹å½“å‰ JVM ä¿¡æ¯</summary>
    
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/tags/Arthas/"/>
    
    <category term="Arthasè¯Šæ–­å·¥å…·" scheme="https://yuanxw.github.io/tags/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Arthasè¯Šæ–­**å·¥å…·(ä¸€)**Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¿«é€Ÿå…¥é—¨</title>
    <link href="https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%BA%8C)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%BA%8C)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</id>
    <published>2023-03-01T16:00:00.000Z</published>
    <updated>2025-09-03T15:38:38.827Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasè¯Šæ–­å·¥å…·-äºŒ-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¸¸ç”¨å‘½ä»¤"><a href="#Arthasè¯Šæ–­å·¥å…·-äºŒ-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Arthasè¯Šæ–­å·¥å…·(äºŒ)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¸¸ç”¨å‘½ä»¤"></a><strong>Arthasè¯Šæ–­</strong>å·¥å…·(äºŒ)<strong>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¸¸ç”¨å‘½ä»¤</strong></h1><h2 id="1-dashboardå‘½ä»¤"><a href="#1-dashboardå‘½ä»¤" class="headerlink" title="1. dashboardå‘½ä»¤"></a>1. <strong>dashboardå‘½ä»¤</strong></h2><h3 id="1-1-æ•°æ®è¯´æ˜"><a href="#1-1-æ•°æ®è¯´æ˜" class="headerlink" title="1.1 æ•°æ®è¯´æ˜"></a><strong>1.1 æ•°æ®è¯´æ˜</strong></h3><ul><li>ID: Java çº§åˆ«çš„çº¿ç¨‹ IDï¼Œæ³¨æ„è¿™ä¸ª ID ä¸èƒ½è·Ÿ jstack ä¸­çš„ nativeID ä¸€ä¸€å¯¹åº”ã€‚</li><li>NAME: çº¿ç¨‹å</li><li>GROUP: çº¿ç¨‹ç»„å</li><li>PRIORITY: çº¿ç¨‹ä¼˜å…ˆçº§, 1~10 ä¹‹é—´çš„æ•°å­—ï¼Œè¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜</li><li>STATE: çº¿ç¨‹çš„çŠ¶æ€</li><li>CPU%: çº¿ç¨‹çš„ cpu ä½¿ç”¨ç‡ã€‚æ¯”å¦‚é‡‡æ ·é—´éš” 1000msï¼ŒæŸä¸ªçº¿ç¨‹çš„å¢é‡ cpu æ—¶é—´ä¸º 100msï¼Œåˆ™ cpu ä½¿ç”¨ç‡&#x3D;100&#x2F;1000&#x3D;10%</li><li>DELTA_TIME: ä¸Šæ¬¡é‡‡æ ·ä¹‹åçº¿ç¨‹è¿è¡Œå¢é‡ CPU æ—¶é—´ï¼Œæ•°æ®æ ¼å¼ä¸º<code>ç§’</code></li><li>TIME: çº¿ç¨‹è¿è¡Œæ€» CPU æ—¶é—´ï¼Œæ•°æ®æ ¼å¼ä¸º<code>åˆ†:ç§’</code></li><li>INTERRUPTED: çº¿ç¨‹å½“å‰çš„ä¸­æ–­ä½çŠ¶æ€</li><li>DAEMON: æ˜¯å¦æ˜¯ daemon çº¿ç¨‹</li></ul><h3 id="1-2-JVM-å†…éƒ¨çº¿ç¨‹"><a href="#1-2-JVM-å†…éƒ¨çº¿ç¨‹" class="headerlink" title="1.2 JVM å†…éƒ¨çº¿ç¨‹"></a><strong>1.2 JVM å†…éƒ¨çº¿ç¨‹</strong></h3><p>Java 8 ä¹‹åæ”¯æŒè·å– JVM å†…éƒ¨çº¿ç¨‹ CPU æ—¶é—´ï¼Œè¿™äº›çº¿ç¨‹åªæœ‰åç§°å’Œ CPU æ—¶é—´ï¼Œæ²¡æœ‰ ID åŠçŠ¶æ€ç­‰ä¿¡æ¯ï¼ˆæ˜¾ç¤º ID ä¸º-1ï¼‰ã€‚ é€šè¿‡å†…éƒ¨çº¿ç¨‹å¯ä»¥è§‚æµ‹åˆ° JVM æ´»åŠ¨ï¼Œå¦‚ GCã€JIT ç¼–è¯‘ç­‰å ç”¨ CPU æƒ…å†µï¼Œæ–¹ä¾¿äº†è§£ JVM æ•´ä½“è¿è¡ŒçŠ¶å†µã€‚</p><ul><li>å½“ JVM å †(heap)&#x2F;å…ƒæ•°æ®(metaspace)ç©ºé—´ä¸è¶³æˆ– OOM æ—¶ï¼Œå¯ä»¥çœ‹åˆ° GC çº¿ç¨‹çš„ CPU å ç”¨ç‡æ˜æ˜¾é«˜äºå…¶ä»–çš„çº¿ç¨‹ã€‚</li><li>å½“æ‰§è¡Œ<code>trace/watch/tt/redefine</code>ç­‰å‘½ä»¤åï¼Œå¯ä»¥çœ‹åˆ° JIT çº¿ç¨‹æ´»åŠ¨å˜å¾—æ›´é¢‘ç¹ã€‚å› ä¸º JVM çƒ­æ›´æ–° class å­—èŠ‚ç æ—¶æ¸…é™¤äº†æ­¤ class ç›¸å…³çš„ JIT ç¼–è¯‘ç»“æœï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ã€‚</li></ul><p>JVM å†…éƒ¨çº¿ç¨‹åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</p><ul><li>JIT ç¼–è¯‘çº¿ç¨‹: å¦‚Â <code>C1 CompilerThread0</code>,Â <code>C2 CompilerThread0</code></li><li>GC çº¿ç¨‹: å¦‚<code>GC Thread0</code>,Â <code>G1 Young RemSet Sampling</code></li><li>å…¶å®ƒå†…éƒ¨çº¿ç¨‹: å¦‚<code>VM Periodic Task Thread</code>,Â <code>VM Thread</code>,Â <code>Service Thread</code></li></ul><p><img src="/images/arthas/chapter2/image.png" alt="image.png"></p><h2 id="2-thread-å‘½ä»¤"><a href="#2-thread-å‘½ä»¤" class="headerlink" title="2. thread å‘½ä»¤"></a>2. <strong>thread å‘½ä»¤</strong></h2><p>é€šè¿‡ thread å‘½ä»¤æ¥è·å–åˆ°<code>math-game</code>è¿›ç¨‹çš„ Main Classã€‚<code>thread 1</code>ä¼šæ‰“å°çº¿ç¨‹ ID 1 çš„æ ˆï¼Œé€šå¸¸æ˜¯ main å‡½æ•°çš„çº¿ç¨‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ **thread** </span><br><span class="line">Threads Total: 30, NEW: 0, RUNNABLE: 12, BLOCKED: 0, WAITING: 2, TIMED_WAITING: 4, TERMINATED: 0, Internal threads: 12                                                                                                                                                        </span><br><span class="line">ID         NAME                                                                GROUP                             PRIORITY              STATE                  %CPU                  DELTA_TIME             TIME                  INTERRUPTED            DAEMON                </span><br><span class="line">-1         C1 CompilerThread0                                                  -                                 -1                    -                      0.26                  0.000                  0:3.219               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">24         arthas-command-execute                                              system                            5                     RUNNABLE               0.15                  0.000                  0:0.016               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         VM Periodic Task Thread                                             -                                 -1                    -                      0.05                  0.000                  0:3.005               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         GC Thread#1                                                         -                                 -1                    -                      0.03                  0.000                  0:0.405               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         VM Thread                                                           -                                 -1                    -                      0.03                  0.000                  0:0.487               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         GC Thread#0                                                         -                                 -1                    -                      0.03                  0.000                  0:0.409               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Young RemSet Sampling                                            -                                 -1                    -                      0.02                  0.000                  0:0.879               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         C2 CompilerThread0                                                  -                                 -1                    -                      0.0                   0.000                  0:5.703               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">2          Reference Handler                                                   system                            10                    RUNNABLE               0.0                   0.000                  0:0.001               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">3          Finalizer                                                           system                            8                     WAITING                0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">4          Signal Dispatcher                                                   system                            9                     RUNNABLE               0.0                   0.000                  0:0.003               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">11         Attach Listener                                                     system                            9                     RUNNABLE               0.0                   0.000                  0:0.119               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">13         arthas-timer                                                        system                            9                     WAITING                0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">16         arthas-NettyHttpTelnetBootstrap-3-1                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.040               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">17         arthas-NettyWebsocketTtyBootstrap-4-1                               system                            5                     RUNNABLE               0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">18         arthas-NettyWebsocketTtyBootstrap-4-2                               system                            5                     RUNNABLE               0.0                   0.000                  0:0.001               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">19         arthas-shell-server                                                 system                            9                     TIMED_WAITING          0.0                   0.000                  0:0.020               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">20         arthas-session-manager                                              system                            9                     TIMED_WAITING          0.0                   0.000                  0:0.009               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">22         arthas-NettyHttpTelnetBootstrap-3-2                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.337               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">23         arthas-NettyHttpTelnetBootstrap-3-3                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.029               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">25         arthas-NettyHttpTelnetBootstrap-3-4                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.025               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">26         arthas-NettyHttpTelnetBootstrap-3-5                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.027               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">27         arthas-NettyHttpTelnetBootstrap-3-6                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.500               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">1          main                                                                main                              5                     TIMED_WAITING          0.0                   0.000                  0:1.265               <span class="literal">false</span>                  <span class="literal">false</span>                 </span><br><span class="line">10         Common-Cleaner                                                      InnocuousThreadGroup              8                     TIMED_WAITING          0.0                   0.000                  0:0.005               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         Sweeper thread                                                      -                                 -1                    -                      0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Conc#0                                                           -                                 -1                    -                      0.0                   0.000                  0:0.012               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Refine#0                                                         -                                 -1                    -                      0.0                   0.000                  0:0.003               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Main Marker                                                      -                                 -1                    -                      0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         Service Thread                                                      -                                 -1                    -                      0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">                                                                                                                                                                                                                                                                              </span><br><span class="line">[arthas@5167]$ **thread 1**</span><br><span class="line"><span class="string">&quot;main&quot;</span> Id=1 TIMED_WAITING</span><br><span class="line">    at java.base@11.0.16.1/java.lang.Thread.<span class="built_in">sleep</span>(Native Method)</span><br><span class="line">    at java.base@11.0.16.1/java.lang.Thread.<span class="built_in">sleep</span>(Thread.java:339)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.TimeUnit.<span class="built_in">sleep</span>(TimeUnit.java:446)</span><br><span class="line">    at app//demo.MathGame.main(MathGame.java:17)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>æ”¯æŒä¸€é”®å±•ç¤ºå½“å‰æœ€å¿™çš„å‰ N ä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆï¼š</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ thread -n 3</span><br><span class="line"><span class="string">&quot;arthas-command-execute&quot;</span> Id=24 cpuUsage=0.31% deltaTime=0ms <span class="keyword">time</span>=1521ms RUNNABLE</span><br><span class="line">    at java.management@11.0.16.1/sun.management.ThreadImpl.dumpThreads0(Native Method)</span><br><span class="line">    at java.management@11.0.16.1/sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:485)</span><br><span class="line">    at com.taobao.arthas.core.command.monitor200.ThreadCommand.processTopBusyThreads(ThreadCommand.java:206)</span><br><span class="line">    at com.taobao.arthas.core.command.monitor200.ThreadCommand.process(ThreadCommand.java:122)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.process(AnnotatedCommandImpl.java:82)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.access<span class="variable">$100</span>(AnnotatedCommandImpl.java:18)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl<span class="variable">$ProcessHandler</span>.handle(AnnotatedCommandImpl.java:111)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl<span class="variable">$ProcessHandler</span>.handle(AnnotatedCommandImpl.java:108)</span><br><span class="line">    at com.taobao.arthas.core.shell.system.impl.ProcessImpl<span class="variable">$CommandProcessTask</span>.run(ProcessImpl.java:385)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.Executors<span class="variable">$RunnableAdapter</span>.call(Executors.java:515)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.FutureTask.run(FutureTask.java:264)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.ScheduledThreadPoolExecutor<span class="variable">$ScheduledFutureTask</span>.run(ScheduledThreadPoolExecutor.java:304)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:628)</span><br><span class="line">    at java.base@11.0.16.1/java.lang.Thread.run(Thread.java:834)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>thread -b, æ‰¾å‡ºå½“å‰é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹</strong></li></ul><p>æœ‰æ—¶å€™æˆ‘ä»¬å‘ç°åº”ç”¨å¡ä½äº†ï¼Œ é€šå¸¸æ˜¯ç”±äºæŸä¸ªçº¿ç¨‹æ‹¿ä½äº†æŸä¸ªé”ï¼Œ å¹¶ä¸”å…¶ä»–çº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™æŠŠé”é€ æˆçš„ã€‚ ä¸ºäº†æ’æŸ¥è¿™ç±»é—®é¢˜ï¼Œ arthas æä¾›äº†<code>thread -b</code>ï¼Œ ä¸€é”®æ‰¾å‡ºé‚£ä¸ªç½ªé­ç¥¸é¦–ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ thread -b</span><br><span class="line">No most blocking thread found!</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>thread -i, æŒ‡å®šé‡‡æ ·æ—¶é—´é—´éš”</strong></li><li><code>thread -i 1000</code>Â : ç»Ÿè®¡æœ€è¿‘ 1000ms å†…çš„çº¿ç¨‹ CPU æ—¶é—´ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ thread -i 1000</span><br><span class="line">Threads Total: 32, NEW: 0, RUNNABLE: 14, BLOCKED: 0, WAITING: 2, TIMED_WAITING: 4, TERMINATED: 0, Internal threads: 12                                                                                                                                                        </span><br><span class="line">ID         NAME                                                                GROUP                             PRIORITY              STATE                  %CPU                  DELTA_TIME             TIME                  INTERRUPTED            DAEMON                </span><br><span class="line">-1         VM Periodic Task Thread                                             -                                 -1                    -                      0.08                  0.000                  0:29.457              <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         C1 CompilerThread0                                                  -                                 -1                    -                      0.04                  0.000                  0:6.510               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">24         arthas-command-execute                                              system                            5                     RUNNABLE               0.02                  0.000                  0:1.580               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Young RemSet Sampling                                            -                                 -1                    -                      0.02                  0.000                  0:10.490              <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">1          main                                                                main                              5                     TIMED_WAITING          0.01                  0.000                  0:9.671               <span class="literal">false</span>                  <span class="literal">false</span>                 </span><br><span class="line">-1         VM Thread                                                           -                                 -1                    -                      0.01                  0.000                  0:5.414               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         GC Thread#1                                                         -                                 -1                    -                      0.01                  0.000                  0:3.250               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         GC Thread#0                                                         -                                 -1                    -                      0.0                   0.000                  0:3.276               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">2          Reference Handler                                                   system                            10                    RUNNABLE               0.0                   0.000                  0:0.002               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">3          Finalizer                                                           system                            8                     WAITING                0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">4          Signal Dispatcher                                                   system                            9                     RUNNABLE               0.0                   0.000                  0:0.003               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">11         Attach Listener                                                     system                            9                     RUNNABLE               0.0                   0.000                  0:0.119               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">13         arthas-timer                                                        system                            9                     WAITING                0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">16         arthas-NettyHttpTelnetBootstrap-3-1                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.042               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">17         arthas-NettyWebsocketTtyBootstrap-4-1                               system                            5                     RUNNABLE               0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">18         arthas-NettyWebsocketTtyBootstrap-4-2                               system                            5                     RUNNABLE               0.0                   0.000                  0:0.001               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">19         arthas-shell-server                                                 system                            9                     TIMED_WAITING          0.0                   0.000                  0:0.106               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">20         arthas-session-manager                                              system                            9                     TIMED_WAITING          0.0                   0.000                  0:0.072               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">22         arthas-NettyHttpTelnetBootstrap-3-2                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.337               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">23         arthas-NettyHttpTelnetBootstrap-3-3                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.029               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">25         arthas-NettyHttpTelnetBootstrap-3-4                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.025               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">26         arthas-NettyHttpTelnetBootstrap-3-5                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.027               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">27         arthas-NettyHttpTelnetBootstrap-3-6                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.572               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">33         arthas-NettyHttpTelnetBootstrap-3-7                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.022               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">34         arthas-NettyHttpTelnetBootstrap-3-8                                 system                            5                     RUNNABLE               0.0                   0.000                  0:0.674               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">10         Common-Cleaner                                                      InnocuousThreadGroup              8                     TIMED_WAITING          0.0                   0.000                  0:0.044               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         Sweeper thread                                                      -                                 -1                    -                      0.0                   0.000                  0:0.008               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Conc#0                                                           -                                 -1                    -                      0.0                   0.000                  0:0.066               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Refine#0                                                         -                                 -1                    -                      0.0                   0.000                  0:0.005               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         C2 CompilerThread0                                                  -                                 -1                    -                      0.0                   0.000                  0:15.009              <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         G1 Main Marker                                                      -                                 -1                    -                      0.0                   0.000                  0:0.001               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">-1         Service Thread                                                      -                                 -1                    -                      0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>  </span><br></pre></td></tr></table></figure><ul><li><code>thread -n 3 -i 100</code>Â : åˆ—å‡º 100ms å†…æœ€å¿™çš„ 3 ä¸ªçº¿ç¨‹æ ˆ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ thread -n 3 -i 100</span><br><span class="line"><span class="string">&quot;arthas-command-execute&quot;</span> Id=24 cpuUsage=0.26% deltaTime=0ms <span class="keyword">time</span>=1585ms RUNNABLE</span><br><span class="line">    at java.management@11.0.16.1/sun.management.ThreadImpl.dumpThreads0(Native Method)</span><br><span class="line">    at java.management@11.0.16.1/sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:485)</span><br><span class="line">    at com.taobao.arthas.core.command.monitor200.ThreadCommand.processTopBusyThreads(ThreadCommand.java:206)</span><br><span class="line">    at com.taobao.arthas.core.command.monitor200.ThreadCommand.process(ThreadCommand.java:122)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.process(AnnotatedCommandImpl.java:82)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl.access<span class="variable">$100</span>(AnnotatedCommandImpl.java:18)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl<span class="variable">$ProcessHandler</span>.handle(AnnotatedCommandImpl.java:111)</span><br><span class="line">    at com.taobao.arthas.core.shell.command.impl.AnnotatedCommandImpl<span class="variable">$ProcessHandler</span>.handle(AnnotatedCommandImpl.java:108)</span><br><span class="line">    at com.taobao.arthas.core.shell.system.impl.ProcessImpl<span class="variable">$CommandProcessTask</span>.run(ProcessImpl.java:385)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.Executors<span class="variable">$RunnableAdapter</span>.call(Executors.java:515)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.FutureTask.run(FutureTask.java:264)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.ScheduledThreadPoolExecutor<span class="variable">$ScheduledFutureTask</span>.run(ScheduledThreadPoolExecutor.java:304)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)</span><br><span class="line">    at java.base@11.0.16.1/java.util.concurrent.ThreadPoolExecutor<span class="variable">$Worker</span>.run(ThreadPoolExecutor.java:628)</span><br><span class="line">    at java.base@11.0.16.1/java.lang.Thread.run(Thread.java:834)</span><br></pre></td></tr></table></figure><ul><li><strong>thread â€“state ï¼ŒæŸ¥çœ‹æŒ‡å®šçŠ¶æ€çš„çº¿ç¨‹</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ thread --state WAITING</span><br><span class="line">Threads Total: 20, NEW: 0, RUNNABLE: 14, BLOCKED: 0, WAITING: 2, TIMED_WAITING: 4, TERMINATED: 0                                                                                                                                                                              </span><br><span class="line">ID         NAME                                                                GROUP                             PRIORITY              STATE                  %CPU                  DELTA_TIME             TIME                  INTERRUPTED            DAEMON                </span><br><span class="line">3          Finalizer                                                           system                            8                     WAITING                0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>                  </span><br><span class="line">13         arthas-timer                                                        system                            9                     WAITING                0.0                   0.000                  0:0.000               <span class="literal">false</span>                  <span class="literal">true</span>         </span><br></pre></td></tr></table></figure><h2 id="3-watch-å‘½ä»¤"><a href="#3-watch-å‘½ä»¤" class="headerlink" title="3. watch å‘½ä»¤"></a>3. <strong>watch å‘½ä»¤</strong></h2><p>é€šè¿‡<a href="https://arthas.aliyun.com/doc/watch.html"><strong>watch</strong></a>å‘½ä»¤æ¥æŸ¥çœ‹<code>demo.MathGame#primeFactors</code>å‡½æ•°çš„è¿”å›å€¼ï¼š</p><p> watch demo.MathGame primeFactors returnObj </p><ul><li>demo.MathGame å…¨ç±»å</li><li>primeFactors æ–¹æ³•å</li><li>è¿”å›å¯¹è±¡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[arthas@5167]$ watch demo.MathGame primeFactors returnObj </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 204 ms, listenerId: 1</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=2025-06-06 10:28:13.587; [cost=4.005634ms] result=@ArrayList[</span><br><span class="line">    @Integer[7],</span><br><span class="line">    @Integer[11],</span><br><span class="line">    @Integer[1301],</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExceptionExit</span><br><span class="line">ts=2025-06-06 10:28:14.591; [cost=0.129017ms] result=null</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=2025-06-06 10:28:15.602; [cost=8.688466ms] result=@ArrayList[</span><br><span class="line">    @Integer[2],</span><br><span class="line">    @Integer[3],</span><br><span class="line">    @Integer[12409],</span><br><span class="line">]</span><br><span class="line">method=demo.MathGame.primeFactors location=AtExit</span><br><span class="line">ts=2025-06-06 10:28:16.606; [cost=0.057975ms] result=@ArrayList[</span><br><span class="line">    @Integer[2],</span><br><span class="line">    @Integer[2],</span><br><span class="line">    @Integer[5],</span><br><span class="line">    @Integer[23],</span><br><span class="line">    @Integer[173],</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-é€€å‡º-arthas"><a href="#4-é€€å‡º-arthas" class="headerlink" title="4.é€€å‡º arthas"></a><strong>4.é€€å‡º arthas</strong></h2><p>å¦‚æœåªæ˜¯é€€å‡ºå½“å‰çš„è¿æ¥ï¼Œå¯ä»¥ç”¨<code>quit</code>æˆ–è€…<code>exit</code>å‘½ä»¤ã€‚Attach åˆ°ç›®æ ‡è¿›ç¨‹ä¸Šçš„ arthas è¿˜ä¼šç»§ç»­è¿è¡Œï¼Œç«¯å£ä¼šä¿æŒå¼€æ”¾ï¼Œä¸‹æ¬¡è¿æ¥æ—¶å¯ä»¥ç›´æ¥è¿æ¥ä¸Šã€‚</p><p>å¦‚æœæƒ³å®Œå…¨é€€å‡º arthasï¼Œå¯ä»¥æ‰§è¡Œ<code>stop</code>å‘½ä»¤ã€‚</p><h3 id="5-å¸®åŠ©Help"><a href="#5-å¸®åŠ©Help" class="headerlink" title="5.å¸®åŠ©Help"></a>5.å¸®åŠ©Help</h3><p>æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰ arthas ç‰ˆæœ¬æ”¯æŒçš„æŒ‡ä»¤ï¼Œæˆ–è€…æŸ¥çœ‹å…·ä½“æŒ‡ä»¤çš„ä½¿ç”¨è¯´æ˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ <span class="built_in">help</span></span><br><span class="line"> NAME         DESCRIPTION                                                                                                                                                                                                                                                     </span><br><span class="line"> <span class="built_in">help</span>         Display Arthas Help                                                                                                                                                                                                                                             </span><br><span class="line"> auth         Authenticates the current session                                                                                                                                                                                                                               </span><br><span class="line"> keymap       Display all the available keymap <span class="keyword">for</span> the specified connection.                                                                                                                                                                                                  </span><br><span class="line"> sc           Search all the classes loaded by JVM                                                                                                                                                                                                                            </span><br><span class="line"> sm           Search the method of classes loaded by JVM                                                                                                                                                                                                                      </span><br><span class="line"> classloader  Show classloader info                                                                                                                                                                                                                                           </span><br><span class="line"> jad          Decompile class                                                                                                                                                                                                                                                 </span><br><span class="line"> getstatic    Show the static field of a class                                                                                                                                                                                                                                </span><br><span class="line"> monitor      Monitor method execution statistics, e.g. total/success/failure count, average rt, fail rate, etc.                                                                                                                                                              </span><br><span class="line"> stack        Display the stack trace <span class="keyword">for</span> the specified class and method                                                                                                                                                                                                      </span><br><span class="line"> thread       Display thread info, thread stack                                                                                                                                                                                                                               </span><br><span class="line"> trace        Trace the execution <span class="keyword">time</span> of specified method invocation.                                                                                                                                                                                                        </span><br><span class="line"> watch        Display the input/output parameter, <span class="built_in">return</span> object, and thrown exception of specified method invocation                                                                                                                                                          </span><br><span class="line"> tt           Time Tunnel                                                                                                                                                                                                                                                     </span><br><span class="line"> jvm          Display the target JVM information                                                                                                                                                                                                                              </span><br><span class="line"> memory       Display jvm memory info.                                                                                                                                                                                                                                        </span><br><span class="line"> perfcounter  Display the perf counter information.                                                                                                                                                                                                                           </span><br><span class="line"> ognl         Execute ognl expression.                                                                                                                                                                                                                                        </span><br><span class="line"> mc           Memory compiler, compiles java files into bytecode and class files <span class="keyword">in</span> memory.                                                                                                                                                                                   </span><br><span class="line"> redefine     Redefine classes. @see Instrumentation#redefineClasses(ClassDefinition...)                                                                                                                                                                                      </span><br><span class="line"> retransform  Retransform classes. @see Instrumentation#retransformClasses(Class...)                                                                                                                                                                                          </span><br><span class="line"> dashboard    Overview of target jvm<span class="string">&#x27;s thread, memory, gc, vm, tomcat info.                                                                                                                                                                                                   </span></span><br><span class="line"><span class="string"> dump         Dump class byte array from JVM                                                                                                                                                                                                                                  </span></span><br><span class="line"><span class="string"> heapdump     Heap dump                                                                                                                                                                                                                                                       </span></span><br><span class="line"><span class="string"> options      View and change various Arthas options                                                                                                                                                                                                                          </span></span><br><span class="line"><span class="string"> cls          Clear the screen                                                                                                                                                                                                                                                </span></span><br><span class="line"><span class="string"> reset        Reset all the enhanced classes                                                                                                                                                                                                                                  </span></span><br><span class="line"><span class="string"> version      Display Arthas version                                                                                                                                                                                                                                          </span></span><br><span class="line"><span class="string"> session      Display current session information                                                                                                                                                                                                                             </span></span><br><span class="line"><span class="string"> sysprop      Display and change the system properties.                                                                                                                                                                                                                       </span></span><br><span class="line"><span class="string"> sysenv       Display the system env.                                                                                                                                                                                                                                         </span></span><br><span class="line"><span class="string"> vmoption     Display, and update the vm diagnostic options.                                                                                                                                                                                                                  </span></span><br><span class="line"><span class="string"> logger       Print logger info, and update the logger level                                                                                                                                                                                                                  </span></span><br><span class="line"><span class="string"> history      Display command history                                                                                                                                                                                                                                         </span></span><br><span class="line"><span class="string"> cat          Concatenate and print files                                                                                                                                                                                                                                     </span></span><br><span class="line"><span class="string"> base64       Encode and decode using Base64 representation                                                                                                                                                                                                                   </span></span><br><span class="line"><span class="string"> echo         write arguments to the standard output                                                                                                                                                                                                                          </span></span><br><span class="line"><span class="string"> pwd          Return working directory name                                                                                                                                                                                                                                   </span></span><br><span class="line"><span class="string"> mbean        Display the mbean information                                                                                                                                                                                                                                   </span></span><br><span class="line"><span class="string"> grep         grep command for pipes.                                                                                                                                                                                                                                         </span></span><br><span class="line"><span class="string"> tee          tee command for pipes.                                                                                                                                                                                                                                          </span></span><br><span class="line"><span class="string"> profiler     Async Profiler. https://github.com/jvm-profiling-tools/async-profiler                                                                                                                                                                                           </span></span><br><span class="line"><span class="string"> vmtool       jvm tool                                                                                                                                                                                                                                                        </span></span><br><span class="line"><span class="string"> stop         Stop/Shutdown Arthas server and exit the console.                                                                                                                                                                                                               </span></span><br><span class="line"><span class="string"> jfr          Java Flight Recorder Command</span></span><br></pre></td></tr></table></figure><h3 id="6-groupåˆ†ç»„"><a href="#6-groupåˆ†ç»„" class="headerlink" title="6.groupåˆ†ç»„"></a>6.groupåˆ†ç»„</h3><p>ç±»ä¼¼ä¼ ç»Ÿçš„<code>grep</code>å‘½ä»¤ã€‚</p><ul><li>è¿‡æ»¤åŒ…å«javaå…³é”®çš„æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## è¿‡æ»¤åŒ…å«javaå…³é”®çš„æ•°æ®</span></span><br><span class="line">[arthas@5167]$ sysprop | grep java</span><br><span class="line"> java.specification.version                            11</span><br><span class="line"> java.class.path                                       math-game.jar</span><br><span class="line"> java.vm.vendor                                        Oracle Corporation</span><br><span class="line"> java.vendor.url                                       https://openjdk.java.net/</span><br><span class="line"> java.vm.specification.version                         11</span><br><span class="line"> sun.java.launcher                                     SUN_STANDARD</span><br><span class="line"> sun.java.command                                      math-game.jar</span><br><span class="line"> java.specification.vendor                             Oracle Corporation</span><br><span class="line"> java.version.date                                     2022-08-18</span><br><span class="line"> java.home                                             /usr/local/software/jdk-11.0.16.1</span><br><span class="line"> java.vm.compressedOopsMode                            32-bit</span><br><span class="line"> java.specification.name                               Java Platform API Specification</span><br><span class="line"> java.vm.specification.vendor                          Oracle Corporation</span><br><span class="line"> java.awt.graphicsenv                                  sun.awt.X11GraphicsEnvironment</span><br><span class="line"> java.runtime.version                                  11.0.16.1+1-LTS-1</span><br><span class="line"> java.runtime.name                                     Java(TM) SE Runtime Environment</span><br><span class="line"> java.vm.name                                          Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line"> java.vendor.version                                   18.9</span><br><span class="line"> java.vendor.url.bug                                   https://bugreport.java.com/bugreport/</span><br><span class="line"> java.io.tmpdir                                        /tmp</span><br><span class="line"> java.version                                          11.0.16.1</span><br><span class="line"> java.vm.specification.name                            Java Virtual Machine Specification</span><br><span class="line"> java.awt.printerjob                                   sun.print.PSPrinterJob</span><br><span class="line"> java.library.path                                     /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line"> java.vendor                                           Oracle Corporation</span><br><span class="line"> java.vm.info                                          mixed mode</span><br><span class="line"> java.vm.version                                       11.0.16.1+1-LTS-1</span><br><span class="line"> java.class.version                                    55.</span><br></pre></td></tr></table></figure><ul><li>è¿‡æ»¤åŒ…å«javaå…³é”®çš„æ•°æ®ï¼Œå¹¶æ˜¾ç¤ºå‡ºå¯¹åº”çš„è¡Œå·</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[arthas@5167]$ sysprop | grep java -n</span><br><span class="line">4: java.specification.version                            11</span><br><span class="line">7: java.class.path                                       math-game.jar</span><br><span class="line">8: java.vm.vendor                                        Oracle Corporation</span><br><span class="line">10: java.vendor.url                                       https://openjdk.java.net/</span><br><span class="line">13: java.vm.specification.version                         11</span><br><span class="line">14: sun.java.launcher                                     SUN_STANDARD</span><br><span class="line">17: sun.java.command                                      math-game.jar</span><br><span class="line">22: java.specification.vendor                             Oracle Corporation</span><br><span class="line">23: java.version.date                                     2022-08-18</span><br><span class="line">24: java.home                                             /usr/local/software/jdk-11.0.16.1</span><br><span class="line">26: java.vm.compressedOopsMode                            32-bit</span><br><span class="line">28: java.specification.name                               Java Platform API Specification</span><br><span class="line">29: java.vm.specification.vendor                          Oracle Corporation</span><br><span class="line">30: java.awt.graphicsenv                                  sun.awt.X11GraphicsEnvironment</span><br><span class="line">32: java.runtime.version                                  11.0.16.1+1-LTS-1</span><br><span class="line">36: java.runtime.name                                     Java(TM) SE Runtime Environment</span><br><span class="line">38: java.vm.name                                          Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">39: java.vendor.version                                   18.9</span><br><span class="line">40: java.vendor.url.bug                                   https://bugreport.java.com/bugreport/</span><br><span class="line">41: java.io.tmpdir                                        /tmp</span><br><span class="line">42: java.version                                          11.0.16.1</span><br><span class="line">45: java.vm.specification.name                            Java Virtual Machine Specification</span><br><span class="line">46: java.awt.printerjob                                   sun.print.PSPrinterJob</span><br><span class="line">48: java.library.path                                     /usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">49: java.vendor                                           Oracle Corporation</span><br><span class="line">50: java.vm.info                                          mixed mode</span><br><span class="line">51: java.vm.version                                       11.0.16.1+1-LTS-1</span><br><span class="line">53: java.class.version                                    55.0</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>è¿‡æ»¤ä¸åŒ…å«javaå…³é”®çš„æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ sysenv | grep -v JAVA</span><br><span class="line"> KEY                                                   VALUE                                                                                                                                                                                                                 </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CLASSPATH                                             .:/usr/local/software/jdk-11.0.16.1/lib/dt.jar:/usr/local/software/jdk-11.0.16.1/lib/tools.jar</span><br><span class="line"> HISTCONTROL                                           ignoredups</span><br><span class="line"> HISTSIZE                                              1000</span><br><span class="line"> HOME                                                  /root</span><br><span class="line"> HOSTNAME                                              localhost.localdomain</span><br><span class="line"> LANG                                                  en_US.UTF-8</span><br><span class="line"> LESSOPEN                                              ||/usr/bin/lesspipe.sh %s</span><br><span class="line"> LOGNAME                                               root</span><br><span class="line"> LS_COLORS                                             rs=0:di=01;34:<span class="built_in">ln</span>=01;36:mh=00:pi=40;33:so=01;35:<span class="keyword">do</span>=01;35:bd=40;33;01:<span class="built_in">cd</span>=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01</span><br><span class="line">                                                       ;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*</span><br><span class="line">                                                       .bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*</span><br><span class="line">                                                       .cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01</span><br><span class="line">                                                       ;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.<span class="built_in">rm</span>=01;35:*.rmvb=01;35:*.fl</span><br><span class="line">                                                       c=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mi</span><br><span class="line">                                                       d=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:</span><br><span class="line"> MAIL                                                  /var/spool/mail/root</span><br><span class="line"> OLDPWD                                                /usr/local/software</span><br><span class="line"> PATH                                                  /usr/local/software/jdk-11.0.16.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"> PWD                                                   /usr/local/software/arthas</span><br><span class="line"> SELINUX_LEVEL_REQUESTED</span><br><span class="line"> SELINUX_ROLE_REQUESTED</span><br><span class="line"> SELINUX_USE_CURRENT_RANGE</span><br><span class="line"> SHELL                                                 /bin/bash</span><br><span class="line"> SHLVL                                                 1</span><br><span class="line"> SSH_CLIENT                                            192.168.3.74 6122 22</span><br><span class="line"> SSH_CONNECTION                                        192.168.3.74 6122 192.168.3.125 22</span><br><span class="line"> SSH_TTY                                               /dev/pts/1</span><br><span class="line"> TERM                                                  xterm</span><br><span class="line"> USER                                                  root</span><br><span class="line"> XDG_RUNTIME_DIR                                       /run/user/0</span><br><span class="line"> XDG_SESSION_ID                                        5</span><br><span class="line"> _                                                     /usr/local/software/jdk-11.0.16.1/bin/java</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ‰€éœ€è¦æ•°æ®</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ sysenv | grep -e <span class="string">&quot;(?i)(JAVA|sun)&quot;</span></span><br><span class="line"> JAVA_HOME                                             /usr/local/software/jdk-11.0.16.1</span><br><span class="line"> _                                                     /usr/local/software/jdk-11.0.16.1/bin/java</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-å¿«æ·é”®æ˜ å°„è¡¨keymap"><a href="#7-å¿«æ·é”®æ˜ å°„è¡¨keymap" class="headerlink" title="7.å¿«æ·é”®æ˜ å°„è¡¨keymap"></a>7.å¿«æ·é”®æ˜ å°„è¡¨keymap</h3><p><code>keymap</code>å‘½ä»¤è¾“å‡ºå½“å‰çš„å¿«æ·é”®æ˜ å°„è¡¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[arthas@5167]$ keymap</span><br><span class="line"> Shortcut                                                            Description                                                        Name                                                                                                                                  </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> <span class="string">&quot;\C-a&quot;</span>                                                              Ctrl + a                                                            beginning-of-line                                                                                                                    </span><br><span class="line"> <span class="string">&quot;\C-e&quot;</span>                                                              Ctrl + e                                                            end-of-line                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\C-f&quot;</span>                                                              Ctrl + f                                                            forward-word                                                                                                                         </span><br><span class="line"> <span class="string">&quot;\C-b&quot;</span>                                                              Ctrl + b                                                            backward-word                                                                                                                        </span><br><span class="line"> <span class="string">&quot;\e[D&quot;</span>                                                              Left arrow                                                          backward-char                                                                                                                        </span><br><span class="line"> <span class="string">&quot;\e[C&quot;</span>                                                              Right arrow                                                         forward-char                                                                                                                         </span><br><span class="line"> <span class="string">&quot;\e[A&quot;</span>                                                              Up arrow                                                            history-search-backward                                                                                                              </span><br><span class="line"> <span class="string">&quot;\e[B&quot;</span>                                                              Down arrow                                                          history-search-forward                                                                                                               </span><br><span class="line"> <span class="string">&quot;\C-h&quot;</span>                                                              Ctrl + h                                                            backward-delete-char                                                                                                                 </span><br><span class="line"> <span class="string">&quot;\C-?&quot;</span>                                                              Ctrl + ?                                                            backward-delete-char                                                                                                                 </span><br><span class="line"> <span class="string">&quot;\C-u&quot;</span>                                                              Ctrl + u                                                            undo                                                                                                                                 </span><br><span class="line"> <span class="string">&quot;\C-d&quot;</span>                                                              Ctrl + d                                                            delete-char                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\C-k&quot;</span>                                                              Ctrl + k                                                            kill-line                                                                                                                            </span><br><span class="line"> <span class="string">&quot;\C-i&quot;</span>                                                              Ctrl + i                                                            complete                                                                                                                             </span><br><span class="line"> <span class="string">&quot;\C-j&quot;</span>                                                              Ctrl + j                                                            accept-line                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\C-m&quot;</span>                                                              Ctrl + m                                                            accept-line                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\C-w&quot;</span>                                                              Ctrl + w                                                            backward-delete-word                                                                                                                 </span><br><span class="line"> <span class="string">&quot;\C-x\e[3~&quot;</span>                                                         <span class="string">&quot;\C-x\e[3~&quot;</span>                                                         backward-kill-line                                                                                                                   </span><br><span class="line"> <span class="string">&quot;\e\C-?&quot;</span>                                                            <span class="string">&quot;\e\C-?&quot;</span>                                                            backward-kill-word                                                                                                                   </span><br><span class="line"> <span class="string">&quot;\e[1~&quot;</span>                                                             <span class="string">&quot;\e[1~&quot;</span>                                                             beginning-of-line                                                                                                                    </span><br><span class="line"> <span class="string">&quot;\e[4~&quot;</span>                                                             <span class="string">&quot;\e[4~&quot;</span>                                                             end-of-line                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\e[5~&quot;</span>                                                             <span class="string">&quot;\e[5~&quot;</span>                                                             beginning-of-history                                                                                                                 </span><br><span class="line"> <span class="string">&quot;\e[6~&quot;</span>                                                             <span class="string">&quot;\e[6~&quot;</span>                                                             end-of-history                                                                                                                       </span><br><span class="line"> <span class="string">&quot;\e[3~&quot;</span>                                                             <span class="string">&quot;\e[3~&quot;</span>                                                             delete-char                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\e[2~&quot;</span>                                                             <span class="string">&quot;\e[2~&quot;</span>                                                             quoted-insert                                                                                                                        </span><br><span class="line"> <span class="string">&quot;\e[7~&quot;</span>                                                             <span class="string">&quot;\e[7~&quot;</span>                                                             beginning-of-line                                                                                                                    </span><br><span class="line"> <span class="string">&quot;\e[8~&quot;</span>                                                             <span class="string">&quot;\e[8~&quot;</span>                                                             end-of-line                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\eOH&quot;</span>                                                              <span class="string">&quot;\eOH&quot;</span>                                                              beginning-of-line                                                                                                                    </span><br><span class="line"> <span class="string">&quot;\eOF&quot;</span>                                                              <span class="string">&quot;\eOF&quot;</span>                                                              end-of-line                                                                                                                          </span><br><span class="line"> <span class="string">&quot;\e[H&quot;</span>                                                              <span class="string">&quot;\e[H&quot;</span>                                                              beginning-of-line                                                                                                                    </span><br><span class="line"> <span class="string">&quot;\e[F&quot;</span>                                                              <span class="string">&quot;\e[F&quot;</span>                                                              end-of-lin</span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„å¿«æ·é”®å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å¿«æ·é”®</th><th>å¿«æ·é”®è¯´æ˜</th><th>å‘½ä»¤åç§°</th><th>å‘½ä»¤è¯´æ˜</th></tr></thead><tbody><tr><td><code>&quot;\C-a&quot;</code></td><td>ctrl + a</td><td>beginning-of-line</td><td>è·³åˆ°è¡Œé¦–</td></tr><tr><td><code>&quot;\C-e&quot;</code></td><td>ctrl + e</td><td>end-of-line</td><td>è·³åˆ°è¡Œå°¾</td></tr><tr><td><code>&quot;\C-f&quot;</code></td><td>ctrl + f</td><td>forward-word</td><td>å‘å‰ç§»åŠ¨ä¸€ä¸ªå•è¯</td></tr><tr><td><code>&quot;\C-b&quot;</code></td><td>ctrl + b</td><td>backward-word</td><td>å‘åç§»åŠ¨ä¸€ä¸ªå•è¯</td></tr><tr><td><code>&quot;\e[D&quot;</code></td><td>é”®ç›˜å·¦æ–¹å‘é”®</td><td>backward-char</td><td>å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td><code>&quot;\e[C&quot;</code></td><td>é”®ç›˜å³æ–¹å‘é”®</td><td>forward-char</td><td>å…‰æ ‡å‘åç§»åŠ¨ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td><code>&quot;\e[B&quot;</code></td><td>é”®ç›˜ä¸‹æ–¹å‘é”®</td><td>next-history</td><td>ä¸‹ç¿»æ˜¾ç¤ºä¸‹ä¸€ä¸ªå‘½ä»¤</td></tr><tr><td><code>&quot;\e[A&quot;</code></td><td>é”®ç›˜ä¸Šæ–¹å‘é”®</td><td>previous-history</td><td>ä¸Šç¿»æ˜¾ç¤ºä¸Šä¸€ä¸ªå‘½ä»¤</td></tr><tr><td><code>&quot;\C-h&quot;</code></td><td>ctrl + h</td><td>backward-delete-char</td><td>å‘ååˆ é™¤ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td><code>&quot;\C-?&quot;</code></td><td>ctrl + shift + &#x2F;</td><td>backward-delete-char</td><td>å‘ååˆ é™¤ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td><code>&quot;\C-u&quot;</code></td><td>ctrl + u</td><td>undo</td><td>æ’¤é”€ä¸Šä¸€ä¸ªå‘½ä»¤ï¼Œç›¸å½“äºæ¸…ç©ºå½“å‰è¡Œ</td></tr><tr><td><code>&quot;\C-d&quot;</code></td><td>ctrl + d</td><td>delete-char</td><td>åˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨å­—ç¬¦</td></tr><tr><td><code>&quot;\C-k&quot;</code></td><td>ctrl + k</td><td>kill-line</td><td>åˆ é™¤å½“å‰å…‰æ ‡åˆ°è¡Œå°¾çš„æ‰€æœ‰å­—ç¬¦</td></tr><tr><td><code>&quot;\C-i&quot;</code></td><td>ctrl + i</td><td>complete</td><td>è‡ªåŠ¨è¡¥å…¨ï¼Œç›¸å½“äºæ•²<code>TAB</code></td></tr><tr><td><code>&quot;\C-j&quot;</code></td><td>ctrl + j</td><td>accept-line</td><td>ç»“æŸå½“å‰è¡Œï¼Œç›¸å½“äºæ•²å›è½¦</td></tr><tr><td><code>&quot;\C-m&quot;</code></td><td>ctrl + m</td><td>accept-line</td><td>ç»“æŸå½“å‰è¡Œï¼Œç›¸å½“äºæ•²å›è½¦</td></tr><tr><td><code>&quot;\C-w&quot;</code></td><td></td><td>backward-delete-word</td><td></td></tr><tr><td><code>&quot;\C-x\e[3~&quot;</code></td><td></td><td>backward-kill-line</td><td></td></tr><tr><td><code>&quot;\e\C-?&quot;</code></td><td></td><td>backward-kill-word</td><td></td></tr></tbody></table><ul><li>ä»»ä½•æ—¶å€™Â <code>tab</code>Â é”®ï¼Œä¼šæ ¹æ®å½“å‰çš„è¾“å…¥ç»™å‡ºæç¤º</li><li>å‘½ä»¤åæ•²Â Â æˆ–Â <code>-</code>Â ï¼Œç„¶åæŒ‰Â <code>tab</code>Â é”®ï¼Œå¯ä»¥å±•ç¤ºå‡ºæ­¤å‘½ä»¤å…·ä½“çš„é€‰é¡¹</li></ul><p><strong>è‡ªå®šä¹‰å¿«æ·é”®</strong></p><p>åœ¨å½“å‰ç”¨æˆ·ç›®å½•ä¸‹æ–°å»º<code>$USER_HOME/.arthas/conf/inputrc</code>æ–‡ä»¶ï¼ŒåŠ å…¥è‡ªå®šä¹‰é…ç½®ã€‚</p><p>å‡è®¾æˆ‘æ˜¯ vim çš„é‡åº¦ç”¨æˆ·ï¼Œæˆ‘è¦æŠŠ<code>ctrl+h</code>è®¾ç½®ä¸ºå…‰æ ‡å‘å‰ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ™è®¾ç½®å¦‚ä¸‹ï¼Œé¦–å…ˆæ‹·è´é»˜è®¤é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&quot;\C-a&quot;: beginning-of-line</span><br><span class="line">&quot;\C-e&quot;: end-of-line</span><br><span class="line">&quot;\C-f&quot;: forward-word</span><br><span class="line">&quot;\C-b&quot;: backward-word</span><br><span class="line">&quot;\e[D&quot;: backward-char</span><br><span class="line">&quot;\e[C&quot;: forward-char</span><br><span class="line">&quot;\e[B&quot;: next-history</span><br><span class="line">&quot;\e[A&quot;: previous-history</span><br><span class="line">&quot;\C-h&quot;: backward-delete-char</span><br><span class="line">&quot;\C-?&quot;: backward-delete-char</span><br><span class="line">&quot;\C-u&quot;: undo</span><br><span class="line">&quot;\C-d&quot;: delete-char</span><br><span class="line">&quot;\C-k&quot;: kill-line</span><br><span class="line">&quot;\C-i&quot;: complete</span><br><span class="line">&quot;\C-j&quot;: accept-line</span><br><span class="line">&quot;\C-m&quot;: accept-line</span><br><span class="line">&quot;\C-w&quot;: backward-delete-word</span><br><span class="line">&quot;\C-x\e[3~&quot;: backward-kill-line</span><br><span class="line">&quot;\e\C-?&quot;: backward-kill-word</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠ<code>&quot;\C-h&quot;: backward-delete-char</code>æ¢æˆ<code>&quot;\C-h&quot;: backward-char</code>ï¼Œç„¶åé‡æ–°è¿æ¥å³å¯ã€‚</p><p><strong>åå°å¼‚æ­¥å‘½ä»¤ç›¸å…³å¿«æ·é”®</strong></p><ul><li>ctrl + c: ç»ˆæ­¢å½“å‰å‘½ä»¤</li><li>ctrl + z: æŒ‚èµ·å½“å‰å‘½ä»¤ï¼Œåç»­å¯ä»¥ bg&#x2F;fg é‡æ–°æ”¯æŒæ­¤å‘½ä»¤ï¼Œæˆ– kill æ‰</li><li>ctrl + a: å›åˆ°è¡Œé¦–</li><li>ctrl + e: å›åˆ°è¡Œå°¾</li></ul>]]></content>
    
    
    <summary type="html">dashboardå‘½ä»¤</summary>
    
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/tags/Arthas/"/>
    
    <category term="Arthasè¯Šæ–­å·¥å…·" scheme="https://yuanxw.github.io/tags/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>Arthasè¯Šæ–­**å·¥å…·(ä¸€)**Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¿«é€Ÿå…¥é—¨</title>
    <link href="https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%B8%80)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <id>https://yuanxw.github.io/Arthas%E5%BA%94%E7%94%A8(Java)%E8%AF%8A%E6%96%AD%E5%88%A9%E5%99%A8/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7(%E4%B8%80)Arthas%EF%BC%88%E9%98%BF%E5%B0%94%E8%90%A8%E6%96%AF%EF%BC%89%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</id>
    <published>2023-02-28T16:00:00.000Z</published>
    <updated>2025-09-03T15:36:52.001Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Arthasè¯Šæ–­å·¥å…·-ä¸€-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¿«é€Ÿå…¥é—¨"><a href="#Arthasè¯Šæ–­å·¥å…·-ä¸€-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¿«é€Ÿå…¥é—¨" class="headerlink" title="Arthasè¯Šæ–­å·¥å…·(ä¸€)Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¿«é€Ÿå…¥é—¨"></a><strong>Arthasè¯Šæ–­</strong>å·¥å…·(ä¸€)<strong>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰å¿«é€Ÿå…¥é—¨</strong></h1><h2 id="1-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰-èƒ½ä¸ºä½ åšä»€ä¹ˆï¼Ÿ"><a href="#1-Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰-èƒ½ä¸ºä½ åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰ èƒ½ä¸ºä½ åšä»€ä¹ˆï¼Ÿ"></a>1. <strong>Arthasï¼ˆé˜¿å°”è¨æ–¯ï¼‰ èƒ½ä¸ºä½ åšä»€ä¹ˆï¼Ÿ</strong></h2><p><code>Arthas</code>Â æ˜¯Alibabaå¼€æºçš„Javaè¯Šæ–­å·¥å…·ï¼Œæ·±å—å¼€å‘è€…å–œçˆ±ã€‚</p><p><img src="/images/arthas/chapter1/image.png" alt="Untitled"></p><p>å½“ä½ é‡åˆ°ä»¥ä¸‹ç±»ä¼¼é—®é¢˜è€ŒæŸæ‰‹æ— ç­–æ—¶ï¼Œ<code>Arthas</code>å¯ä»¥å¸®åŠ©ä½ è§£å†³ï¼š</p><ol><li>è¿™ä¸ªç±»ä»å“ªä¸ª jar åŒ…åŠ è½½çš„ï¼Ÿä¸ºä»€ä¹ˆä¼šæŠ¥å„ç§ç±»ç›¸å…³çš„ Exceptionï¼Ÿ</li><li>æˆ‘æ”¹çš„ä»£ç ä¸ºä»€ä¹ˆæ²¡æœ‰æ‰§è¡Œåˆ°ï¼Ÿéš¾é“æ˜¯æˆ‘æ²¡ commitï¼Ÿåˆ†æ”¯æé”™äº†ï¼Ÿ</li><li>é‡åˆ°é—®é¢˜æ— æ³•åœ¨çº¿ä¸Š debugï¼Œéš¾é“åªèƒ½é€šè¿‡åŠ æ—¥å¿—å†é‡æ–°å‘å¸ƒå—ï¼Ÿ</li><li>çº¿ä¸Šé‡åˆ°æŸä¸ªç”¨æˆ·çš„æ•°æ®å¤„ç†æœ‰é—®é¢˜ï¼Œä½†çº¿ä¸ŠåŒæ ·æ— æ³• debugï¼Œçº¿ä¸‹æ— æ³•é‡ç°ï¼</li><li>æ˜¯å¦æœ‰ä¸€ä¸ªå…¨å±€è§†è§’æ¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Ÿ</li><li>æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç›‘æ§åˆ°JVMçš„å®æ—¶è¿è¡ŒçŠ¶æ€ï¼Ÿ</li><li>æ€ä¹ˆå¿«é€Ÿå®šä½åº”ç”¨çš„çƒ­ç‚¹ï¼Œç”Ÿæˆç«ç„°å›¾ï¼Ÿ</li><li>æ€æ ·ç›´æ¥ä»JVMå†…æŸ¥æ‰¾æŸä¸ªç±»çš„å®ä¾‹ï¼Ÿ</li></ol><p><code>Arthas</code>æ”¯æŒJDK 6+ï¼Œæ”¯æŒLinux&#x2F;Mac&#x2F;Windowsï¼Œé‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„Â <code>Tab</code>Â è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚</p><h2 id="2-å®‰è£…å’Œå¸è½½"><a href="#2-å®‰è£…å’Œå¸è½½" class="headerlink" title="2. å®‰è£…å’Œå¸è½½"></a>2. å®‰è£…å’Œå¸è½½</h2><h3 id="2-1-åœ¨çº¿å®‰è£…Arthas"><a href="#2-1-åœ¨çº¿å®‰è£…Arthas" class="headerlink" title="2.1 åœ¨çº¿å®‰è£…Arthas"></a><strong>2.1 åœ¨çº¿å®‰è£…Arthas</strong></h3><ul><li>å¦‚æœä¸‹è½½é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨ aliyun çš„é•œåƒï¼š<code>java -jar arthas-boot.jar --repo-mirror aliyun --use-http</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost arthas]# curl -O https://arthas.aliyun.com/arthas-boot.jar</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  141k  100  141k    0     0   271k      0 --:--:-- --:--:-- --:--:--  271k</span><br></pre></td></tr></table></figure><h3 id="2-2ç¦»çº¿å®‰è£…"><a href="#2-2ç¦»çº¿å®‰è£…" class="headerlink" title="2.2ç¦»çº¿å®‰è£…"></a><strong>2.2</strong>ç¦»çº¿å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost software]# wget https://github.com/alibaba/arthas/releases/download/arthas-all-4.0.5/arthas-bin.zip</span><br><span class="line">--2025-06-07 04:46:25--  https://github.com/alibaba/arthas/releases/download/arthas-all-4.0.5/arthas-bin.zip</span><br><span class="line">Resolving github.com (github.com)... 20.205.243.166</span><br><span class="line">Connecting to github.com (github.com)|20.205.243.166|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 302 Found</span><br><span class="line">Location: https://objects.githubusercontent.com/github-production-release-asset-2e65be/146633589/8f7c17e7-21d1-4e42-92b8-4ecefa107242?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=releaseassetproduction%2F20250607%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20250607T084434Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=0b3b5544008f728b619ef27e1c0a18f18a65a0948840e4201cabf902ac108612&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3Darthas-bin.zip&amp;response-content-type=application%2Foctet-stream [following]</span><br><span class="line">--2025-06-07 04:46:26--  https://objects.githubusercontent.com/github-production-release-asset-2e65be/146633589/8f7c17e7-21d1-4e42-92b8-4ecefa107242?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=releaseassetproduction%2F20250607%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20250607T084434Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=0b3b5544008f728b619ef27e1c0a18f18a65a0948840e4201cabf902ac108612&amp;X-Amz-SignedHeaders=host&amp;response-content-disposition=attachment%3B%20filename%3Darthas-bin.zip&amp;response-content-type=application%2Foctet-stream</span><br><span class="line">Resolving objects.githubusercontent.com (objects.githubusercontent.com)... 185.199.108.133, 185.199.111.133, 185.199.110.133, ...</span><br><span class="line">Connecting to objects.githubusercontent.com (objects.githubusercontent.com)|185.199.108.133|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 14402310 (14M) [application/octet-stream]</span><br><span class="line">Saving to: â€˜arthas-bin.zipâ€™</span><br><span class="line"></span><br><span class="line">100%[====================================================================================================================================================================================================================================&gt;] 14,402,310  5.22MB/s   <span class="keyword">in</span> 2.6s   </span><br><span class="line"></span><br><span class="line">2025-06-07 04:46:29 (5.22 MB/s) - â€˜arthas-bin.zipâ€™ saved [14402310/14402310]</span><br><span class="line"></span><br><span class="line"><span class="comment">## è§£å‹ç¼©åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">[root@localhost software]# unzip arthas-bin.zip -d /usr/local/software/arthas-bin</span><br><span class="line">Archive:  arthas-bin.zip</span><br><span class="line">   creating: /usr/local/software/arthas-bin/async-profiler/</span><br><span class="line">   creating: /usr/local/software/arthas-bin/lib/</span><br><span class="line">  inflating: /usr/local/software/arthas-bin/arthas-spy.jar  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/arthas-core.jar  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/logback.xml  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/arthas.properties  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/arthas-agent.jar  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/arthas-client.jar  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/arthas-boot.jar  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/math-game.jar  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/install-local.sh  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/as.sh  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/as.bat  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/as-service.bat  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/async-profiler/libasyncProfiler-linux-arm64.so  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/async-profiler/libasyncProfiler-linux-x64.so  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/async-profiler/libasyncProfiler-mac.dylib  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/lib/libArthasJniLibrary-aarch64.so  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/lib/libArthasJniLibrary-x64.dll  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/lib/libArthasJniLibrary-x64.so  </span><br><span class="line">  inflating: /usr/local/software/arthas-bin/lib/libArthasJniLibrary.dyli</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-3-å¯åŠ¨Arthas"><a href="#2-3-å¯åŠ¨Arthas" class="headerlink" title="2.3 å¯åŠ¨Arthas"></a><strong>2.3 å¯åŠ¨Arthas</strong></h3><p>å¦‚æœæ²¡æœ‰javaè¿›ç¨‹æ˜¯å¯åŠ¨ä¸äº†ã€‚ä¼šçœ‹æŠ¥é”™ä¿¡æ¯ï¼šCan not find java process. Try to run <code>jps</code> command lists the instrumented Java HotSpot VMs on the target system.<br>Please select an available pid.</p><ul><li>æ‰§è¡Œè¯¥ç¨‹åºçš„ç”¨æˆ·éœ€è¦å’Œç›®æ ‡è¿›ç¨‹å…·æœ‰ç›¸åŒçš„æƒé™ã€‚æ¯”å¦‚ä»¥<code>admin</code>ç”¨æˆ·æ¥æ‰§è¡Œï¼š<code>sudo su admin &amp;&amp; java -jar arthas-boot.jar</code>Â æˆ–Â <code>sudo -u admin -EH java -jar arthas-boot.jar</code>ã€‚</li><li>å¦‚æœ attach ä¸ä¸Šç›®æ ‡è¿›ç¨‹ï¼Œå¯ä»¥æŸ¥çœ‹<code>~/logs/arthas/</code>Â ç›®å½•ä¸‹çš„æ—¥å¿—ã€‚</li><li><code>java -jar arthas-boot.jar -h</code>Â æ‰“å°æ›´å¤šå‚æ•°ä¿¡æ¯ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost arthas]# java -jar arthas-boot.jar</span><br><span class="line">[INFO] JAVA_HOME: /usr/local/software/jdk-11.0.16.1</span><br><span class="line">[INFO] arthas-boot version: 4.0.5</span><br><span class="line">[INFO] Can not find java process. Try to run `jps` <span class="built_in">command</span> lists the instrumented Java HotSpot VMs on the target system.</span><br><span class="line">Please <span class="keyword">select</span> an available pid.</span><br><span class="line">[root@localhost arthas]# </span><br></pre></td></tr></table></figure><ul><li><strong>å¯åŠ¨ math-game</strong></li></ul><p><code>math-game</code>æ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œæ¯éš”ä¸€ç§’ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå†æ‰§è¡Œè´¨å› æ•°åˆ†è§£ï¼Œå¹¶æ‰“å°å‡ºåˆ†è§£ç»“æœã€‚</p><p><code>math-game</code>æºä»£ç ï¼š<a href="https://github.com/alibaba/arthas/blob/master/math-game/src/main/java/demo/MathGame.java"><strong>æŸ¥çœ‹</strong></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost arthas]# curl -O https://arthas.aliyun.com/math-game.jar</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  4510  100  4510    0     0  16208      0 --:--:-- --:--:-- --:--:-- 16223</span><br><span class="line">[root@localhost arthas]# java -jar math-game.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>é‡æ–°å¯åŠ¨ Arthas</strong></li></ul><p>å¯åŠ¨å‘½ä»¤ï¼šjava -jar arthas-boot.jarã€‚å¦‚æœä¸å­˜åœ¨arthasåˆ™ä¼šè‡ªåŠ¨ä¸‹è½½arthasç›¸å…³çš„åŒ…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-boot.jar</span><br><span class="line">* **[1]: 5167 math-game.jar**</span><br></pre></td></tr></table></figure><p>é€‰æ‹©åº”ç”¨ java è¿›ç¨‹ï¼ŒæœåŠ¡å™¨ä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œ<code>math-game</code>è¿›ç¨‹æ˜¯ç¬¬ 1 ä¸ªï¼Œåˆ™è¾“å…¥ 1ï¼Œå†è¾“å…¥<code>å›è½¦/enter</code>ã€‚Arthas ä¼š attach åˆ°ç›®æ ‡è¿›ç¨‹ä¸Šï¼Œå¹¶è¾“å‡ºæ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost arthas]# java -jar arthas-boot.jar</span><br><span class="line">[INFO] JAVA_HOME: /usr/local/software/jdk-11.0.16.1</span><br><span class="line">[INFO] arthas-boot version: 4.0.5</span><br><span class="line">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class="line">* **[1]: 5167 math-game.jar**</span><br><span class="line">1</span><br><span class="line">[INFO] Start download arthas from remote server: https://arthas.aliyun.com/download/4.0.5?mirror=center</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 424.56 KB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 1.33 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 2.12 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 2.88 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 3.72 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 4.77 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 5.71 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 6.52 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 7.56 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 8.44 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 9.51 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 10.41 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 11.43 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 12.08 MB, downloading ...</span><br><span class="line">[INFO] File size: 13.75 MB, downloaded size: 12.90 MB, downloading ...</span><br><span class="line">[INFO] Download arthas success.</span><br><span class="line">[INFO] arthas home: /root/.arthas/lib/4.0.5/arthas</span><br><span class="line">[INFO] Try to attach process 5167</span><br><span class="line">Picked up JAVA_TOOL_OPTIONS: </span><br><span class="line">[INFO] Attach process 5167 success.</span><br><span class="line">[INFO] arthas-client connect 127.0.0.1 3658</span><br><span class="line">  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </span><br><span class="line"> /  O  \ |  .--. <span class="string">&#x27;&#x27;</span>--.  .--<span class="string">&#x27;|  &#x27;</span>--<span class="string">&#x27;  | /  O  \ &#x27;</span>   .-<span class="string">&#x27;                          </span></span><br><span class="line"><span class="string">|  .-.  ||  &#x27;</span>--<span class="string">&#x27;.&#x27;</span>   |  |   |  .--.  ||  .-.  |`.  `-.                          </span><br><span class="line">|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-<span class="string">&#x27;    |                         </span></span><br><span class="line"><span class="string">`--&#x27;</span> `--<span class="string">&#x27;`--&#x27;</span> <span class="string">&#x27;--&#x27;</span>   `--<span class="string">&#x27;   `--&#x27;</span>  `--<span class="string">&#x27;`--&#x27;</span> `--<span class="string">&#x27;`-----&#x27;</span>                          </span><br><span class="line"></span><br><span class="line">wiki        https://arthas.aliyun.com/doc                                       </span><br><span class="line">tutorials   https://arthas.aliyun.com/doc/arthas-tutorials.html                 </span><br><span class="line">version     4.0.5                                                               </span><br><span class="line">main_class  math-game.jar                                                       </span><br><span class="line">pid         5167                                                                </span><br><span class="line">start_time  2025-06-06 05:55:57.044                                             </span><br><span class="line">currnt_time 2025-06-06 05:56:41.167   </span><br></pre></td></tr></table></figure><h3 id="2-4-å¸è½½Arthas"><a href="#2-4-å¸è½½Arthas" class="headerlink" title="2.4 å¸è½½Arthas"></a><strong>2.4 å¸è½½Arthas</strong></h3><p>åœ¨çº¿å®‰è£… åˆ é™¤ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost arthas]# <span class="built_in">rm</span> -rf ~/.arthas/</span><br><span class="line">[root@localhost arthas]# <span class="built_in">rm</span> -rf ~/logs/arthas*</span><br></pre></td></tr></table></figure><p>ç¦»çº¿å®‰è£… åˆ é™¤&#x2F;usr&#x2F;local&#x2F;software&#x2F;arthas-binç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost arthas]# <span class="built_in">rm</span> -rf /usr/local/software/arthas-bin</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ArthasÂ æ˜¯Alibabaå¼€æºçš„Javaè¯Šæ–­å·¥å…·ï¼Œæ·±å—å¼€å‘è€…å–œçˆ±</summary>
    
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://yuanxw.github.io/tags/Arthas/"/>
    
    <category term="Arthasè¯Šæ–­å·¥å…·" scheme="https://yuanxw.github.io/tags/Arthas%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(åå››)**åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E5%9B%9B)%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E5%9B%9B)%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/</id>
    <published>2023-02-13T16:00:00.000Z</published>
    <updated>2025-09-03T15:22:51.570Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-åå››-åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-åå››-åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(åå››)åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(åå››)<strong>åƒåœ¾å›æ”¶ç›¸å…³æ¦‚å¿µ</strong></h2><h3 id="1-System-gc"><a href="#1-System-gc" class="headerlink" title="1. System.gc()"></a>1. <strong>System.gc()</strong></h3><ul><li><p><strong>ç†è§£</strong></p><ul><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡system.gcï¼ˆï¼‰è€…Runtime.getRuntime().gc() çš„è°ƒç”¨ï¼Œä¼šæ˜¾å¼è§¦å‘FullGCï¼ŒåŒæ—¶å¯¹è€å¹´ä»£å’Œæ–°ç”Ÿä»£è¿›è¡Œå›æ”¶ï¼Œå°è¯•é‡Šæ”¾è¢«ä¸¢å¼ƒå¯¹è±¡å ç”¨çš„å†…å­˜ã€‚ç„¶è€Œsystem.gc() )è°ƒç”¨é™„å¸¦ä¸€ä¸ªå…è´£å£°æ˜ï¼Œæ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ã€‚(ä¸èƒ½ç¡®ä¿ç«‹å³ç”Ÿæ•ˆ)</p></li><li><p>JVMå®ç°è€…å¯ä»¥é€šè¿‡system.gc() è°ƒç”¨æ¥å†³å®šJVMçš„GCè¡Œä¸ºã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶åº”è¯¥æ˜¯è‡ªåŠ¨è¿›è¡Œçš„ï¼Œæ— é¡»æ‰‹åŠ¨è§¦å‘ï¼Œå¦åˆ™å°±å¤ªè¿‡äºéº»çƒ¦äº†ã€‚åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ€§èƒ½åŸºå‡†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œä¹‹é—´è°ƒç”¨System.gc()ä»£ç æ¼”ç¤ºæ˜¯å¦å‡ºå‘GCæ“ä½œ</p></li><li><p>ä»£ç æ¼”ç¤ºæ˜¯å¦å‡ºå‘GCæ“ä½œ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.gc;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * System.gc()</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-03-07 10:41:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemGC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SystemGC</span>();</span><br><span class="line">        <span class="comment">// æé†’JVMè¿›è¡Œåƒåœ¾å›æ”¶</span></span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="comment">// å¼ºåˆ¶è°ƒç”¨ å¤±å»å¼•ç”¨å¯¹è±¡çš„finalize()</span></span><br><span class="line">        <span class="comment">//System.runFinalization();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">        System.out.println(<span class="string">&quot;...SystemGC.finalize()æ–¹æ³•è¢«æ‰§è¡Œ!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>  è¾“å‡ºç»“æœä¸ç¡®å®šï¼šæœ‰æ—¶å€™ä¼šè°ƒç”¨ finalize() æ–¹æ³•ï¼Œæœ‰æ—¶å€™å¹¶ä¸ä¼šè°ƒç”¨</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...SystemGC.finalize()æ–¹æ³•è¢«æ‰§è¡Œ!!!</span><br></pre></td></tr></table></figure></li><li><p><strong>æ‰‹åŠ¨GCæ¥ç†è§£ä¸å¯è¾¾å¯¹è±¡çš„å›æ”¶</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.gc;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŠ ä¸Šå‚æ•°ï¼š  -XX:+PrintGCDetails -Xms256m -Xmx256m -XX:+PrintGCDetails -XX:PretenureSizeThreshold=15m</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-03-07 10:53:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalVariablesGC</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§¦å‘Minor GCæ²¡æœ‰å›æ”¶å¯¹è±¡ï¼Œç„¶ååœ¨è§¦å‘Full GCå°†è¯¥å¯¹è±¡å­˜å…¥oldåŒº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//10MB</span></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  è§¦å‘YoungGCçš„æ—¶å€™ï¼Œå·²ç»è¢«å›æ”¶äº†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        buffer = <span class="literal">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ä¼šè¢«å›æ”¶ï¼Œå› ä¸ºå®ƒè¿˜å­˜æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨ç´¢å¼•ä¸º1çš„æ§½ä¸­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC3</span><span class="params">()</span> &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼šè¢«å›æ”¶ï¼Œå› ä¸ºå®ƒè¿˜å­˜æ”¾åœ¨å±€éƒ¨å˜é‡è¡¨ç´¢å¼•ä¸º1çš„æ§½ä¸­ï¼Œä½†æ˜¯åé¢å®šä¹‰çš„valueæŠŠè¿™ä¸ªæ§½ç»™æ›¿æ¢äº†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC4</span><span class="params">()</span> &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * localvarGC5ä¸­çš„æ•°ç»„å·²ç»è¢«å›æ”¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">localvarGC5</span><span class="params">()</span> &#123;</span><br><span class="line">        localvarGC1();</span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LocalVariablesGC</span> <span class="variable">local</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocalVariablesGC</span>();</span><br><span class="line">        <span class="comment">// é€šè¿‡åœ¨mainæ–¹æ³•è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;...LocalVariablesGC.localvarGC-1()&quot;</span>);</span><br><span class="line">        local.localvarGC1();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(&quot;...LocalVariablesGC.localvarGC-2()&quot;);</span></span><br><span class="line"><span class="comment">//        local.localvarGC2();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;...LocalVariablesGC.localvarGC-3()&quot;);</span></span><br><span class="line"><span class="comment">//        local.localvarGC3();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;...LocalVariablesGC.localvarGC-4()&quot;);</span></span><br><span class="line"><span class="comment">//        local.localvarGC4();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;...LocalVariablesGC.localvarGC-5()&quot;);</span></span><br><span class="line"><span class="comment">//        local.localvarGC5();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æ‰§è¡Œç»“æœï¼š</p><ul><li>æ‰§è¡Œ System.gc() ä»…ä»…æ˜¯å°†å¹´è½»ä»£çš„ buffer æ•°ç»„å¯¹è±¡æ”¾åˆ°äº†è€å¹´ä»£ï¼Œbufferå¯¹è±¡ä»ç„¶æ²¡æœ‰å›æ”¶</li></ul>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...LocalVariablesGC.localvarGC<span class="literal">-1</span>()</span><br><span class="line">**[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">10728</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">10976</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0052388</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">Full</span> <span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">10728</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] [<span class="type">ParOldGen</span>: <span class="number">248</span><span class="type">K</span>-&gt;<span class="number">10868</span><span class="type">K</span>(<span class="number">175104</span><span class="type">K</span>)] <span class="number">10976</span><span class="type">K</span>-&gt;<span class="number">10868</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), [<span class="type">Metaspace</span>: <span class="number">3228</span><span class="type">K</span>-&gt;<span class="number">3228</span><span class="type">K</span>(<span class="number">1056768</span><span class="type">K</span>)], <span class="number">0.0040694</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.02</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>]** </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">76288</span>K, used <span class="number">655</span>K [<span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">65536</span><span class="type">K</span>, <span class="number">1</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000faba3ee8</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">175104</span><span class="type">K</span>, <span class="type">used</span> <span class="number">10868</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">175104</span><span class="type">K</span>, <span class="number">6</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000f0a9d270</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">3235</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4500</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">350</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">388</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br></pre></td></tr></table></figure><ul><li>ç”±äº buffer æ•°ç»„å¯¹è±¡æ²¡æœ‰å¼•ç”¨æŒ‡å‘å®ƒï¼Œæ‰§è¡Œ System.gc() å°†è¢«å›æ”¶</li></ul>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...LocalVariablesGC.localvarGC<span class="literal">-2</span>()</span><br><span class="line">**[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">840</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">848</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0007219</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">Full</span> <span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">840</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] [<span class="type">ParOldGen</span>: <span class="number">8</span><span class="type">K</span>-&gt;<span class="number">628</span><span class="type">K</span>(<span class="number">175104</span><span class="type">K</span>)] <span class="number">848</span><span class="type">K</span>-&gt;<span class="number">628</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), [<span class="type">Metaspace</span>: <span class="number">3229</span><span class="type">K</span>-&gt;<span class="number">3229</span><span class="type">K</span>(<span class="number">1056768</span><span class="type">K</span>)], <span class="number">0.0034734</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>]** </span><br><span class="line">Heap</span><br><span class="line"></span><br><span class="line"> PSYoungGen      total <span class="number">76288</span>K, used <span class="number">655</span>K [<span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">65536</span><span class="type">K</span>, <span class="number">1</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000faba3ee8</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">175104</span><span class="type">K</span>, <span class="type">used</span> <span class="number">628</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">175104</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000f009d260</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">3235</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4500</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">350</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">388</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br></pre></td></tr></table></figure><ul><li>è™½ç„¶å‡ºäº†ä»£ç å—çš„ä½œç”¨åŸŸï¼Œä½†æ˜¯ buffer æ•°ç»„å¯¹è±¡å¹¶æ²¡æœ‰è¢«å›æ”¶</li></ul>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...LocalVariablesGC.localvarGC<span class="literal">-3</span>()</span><br><span class="line">**[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">10736</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">10976</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0051980</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.01</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">Full</span> <span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">10736</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] [<span class="type">ParOldGen</span>: <span class="number">240</span><span class="type">K</span>-&gt;<span class="number">10868</span><span class="type">K</span>(<span class="number">175104</span><span class="type">K</span>)] <span class="number">10976</span><span class="type">K</span>-&gt;<span class="number">10868</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), [<span class="type">Metaspace</span>: <span class="number">3229</span><span class="type">K</span>-&gt;<span class="number">3229</span><span class="type">K</span>(<span class="number">1056768</span><span class="type">K</span>)], <span class="number">0.0039932</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.05</span> <span class="type">sys</span>=<span class="number">0.06</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>]** </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">76288</span>K, used <span class="number">655</span>K [<span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">65536</span><span class="type">K</span>, <span class="number">1</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000faba3ee8</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">175104</span><span class="type">K</span>, <span class="type">used</span> <span class="number">10868</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">175104</span><span class="type">K</span>, <span class="number">6</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000f0a9d270</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">3235</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4500</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">350</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">388</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br></pre></td></tr></table></figure><ul><li><p>1ã€æ¥çœ‹çœ‹å­—èŠ‚ç ï¼šå®ä¾‹æ–¹æ³•å±€éƒ¨å˜é‡è¡¨ç¬¬ä¸€ä¸ªå˜é‡è‚¯å®šæ˜¯ this</p><p>  Qï¼šå°±å¤šå®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ value ï¼Œå°±å¯ä»¥æŠŠå­—èŠ‚æ•°ç»„å›æ”¶äº†å‘¢ï¼Ÿ</p><p>  Aï¼šå±€éƒ¨å˜é‡è¡¨é•¿åº¦ä¸º 2 ï¼Œè¿™è¯´æ˜äº†å‡ºäº†ä»£ç å—æ—¶ï¼Œbuffer å°±å‡ºäº†å…¶ä½œç”¨åŸŸèŒƒå›´ï¼Œæ­¤æ—¶æ²¡æœ‰ä¸º value å¼€å¯æ–°çš„æ§½ï¼Œvalue å˜é‡ç›´æ¥å æ®äº† buffer å˜é‡çš„æ§½ï¼ˆSlotï¼‰ï¼Œå¯¼è‡´å †ä¸­çš„å­—èŠ‚æ•°ç»„æ²¡æœ‰å¼•ç”¨å†æŒ‡å‘å®ƒï¼Œæ‰§è¡Œ System.gc() æ—¶è¢«å›æ”¶ã€‚çœ‹ï¼Œvalue ä½äºå±€éƒ¨å˜é‡è¡¨ä¸­ç´¢å¼•ä¸º 1 çš„ä½ç½®ã€‚valueè¿™ä¸ªå±€éƒ¨å˜é‡æŠŠåŸæœ¬å±äºbufferçš„slotç»™å ç”¨äº†ï¼Œè¿™æ ·æ ˆä¸Šå°±æ²¡æœ‰bufferå˜é‡æŒ‡å‘<code>new byte[10 * 1024 * 1024]</code>å®ä¾‹äº†ã€‚</p></li><li><p>å±€éƒ¨å˜é‡é™¤äº†æ–¹æ³•èŒƒå›´å°±æ˜¯å¤±æ•ˆäº†ï¼Œå †ä¸­çš„å­—èŠ‚æ•°ç»„é“å®šè¢«å›æ”¶</p></li></ul>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...LocalVariablesGC.localvarGC<span class="literal">-5</span>()</span><br><span class="line">[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">10728</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">10944</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0050946</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.01</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">Full</span> <span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">10728</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] [<span class="type">ParOldGen</span>: <span class="number">216</span><span class="type">K</span>-&gt;<span class="number">10868</span><span class="type">K</span>(<span class="number">175104</span><span class="type">K</span>)] <span class="number">10944</span><span class="type">K</span>-&gt;<span class="number">10868</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), [<span class="type">Metaspace</span>: <span class="number">3229</span><span class="type">K</span>-&gt;<span class="number">3229</span><span class="type">K</span>(<span class="number">1056768</span><span class="type">K</span>)], <span class="number">0.0043706</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.13</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">0</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">10868</span><span class="type">K</span>-&gt;<span class="number">10868</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0002125</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">Full</span> <span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">0</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] [<span class="type">ParOldGen</span>: <span class="number">10868</span><span class="type">K</span>-&gt;<span class="number">628</span><span class="type">K</span>(<span class="number">175104</span><span class="type">K</span>)] <span class="number">10868</span><span class="type">K</span>-&gt;<span class="number">628</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), [<span class="type">Metaspace</span>: <span class="number">3229</span><span class="type">K</span>-&gt;<span class="number">3229</span><span class="type">K</span>(<span class="number">1056768</span><span class="type">K</span>)], <span class="number">0.0042302</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">76288</span>K, used <span class="number">655</span>K [<span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">65536</span><span class="type">K</span>, <span class="number">1</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000faba3ee8</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">175104</span><span class="type">K</span>, <span class="type">used</span> <span class="number">628</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">175104</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000f009d260</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">3235</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4500</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">350</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">388</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br></pre></td></tr></table></figure>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...LocalVariablesGC.localvarGC<span class="literal">-4</span>()</span><br><span class="line">[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">840</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] <span class="number">15483</span><span class="type">K</span>-&gt;<span class="number">848</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), <span class="number">0.0007100</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">Full</span> <span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">840</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">76288</span><span class="type">K</span>)] [<span class="type">ParOldGen</span>: <span class="number">8</span><span class="type">K</span>-&gt;<span class="number">628</span><span class="type">K</span>(<span class="number">175104</span><span class="type">K</span>)] <span class="number">848</span><span class="type">K</span>-&gt;<span class="number">628</span><span class="type">K</span>(<span class="number">251392</span><span class="type">K</span>), [<span class="type">Metaspace</span>: <span class="number">3229</span><span class="type">K</span>-&gt;<span class="number">3229</span><span class="type">K</span>(<span class="number">1056768</span><span class="type">K</span>)], <span class="number">0.0041518</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">76288</span>K, used <span class="number">655</span>K [<span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>, <span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">65536</span><span class="type">K</span>, <span class="number">1</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000fab00000</span>,<span class="number">0</span><span class="type">x00000000faba3ee8</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000feb00000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">10752</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x00000000ff580000</span>,<span class="number">0</span><span class="type">x0000000100000000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">175104</span><span class="type">K</span>, <span class="type">used</span> <span class="number">628</span><span class="type">K</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>, <span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">175104</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x00000000f0000000</span>,<span class="number">0</span><span class="type">x00000000f009d260</span>,<span class="number">0</span><span class="type">x00000000fab00000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">3235</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4500</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">350</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">388</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="2-å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼"><a href="#2-å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼" class="headerlink" title="2.å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼"></a>2.<strong>å†…å­˜æº¢å‡ºå’Œå†…å­˜æ³„æ¼</strong></h3><ul><li><p>ä»€ä¹ˆæ˜¯<strong>å†…å­˜æº¢å‡ºï¼Ÿ</strong></p><ol><li>å†…å­˜æº¢å‡ºç›¸å¯¹äºå†…å­˜æ³„æ¼æ¥è¯´ï¼Œå°½ç®¡æ›´å®¹æ˜“è¢«ç†è§£ï¼Œä½†æ˜¯åŒæ ·çš„ï¼Œå†…å­˜æº¢å‡ºä¹Ÿæ˜¯å¼•å‘ç¨‹åºå´©æºƒçš„ç½ªé­ç¥¸é¦–ä¹‹ä¸€ã€‚</li><li>ç”±äºGCä¸€ç›´åœ¨å‘å±•ï¼Œæ‰€æœ‰ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤éåº”ç”¨ç¨‹åºå ç”¨çš„å†…å­˜å¢é•¿é€Ÿåº¦éå¸¸å¿«ï¼Œé€ æˆåƒåœ¾å›æ”¶å·²ç»è·Ÿä¸ä¸Šå†…å­˜æ¶ˆè€—çš„é€Ÿåº¦ï¼Œå¦åˆ™ä¸å¤ªå®¹æ˜“å‡ºç°OOMçš„æƒ…å†µã€‚</li><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒGCä¼šè¿›è¡Œå„ç§å¹´é¾„æ®µçš„åƒåœ¾å›æ”¶ï¼Œå®åœ¨ä¸è¡Œäº†å°±æ”¾å¤§æ‹›ï¼Œæ¥ä¸€æ¬¡ç‹¬å å¼çš„Full GCæ“ä½œï¼Œè¿™æ—¶å€™ä¼šå›æ”¶å¤§é‡çš„å†…å­˜ï¼Œä¾›åº”ç”¨ç¨‹åºç»§ç»­ä½¿ç”¨ã€‚</li><li>Javadocä¸­å¯¹OutofMemoryErrorçš„è§£é‡Šæ˜¯ï¼Œæ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œå¹¶ä¸”åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜ã€‚</li></ol></li><li><p><strong>å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰åŸå› åˆ†æ</strong></p><ul><li><p>é¦–å…ˆè¯´æ²¡æœ‰ç©ºé—²å†…å­˜çš„æƒ…å†µï¼šè¯´æ˜Javaè™šæ‹Ÿæœºçš„å †å†…å­˜ä¸å¤Ÿã€‚åŸå› æœ‰äºŒï¼š</p><ol><li>Javaè™šæ‹Ÿæœºçš„å †å†…å­˜è®¾ç½®ä¸å¤Ÿã€‚<ul><li>æ¯”å¦‚ï¼šå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ï¼›ä¹Ÿå¾ˆæœ‰å¯èƒ½å°±æ˜¯å †çš„å¤§å°ä¸åˆç†ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å¤„ç†æ¯”è¾ƒå¯è§‚çš„æ•°æ®é‡ï¼Œä½†æ˜¯æ²¡æœ‰æ˜¾å¼æŒ‡å®šJVMå †å¤§å°æˆ–è€…æŒ‡å®šæ•°å€¼åå°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°-Xms ã€-Xmxæ¥è°ƒæ•´ã€‚</li></ul></li><li>ä»£ç ä¸­åˆ›å»ºäº†å¤§é‡å¤§å¯¹è±¡ï¼Œå¹¶ä¸”é•¿æ—¶é—´ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨æ”¶é›†ï¼ˆå­˜åœ¨è¢«å¼•ç”¨ï¼‰<ul><li>å¯¹äºè€ç‰ˆæœ¬çš„Oracle JDKï¼Œå› ä¸ºæ°¸ä¹…ä»£çš„å¤§å°æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”JVMå¯¹æ°¸ä¹…ä»£åƒåœ¾å›æ”¶ï¼ˆå¦‚ï¼Œå¸¸é‡æ± å›æ”¶ã€å¸è½½ä¸å†éœ€è¦çš„ç±»å‹ï¼‰éå¸¸ä¸ç§¯æï¼Œæ‰€ä»¥å½“æˆ‘ä»¬ä¸æ–­æ·»åŠ æ–°ç±»å‹çš„æ—¶å€™ï¼Œæ°¸ä¹…ä»£å‡ºç°<strong>OutOfMemoryError</strong>ä¹Ÿéå¸¸å¤šè§ã€‚å°¤å…¶æ˜¯åœ¨è¿è¡Œæ—¶å­˜åœ¨å¤§é‡åŠ¨æ€ç±»å‹ç”Ÿæˆçš„åœºåˆï¼›ç±»ä¼¼internå­—ç¬¦ä¸²ç¼“å­˜å ç”¨å¤ªå¤šç©ºé—´ï¼Œä¹Ÿä¼šå¯¼è‡´OOMé—®é¢˜ã€‚å¯¹åº”çš„å¼‚å¸¸ä¿¡æ¯ï¼Œä¼šæ ‡è®°å‡ºæ¥å’Œæ°¸ä¹…ä»£ç›¸å…³ï¼šâ€œ<strong>java.lang.OutOfMemoryError:PermGen space</strong>â€œã€‚</li><li>éšç€å…ƒæ•°æ®åŒºçš„å¼•å…¥ï¼Œæ–¹æ³•åŒºå†…å­˜å·²ç»ä¸å†é‚£ä¹ˆçª˜è¿«ï¼Œæ‰€ä»¥ç›¸åº”çš„OOMæœ‰æ‰€æ”¹è§‚ï¼Œå‡ºç°OOMï¼Œå¼‚å¸¸ä¿¡æ¯åˆ™å˜æˆäº†ï¼šâ€œ<strong>java.lang.OutofMemoryError:Metaspace</strong>â€œã€‚ç›´æ¥å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¼šå¯¼è‡´<strong>OOM</strong>ã€‚</li></ul></li></ol></li><li><p>æŠ›å‡º<strong>OutofMemoryError</strong>ä¹‹å‰ï¼Œé€šå¸¸åƒåœ¾æ”¶é›†å™¨ä¼šè¢«è§¦å‘ï¼Œå°½å…¶æ‰€èƒ½å»æ¸…ç†å‡ºç©ºé—´ã€‚</p><ul><li>ä¾‹å¦‚ï¼šåœ¨å¼•ç”¨æœºåˆ¶åˆ†æä¸­ï¼Œæ¶‰åŠåˆ°JVMä¼šå»å°è¯•<strong>å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡</strong>ç­‰ã€‚</li><li>åœ¨**java.nio.Bits.reserveMemory()**æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬èƒ½æ¸…æ¥šçš„çœ‹åˆ°ï¼ŒSystem.gc()ä¼šè¢«è°ƒç”¨ï¼Œä»¥æ¸…ç†ç©ºé—´ã€‚</li></ul></li><li><p>å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šè¢«è§¦å‘çš„</p><ul><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å»åˆ†é…ä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œç±»ä¼¼ä¸€ä¸ªè¶…å¤§æ•°ç»„è¶…è¿‡å †çš„æœ€å¤§å€¼ï¼ŒJVMå¯ä»¥åˆ¤æ–­å‡ºåƒåœ¾æ”¶é›†å¹¶ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥ç›´æ¥æŠ›å‡º<strong>OutofMemoryError</strong>ã€‚</li></ul></li></ul></li><li><p>ä»€ä¹ˆæ˜¯<strong>å†…å­˜æ³„æ¼ï¼Ÿ</strong></p><ol><li>ä¹Ÿç§°ä½œâ€œå­˜å‚¨æ¸—æ¼â€ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œ<strong>åªæœ‰å¯¹è±¡ä¸ä¼šå†è¢«ç¨‹åºç”¨åˆ°äº†ï¼Œä½†æ˜¯GCåˆä¸èƒ½å›æ”¶ä»–ä»¬çš„æƒ…å†µï¼Œæ‰å«å†…å­˜æ³„æ¼ã€‚</strong></li><li>ä½†å®é™…æƒ…å†µå¾ˆå¤šæ—¶å€™ä¸€äº›ä¸å¤ªå¥½çš„å®è·µï¼ˆæˆ–ç–å¿½ï¼‰ä¼šå¯¼è‡´å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå˜å¾—å¾ˆé•¿ç”šè‡³å¯¼è‡´OOMï¼Œä¹Ÿå¯ä»¥å«åšå®½æ³›æ„ä¹‰ä¸Šçš„â€œå†…å­˜æ³„æ¼â€ã€‚</li><li>å°½ç®¡å†…å­˜æ³„æ¼å¹¶ä¸ä¼šç«‹åˆ»å¼•èµ·ç¨‹åºå´©æºƒï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œç¨‹åºä¸­çš„å¯ç”¨å†…å­˜å°±ä¼šè¢«é€æ­¥èš•é£Ÿï¼Œç›´è‡³è€—å°½æ‰€æœ‰å†…å­˜ï¼Œæœ€ç»ˆå‡ºç°OutofMemoryå¼‚å¸¸ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</li><li>æ³¨æ„ï¼Œè¿™é‡Œçš„å­˜å‚¨ç©ºé—´å¹¶ä¸æ˜¯æŒ‡ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯æŒ‡è™šæ‹Ÿå†…å­˜å¤§å°ï¼Œè¿™ä¸ªè™šæ‹Ÿå†…å­˜å¤§å°å–å†³äºç£ç›˜äº¤æ¢åŒºè®¾å®šçš„å¤§å°ã€‚</li></ol><p>  <img src="/images/jvm_virtual_machine/chapter14/image.png" alt="Untitled"></p><p>  Javaä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ï¼Œæœ€ä¸Šé¢çš„æ•°æ®ä¸å¯è¾¾ï¼Œå°±æ˜¯éœ€è¦è¢«å›æ”¶çš„ã€‚åæœŸæœ‰ä¸€äº›å¯¹è±¡ä¸ç”¨äº†ï¼ŒæŒ‰é“ç†åº”è¯¥æ–­å¼€å¼•ç”¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é“¾æ²¡æœ‰æ–­å¼€ï¼Œä»è€Œå¯¼è‡´æ²¡æœ‰åŠæ³•è¢«å›æ”¶ã€‚</p><ul><li><p><strong>ä¸¾ä¾‹</strong></p><ul><li>å•ä¾‹æ¨¡å¼</li></ul><p>  å•ä¾‹çš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç¨‹åºæ˜¯ä¸€æ ·é•¿çš„ï¼Œæ‰€ä»¥å•ä¾‹ç¨‹åºä¸­ï¼Œå¦‚æœæŒæœ‰å¯¹å¤–éƒ¨å¯¹è±¡çš„å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤–éƒ¨å¯¹è±¡æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ï¼Œåˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼çš„äº§ç”Ÿã€‚</p><ul><li>ä¸€äº›æä¾›closeçš„èµ„æºæœªå…³é—­å¯¼è‡´å†…å­˜æ³„æ¼</li></ul><p>  æ•°æ®åº“è¿æ¥ï¼ˆdataSourse.getConnection() ï¼‰ï¼Œç½‘ç»œè¿æ¥ï¼ˆsocketï¼‰å’Œioè¿æ¥å¿…é¡»æ‰‹åŠ¨closeï¼Œå¦åˆ™æ˜¯ä¸èƒ½è¢«å›æ”¶çš„ã€‚</p></li></ul></li></ul><h3 id="3-Stop-The-World"><a href="#3-Stop-The-World" class="headerlink" title="3.Stop The World"></a>3.<strong>Stop The World</strong></h3>]]></content>
    
    
    <summary type="html">åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡system.gcï¼ˆï¼‰è€…Runtime.getRuntime().gc() çš„è°ƒç”¨ï¼Œä¼šæ˜¾å¼è§¦å‘FullGCï¼ŒåŒæ—¶å¯¹è€å¹´ä»£å’Œæ–°ç”Ÿä»£è¿›è¡Œå›æ”¶ï¼Œå°è¯•é‡Šæ”¾è¢«ä¸¢å¼ƒå¯¹è±¡å ç”¨çš„å†…å­˜ã€‚ç„¶è€Œsystem.gc() )è°ƒç”¨é™„å¸¦ä¸€ä¸ªå…è´£å£°æ˜ï¼Œæ— æ³•ä¿è¯å¯¹åƒåœ¾æ”¶é›†å™¨çš„è°ƒç”¨ã€‚(ä¸èƒ½ç¡®ä¿ç«‹å³ç”Ÿæ•ˆ)</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(åä¸‰)åƒåœ¾å›æ”¶ç®—æ³•</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E4%B8%89)%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E4%B8%89)%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95/</id>
    <published>2023-02-12T16:00:00.000Z</published>
    <updated>2025-09-03T15:23:42.284Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-åä¸‰-åƒåœ¾å›æ”¶ç®—æ³•"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-åä¸‰-åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(åä¸‰)åƒåœ¾å›æ”¶ç®—æ³•"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(åä¸‰)åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="1-ä»€ä¹ˆæ˜¯åƒåœ¾"><a href="#1-ä»€ä¹ˆæ˜¯åƒåœ¾" class="headerlink" title="1. ä»€ä¹ˆæ˜¯åƒåœ¾"></a>1. <strong>ä»€ä¹ˆæ˜¯åƒåœ¾</strong></h3><p><img src="/images/jvm_virtual_machine/chapter13/image.png" alt="Untitled"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ˜ç¡®çš„çŸ¥é“ï¼ŒJava å’Œ C++è¯­è¨€çš„åŒºåˆ«ï¼Œå°±åœ¨äºåƒåœ¾æ”¶é›†æŠ€æœ¯å’Œå†…å­˜åŠ¨æ€åˆ†é…ä¸Šï¼ŒCè¯­è¨€æ²¡æœ‰åƒåœ¾æ”¶é›†æŠ€æœ¯ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„æ”¶é›†ã€‚</p><p>åƒåœ¾æ”¶é›†ï¼Œä¸æ˜¯Javaè¯­è¨€çš„ä¼´ç”Ÿäº§ç‰©ã€‚æ—©åœ¨1960å¹´ï¼Œç¬¬ä¸€é—¨å¼€å§‹ä½¿ç”¨å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯çš„Lispè¯­è¨€è¯ç”Ÿã€‚ å…³äºåƒåœ¾æ”¶é›†æœ‰ä¸‰ä¸ªç»å…¸é—®é¢˜ï¼š</p><ul><li>å“ªäº›å†…å­˜éœ€è¦å›æ”¶ï¼Ÿ</li><li>ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Ÿ</li><li>å¦‚ä½•å›æ”¶ï¼Ÿ</li></ul><p>åƒåœ¾æ”¶é›†æœºåˆ¶æ˜¯Javaçš„æ‹›ç‰Œèƒ½åŠ›ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚å¦‚ä»Šï¼Œåƒåœ¾æ”¶é›†å‡ ä¹æˆä¸ºç°ä»£è¯­è¨€çš„æ ‡é…ï¼Œå³ä½¿ç»è¿‡å¦‚æ­¤é•¿æ—¶é—´çš„å‘å±•ï¼ŒJavaçš„åƒåœ¾æ”¶é›†æœºåˆ¶ä»ç„¶åœ¨ä¸æ–­çš„æ¼”è¿›ä¸­ï¼Œä¸åŒå¤§å°çš„è®¾å¤‡ã€ä¸åŒç‰¹å¾çš„åº”ç”¨åœºæ™¯ï¼Œå¯¹åƒåœ¾æ”¶é›†æå‡ºäº†æ–°çš„æŒ‘æˆ˜ï¼Œè¿™å½“ç„¶ä¹Ÿæ˜¯é¢è¯•çš„çƒ­ç‚¹ã€‚</p><ul><li><p><strong>ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿ</strong></p><ol><li>åƒåœ¾æ˜¯æŒ‡<strong>åœ¨è¿è¡Œç¨‹åºä¸­æ²¡æœ‰ä»»ä½•æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡</strong>ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯éœ€è¦è¢«å›æ”¶çš„åƒåœ¾ã€‚</li><li>å¤–æ–‡ï¼šAn object is considered garbage when it can no longer be reached from any pointer in the running program.</li><li>å¦‚æœä¸åŠæ—¶å¯¹å†…å­˜ä¸­çš„åƒåœ¾è¿›è¡Œæ¸…ç†ï¼Œé‚£ä¹ˆï¼Œè¿™äº›åƒåœ¾å¯¹è±¡æ‰€å çš„å†…å­˜ç©ºé—´ä¼šä¸€ç›´ä¿ç•™åˆ°åº”ç”¨ç¨‹åºç»“æŸï¼Œè¢«ä¿ç•™çš„ç©ºé—´æ— æ³•è¢«å…¶ä»–å¯¹è±¡ä½¿ç”¨ã€‚ç”šè‡³å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</li></ol></li><li><p><strong>ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ</strong></p><ul><li><strong>æƒ³è¦å­¦ä¹ GCï¼Œé¦–å…ˆéœ€è¦ç†è§£ä¸ºä»€ä¹ˆéœ€è¦GCï¼Ÿ</strong><ol><li>å¯¹äºé«˜çº§è¯­è¨€æ¥è¯´ï¼Œä¸€ä¸ªåŸºæœ¬è®¤çŸ¥æ˜¯å¦‚æœä¸è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œ<strong>å†…å­˜è¿Ÿæ—©éƒ½ä¼šè¢«æ¶ˆè€—å®Œ</strong>ï¼Œå› ä¸ºä¸æ–­åœ°åˆ†é…å†…å­˜ç©ºé—´è€Œä¸è¿›è¡Œå›æ”¶ï¼Œå°±å¥½åƒä¸åœåœ°ç”Ÿäº§ç”Ÿæ´»åƒåœ¾è€Œä»æ¥ä¸æ‰“æ‰«ä¸€æ ·ã€‚</li><li>é™¤äº†é‡Šæ”¾æ²¡ç”¨çš„å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶ä¹Ÿå¯ä»¥æ¸…é™¤å†…å­˜é‡Œçš„è®°å½•ç¢ç‰‡ã€‚ç¢ç‰‡æ•´ç†å°†æ‰€å ç”¨çš„å †å†…å­˜ç§»åˆ°å †çš„ä¸€ç«¯ï¼Œ<strong>ä»¥ä¾¿JVMå°†æ•´ç†å‡ºçš„å†…å­˜åˆ†é…ç»™æ–°çš„å¯¹è±¡</strong>ã€‚</li><li>éšç€åº”ç”¨ç¨‹åºæ‰€åº”ä»˜çš„ä¸šåŠ¡è¶Šæ¥è¶Šåºå¤§ã€å¤æ‚ï¼Œç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œ<strong>æ²¡æœ‰GCå°±ä¸èƒ½ä¿è¯åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿›è¡Œ</strong>ã€‚è€Œç»å¸¸é€ æˆSTWçš„GCåˆè·Ÿä¸ä¸Šå®é™…çš„éœ€æ±‚ï¼Œæ‰€ä»¥æ‰ä¼šä¸æ–­åœ°å°è¯•å¯¹GCè¿›è¡Œä¼˜åŒ–ã€‚</li></ol></li></ul></li><li><p><strong>æ—©æœŸåƒåœ¾å›æ”¶</strong></p><ol><li><p>åœ¨æ—©æœŸçš„C&#x2F;C++æ—¶ä»£ï¼Œåƒåœ¾å›æ”¶åŸºæœ¬ä¸Šæ˜¯æ‰‹å·¥è¿›è¡Œçš„ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨newå…³é”®å­—è¿›è¡Œå†…å­˜ç”³è¯·ï¼Œå¹¶ä½¿ç”¨deleteå…³é”®å­—è¿›è¡Œå†…å­˜é‡Šæ”¾ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MibBridge *pBridge= <span class="keyword">new</span> <span class="title class_">cmBaseGroupBridge</span>ï¼ˆï¼‰ï¼›</span><br><span class="line">  <span class="comment">//å¦‚æœæ³¨å†Œå¤±è´¥ï¼Œä½¿ç”¨Deleteé‡Šæ”¾è¯¥å¯¹è±¡æ‰€å å†…å­˜åŒºåŸŸ</span></span><br><span class="line">  <span class="keyword">if</span>ï¼ˆpBridge-&gt;Registerï¼ˆkDestroyï¼‰ï¼=NO ERRORï¼‰</span><br><span class="line">  delete pBridgeï¼›</span><br></pre></td></tr></table></figure></li><li><p>è¿™ç§æ–¹å¼å¯ä»¥çµæ´»æ§åˆ¶å†…å­˜é‡Šæ”¾çš„æ—¶é—´ï¼Œä½†æ˜¯ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥<strong>é¢‘ç¹ç”³è¯·å’Œé‡Šæ”¾å†…å­˜çš„ç®¡ç†è´Ÿæ‹…</strong>ã€‚å€˜è‹¥æœ‰ä¸€å¤„å†…å­˜åŒºé—´ç”±äºç¨‹åºå‘˜ç¼–ç çš„é—®é¢˜å¿˜è®°è¢«å›æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿ<strong>å†…å­˜æ³„æ¼</strong>ï¼Œåƒåœ¾å¯¹è±¡æ°¸è¿œæ— æ³•è¢«æ¸…é™¤ï¼Œéšç€ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„ä¸æ–­å¢é•¿ï¼Œåƒåœ¾å¯¹è±¡æ‰€è€—å†…å­˜å¯èƒ½æŒç»­ä¸Šå‡ï¼Œç›´åˆ°å‡ºç°å†…å­˜æº¢å‡ºå¹¶é€ æˆ<strong>åº”ç”¨ç¨‹åºå´©æºƒ</strong>ã€‚</p></li><li><p>æœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶åï¼Œä¸Šè¿°ä»£ç ææœ‰å¯èƒ½å˜æˆè¿™æ ·</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MibBridge *pBridge=<span class="keyword">new</span> <span class="title class_">cmBaseGroupBridge</span>(); </span><br><span class="line">  pBridge-&gt;Register(kDestroy);</span><br></pre></td></tr></table></figure></li></ol></li></ul><ol><li>ç°åœ¨ï¼Œé™¤äº†Javaä»¥å¤–ï¼ŒC#ã€Pythonã€Rubyç­‰è¯­è¨€éƒ½ä½¿ç”¨äº†è‡ªåŠ¨åƒåœ¾å›æ”¶çš„æ€æƒ³ï¼Œä¹Ÿæ˜¯æœªæ¥å‘å±•è¶‹åŠ¿ï¼Œå¯ä»¥è¯´è¿™ç§è‡ªåŠ¨åŒ–çš„å†…å­˜åˆ†é…å’Œæ¥åŠå›æ”¶æ–¹å¼å·²ç»æˆä¸ºäº†ç°ä»£å¼€å‘è¯­è¨€å¿…å¤‡çš„æ ‡å‡†ã€‚</li></ol><h3 id="2-Java-åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#2-Java-åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="2.Java åƒåœ¾å›æ”¶æœºåˆ¶"></a>2.<strong>Java åƒåœ¾å›æ”¶æœºåˆ¶</strong></h3><ul><li><p><strong>è‡ªåŠ¨å†…å­˜ç®¡ç†</strong></p><ul><li><strong>å®˜ç½‘ä»‹ç»ï¼š</strong><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html">Java Platform, Standard Edition HotSpot Virtual Machine Garbage Collection Tuning Guide, Release 8 (oracle.com)</a></li></ul></li><li><p><strong>è‡ªåŠ¨å†…å­˜ç®¡ç†çš„ä¼˜ç‚¹</strong></p><ol><li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œæ— éœ€å¼€å‘äººå‘˜æ‰‹åŠ¨å‚ä¸å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼Œè¿™æ ·é™ä½å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„é£é™©</li><li>æ²¡æœ‰åƒåœ¾å›æ”¶å™¨ï¼Œjavaä¹Ÿä¼šå’Œcppä¸€æ ·ï¼Œå„ç§æ‚¬å‚æŒ‡é’ˆï¼Œé‡æŒ‡é’ˆï¼Œæ³„éœ²é—®é¢˜è®©ä½ å¤´ç–¼ä¸å·²ã€‚</li><li>è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå°†ç¨‹åºå‘˜ä»ç¹é‡çš„å†…å­˜ç®¡ç†ä¸­é‡Šæ”¾å‡ºæ¥ï¼Œå¯ä»¥æ›´ä¸“å¿ƒåœ°ä¸“æ³¨äºä¸šåŠ¡å¼€å‘</li></ol></li><li><p><strong>å…³äºè‡ªåŠ¨å†…å­˜ç®¡ç†çš„æ‹…å¿§</strong></p><ol><li>å¯¹äºJavaå¼€å‘äººå‘˜è€Œè¨€ï¼Œè‡ªåŠ¨å†…å­˜ç®¡ç†å°±åƒæ˜¯ä¸€ä¸ªé»‘åŒ£å­ï¼Œå¦‚æœè¿‡åº¦ä¾èµ–äºâ€œè‡ªåŠ¨â€ï¼Œé‚£ä¹ˆè¿™å°†ä¼šæ˜¯ä¸€åœºç¾éš¾ï¼Œæœ€ä¸¥é‡çš„å°±ä¼š<strong>å¼±åŒ–Javaå¼€å‘äººå‘˜åœ¨ç¨‹åºå‡ºç°å†…å­˜æº¢å‡ºæ—¶å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›</strong>ã€‚</li><li>æ­¤æ—¶ï¼Œäº†è§£JVMçš„è‡ªåŠ¨å†…å­˜åˆ†é…å’Œå†…å­˜å›æ”¶åŸç†å°±æ˜¾å¾—éå¸¸é‡è¦ï¼Œåªæœ‰åœ¨çœŸæ­£äº†è§£JVMæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜åï¼Œæˆ‘ä»¬æ‰èƒ½å¤Ÿåœ¨é‡è§OutofMemoryErroræ—¶ï¼Œå¿«é€Ÿåœ°æ ¹æ®é”™è¯¯å¼‚å¸¸æ—¥å¿—å®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜ã€‚</li><li>å½“éœ€è¦æ’æŸ¥å„ç§å†…å­˜æº¢å‡ºã€å†…å­˜æ³„æ¼é—®é¢˜æ—¶ï¼Œå½“åƒåœ¾æ”¶é›†æˆä¸ºç³»ç»Ÿè¾¾åˆ°æ›´é«˜å¹¶å‘é‡çš„ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¯¹è¿™äº›â€œè‡ªåŠ¨åŒ–â€çš„æŠ€æœ¯<strong>å®æ–½å¿…è¦çš„ç›‘æ§å’Œè°ƒèŠ‚</strong>ã€‚</li></ol></li><li><p><strong>GCä¸»è¦å…³æ³¨çš„åŒºåŸŸ</strong></p><p>  GCä¸»è¦å…³æ³¨äº æ–¹æ³•åŒº å’Œå †ä¸­çš„åƒåœ¾æ”¶é›†</p><p>  <img src="/images/jvm_virtual_machine/chapter13/image1.png" alt="Untitled"></p><p>  åƒåœ¾æ”¶é›†å™¨å¯ä»¥å¯¹å¹´è½»ä»£å›æ”¶ï¼Œä¹Ÿå¯ä»¥å¯¹è€å¹´ä»£å›æ”¶ï¼Œç”šè‡³æ˜¯å…¨æ ˆå’Œæ–¹æ³•åŒºçš„å›æ”¶</p><ul><li>å…¶ä¸­ï¼ŒJavaå †æ˜¯åƒåœ¾æ”¶é›†å™¨çš„å·¥ä½œé‡ç‚¹</li></ul><p>  ä»æ¬¡æ•°ä¸Šè®²ï¼š</p><ul><li>é¢‘ç¹æ”¶é›†YoungåŒº</li><li>è¾ƒå°‘æ”¶é›†OldåŒº</li><li>åŸºæœ¬ä¸æ”¶é›†PermåŒºï¼ˆå…ƒç©ºé—´ï¼‰</li></ul></li></ul><h3 id="3-åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•"><a href="#3-åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•" class="headerlink" title="3.åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•"></a>3.<strong>åƒåœ¾å›æ”¶ç›¸å…³ç®—æ³•</strong></h3><ul><li><p><strong>å¼•ç”¨è®¡æ•°ç®—æ³•</strong></p><ol><li>åœ¨å †é‡Œå­˜æ”¾ç€å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡å®ä¾‹ï¼Œåœ¨GCæ‰§è¡Œåƒåœ¾å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆ<strong>éœ€è¦åŒºåˆ†å‡ºå†…å­˜ä¸­å“ªäº›æ˜¯å­˜æ´»å¯¹è±¡ï¼Œå“ªäº›æ˜¯å·²ç»æ­»äº¡çš„å¯¹è±¡ã€‚åªæœ‰è¢«æ ‡è®°ä¸ºå·±ç»æ­»äº¡çš„å¯¹è±¡ï¼ŒGCæ‰ä¼šåœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œé‡Šæ”¾æ‰å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç§°ä¸ºåƒåœ¾æ ‡è®°é˜¶æ®µã€‚</strong></li><li>é‚£ä¹ˆåœ¨JVMä¸­ç©¶ç«Ÿæ˜¯å¦‚ä½•æ ‡è®°ä¸€ä¸ªæ­»äº¡å¯¹è±¡å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å·²ç»ä¸å†è¢«ä»»ä½•çš„å­˜æ´»å¯¹è±¡ç»§ç»­å¼•ç”¨æ—¶ï¼Œå°±å¯ä»¥å®£åˆ¤ä¸ºå·²ç»æ­»äº¡ã€‚</li><li>åˆ¤æ–­å¯¹è±¡å­˜æ´»ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š<strong>å¼•ç”¨è®¡æ•°ç®—æ³•</strong>å’Œ<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ã€‚</li></ol><ul><li><strong>å¼•ç”¨è®¡æ•°ç®—æ³•-åŸç†</strong><ul><li>å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Countingï¼‰æ¯”è¾ƒç®€å•ï¼Œå¯¹æ¯ä¸ªå¯¹è±¡ä¿å­˜ä¸€ä¸ªæ•´å‹çš„å¼•ç”¨è®¡æ•°å™¨å±æ€§ã€‚ç”¨äºè®°å½•å¯¹è±¡è¢«å¼•ç”¨çš„æƒ…å†µã€‚</li><li>å¯¹äºä¸€ä¸ªå¯¹è±¡Aï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†Aï¼Œåˆ™Açš„å¼•ç”¨è®¡æ•°å™¨å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å°±å‡1ã€‚åªè¦å¯¹è±¡Açš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ä¸º0ï¼Œå³è¡¨ç¤ºå¯¹è±¡Aä¸å¯èƒ½å†è¢«ä½¿ç”¨ï¼Œå¯è¿›è¡Œå›æ”¶ã€‚</li><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œåƒåœ¾å¯¹è±¡ä¾¿äºè¾¨è¯†ï¼›åˆ¤å®šæ•ˆç‡é«˜ï¼Œå›æ”¶æ²¡æœ‰å»¶è¿Ÿæ€§ã€‚</li><li>ç¼ºç‚¹ï¼š<ol><li>å®ƒéœ€è¦å•ç‹¬çš„å­—æ®µå­˜å‚¨è®¡æ•°å™¨ï¼Œè¿™æ ·çš„åšæ³•å¢åŠ äº†<strong>å­˜å‚¨ç©ºé—´çš„å¼€é”€</strong>ã€‚</li><li>æ¯æ¬¡èµ‹å€¼éƒ½éœ€è¦æ›´æ–°è®¡æ•°å™¨ï¼Œä¼´éšç€åŠ æ³•å’Œå‡æ³•æ“ä½œï¼Œè¿™å¢åŠ äº†<strong>æ—¶é—´å¼€é”€</strong>ã€‚</li><li>å¼•ç”¨è®¡æ•°å™¨æœ‰ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå³<strong>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</strong>çš„æƒ…å†µã€‚è¿™æ˜¯ä¸€æ¡è‡´å‘½ç¼ºé™·ï¼Œå¯¼è‡´åœ¨Javaçš„åƒåœ¾å›æ”¶å™¨ä¸­æ²¡æœ‰ä½¿ç”¨è¿™ç±»ç®—æ³•ã€‚</li></ol></li></ul></li><li><strong>å¾ªç¯å¼•ç”¨</strong><ul><li>å½“pçš„æŒ‡é’ˆæ–­å¼€çš„æ—¶å€™ï¼Œå†…éƒ¨çš„å¼•ç”¨å½¢æˆä¸€ä¸ªå¾ªç¯ï¼Œè®¡æ•°å™¨éƒ½è¿˜ç®—1ï¼Œæ— æ³•è¢«å›æ”¶ï¼Œè¿™å°±æ˜¯å¾ªç¯å¼•ç”¨ï¼Œä»è€Œé€ æˆå†…å­˜æ³„æ¼****</li></ul></li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image2.png" alt="Untitled"></p><ul><li>éªŒè¯Javaæ˜¯å¦é‡‡ç”¨çš„æ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.gc;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * å¼•ç”¨è®¡æ•°ç®—æ³•æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-03-05 16:44:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefCountGC</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªæˆå‘˜å±æ€§çš„å”¯ä¸€ä½œç”¨å°±æ˜¯å ç”¨ä¸€ç‚¹å†…å­˜</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] bigSize = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">5</span>*<span class="number">1024</span>*<span class="number">1024</span>];</span><br><span class="line">    <span class="comment">// å¼•ç”¨</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">RefCountGC</span> <span class="variable">obj1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RefCountGC</span>();</span><br><span class="line">        <span class="type">RefCountGC</span> <span class="variable">obj2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RefCountGC</span>();</span><br><span class="line">        obj1.reference = obj2;</span><br><span class="line">        obj2.reference = obj1;</span><br><span class="line">        obj1 = <span class="literal">null</span>;</span><br><span class="line">        obj2 = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ˜¾ç¤ºçš„æ‰§è¡Œåƒåœ¾æ”¶é›†è¡Œä¸ºï¼Œåˆ¤æ–­obj1 å’Œ obj2æ˜¯å¦è¢«å›æ”¶ï¼Ÿ</span></span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">15093</span><span class="type">K</span>-&gt;<span class="number">808</span><span class="type">K</span>(<span class="number">94208</span><span class="type">K</span>)] <span class="number">15093</span><span class="type">K</span>-&gt;<span class="number">816</span><span class="type">K</span>(<span class="number">310272</span><span class="type">K</span>), <span class="number">0.0010090</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">[<span class="type">Full</span> <span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">808</span><span class="type">K</span>-&gt;<span class="number">0</span><span class="type">K</span>(<span class="number">94208</span><span class="type">K</span>)] [<span class="type">ParOldGen</span>: <span class="number">8</span><span class="type">K</span>-&gt;<span class="number">627</span><span class="type">K</span>(<span class="number">216064</span><span class="type">K</span>)] <span class="number">816</span><span class="type">K</span>-&gt;<span class="number">627</span><span class="type">K</span>(<span class="number">310272</span><span class="type">K</span>), [<span class="type">Metaspace</span>: <span class="number">3226</span><span class="type">K</span>-&gt;<span class="number">3226</span><span class="type">K</span>(<span class="number">1056768</span><span class="type">K</span>)], <span class="number">0.0038155</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total <span class="number">94208</span>K, used <span class="number">809</span>K [<span class="number">0</span><span class="type">x0000000756f80000</span>, <span class="number">0</span><span class="type">x000000075d880000</span>, <span class="number">0</span><span class="type">x00000007c0000000</span>)</span><br><span class="line">  <span class="type">eden</span> <span class="type">space</span> <span class="number">80896</span><span class="type">K</span>, <span class="number">1</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x0000000756f80000</span>,<span class="number">0</span><span class="type">x000000075704a548</span>,<span class="number">0</span><span class="type">x000000075be80000</span>)</span><br><span class="line">  <span class="type">from</span> <span class="type">space</span> <span class="number">13312</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x000000075be80000</span>,<span class="number">0</span><span class="type">x000000075be80000</span>,<span class="number">0</span><span class="type">x000000075cb80000</span>)</span><br><span class="line">  <span class="type">to</span>   <span class="type">space</span> <span class="number">13312</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x000000075cb80000</span>,<span class="number">0</span><span class="type">x000000075cb80000</span>,<span class="number">0</span><span class="type">x000000075d880000</span>)</span><br><span class="line"> <span class="type">ParOldGen</span>       <span class="type">total</span> <span class="number">216064</span><span class="type">K</span>, <span class="type">used</span> <span class="number">627</span><span class="type">K</span> [<span class="number">0</span><span class="type">x0000000684e00000</span>, <span class="number">0</span><span class="type">x0000000692100000</span>, <span class="number">0</span><span class="type">x0000000756f80000</span>)</span><br><span class="line">  <span class="type">object</span> <span class="type">space</span> <span class="number">216064</span><span class="type">K</span>, <span class="number">0</span>% <span class="type">used</span> [<span class="number">0</span><span class="type">x0000000684e00000</span>,<span class="number">0</span><span class="type">x0000000684e9cc80</span>,<span class="number">0</span><span class="type">x0000000692100000</span>)</span><br><span class="line"> <span class="type">Metaspace</span>       <span class="type">used</span> <span class="number">3233</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">4496</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">4864</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1056768</span><span class="type">K</span></span><br><span class="line">  <span class="type">class</span> <span class="type">space</span>    <span class="type">used</span> <span class="number">350</span><span class="type">K</span>, <span class="type">capacity</span> <span class="number">388</span><span class="type">K</span>, <span class="type">committed</span> <span class="number">512</span><span class="type">K</span>, <span class="type">reserved</span> <span class="number">1048576</span><span class="type">K</span></span><br></pre></td></tr></table></figure><p>  æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°ï¼Œä¸Šè¿°è¿›è¡Œäº†GCæ”¶é›†çš„è¡Œä¸ºï¼Œå°†ä¸Šè¿°çš„æ–°ç”Ÿä»£ä¸­çš„ä¸¤ä¸ªå¯¹è±¡éƒ½è¿›è¡Œå›æ”¶äº†</p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">GC</span> (<span class="type">System.gc</span>()) [<span class="type">PSYoungGen</span>: <span class="number">15093</span><span class="type">K</span>-&gt;<span class="number">808</span><span class="type">K</span>(<span class="number">94208</span><span class="type">K</span>)] <span class="number">15093</span><span class="type">K</span>-&gt;<span class="number">816</span><span class="type">K</span>(<span class="number">310272</span><span class="type">K</span>), <span class="number">0.0010090</span> <span class="type">secs</span>] [<span class="type">Times</span>: <span class="type">user</span>=<span class="number">0.00</span> <span class="type">sys</span>=<span class="number">0.00</span>, <span class="type">real</span>=<span class="number">0.00</span> <span class="type">secs</span>] </span><br></pre></td></tr></table></figure><p>   å¦‚æœä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡ä¼šæ— æ³•å›æ”¶ã€‚è€Œç°åœ¨ä¸¤ä¸ªå¯¹è±¡è¢«å›æ”¶äº†ï¼Œè¯´æ˜Javaä½¿ç”¨çš„ä¸æ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ¥è¿›è¡Œæ ‡è®°çš„ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter13/image3.png" alt="Untitled"></p></li><li><p><strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong></p><ul><li><strong>æ¦‚å¿µï¼š</strong><ul><li><strong>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼šä¹Ÿå¯ä»¥ç§°ä¸ºæ ¹æœç´¢ç®—æ³•ã€è¿½è¸ªæ€§åƒåœ¾æ”¶é›†</strong><ol><li>ç›¸å¯¹äºå¼•ç”¨è®¡æ•°ç®—æ³•è€Œè¨€ï¼Œå¯è¾¾æ€§åˆ†æç®—æ³•ä¸ä»…åŒæ ·å…·å¤‡å®ç°ç®€å•å’Œæ‰§è¡Œé«˜æ•ˆç­‰ç‰¹ç‚¹ï¼Œæ›´é‡è¦çš„æ˜¯è¯¥ç®—æ³•å¯ä»¥æœ‰æ•ˆåœ°<strong>è§£å†³åœ¨å¼•ç”¨è®¡æ•°ç®—æ³•ä¸­å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼çš„å‘ç”Ÿ</strong>ã€‚</li><li>ç›¸è¾ƒäºå¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œè¿™é‡Œçš„å¯è¾¾æ€§åˆ†æå°±æ˜¯Javaã€C#é€‰æ‹©çš„ã€‚è¿™ç§ç±»å‹çš„åƒåœ¾æ”¶é›†é€šå¸¸ä¹Ÿå«ä½œ<strong>è¿½è¸ªæ€§åƒåœ¾æ”¶é›†</strong>ï¼ˆTracing Garbage Collectionï¼‰</li></ol></li></ul></li><li><strong>å¯è¾¾æ€§åˆ†æå®ç°æ€è·¯</strong><ul><li><p>æ‰€è°“â€GCRootsâ€æ ¹é›†åˆå°±æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨</p></li><li><p>å…¶åŸºæœ¬æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>å¯è¾¾æ€§åˆ†æç®—æ³•æ˜¯ä»¥æ ¹å¯¹è±¡é›†åˆï¼ˆGCRootsï¼‰ä¸ºèµ·å§‹ç‚¹ï¼ŒæŒ‰ç…§ä»ä¸Šè‡³ä¸‹çš„æ–¹å¼<strong>æœç´¢è¢«æ ¹å¯¹è±¡é›†åˆæ‰€è¿æ¥çš„ç›®æ ‡å¯¹è±¡æ˜¯å¦å¯è¾¾ã€‚</strong></li><li>ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åï¼Œå†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡éƒ½ä¼šè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–é—´æ¥è¿æ¥ç€ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸º<strong>å¼•ç”¨é“¾</strong>ï¼ˆReference Chainï¼‰</li><li>å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼Œåˆ™æ˜¯ä¸å¯è¾¾çš„ï¼Œå°±æ„å‘³ç€è¯¥å¯¹è±¡å·±ç»æ­»äº¡ï¼Œå¯ä»¥æ ‡è®°åƒåœ¾å¯¹è±¡ã€‚</li><li>åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ï¼Œåªæœ‰èƒ½å¤Ÿè¢«æ ¹å¯¹è±¡é›†åˆç›´æ¥æˆ–è€…é—´æ¥è¿æ¥çš„å¯¹è±¡æ‰æ˜¯å­˜æ´»å¯¹è±¡ã€‚</li></ol><p>  <img src="/images/jvm_virtual_machine/chapter13/image4.png" alt="Untitled"></p></li></ul></li></ul></li><li><p><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong></p><ul><li><p><strong>åƒåœ¾æ¸…é™¤é˜¶æ®µ</strong></p><ul><li>å½“æˆåŠŸåŒºåˆ†å‡ºå†…å­˜ä¸­å­˜æ´»å¯¹è±¡å’Œæ­»äº¡å¯¹è±¡åï¼ŒGCæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯æ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œé‡Šæ”¾æ‰æ— ç”¨å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œä»¥ä¾¿æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚ç›®å‰åœ¨JVMä¸­æ¯”è¾ƒå¸¸è§çš„ä¸‰ç§åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯<ol><li>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</li><li>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</li><li>æ ‡è®°-å‹ç¼©ç®—æ³•ï¼ˆMark-Compactï¼‰</li></ol></li><li>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰æ˜¯ä¸€ç§éå¸¸åŸºç¡€å’Œå¸¸è§çš„åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œè¯¥ç®—æ³•è¢«J.McCarthyç­‰äººåœ¨1960å¹´æå‡ºå¹¶å¹¶åº”ç”¨äºLispè¯­è¨€ã€‚</li></ul></li><li><p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p><ul><li>å½“å †ä¸­çš„æœ‰æ•ˆå†…å­˜ç©ºé—´ï¼ˆavailable memoryï¼‰è¢«è€—å°½çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢æ•´ä¸ªç¨‹åºï¼ˆä¹Ÿè¢«ç§°ä¸ºstop the worldï¼‰ï¼Œç„¶åè¿›è¡Œä¸¤é¡¹å·¥ä½œï¼Œç¬¬ä¸€é¡¹åˆ™æ˜¯æ ‡è®°ï¼Œç¬¬äºŒé¡¹åˆ™æ˜¯æ¸…é™¤</li><li><strong>æ ‡è®°</strong>ï¼šCollectorä»å¼•ç”¨æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œ<strong>æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡</strong>ã€‚ä¸€èˆ¬æ˜¯åœ¨å¯¹è±¡çš„Headerä¸­è®°å½•ä¸ºå¯è¾¾å¯¹è±¡ã€‚<ul><li><strong>æ ‡è®°çš„æ˜¯å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸æ˜¯åƒåœ¾ï¼ï¼</strong></li></ul></li><li><strong>æ¸…é™¤</strong>ï¼šCollectorå¯¹å †å†…å­˜ä»å¤´åˆ°å°¾è¿›è¡Œçº¿æ€§çš„éå†ï¼Œå¦‚æœå‘ç°æŸä¸ªå¯¹è±¡åœ¨å…¶Headerä¸­æ²¡æœ‰æ ‡è®°ä¸ºå¯è¾¾å¯¹è±¡ï¼Œåˆ™å°†å…¶å›æ”¶</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image5.png" alt="Untitled">  </p></li><li><p><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹</strong></p><ol><li>æ ‡è®°æ¸…é™¤ç®—æ³•çš„æ•ˆç‡ä¸ç®—é«˜</li><li>åœ¨è¿›è¡ŒGCçš„æ—¶å€™ï¼Œéœ€è¦åœæ­¢æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œç”¨æˆ·ä½“éªŒè¾ƒå·®</li><li>è¿™ç§æ–¹å¼æ¸…ç†å‡ºæ¥çš„ç©ºé—²å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œäº§ç”Ÿå†…ç¢ç‰‡ï¼Œéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨</li></ol></li><li><p><strong>æ³¨æ„ï¼šä½•ä¸ºæ¸…é™¤ï¼Ÿ</strong></p><ul><li>è¿™é‡Œæ‰€è°“çš„æ¸…é™¤å¹¶ä¸æ˜¯çœŸçš„ç½®ç©ºï¼Œè€Œæ˜¯æŠŠéœ€è¦æ¸…é™¤çš„å¯¹è±¡åœ°å€ä¿å­˜åœ¨ç©ºé—²çš„åœ°å€åˆ—è¡¨é‡Œã€‚ä¸‹æ¬¡æœ‰æ–°å¯¹è±¡éœ€è¦åŠ è½½æ—¶ï¼Œåˆ¤æ–­åƒåœ¾çš„ä½ç½®ç©ºé—´æ˜¯å¦å¤Ÿï¼Œå¦‚æœå¤Ÿï¼Œå°±å­˜æ”¾ï¼ˆä¹Ÿå°±æ˜¯è¦†ç›–åŸæœ‰çš„åœ°å€ï¼‰ã€‚</li><li>å…³äºç©ºé—²åˆ—è¡¨æ˜¯åœ¨ä¸ºå¯¹è±¡åˆ†é…å†…å­˜çš„æ—¶å€™æè¿‡ï¼š<ul><li>å¦‚æœå†…å­˜è§„æ•´<ul><li>é‡‡ç”¨æŒ‡é’ˆç¢°æ’çš„æ–¹å¼è¿›è¡Œå†…å­˜åˆ†é…</li></ul></li><li>å¦‚æœå†…å­˜ä¸è§„æ•´<ul><li>è™šæ‹Ÿæœºéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨</li><li>é‡‡ç”¨ç©ºé—²åˆ—è¡¨åˆ†é…å†…å­˜</li></ul></li></ul></li></ul></li><li><p><strong>GC Rootså¯ä»¥æ˜¯å“ªäº›ï¼Ÿ</strong></p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡<ul><li>æ¯”å¦‚ï¼šå„ä¸ªçº¿ç¨‹è¢«è°ƒç”¨çš„æ–¹æ³•ä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰ã€‚</li></ul></li><li>æœ¬åœ°æ–¹æ³•æ ˆå†…JNIï¼ˆé€šå¸¸è¯´çš„æœ¬åœ°æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡<ul><li>æ¯”å¦‚ï¼šJavaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡</li></ul></li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡<ul><li>æ¯”å¦‚ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆStringTableï¼‰é‡Œçš„å¼•ç”¨</li></ul></li><li>æ‰€æœ‰è¢«åŒæ­¥é”synchronizedæŒæœ‰çš„å¯¹è±¡</li><li>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ã€‚<ul><li>åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»çš„å¼‚å¸¸å¯¹è±¡ï¼ˆå¦‚ï¼šNullPointerExceptionã€OutofMemoryErrorï¼‰ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</li></ul></li><li>åæ˜ javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBeanã€JVMTIä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image6.png" alt="Untitled"></p><ul><li><strong>æ³¨æ„</strong><ol><li>å¦‚æœè¦ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å†…å­˜æ˜¯å¦å¯å›æ”¶ï¼Œé‚£ä¹ˆåˆ†æå·¥ä½œå¿…é¡»åœ¨ä¸€ä¸ªèƒ½ä¿éšœä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œã€‚è¿™ç‚¹ä¸æ»¡è¶³çš„è¯åˆ†æç»“æœçš„å‡†ç¡®æ€§å°±æ— æ³•ä¿è¯ã€‚</li><li>è¿™ç‚¹ä¹Ÿæ˜¯å¯¼è‡´GCè¿›è¡Œæ—¶å¿…é¡»â€œStop The Worldâ€çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚å³ä½¿æ˜¯å·ç§°ï¼ˆå‡ ä¹ï¼‰ä¸ä¼šå‘ç”Ÿåœé¡¿çš„CMSæ”¶é›†å™¨ä¸­ï¼Œ<strong>æšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„</strong>ã€‚</li></ol></li></ul></li></ul></li><li><p><strong>æ¸…é™¤é˜¶æ®µï¼šå¤åˆ¶ç®—æ³•</strong></p><ul><li><p><strong>èƒŒæ™¯</strong></p><ul><li>ä¸ºäº†è§£å†³æ ‡è®°-æ¸…é™¤ç®—æ³•åœ¨åƒåœ¾æ”¶é›†æ•ˆç‡æ–¹é¢çš„ç¼ºé™·ï¼ŒM.L.Minskyäº1963å¹´å‘è¡¨äº†è‘—åçš„è®ºæ–‡ï¼Œâ€œä½¿ç”¨åŒå­˜å‚¨åŒºçš„Lispè¯­è¨€åƒåœ¾æ”¶é›†å™¨CA LISP Garbage Collector Algorithm Using Serial Secondary Storageï¼‰â€ã€‚M.L.Minskyåœ¨è¯¥è®ºæ–‡ä¸­æè¿°çš„ç®—æ³•è¢«äººä»¬ç§°ä¸ºå¤åˆ¶ï¼ˆCopyingï¼‰ç®—æ³•ï¼Œå®ƒä¹Ÿè¢«M.L.Minskyæœ¬äººæˆåŠŸåœ°å¼•å…¥åˆ°äº†Lispè¯­è¨€çš„ä¸€ä¸ªå®ç°ç‰ˆæœ¬ä¸­ã€‚</li></ul></li><li><p><strong>æ ¸å¿ƒæ€æƒ³</strong></p><ul><li>å°†æ´»ç€çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶å°†æ­£åœ¨ä½¿ç”¨çš„å†…å­˜ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æœªè¢«ä½¿ç”¨çš„å†…å­˜å—ä¸­ï¼Œä¹‹åæ¸…é™¤æ­£åœ¨ä½¿ç”¨çš„å†…å­˜å—ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œäº¤æ¢ä¸¤ä¸ªå†…å­˜çš„è§’è‰²ï¼Œæœ€åå®Œæˆåƒåœ¾å›æ”¶ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image7.png" alt="Untitled"></p><ul><li>æŠŠå¯è¾¾çš„å¯¹è±¡ï¼Œç›´æ¥å¤åˆ¶åˆ°å¦å¤–ä¸€ä¸ªåŒºåŸŸä¸­å¤åˆ¶å®Œæˆåï¼ŒAåŒºå°±æ²¡æœ‰ç”¨äº†ï¼Œé‡Œé¢çš„å¯¹è±¡å¯ä»¥ç›´æ¥æ¸…é™¤æ‰ï¼Œå…¶å®é‡Œé¢çš„æ–°ç”Ÿä»£é‡Œé¢å°±ç”¨åˆ°äº†å¤åˆ¶ç®—æ³•</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image8.png" alt="Untitled">  </p></li><li><p><strong>ä¼˜ç‚¹</strong></p><ul><li>æ²¡æœ‰æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹ï¼Œå®ç°ç®€å•ï¼Œè¿è¡Œé«˜æ•ˆ</li><li>å¤åˆ¶è¿‡å»ä»¥åä¿è¯ç©ºé—´çš„è¿ç»­æ€§ï¼Œä¸ä¼šå‡ºç°â€œç¢ç‰‡â€é—®é¢˜ã€‚</li></ul></li><li><p><strong>ç¼ºç‚¹</strong></p><ul><li>æ­¤ç®—æ³•çš„ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œå°±æ˜¯éœ€è¦ä¸¤å€çš„å†…å­˜ç©ºé—´ã€‚</li><li>å¯¹äºG1è¿™ç§åˆ†æ‹†æˆä¸ºå¤§é‡regionçš„GCï¼Œå¤åˆ¶è€Œä¸æ˜¯ç§»åŠ¨ï¼Œæ„å‘³ç€GCéœ€è¦ç»´æŠ¤regionä¹‹é—´å¯¹è±¡å¼•ç”¨å…³ç³»ï¼Œä¸ç®¡æ˜¯å†…å­˜å ç”¨æˆ–è€…æ—¶é—´å¼€é”€ä¹Ÿä¸å°</li></ul></li><li><p><strong>æ³¨æ„</strong></p><ul><li>å¦‚æœç³»ç»Ÿä¸­çš„åƒåœ¾å¯¹è±¡å¾ˆå¤šï¼Œå¤åˆ¶ç®—æ³•éœ€è¦å¤åˆ¶çš„å­˜æ´»å¯¹è±¡æ•°é‡å¹¶ä¸ä¼šå¤ªå¤§ï¼Œæˆ–è€…è¯´éå¸¸ä½æ‰è¡Œï¼ˆè€å¹´ä»£å¤§é‡çš„å¯¹è±¡å­˜æ´»ï¼Œé‚£ä¹ˆå¤åˆ¶çš„å¯¹è±¡å°†ä¼šæœ‰å¾ˆå¤šï¼Œæ•ˆç‡ä¼šå¾ˆä½ï¼‰</li><li>åœ¨æ–°ç”Ÿä»£ï¼Œå¯¹å¸¸è§„åº”ç”¨çš„åƒåœ¾å›æ”¶ï¼Œä¸€æ¬¡é€šå¸¸å¯ä»¥å›æ”¶70% - 99% çš„å†…å­˜ç©ºé—´ã€‚å›æ”¶æ€§ä»·æ¯”å¾ˆé«˜ã€‚æ‰€ä»¥ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½æ˜¯ç”¨è¿™ç§æ”¶é›†ç®—æ³•å›æ”¶æ–°ç”Ÿä»£ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image9.png" alt="Untitled"></p></li></ul></li></ul><h3 id="4-å¯¹è±¡çš„-finalization-æœºåˆ¶"><a href="#4-å¯¹è±¡çš„-finalization-æœºåˆ¶" class="headerlink" title="4.å¯¹è±¡çš„ finalization æœºåˆ¶"></a>4.<strong>å¯¹è±¡çš„ finalization æœºåˆ¶</strong></h3><ul><li><p>æ¦‚è¿°</p><ul><li>Javaè¯­è¨€æä¾›äº†å¯¹è±¡ç»ˆæ­¢ï¼ˆfinalizationï¼‰æœºåˆ¶æ¥å…è®¸å¼€å‘äººå‘˜æä¾›å¯¹è±¡è¢«é”€æ¯ä¹‹å‰çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘ã€‚</li><li>å½“åƒåœ¾å›æ”¶å™¨å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå³ï¼šåƒåœ¾å›æ”¶æ­¤å¯¹è±¡ä¹‹å‰ï¼Œæ€»ä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•ã€‚</li><li>finalize() æ–¹æ³•å…è®¸åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼Œç”¨äºåœ¨å¯¹è±¡è¢«å›æ”¶æ—¶è¿›è¡Œèµ„æºé‡Šæ”¾ã€‚é€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾å’Œæ¸…ç†çš„å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ã€å¥—æ¥å­—å’Œæ•°æ®åº“è¿æ¥ç­‰ã€‚</li></ul></li><li><p><strong>å¯¹è±¡é”€æ¯å‰çš„å›è°ƒå‡½æ•°ï¼šfinalize()</strong></p><ul><li>Javaè¯­è¨€æä¾›äº†å¯¹è±¡ç»ˆæ­¢ï¼ˆfinalizationï¼‰æœºåˆ¶æ¥å…è®¸å¼€å‘äººå‘˜æä¾›<strong>å¯¹è±¡è¢«é”€æ¯ä¹‹å‰çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘</strong>ã€‚</li><li>å½“åƒåœ¾å›æ”¶å™¨å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå³ï¼šåƒåœ¾å›æ”¶æ­¤å¯¹è±¡ä¹‹å‰ï¼Œæ€»ä¼šå…ˆè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•ã€‚</li><li>finalize() æ–¹æ³•å…è®¸åœ¨å­ç±»ä¸­è¢«é‡å†™ï¼Œ<strong>ç”¨äºåœ¨å¯¹è±¡è¢«å›æ”¶æ—¶è¿›è¡Œèµ„æºé‡Šæ”¾</strong>ã€‚é€šå¸¸åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œä¸€äº›èµ„æºé‡Šæ”¾å’Œæ¸…ç†çš„å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ã€å¥—æ¥å­—å’Œæ•°æ®åº“è¿æ¥ç­‰ã€‚</li></ul></li><li><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><p>  æ°¸è¿œä¸è¦ä¸»åŠ¨è°ƒç”¨æŸä¸ªå¯¹è±¡çš„finalizeï¼ˆï¼‰æ–¹æ³•Iåº”è¯¥äº¤ç»™åƒåœ¾å›æ”¶æœºåˆ¶è°ƒç”¨ã€‚ç†ç”±åŒ…æ‹¬ä¸‹é¢ä¸‰ç‚¹ï¼š</p><ul><li>åœ¨finalizeï¼ˆï¼‰æ—¶å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡å¤æ´»ã€‚</li><li>finalizeï¼ˆï¼‰æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´æ˜¯æ²¡æœ‰ä¿éšœçš„ï¼Œå®ƒå®Œå…¨ç”±Gcçº¿ç¨‹å†³å®šï¼Œæç«¯æƒ…å†µä¸‹ï¼Œè‹¥ä¸å‘ç”ŸGCï¼Œåˆ™finalizeï¼ˆï¼‰æ–¹æ³•å°†æ²¡æœ‰æ‰§è¡Œæœºä¼šã€‚<ul><li>å› ä¸ºä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œå³ä½¿ä¸»åŠ¨è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šå› æ­¤å°±ç›´æ¥è¿›è¡Œå›æ”¶</li></ul></li><li>ä¸€ä¸ªç³Ÿç³•çš„finalizeï¼ˆï¼‰ä¼šä¸¥é‡å½±å“Gcçš„æ€§èƒ½ã€‚</li></ul></li><li><p><strong>ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ï¼Ÿ</strong></p><ul><li><p>ç”±äºfinalize()æ–¹æ³•çš„å­˜åœ¨ï¼Œ<strong>è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡ä¸€èˆ¬å¤„äºä¸‰ç§å¯èƒ½çš„çŠ¶æ€ã€‚</strong></p><ol><li>å¦‚æœä»æ‰€æœ‰çš„æ ¹èŠ‚ç‚¹éƒ½æ— æ³•è®¿é—®åˆ°æŸä¸ªå¯¹è±¡ï¼Œè¯´æ˜å¯¹è±¡å·±ç»ä¸å†ä½¿ç”¨äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ­¤å¯¹è±¡éœ€è¦è¢«å›æ”¶ã€‚ä½†äº‹å®ä¸Šï¼Œä¹Ÿå¹¶éæ˜¯â€œéæ­»ä¸å¯â€çš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€œç¼“åˆ‘â€é˜¶æ®µã€‚<strong>ä¸€ä¸ªæ— æ³•è§¦åŠçš„å¯¹è±¡æœ‰å¯èƒ½åœ¨æŸä¸€ä¸ªæ¡ä»¶ä¸‹â€œå¤æ´»â€è‡ªå·±</strong>ï¼Œå¦‚æœè¿™æ ·ï¼Œé‚£ä¹ˆå¯¹å®ƒç«‹å³è¿›è¡Œå›æ”¶å°±æ˜¯ä¸åˆç†çš„ã€‚ä¸ºæ­¤ï¼Œå®šä¹‰è™šæ‹Ÿæœºä¸­çš„å¯¹è±¡å¯èƒ½çš„ä¸‰ç§çŠ¶æ€ã€‚å¦‚ä¸‹ï¼š<ol><li>å¯è§¦åŠçš„ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå¯ä»¥åˆ°è¾¾è¿™ä¸ªå¯¹è±¡ã€‚</li><li>å¯å¤æ´»çš„ï¼šå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«é‡Šæ”¾ï¼Œä½†æ˜¯å¯¹è±¡æœ‰å¯èƒ½åœ¨finalize()ä¸­å¤æ´»ã€‚</li><li>ä¸å¯è§¦åŠçš„ï¼šå¯¹è±¡çš„finalize()è¢«è°ƒç”¨ï¼Œå¹¶ä¸”æ²¡æœ‰å¤æ´»ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥ä¸å¯è§¦åŠçŠ¶æ€ã€‚ä¸å¯è§¦åŠçš„å¯¹è±¡ä¸å¯èƒ½è¢«å¤æ´»ï¼Œ<strong>å› ä¸ºfinalize()åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</strong>ã€‚</li></ol></li><li>ä»¥ä¸Š3ç§çŠ¶æ€ä¸­ï¼Œæ˜¯ç”±äºfinalize()æ–¹æ³•çš„å­˜åœ¨ï¼Œè¿›è¡Œçš„åŒºåˆ†ã€‚åªæœ‰åœ¨å¯¹è±¡ä¸å¯è§¦åŠæ—¶æ‰å¯ä»¥è¢«å›æ”¶ã€‚</li></ol></li><li><p><strong>å…·ä½“è¿‡ç¨‹</strong></p><p>  åˆ¤å®šä¸€ä¸ªå¯¹è±¡objAæ˜¯å¦å¯å›æ”¶ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š</p><ul><li><p>å¦‚æœå¯¹è±¡objAåˆ°GC Rootsæ²¡æœ‰å¼•ç”¨é“¾ï¼Œåˆ™è¿›è¡Œç¬¬ä¸€æ¬¡æ ‡è®°ã€‚</p></li><li><p>è¿›è¡Œç­›é€‰ï¼Œåˆ¤æ–­æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalizeï¼ˆï¼‰æ–¹æ³•</p><ul><li>å¦‚æœå¯¹è±¡objAæ²¡æœ‰é‡å†™finalizeï¼ˆï¼‰æ–¹æ³•ï¼Œæˆ–è€…finalizeï¼ˆï¼‰æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œåˆ™è™šæ‹Ÿæœºè§†ä¸ºâ€œæ²¡æœ‰å¿…è¦æ‰§è¡Œâ€ï¼ŒobjAè¢«åˆ¤å®šä¸ºä¸å¯è§¦åŠçš„ã€‚</li><li>å¦‚æœå¯¹è±¡objAé‡å†™äº†finalizeï¼ˆï¼‰æ–¹æ³•ï¼Œä¸”è¿˜æœªæ‰§è¡Œè¿‡ï¼Œé‚£ä¹ˆobjAä¼šè¢«æ’å…¥åˆ°F-Queueé˜Ÿåˆ—ä¸­ï¼Œç”±ä¸€ä¸ªè™šæ‹Ÿæœºè‡ªåŠ¨åˆ›å»ºçš„ã€ä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹è§¦å‘å…¶finalizeï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œã€‚</li><li>finalizeï¼ˆï¼‰æ–¹æ³•æ˜¯å¯¹è±¡é€ƒè„±æ­»äº¡çš„æœ€åæœºä¼šï¼Œç¨åGCä¼šå¯¹F-Queueé˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ã€‚å¦‚æœobjAåœ¨finalizeï¼ˆï¼‰æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†è”ç³»ï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡æ ‡è®°æ—¶ï¼ŒobjAä¼šè¢«ç§»å‡ºâ€œå³å°†å›æ”¶â€é›†åˆã€‚ä¹‹åï¼Œå¯¹è±¡ä¼šå†æ¬¡å‡ºç°æ²¡æœ‰å¼•ç”¨å­˜åœ¨çš„æƒ…å†µã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œfinalizeæ–¹æ³•ä¸ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œå¯¹è±¡ä¼šç›´æ¥å˜æˆä¸å¯è§¦åŠçš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¯¹è±¡çš„finalizeæ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image10.png" alt="Untitled"></p></li></ul></li><li><p><strong>ä»£ç æ¼”ç¤º finalize() æ–¹æ³•å¯å¤æ´»å¯¹è±¡</strong></p><ul><li>æˆ‘ä»¬é‡å†™ CanReliveObj ç±»çš„ finalize()æ–¹æ³•ï¼Œåœ¨è°ƒç”¨å…¶ finalize()æ–¹æ³•æ—¶ï¼Œå°† obj æŒ‡å‘å½“å‰ç±»å¯¹è±¡ this</li><li>åœ¨è¿›è¡Œç¬¬ä¸€æ¬¡æ¸…é™¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæ‰§è¡Œfinalizeæ–¹æ³•ï¼Œç„¶å å¯¹è±¡ è¿›è¡Œäº†ä¸€æ¬¡è‡ªæ•‘æ“ä½œï¼Œä½†æ˜¯å› ä¸ºfinalize()æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå› æ­¤ç¬¬äºŒæ¬¡è¯¥å¯¹è±¡å°†ä¼šè¢«åƒåœ¾æ¸…é™¤ã€‚</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.gc;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•Objectç±»ä¸­finalize()æ–¹æ³•ï¼Œå³å¯¹è±¡çš„finalizationæœºåˆ¶ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-03-05 17:54:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanReliveObj</span> &#123;</span><br><span class="line">    <span class="comment">//ç±»å˜é‡ï¼Œå±äº GC Root</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CanReliveObj obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ­¤æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.finalize();</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨å½“å‰ç±»é‡å†™çš„finalize()æ–¹æ³•&quot;</span>);</span><br><span class="line">        <span class="comment">//å½“å‰å¾…å›æ”¶çš„å¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­ä¸å¼•ç”¨é“¾ä¸Šçš„ä¸€ä¸ªå¯¹è±¡objå»ºç«‹äº†è”ç³»</span></span><br><span class="line">        obj = <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            obj = <span class="keyword">new</span> <span class="title class_">CanReliveObj</span>();</span><br><span class="line">            obj = <span class="literal">null</span>;</span><br><span class="line">            System.gc();<span class="comment">//è°ƒç”¨åƒåœ¾å›æ”¶å™¨</span></span><br><span class="line">            System.out.println(<span class="string">&quot;-----------------ç¬¬ä¸€æ¬¡gcæ“ä½œ------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å› ä¸ºFinalizerçº¿ç¨‹ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ2ç§’ï¼Œä»¥ç­‰å¾…å®ƒ</span></span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj is dead&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj is still alive&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;-----------------ç¬¬äºŒæ¬¡gcæ“ä½œ------------&quot;</span>);</span><br><span class="line">            obj = <span class="literal">null</span>;</span><br><span class="line">            System.gc();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä¸‹é¢ä»£ç å’Œä¸Šé¢ä»£ç æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ canReliveObjå´è‡ªæ•‘å¤±è´¥äº†</span></span><br><span class="line">            <span class="comment">// å› ä¸ºFinalizerçº¿ç¨‹ä¼˜å…ˆçº§å¾ˆä½ï¼Œæš‚åœ2ç§’ï¼Œä»¥ç­‰å¾…å®ƒ</span></span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj is dead&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;obj is still alive&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ€åè¿è¡Œç»“æœ</li></ul>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨å½“å‰ç±»é‡å†™çš„finalize()æ–¹æ³•</span><br><span class="line"><span class="literal">-----------------</span>ç¬¬ä¸€æ¬¡<span class="built_in">gc</span>æ“ä½œ<span class="literal">------------</span></span><br><span class="line">obj is still alive</span><br><span class="line"><span class="literal">-----------------</span>ç¬¬äºŒæ¬¡<span class="built_in">gc</span>æ“ä½œ<span class="literal">------------</span></span><br><span class="line">obj is dead</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="5-MATä¸JProfilerçš„GC-Rootsæº¯æº"><a href="#5-MATä¸JProfilerçš„GC-Rootsæº¯æº" class="headerlink" title="5.MATä¸JProfilerçš„GC Rootsæº¯æº"></a>5.<strong>MATä¸JProfilerçš„GC Rootsæº¯æº</strong></h3><ul><li><p><strong>MAT</strong></p><ul><li><p><strong>ä»‹ç»</strong></p><ul><li>MATæ˜¯Memory Analyzerçš„ç®€ç§°ï¼Œå®ƒæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„Javaå †å†…å­˜åˆ†æå™¨ã€‚ç”¨äºæŸ¥æ‰¾å†…å­˜æ³„æ¼ä»¥åŠæŸ¥çœ‹å†…å­˜æ¶ˆè€—æƒ…å†µã€‚</li><li>MATæ˜¯åŸºäºEclipseå¼€å‘çš„ï¼Œæ˜¯ä¸€æ¬¾å…è´¹çš„æ€§èƒ½åˆ†æå·¥å…·ã€‚</li><li>ä¸‹è½½åœ°å€ï¼š<a href="http://www.eclipse.org/mat/">Eclipse Memory Analyzer Open Source Project | The Eclipse Foundation</a></li></ul></li><li><p>è·å–dumpæ–‡ä»¶</p><ul><li><strong>å‘½ä»¤è¡Œä½¿ç”¨ jmap</strong></li></ul>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\yuanxw&gt;jps</span><br><span class="line"><span class="number">13376</span> Jps</span><br><span class="line"><span class="number">16176</span> RefCountGC</span><br><span class="line"><span class="number">5856</span></span><br><span class="line"><span class="number">16824</span> Launcher</span><br><span class="line"><span class="number">16700</span> Main</span><br><span class="line"></span><br><span class="line">C:\Users\yuanxw&gt;jmap <span class="literal">-dump</span>:format=b,live,file=refcountgc.bin <span class="number">16176</span></span><br><span class="line">Dumping heap to C:\Users\yuanxw\refcountgc.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure><ul><li>æ‰“å¼€åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æœ‰å“ªäº›å¯ä»¥ä½œä¸ºGC Rootsçš„å¯¹è±¡</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image11.png" alt="Untitled"></p></li></ul></li><li><p><strong>JProfiler</strong></p><ul><li><p><strong>JProfilerçš„GC Rootsæº¯æº</strong></p><ul><li>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šæŸ¥çœ‹æ‰€æœ‰çš„GC Rootsã€‚ä¸€èˆ¬éƒ½æ˜¯æŸ¥çœ‹æŸä¸€ä¸ªæˆ–å‡ ä¸ªå¯¹è±¡çš„GC Rootæ˜¯å“ªä¸ªï¼Œè¿™ä¸ªè¿‡ç¨‹å«<strong>GC Roots æº¯æº</strong></li><li>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä½¿ç”¨ JProfiler è¿›è¡Œ GC Roots æº¯æºæ¼”ç¤º</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter13/image12.png" alt="Untitled"></p><p>  - </p></li><li><p><strong>å¦‚ä½•åˆ¤æ–­ä»€ä¹ˆåŸå› é€ æˆOOM</strong></p><ul><li>å½“æˆ‘ä»¬ç¨‹åºå‡ºç°OOMçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œæ’æŸ¥ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ä¸‹é¢çš„ä¾‹å­è¿›è¡Œè¯´æ˜</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.gc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å†…å­˜æº¢å‡ºæ’æŸ¥</span></span><br><span class="line"><span class="comment"> * -Xms8m -Xmx8m -XX:+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="comment"> * è¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯å½“ç¨‹åºå‡ºç°OOMçš„æ—¶å€™å°±ä¼šåœ¨å½“å‰å·¥ç¨‹ç›®å½•ç”Ÿæˆä¸€ä¸ªdumpæ–‡ä»¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapOOM</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1</span> * <span class="number">1024</span> * <span class="number">1024</span>];<span class="comment">//1MB</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;HeapOOM&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                list.add(<span class="keyword">new</span> <span class="title class_">HeapOOM</span>());</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Throwable e)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä¸Šè¿°ä»£ç å°±æ˜¯ä¸æ–­çš„åˆ›å»ºä¸€ä¸ª1Må°å­—èŠ‚æ•°ç»„ï¼Œç„¶åè®©å†…å­˜æº¢å‡ºï¼Œæˆ‘ä»¬éœ€è¦é™åˆ¶ä¸€ä¸‹å†…å­˜å¤§å°ï¼ŒåŒæ—¶ä½¿ç”¨HeapDumpOnOutOfMemoryErrorå°†å‡ºé”™æ—¶å€™çš„dumpæ–‡ä»¶è¾“å‡º</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">Dumping heap to java_pid7196.hprof ...</span><br><span class="line">Heap dump file created [<span class="number">7705267</span> bytes in <span class="number">0.009</span> secs]</span><br><span class="line">count = <span class="number">6</span></span><br><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at com.peppa.gc.HeapOOM.&lt;init&gt;(HeapOOM.java:<span class="number">10</span>)</span><br><span class="line">at com.peppa.gc.HeapOOM.main(HeapOOM.java:<span class="number">18</span>)</span><br></pre></td></tr></table></figure><p>  æˆ‘ä»¬å°†ç”Ÿæˆçš„dumpæ–‡ä»¶æ‰“å¼€ï¼Œç„¶åç‚¹å‡»Biggest Objectså°±èƒ½å¤Ÿçœ‹åˆ°è¶…å¤§å¯¹è±¡</p><p>  <img src="/images/jvm_virtual_machine/chapter13/image13.png" alt="Untitled"></p><p>  ç„¶åæˆ‘ä»¬é€šè¿‡çº¿ç¨‹ï¼Œè¿˜èƒ½å¤Ÿå®šä½åˆ°å“ªé‡Œå‡ºç°OOM</p><p>  <img src="/images/jvm_virtual_machine/chapter13/image14.png" alt="Untitled"></p></li></ul></li><li><p><strong>æ¸…é™¤é˜¶æ®µï¼šæ ‡è®°-æ•´ç†ç®—æ³•</strong></p><ul><li><p><strong>èƒŒæ™¯</strong></p><ul><li>å¤åˆ¶ç®—æ³•çš„é«˜æ•ˆæ€§æ˜¯å»ºç«‹åœ¨å­˜æ´»å¯¹è±¡å°‘ã€åƒåœ¾å¯¹è±¡å¤šçš„å‰æä¸‹çš„ã€‚è¿™ç§æƒ…å†µåœ¨æ–°ç”Ÿä»£ç»å¸¸å‘ç”Ÿï¼Œä½†æ˜¯åœ¨è€å¹´ä»£ï¼Œæ›´å¸¸è§çš„æƒ…å†µæ˜¯å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯å­˜æ´»å¯¹è±¡ã€‚å¦‚æœä¾ç„¶ä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œç”±äºå­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå¤åˆ¶çš„æˆæœ¬ä¹Ÿå°†å¾ˆé«˜ã€‚å› æ­¤ï¼ŒåŸºäºè€å¹´ä»£åƒåœ¾å›æ”¶çš„ç‰¹æ€§ï¼Œéœ€è¦ä½¿ç”¨å…¶ä»–çš„ç®—æ³•ã€‚</li><li>æ ‡è®°ä¸€æ¸…é™¤ç®—æ³•çš„ç¡®å¯ä»¥åº”ç”¨åœ¨è€å¹´ä»£ä¸­ï¼Œä½†æ˜¯è¯¥ç®—æ³•ä¸ä»…æ‰§è¡Œæ•ˆç‡ä½ä¸‹ï¼Œè€Œä¸”åœ¨æ‰§è¡Œå®Œå†…å­˜å›æ”¶åè¿˜ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥JvMçš„è®¾è®¡è€…éœ€è¦åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ”¹è¿›ã€‚æ ‡è®°-å‹ç¼©ï¼ˆMark-Compactï¼‰ç®—æ³•ç”±æ­¤è¯ç”Ÿã€‚1970å¹´å‰åï¼ŒG.L.Steeleã€C.J.Cheneå’ŒD.s.Wiseç­‰ç ”ç©¶è€…å‘å¸ƒæ ‡è®°-å‹ç¼©ç®—æ³•ã€‚åœ¨è®¸å¤šç°ä»£çš„åƒåœ¾æ”¶é›†å™¨ä¸­ï¼Œäººä»¬éƒ½ä½¿ç”¨äº†æ ‡è®°-å‹ç¼©ç®—æ³•æˆ–å…¶æ”¹è¿›ç‰ˆæœ¬ã€‚</li></ul></li><li><p><strong>æ‰§è¡Œè¿‡ç¨‹</strong></p><ul><li><p>ç¬¬ä¸€é˜¶æ®µå’Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¸€æ ·ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹æ ‡è®°æ‰€æœ‰è¢«å¼•ç”¨å¯¹è±¡</p></li><li><p>ç¬¬äºŒé˜¶æ®µå°†æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡å‹ç¼©åˆ°å†…å­˜çš„ä¸€ç«¯ï¼ŒæŒ‰é¡ºåºæ’æ”¾ã€‚ä¹‹åï¼Œæ¸…ç†è¾¹ç•Œå¤–æ‰€æœ‰çš„ç©ºé—´ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter13/image15.png" alt="Untitled"></p></li></ul></li><li><p><strong>æ ‡æ¸…å’Œæ ‡æ•´çš„åŒºåˆ«</strong></p><ul><li>æ ‡è®°-å‹ç¼©ç®—æ³•çš„æœ€ç»ˆæ•ˆæœç­‰åŒäºæ ‡è®°-æ¸…é™¤ç®—æ³•æ‰§è¡Œå®Œæˆåï¼Œå†è¿›è¡Œä¸€æ¬¡å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œå› æ­¤ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒç§°ä¸ºæ ‡è®°-æ¸…é™¤-å‹ç¼©ï¼ˆMark-Sweep-Compactï¼‰ç®—æ³•ã€‚</li><li>äºŒè€…çš„æœ¬è´¨å·®å¼‚åœ¨äºæ ‡è®°-æ¸…é™¤ç®—æ³•æ˜¯ä¸€ç§éç§»åŠ¨å¼çš„å›æ”¶ç®—æ³•ï¼Œæ ‡è®°-å‹ç¼©æ˜¯ç§»åŠ¨å¼çš„ã€‚æ˜¯å¦ç§»åŠ¨å›æ”¶åçš„å­˜æ´»å¯¹è±¡æ˜¯ä¸€é¡¹ä¼˜ç¼ºç‚¹å¹¶å­˜çš„é£é™©å†³ç­–ã€‚</li><li>æ ‡è®°çš„å­˜æ´»å¯¹è±¡å°†ä¼šè¢«æ•´ç†ï¼ŒæŒ‰ç…§å†…å­˜åœ°å€ä¾æ¬¡æ’åˆ—ï¼Œè€Œæœªè¢«æ ‡è®°çš„å†…å­˜ä¼šè¢«æ¸…ç†æ‰ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVMåªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ï¼Œè¿™æ¯”ç»´æŠ¤ä¸€ä¸ªç©ºé—²åˆ—è¡¨æ˜¾ç„¶å°‘äº†è®¸å¤šå¼€é”€ã€‚</li></ul></li><li><p><strong>æ ‡æ•´çš„ä¼˜ç¼ºç‚¹</strong></p><ul><li><strong>ä¼˜ç‚¹</strong><ol><li>æ¶ˆé™¤äº†æ ‡è®°-æ¸…é™¤ç®—æ³•å½“ä¸­ï¼Œå†…å­˜åŒºåŸŸåˆ†æ•£çš„ç¼ºç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç»™æ–°å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼ŒJVMåªéœ€è¦æŒæœ‰ä¸€ä¸ªå†…å­˜çš„èµ·å§‹åœ°å€å³å¯ã€‚</li><li>æ¶ˆé™¤äº†å¤åˆ¶ç®—æ³•å½“ä¸­ï¼Œå†…å­˜å‡åŠçš„é«˜é¢ä»£ä»·ã€‚</li></ol></li><li><strong>ç¼ºç‚¹</strong><ol><li>ä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•è¦ä½äºå¤åˆ¶ç®—æ³•ã€‚</li><li>ç§»åŠ¨å¯¹è±¡çš„åŒæ—¶ï¼Œå¦‚æœå¯¹è±¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œåˆ™è¿˜éœ€è¦è°ƒæ•´å¼•ç”¨çš„åœ°å€ï¼ˆå› ä¸ºHotSpotè™šæ‹Ÿæœºé‡‡ç”¨çš„ä¸æ˜¯å¥æŸ„æ± çš„æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥æŒ‡é’ˆï¼‰</li><li>ç§»åŠ¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å…¨ç¨‹æš‚åœç”¨æˆ·åº”ç”¨ç¨‹åºã€‚å³ï¼šSTW</li></ol></li></ul></li></ul></li><li><p><strong>åƒåœ¾å›æ”¶ç®—æ³•å°ç»“</strong></p><ul><li><p><strong>å¯¹æ¯”ä¸‰ç§æ¸…é™¤é˜¶æ®µçš„ç®—æ³•</strong></p><ol><li>æ•ˆç‡ä¸Šæ¥è¯´ï¼Œå¤åˆ¶ç®—æ³•æ˜¯å½“ä¹‹æ— æ„§çš„è€å¤§ï¼Œä½†æ˜¯å´æµªè´¹äº†å¤ªå¤šå†…å­˜ã€‚</li><li>è€Œä¸ºäº†å°½é‡å…¼é¡¾ä¸Šé¢æåˆ°çš„ä¸‰ä¸ªæŒ‡æ ‡ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ç›¸å¯¹æ¥è¯´æ›´å¹³æ»‘ä¸€äº›ï¼Œä½†æ˜¯æ•ˆç‡ä¸Šä¸å°½å¦‚äººæ„ï¼Œå®ƒæ¯”å¤åˆ¶ç®—æ³•å¤šäº†ä¸€ä¸ªæ ‡è®°çš„é˜¶æ®µï¼Œæ¯”æ ‡è®°-æ¸…é™¤å¤šäº†ä¸€ä¸ªæ•´ç†å†…å­˜çš„é˜¶æ®µã€‚</li></ol><table><thead><tr><th></th><th><strong>æ ‡è®°æ¸…é™¤</strong></th><th><strong>æ ‡è®°æ•´ç†</strong></th><th><strong>å¤åˆ¶</strong></th></tr></thead><tbody><tr><td><strong>é€Ÿç‡</strong></td><td>ä¸­ç­‰</td><td>æœ€æ…¢</td><td>æœ€å¿«</td></tr><tr><td><strong>ç©ºé—´å¼€é”€</strong></td><td>å°‘ï¼ˆä½†ä¼šå †ç§¯ç¢ç‰‡ï¼‰</td><td>å°‘ï¼ˆä¸å †ç§¯ç¢ç‰‡ï¼‰</td><td>é€šå¸¸éœ€è¦æ´»å¯¹è±¡çš„2å€ç©ºé—´ï¼ˆä¸å †ç§¯ç¢ç‰‡ï¼‰</td></tr><tr><td><strong>ç§»åŠ¨å¯¹è±¡</strong></td><td>å¦</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table></li><li><p><strong>åˆ†ä»£æ”¶é›†ç®—æ³•</strong></p><ul><li>å‰é¢æ‰€æœ‰è¿™äº›ç®—æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰ä¸€ç§ç®—æ³•å¯ä»¥å®Œå…¨æ›¿ä»£å…¶ä»–ç®—æ³•ï¼Œå®ƒä»¬éƒ½å…·æœ‰è‡ªå·±ç‹¬ç‰¹çš„ä¼˜åŠ¿å’Œç‰¹ç‚¹ã€‚åˆ†ä»£æ”¶é›†ç®—æ³•åº”è¿è€Œç”Ÿã€‚</li><li>åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šä¸åŒçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ä¸€æ ·çš„ã€‚å› æ­¤ï¼Œä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡å¯ä»¥é‡‡å–ä¸åŒçš„æ”¶é›†æ–¹å¼ï¼Œä»¥ä¾¿æé«˜å›æ”¶æ•ˆç‡ã€‚ä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹ä½¿ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•ï¼Œä»¥æé«˜åƒåœ¾å›æ”¶çš„æ•ˆç‡ã€‚</li><li>åœ¨Javaç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„å¯¹è±¡ï¼Œå…¶ä¸­æœ‰äº›å¯¹è±¡æ˜¯ä¸ä¸šåŠ¡ä¿¡æ¯ç›¸å…³ï¼Œæ¯”å¦‚Httpè¯·æ±‚ä¸­çš„Sessionå¯¹è±¡ã€çº¿ç¨‹ã€Socketè¿æ¥ï¼Œè¿™ç±»å¯¹è±¡è·Ÿä¸šåŠ¡ç›´æ¥æŒ‚é’©ï¼Œå› æ­¤ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€äº›å¯¹è±¡ï¼Œä¸»è¦æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä¸´æ—¶å˜é‡ï¼Œè¿™äº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¼šæ¯”è¾ƒçŸ­ï¼Œæ¯”å¦‚ï¼šstringå¯¹è±¡ï¼Œç”±äºå…¶ä¸å˜ç±»çš„ç‰¹æ€§ï¼Œç³»ç»Ÿä¼šäº§ç”Ÿå¤§é‡çš„è¿™äº›å¯¹è±¡ï¼Œæœ‰äº›å¯¹è±¡ç”šè‡³åªç”¨ä¸€æ¬¡å³å¯å›æ”¶ã€‚</li></ul></li><li><p>ç›®å‰å‡ ä¹æ‰€æœ‰çš„GCéƒ½é‡‡ç”¨åˆ†ä»£æ‰‹æœºç®—æ³•æ‰§è¡Œåƒåœ¾å›æ”¶çš„</p><p>  åœ¨HotSpotä¸­ï¼ŒåŸºäºåˆ†ä»£çš„æ¦‚å¿µï¼ŒGCæ‰€ä½¿ç”¨çš„å†…å­˜å›æ”¶ç®—æ³•å¿…é¡»ç»“åˆå¹´è½»ä»£å’Œè€å¹´ä»£å„è‡ªçš„ç‰¹ç‚¹ã€‚</p><ul><li><p><strong>å¹´è½»ä»£ï¼ˆYoung Genï¼‰</strong></p><p>  å¹´è½»ä»£ç‰¹ç‚¹ï¼šåŒºåŸŸç›¸å¯¹è€å¹´ä»£è¾ƒå°ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ã€å­˜æ´»ç‡ä½ï¼Œå›æ”¶é¢‘ç¹ã€‚</p><p>  è¿™ç§æƒ…å†µå¤åˆ¶ç®—æ³•çš„å›æ”¶æ•´ç†ï¼Œé€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚å¤åˆ¶ç®—æ³•çš„æ•ˆç‡åªå’Œå½“å‰å­˜æ´»å¯¹è±¡å¤§å°æœ‰å…³ï¼Œå› æ­¤å¾ˆé€‚ç”¨äºå¹´è½»ä»£çš„å›æ”¶ã€‚è€Œå¤åˆ¶ç®—æ³•å†…å­˜åˆ©ç”¨ç‡ä¸é«˜çš„é—®é¢˜ï¼Œé€šè¿‡hotspotä¸­çš„ä¸¤ä¸ªsurvivorçš„è®¾è®¡å¾—åˆ°ç¼“è§£ã€‚</p></li><li><p><strong>è€å¹´ä»£ï¼ˆTenured Genï¼‰</strong></p><p>  è€å¹´ä»£ç‰¹ç‚¹ï¼šåŒºåŸŸè¾ƒå¤§ï¼Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ã€å­˜æ´»ç‡é«˜ï¼Œå›æ”¶ä¸åŠå¹´è½»ä»£é¢‘ç¹ã€‚</p><p>  è¿™ç§æƒ…å†µå­˜åœ¨å¤§é‡å­˜æ´»ç‡é«˜çš„å¯¹è±¡ï¼Œå¤åˆ¶ç®—æ³•æ˜æ˜¾å˜å¾—ä¸åˆé€‚ã€‚ä¸€èˆ¬æ˜¯ç”±æ ‡è®°-æ¸…é™¤æˆ–è€…æ˜¯æ ‡è®°-æ¸…é™¤ä¸æ ‡è®°-æ•´ç†çš„æ··åˆå®ç°ã€‚</p><ul><li>Marké˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°é‡æˆæ­£æ¯”ã€‚</li><li>Sweepé˜¶æ®µçš„å¼€é”€ä¸æ‰€ç®¡ç†åŒºåŸŸçš„å¤§å°æˆæ­£ç›¸å…³ã€‚</li><li>compacté˜¶æ®µçš„å¼€é”€ä¸å­˜æ´»å¯¹è±¡çš„æ•°æ®æˆæ­£æ¯”ã€‚</li></ul></li></ul><p>  ä»¥HotSpotä¸­çš„CMSå›æ”¶å™¨ä¸ºä¾‹ï¼ŒCMSæ˜¯åŸºäºMark-Sweepå®ç°çš„ï¼Œå¯¹äºå¯¹è±¡çš„å›æ”¶æ•ˆç‡å¾ˆé«˜ã€‚è€Œå¯¹äºç¢ç‰‡é—®é¢˜ï¼ŒCMSé‡‡ç”¨åŸºäºMark-Compactç®—æ³•çš„Serial oldå›æ”¶å™¨ä½œä¸ºè¡¥å¿æªæ–½ï¼šå½“å†…å­˜å›æ”¶ä¸ä½³ï¼ˆç¢ç‰‡å¯¼è‡´çš„Concurrent Mode Failureæ—¶ï¼‰ï¼Œå°†é‡‡ç”¨serial oldæ‰§è¡ŒFullGCä»¥è¾¾åˆ°å¯¹è€å¹´ä»£å†…å­˜çš„æ•´ç†ã€‚</p><p>  åˆ†ä»£çš„æ€æƒ³è¢«ç°æœ‰çš„è™šæ‹Ÿæœºå¹¿æ³›ä½¿ç”¨ã€‚å‡ ä¹æ‰€æœ‰çš„åƒåœ¾å›æ”¶å™¨éƒ½åŒºåˆ†æ–°ç”Ÿä»£å’Œè€å¹´ä»£</p></li></ul></li><li><p><strong>å¢é‡æ”¶é›†ç®—æ³•</strong></p><ul><li><p><strong>æ¦‚è¿°</strong></p><ul><li>ä¸Šè¿°ç°æœ‰çš„ç®—æ³•ï¼Œåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è½¯ä»¶å°†å¤„äºä¸€ç§stop the Worldçš„çŠ¶æ€ã€‚åœ¨stop the WorldçŠ¶æ€ä¸‹ï¼Œåº”ç”¨ç¨‹åºæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šæŒ‚èµ·ï¼Œæš‚åœä¸€åˆ‡æ­£å¸¸çš„å·¥ä½œï¼Œç­‰å¾…åƒåœ¾å›æ”¶çš„å®Œæˆã€‚å¦‚æœåƒåœ¾å›æ”¶æ—¶é—´è¿‡é•¿ï¼Œåº”ç”¨ç¨‹åºä¼šè¢«æŒ‚èµ·å¾ˆä¹…ï¼Œå°†ä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒæˆ–è€…ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³å¯¹å®æ—¶åƒåœ¾æ”¶é›†ç®—æ³•çš„ç ”ç©¶ç›´æ¥å¯¼è‡´äº†å¢é‡æ”¶é›†ï¼ˆIncremental Collectingï¼‰ç®—æ³•çš„è¯ç”Ÿã€‚</li></ul></li><li><p><strong>å¢é‡æ”¶é›†ç®—æ³•åŸºæœ¬æ€æƒ³</strong></p><ul><li>å¦‚æœä¸€æ¬¡æ€§å°†æ‰€æœ‰çš„åƒåœ¾è¿›è¡Œå¤„ç†ï¼Œéœ€è¦é€ æˆç³»ç»Ÿé•¿æ—¶é—´çš„åœé¡¿ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®©åƒåœ¾æ”¶é›†çº¿ç¨‹å’Œåº”ç”¨ç¨‹åºçº¿ç¨‹äº¤æ›¿æ‰§è¡Œã€‚æ¯æ¬¡ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹åªæ”¶é›†ä¸€å°ç‰‡åŒºåŸŸçš„å†…å­˜ç©ºé—´ï¼Œæ¥ç€åˆ‡æ¢åˆ°åº”ç”¨ç¨‹åºçº¿ç¨‹ã€‚ä¾æ¬¡åå¤ï¼Œç›´åˆ°åƒåœ¾æ”¶é›†å®Œæˆã€‚</li><li>æ€»çš„æ¥è¯´ï¼Œå¢é‡æ”¶é›†ç®—æ³•çš„åŸºç¡€ä»æ˜¯ä¼ ç»Ÿçš„æ ‡è®°-æ¸…é™¤å’Œå¤åˆ¶ç®—æ³•ã€‚<strong>å¢é‡æ”¶é›†ç®—æ³•é€šè¿‡å¯¹çº¿ç¨‹é—´å†²çªçš„å¦¥å–„å¤„ç†</strong>ï¼Œå…è®¸åƒåœ¾æ”¶é›†çº¿ç¨‹ä»¥åˆ†é˜¶æ®µçš„æ–¹å¼å®Œæˆæ ‡è®°ã€æ¸…ç†æˆ–å¤åˆ¶å·¥ä½œ</li></ul></li><li><p><strong>å¢é‡æ”¶é›†ç®—æ³•çš„ç¼ºç‚¹</strong></p><ul><li>ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œç”±äºåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé—´æ–­æ€§åœ°è¿˜æ‰§è¡Œäº†åº”ç”¨ç¨‹åºä»£ç ï¼Œæ‰€ä»¥èƒ½å‡å°‘ç³»ç»Ÿçš„åœé¡¿æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå› ä¸ºçº¿ç¨‹åˆ‡æ¢å’Œä¸Šä¸‹æ–‡è½¬æ¢çš„æ¶ˆè€—ï¼Œä¼šä½¿å¾—åƒåœ¾å›æ”¶çš„æ€»ä½“æˆæœ¬ä¸Šå‡ï¼Œé€ æˆç³»ç»Ÿååé‡çš„ä¸‹é™ã€‚</li></ul></li><li><p><strong>åˆ†åŒºç®—æ³•</strong></p><ul><li><p>æ¦‚è¿°</p><ol><li>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç›¸åŒæ¡ä»¶ä¸‹ï¼Œå †ç©ºé—´è¶Šå¤§ï¼Œä¸€æ¬¡Gcæ—¶æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œæœ‰å…³GCäº§ç”Ÿçš„åœé¡¿ä¹Ÿè¶Šé•¿ã€‚ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶GCäº§ç”Ÿçš„åœé¡¿æ—¶é—´ï¼Œå°†ä¸€å—å¤§çš„å†…å­˜åŒºåŸŸåˆ†å‰²æˆå¤šä¸ªå°å—ï¼Œæ ¹æ®ç›®æ ‡çš„åœé¡¿æ—¶é—´ï¼Œæ¯æ¬¡åˆç†åœ°å›æ”¶è‹¥å¹²ä¸ªå°åŒºé—´ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå †ç©ºé—´ï¼Œä»è€Œå‡å°‘ä¸€æ¬¡GCæ‰€äº§ç”Ÿçš„åœé¡¿ã€‚</li><li>åˆ†ä»£ç®—æ³•å°†æŒ‰ç…§å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé•¿çŸ­åˆ’åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åŒºç®—æ³•å°†æ•´ä¸ªå †ç©ºé—´åˆ’åˆ†æˆè¿ç»­çš„ä¸åŒå°åŒºé—´ã€‚ æ¯ä¸€ä¸ªå°åŒºé—´éƒ½ç‹¬ç«‹ä½¿ç”¨ï¼Œç‹¬ç«‹å›æ”¶ã€‚è¿™ç§ç®—æ³•çš„å¥½å¤„æ˜¯å¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ã€‚</li></ol><p>  <img src="/images/jvm_virtual_machine/chapter13/image16.png" alt="Untitled"></p></li></ul></li></ul></li></ul>]]></content>
    
    
    <summary type="html">ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ˜ç¡®çš„çŸ¥é“ï¼ŒJava å’Œ C++è¯­è¨€çš„åŒºåˆ«ï¼Œå°±åœ¨äºåƒåœ¾æ”¶é›†æŠ€æœ¯å’Œå†…å­˜åŠ¨æ€åˆ†é…ä¸Šï¼ŒCè¯­è¨€æ²¡æœ‰åƒåœ¾æ”¶é›†æŠ€æœ¯ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„æ”¶é›†ã€‚</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(åäºŒ)StringTable(å­—ç¬¦ä¸²å¸¸é‡æ± )</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E4%BA%8C)StringTable(%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0)/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E4%BA%8C)StringTable(%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E9%87%8F%E6%B1%A0)/</id>
    <published>2023-02-11T16:00:00.000Z</published>
    <updated>2025-09-03T15:22:02.054Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-åäºŒ-StringTable-å­—ç¬¦ä¸²å¸¸é‡æ± "><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-åäºŒ-StringTable-å­—ç¬¦ä¸²å¸¸é‡æ± " class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(åäºŒ)StringTable(å­—ç¬¦ä¸²å¸¸é‡æ± )"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(åäºŒ)StringTable(å­—ç¬¦ä¸²å¸¸é‡æ± )</h2><h3 id="1-StringTable-å­—ç¬¦ä¸²å¸¸é‡æ± "><a href="#1-StringTable-å­—ç¬¦ä¸²å¸¸é‡æ± " class="headerlink" title="1. StringTable(å­—ç¬¦ä¸²å¸¸é‡æ± )"></a>1. StringTable(å­—ç¬¦ä¸²å¸¸é‡æ± )</h3><ul><li><p><strong>Stringçš„åŸºæœ¬ç‰¹æ€§</strong></p><ul><li>Stringï¼šå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€å¯¹ â€â€ å¼•èµ·æ¥è¡¨ç¤º</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;peppa&quot;</span> ;   <span class="comment">// å­—é¢é‡çš„å®šä¹‰æ–¹å¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;hello world&quot;</span>);     <span class="comment">// new å¯¹è±¡çš„æ–¹å¼</span></span><br></pre></td></tr></table></figure><ul><li>stringå£°æ˜ä¸ºfinalçš„ï¼Œä¸å¯è¢«ç»§æ‰¿</li><li>Stringå®ç°äº†Serializableæ¥å£ï¼šè¡¨ç¤ºå­—ç¬¦ä¸²æ˜¯æ”¯æŒåºåˆ—åŒ–çš„ã€‚å®ç°äº†Comparableæ¥å£ï¼šè¡¨ç¤ºstringå¯ä»¥æ¯”è¾ƒå¤§å°</li><li>Stringåœ¨jdk8åŠä»¥å‰å†…éƒ¨å®šä¹‰äº†final char[] valueç”¨äºå­˜å‚¨å­—ç¬¦ä¸²æ•°æ®ã€‚JDK9æ—¶æ”¹ä¸ºbyte[]</li></ul></li><li><p><strong>ä¸ºä»€ä¹ˆJDK9æ”¹å˜äº†ç»“æ„</strong></p><p>  Stringç±»çš„å½“å‰å®ç°å°†å­—ç¬¦å­˜å‚¨åœ¨charæ•°ç»„ä¸­ï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚(16ä½)ã€‚ä»è®¸å¤šä¸åŒçš„åº”ç”¨ç¨‹åºæ”¶é›†çš„æ•°æ®è¡¨æ˜ï¼Œå­—ç¬¦ä¸²æ˜¯å †ä½¿ç”¨çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œè€Œä¸”ï¼Œå¤§å¤šæ•°å­—ç¬¦ä¸²å¯¹è±¡åªåŒ…å«æ‹‰ä¸å­—ç¬¦ã€‚è¿™äº›å­—ç¬¦åªéœ€è¦ä¸€ä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤è¿™äº›å­—ç¬¦ä¸²å¯¹è±¡çš„å†…éƒ¨charæ•°ç»„ä¸­æœ‰ä¸€åŠçš„ç©ºé—´å°†ä¸ä¼šä½¿ç”¨ã€‚</p><p>  æˆ‘ä»¬å»ºè®®æ”¹å˜å­—ç¬¦ä¸²çš„å†…éƒ¨è¡¨ç¤ºclasÅ¡ä»utf - 16å­—ç¬¦æ•°ç»„åˆ°å­—èŠ‚æ•°ç»„+ä¸€ä¸ªencoding-flagå­—æ®µã€‚æ–°çš„Stringç±»å°†æ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹å­˜å‚¨ç¼–ç ä¸ºISO-8859-1&#x2F;Latin-1(æ¯ä¸ªå­—ç¬¦ä¸€ä¸ªå­—èŠ‚)æˆ–UTF-16(æ¯ä¸ªå­—ç¬¦ä¸¤ä¸ªå­—èŠ‚)çš„å­—ç¬¦ã€‚ç¼–ç æ ‡å¿—å°†æŒ‡ç¤ºä½¿ç”¨å“ªç§ç¼–ç ã€‚</p><p>  ç»“è®ºï¼šStringå†ä¹Ÿä¸ç”¨char[] æ¥å­˜å‚¨äº†ï¼Œæ”¹æˆäº†byte [] åŠ ä¸Šç¼–ç æ ‡è®°ï¼ŒèŠ‚çº¦äº†ä¸€äº›ç©ºé—´</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¹‹å‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> value[];</span><br><span class="line"><span class="comment">// ä¹‹å</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] value</span><br></pre></td></tr></table></figure><p>  åŒæ—¶åŸºäºStringçš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚StringBufferå’ŒStringBuilderä¹ŸåŒæ ·åšäº†ä¿®æ”¹</p></li><li><p><strong>Stringçš„ä¸å¯å˜æ€§</strong></p><ul><li>Stringï¼šä»£è¡¨ä¸å¯å˜çš„å­—ç¬¦åºåˆ—ã€‚ç®€ç§°ï¼šä¸å¯å˜æ€§ã€‚<ol><li>å½“å¯¹å­—ç¬¦ä¸²é‡æ–°èµ‹å€¼æ—¶ï¼Œéœ€è¦é‡å†™æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚</li><li>å½“å¯¹ç°æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚</li><li>å½“è°ƒç”¨Stringçš„replace()æ–¹æ³•ä¿®æ”¹æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼ã€‚</li></ol></li><li>é€šè¿‡å­—é¢é‡çš„æ–¹å¼ï¼ˆåŒºåˆ«äºnewï¼‰ç»™ä¸€ä¸ªå­—ç¬¦ä¸²èµ‹å€¼ï¼Œæ­¤æ—¶çš„å­—ç¬¦ä¸²å€¼å£°æ˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚</li></ul></li><li><p><strong>å½“å¯¹å­—ç¬¦ä¸²é‡æ–°èµ‹å€¼æ—¶ï¼Œéœ€è¦é‡å†™æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;<span class="comment">//å­—é¢é‡å®šä¹‰çš„æ–¹å¼ï¼Œ&quot;abc&quot;å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    s1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    System.out.println(s1 == s2);<span class="comment">//åˆ¤æ–­åœ°å€ï¼štrue  --&gt; false</span></span><br><span class="line"></span><br><span class="line">    System.out.println(s1);<span class="comment">//</span></span><br><span class="line">    System.out.println(s2);<span class="comment">//abc</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å­—èŠ‚ç æŒ‡ä»¤</p><ul><li>å–å­—ç¬¦ä¸² â€œabcâ€ æ—¶ï¼Œä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªç¬¦å·å¼•ç”¨ï¼š#2</li><li>å–å­—ç¬¦ä¸² â€œhelloâ€ æ—¶ï¼Œä½¿ç”¨çš„æ˜¯å¦ä¸€ä¸ªç¬¦å·å¼•ç”¨ï¼š#3</li></ul></li><li><p><strong>å½“å¯¹ç°æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œè¿æ¥æ“ä½œæ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    s2 += <span class="string">&quot;def&quot;</span>;</span><br><span class="line">    System.out.println(s2);<span class="comment">//abcdef</span></span><br><span class="line">    System.out.println(s1);<span class="comment">//abc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å½“è°ƒç”¨stringçš„replace()æ–¹æ³•ä¿®æ”¹æŒ‡å®šå­—ç¬¦æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿéœ€è¦é‡æ–°æŒ‡å®šå†…å­˜åŒºåŸŸèµ‹å€¼ï¼Œä¸èƒ½ä½¿ç”¨åŸæœ‰çš„valueè¿›è¡Œèµ‹å€¼</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> s1.replace(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;m&#x27;</span>);</span><br><span class="line">    System.out.println(s1);<span class="comment">//abc</span></span><br><span class="line">    System.out.println(s2);<span class="comment">//mbc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸€é“ç¬”è¯•é¢˜</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringExer</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;good&quot;</span>);</span><br><span class="line">    <span class="type">char</span>[] ch = &#123;<span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(String str, <span class="type">char</span> ch[])</span> &#123;</span><br><span class="line">        str = <span class="string">&quot;test ok&quot;</span>;</span><br><span class="line">        ch[<span class="number">0</span>] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">StringExer</span> <span class="variable">ex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringExer</span>();</span><br><span class="line">        ex.change(ex.str, ex.ch);</span><br><span class="line">        System.out.println(ex.str);<span class="comment">//good</span></span><br><span class="line">        System.out.println(ex.ch);<span class="comment">//best</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  str çš„å†…å®¹å¹¶æ²¡æœ‰å˜ï¼šâ€œtest okâ€ ä½äºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¦ä¸€ä¸ªåŒºåŸŸï¼ˆåœ°å€ï¼‰ï¼Œè¿›è¡Œèµ‹å€¼æ“ä½œå¹¶æ²¡æœ‰ä¿®æ”¹åŸæ¥ str æŒ‡å‘çš„å¼•ç”¨çš„å†…å®¹****</p></li></ul><h3 id="2-String-çš„åº•å±‚ç»“æ„"><a href="#2-String-çš„åº•å±‚ç»“æ„" class="headerlink" title="2.String çš„åº•å±‚ç»“æ„"></a>2.<strong>String çš„åº•å±‚ç»“æ„</strong></h3><ul><li><p><strong>å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸ä¼šå­˜å‚¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²çš„</strong></p><ol><li>Stringçš„String Poolï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„Hashtableï¼Œé»˜è®¤å€¼å¤§å°é•¿åº¦æ˜¯1009ã€‚å¦‚æœæ”¾è¿›String Poolçš„Stringéå¸¸å¤šï¼Œå°±ä¼šé€ æˆHashå†²çªä¸¥é‡ï¼Œä»è€Œå¯¼è‡´é“¾è¡¨ä¼šå¾ˆé•¿ï¼Œè€Œé“¾è¡¨é•¿äº†åç›´æ¥ä¼šé€ æˆçš„å½±å“å°±æ˜¯å½“è°ƒç”¨String.intern()æ–¹æ³•æ—¶æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™ã€‚</li><li>ä½¿ç”¨-XX:StringTablesizeå¯è®¾ç½®StringTableçš„é•¿åº¦</li><li>åœ¨JDK6ä¸­StringTableæ˜¯å›ºå®šçš„ï¼Œå°±æ˜¯1009çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœå¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²è¿‡å¤šå°±ä¼šå¯¼è‡´æ•ˆç‡ä¸‹é™å¾ˆå¿«ï¼ŒStringTablesizeè®¾ç½®æ²¡æœ‰è¦æ±‚</li><li>åœ¨JDK7ä¸­ï¼ŒStringTableçš„é•¿åº¦é»˜è®¤å€¼æ˜¯60013ï¼ŒStringTablesizeè®¾ç½®æ²¡æœ‰è¦æ±‚</li><li>åœ¨JDK8ä¸­ï¼ŒStringTableçš„é•¿åº¦é»˜è®¤å€¼æ˜¯60013ï¼ŒStringTableå¯ä»¥è®¾ç½®çš„æœ€å°å€¼ä¸º1009</li></ol></li><li><p><strong>String çš„å†…å­˜åˆ†é…</strong></p><ol><li>åœ¨Javaè¯­è¨€ä¸­æœ‰8ç§åŸºæœ¬æ•°æ®ç±»å‹å’Œä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„ç±»å‹Stringã€‚è¿™äº›ç±»å‹ä¸ºäº†ä½¿å®ƒä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€Ÿåº¦æ›´å¿«ã€æ›´èŠ‚çœå†…å­˜ï¼Œéƒ½æä¾›äº†ä¸€ç§å¸¸é‡æ± çš„æ¦‚å¿µã€‚</li><li>å¸¸é‡æ± å°±ç±»ä¼¼ä¸€ä¸ªJavaç³»ç»Ÿçº§åˆ«æä¾›çš„ç¼“å­˜ã€‚8ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å¸¸é‡æ± éƒ½æ˜¯ç³»ç»Ÿåè°ƒçš„ï¼ŒStringç±»å‹çš„å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ã€‚<ul><li>ç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„Stringå¯¹è±¡ä¼šç›´æ¥å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚æ¯”å¦‚ï¼š<code>String info=&quot;atguigu.com&quot;;</code></li><li>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„Stringå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨Stringæä¾›çš„intern()æ–¹æ³•ã€‚è¿™ä¸ªåé¢é‡ç‚¹è°ˆ</li></ul></li><li>Java 6åŠä»¥å‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ°¸ä¹…ä»£</li><li>Java 7ä¸­ Oracleçš„å·¥ç¨‹å¸ˆå¯¹å­—ç¬¦ä¸²æ± çš„é€»è¾‘åšäº†å¾ˆå¤§çš„æ”¹å˜ï¼Œå³å°†å­—ç¬¦ä¸²å¸¸é‡æ± çš„ä½ç½®è°ƒæ•´åˆ°Javaå †å†…<ul><li>æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä¿å­˜åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œå’Œå…¶ä»–æ™®é€šå¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·å¯ä»¥è®©ä½ åœ¨è¿›è¡Œè°ƒä¼˜åº”ç”¨æ—¶ä»…éœ€è¦è°ƒæ•´å †å¤§å°å°±å¯ä»¥äº†ã€‚</li><li>å­—ç¬¦ä¸²å¸¸é‡æ± æ¦‚å¿µåŸæœ¬ä½¿ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä½†æ˜¯è¿™ä¸ªæ”¹åŠ¨ä½¿å¾—æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ç†ç”±è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘åœ¨Java 7ä¸­ä½¿ç”¨String.intern()ã€‚</li></ul></li><li>Java8å…ƒç©ºé—´ï¼Œå­—ç¬¦ä¸²å¸¸é‡åœ¨å †</li></ol><p>  <img src="/images/jvm_virtual_machine/chapter12/image.png" alt="Untitled"></p><p>  <img src="/images/jvm_virtual_machine/chapter12/image1.png" alt="Untitled">  </p></li><li><p><strong>StringTable ä¸ºä»€ä¹ˆè¦è°ƒæ•´ï¼Ÿ</strong></p><ol><li>ä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ<ul><li>æ°¸ä¹…ä»£çš„é»˜è®¤ç©ºé—´å¤§å°æ¯”è¾ƒå°</li><li>æ°¸ä¹…ä»£åƒåœ¾å›æ”¶é¢‘ç‡ä½ï¼Œå¤§é‡çš„å­—ç¬¦ä¸²æ— æ³•åŠæ—¶å›æ”¶ï¼Œå®¹æ˜“è¿›è¡ŒFull GCäº§ç”ŸSTWæˆ–è€…å®¹æ˜“äº§ç”ŸOOMï¼šPermGen Space</li><li>å †ä¸­ç©ºé—´è¶³å¤Ÿå¤§ï¼Œå­—ç¬¦ä¸²å¯è¢«åŠæ—¶å›æ”¶</li></ul></li><li>åœ¨JDK 7ä¸­ï¼Œinternedå­—ç¬¦ä¸²ä¸å†åœ¨Javaå †çš„æ°¸ä¹…ä»£ä¸­åˆ†é…ï¼Œè€Œæ˜¯åœ¨Javaå †çš„ä¸»è¦éƒ¨åˆ†ï¼ˆç§°ä¸ºå¹´è½»ä»£å’Œå¹´è€ä»£ï¼‰ä¸­åˆ†é…ï¼Œä¸åº”ç”¨ç¨‹åºåˆ›å»ºçš„å…¶ä»–å¯¹è±¡ä¸€èµ·åˆ†é…ã€‚</li><li>æ­¤æ›´æ”¹å°†å¯¼è‡´é©»ç•™åœ¨ä¸»Javaå †ä¸­çš„æ•°æ®æ›´å¤šï¼Œé©»ç•™åœ¨æ°¸ä¹…ç”Ÿæˆä¸­çš„æ•°æ®æ›´å°‘ï¼Œå› æ­¤å¯èƒ½éœ€è¦è°ƒæ•´å †å¤§å°ã€‚</li></ol><p>  <strong>å®˜æ–¹æ–‡æ¡£</strong>:<a href="https://www.oracle.com/java/technologies/javase/jdk7-relnotes.html#jdk7changes">https://www.oracle.com/java/technologies/javase/jdk7-relnotes.html#jdk7changes</a></p><p>  <strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.strings;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jdk6ä¸­ï¼š</span></span><br><span class="line"><span class="comment"> * -XX:PermSize=10m -XX:MaxPermSize=10m -Xms10m -Xmx10m</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * jdk8ä¸­ï¼š</span></span><br><span class="line"><span class="comment"> * -XX:MetaspaceSize=6m -XX:MaxMetaspaceSize=10m -Xms10m -Xmx10m</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨Setä¿æŒç€å¸¸é‡æ± å¼•ç”¨ï¼Œé¿å…full gcå›æ”¶å¸¸é‡æ± è¡Œä¸º</span></span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line">        <span class="comment">//åœ¨shortå¯ä»¥å–å€¼çš„èŒƒå›´å†…è¶³ä»¥è®©10MBçš„PermSizeæˆ–heapäº§ç”ŸOOMäº†ã€‚</span></span><br><span class="line">        <span class="type">short</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            set.add(String.valueOf(i++).intern());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  è¾“å‡ºç»“æœï¼šå­—ç¬¦ä¸²çœŸçš„åœ¨å †ä¸­ï¼ˆJDK8ï¼‰</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at java.util.HashMap.resize(HashMap.java:<span class="number">704</span>)</span><br><span class="line">at java.util.HashMap.putVal(HashMap.java:<span class="number">663</span>)</span><br><span class="line">at java.util.HashMap.put(HashMap.java:<span class="number">612</span>)</span><br><span class="line">at java.util.HashSet.add(HashSet.java:<span class="number">220</span>)</span><br><span class="line">at com.peppa.strings.StringTest3.main(StringTest3.java:<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">1</span></span><br></pre></td></tr></table></figure></li><li><p><strong>String çš„åŸºæœ¬æ“ä½œ</strong></p><p>  Javaè¯­è¨€è§„èŒƒé‡Œè¦æ±‚å®Œå…¨ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œåº”è¯¥åŒ…å«åŒæ ·çš„Unicodeå­—ç¬¦åºåˆ—ï¼ˆåŒ…å«åŒä¸€ä»½ç ç‚¹åºåˆ—çš„å¸¸é‡ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯æŒ‡å‘åŒä¸€ä¸ªStringç±»å®ä¾‹ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.strings;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringTest4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println();<span class="comment">//2051</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1&quot;</span>);<span class="comment">//2052</span></span><br><span class="line">        System.out.println(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;7&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;8&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;10&quot;</span>);<span class="comment">//2303</span></span><br><span class="line">        <span class="comment">//å¦‚ä¸‹çš„å­—ç¬¦ä¸²&quot;1&quot; åˆ° &quot;10&quot;ä¸ä¼šå†æ¬¡åŠ è½½</span></span><br><span class="line">        System.out.println(<span class="string">&quot;1&quot;</span>);<span class="comment">//2304</span></span><br><span class="line">        System.out.println(<span class="string">&quot;2&quot;</span>);<span class="comment">//2304</span></span><br><span class="line">        System.out.println(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;7&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;8&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;10&quot;</span>);<span class="comment">//2304</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>åˆ†æå­—ç¬¦ä¸²å¸¸é‡æ± çš„å˜åŒ–-æ¡ˆä¾‹1ï¼š</p><p>  1ã€ç¨‹åºå¯åŠ¨æ—¶å·²ç»åŠ è½½äº† <code>*2051*</code>ä¸ªå­—ç¬¦ä¸²å¸¸é‡</p><p>  <img src="/images/jvm_virtual_machine/chapter12/image2.png" alt="Untitled"></p><p>  2ã€åŠ è½½äº†ä¸€ä¸ªæ¢è¡Œç¬¦ï¼ˆprintlnï¼‰ï¼Œæ‰€ä»¥å¤šäº†ä¸€ä¸ª</p><p>  <img src="/images/jvm_virtual_machine/chapter12/image3.png" alt="Untitled"></p><p>  3ã€ä¹‹åçš„å­—ç¬¦ä¸²â€1â€ åˆ° â€œ10â€ä¸ä¼šå†æ¬¡åŠ è½½</p><p>  <img src="/images/jvm_virtual_machine/chapter12/image4.png" alt="Untitled"></p></li><li><p>åˆ†æå­—ç¬¦ä¸²å¸¸é‡æ± çš„å˜åŒ–-æ¡ˆä¾‹2ï¼š</p><ul><li>å®˜æ–¹ç¤ºä¾‹ä»£ç </li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®˜æ–¹ç¤ºä¾‹ä»£ç </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;<span class="comment">//line 1</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;<span class="comment">//line 2</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();<span class="comment">//line 3</span></span><br><span class="line">        <span class="type">Memory</span> <span class="variable">mem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Memory</span>();<span class="comment">//line 4</span></span><br><span class="line">        mem.foo(obj);<span class="comment">//line 5</span></span><br><span class="line">    &#125;<span class="comment">//line 9</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">(Object param)</span> &#123;<span class="comment">//line 6</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> param.toString();<span class="comment">//line 7</span></span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;<span class="comment">//line 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ†æè¿è¡Œæ—¶å†…å­˜ï¼ˆfoo() æ–¹æ³•æ˜¯å®ä¾‹æ–¹æ³•ï¼Œå…¶å®å›¾ä¸­å°‘äº†ä¸€ä¸ª this å±€éƒ¨å˜é‡ï¼‰</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter12/image5.png" alt="Untitled"></p></li></ul></li></ul><h3 id="3-å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ"><a href="#3-å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ" class="headerlink" title="3.å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ"></a>3.<strong>å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</strong></h3><ul><li><p><strong>å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</strong></p><ul><li>å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</li><li>å¸¸é‡æ± ä¸­ä¸ä¼šå­˜åœ¨ç›¸åŒå†…å®¹çš„å˜é‡</li><li>åªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­ã€‚å˜é‡æ‹¼æ¥çš„åŸç†æ˜¯StringBuilder</li><li>å¦‚æœæ‹¼æ¥çš„ç»“æœè°ƒç”¨intern()æ–¹æ³•ï¼Œåˆ™ä¸»åŠ¨å°†å¸¸é‡æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥æ± ä¸­ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡åœ°å€</li></ul></li><li><p><strong>å¸¸é‡ä¸å¸¸é‡çš„æ‹¼æ¥ç»“æœåœ¨å¸¸é‡æ± ï¼ŒåŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ–</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span> + <span class="string">&quot;b&quot;</span> + <span class="string">&quot;c&quot;</span>;<span class="comment">//ç¼–è¯‘æœŸä¼˜åŒ–ï¼šç­‰åŒäº&quot;abc&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;abc&quot;</span>; <span class="comment">//&quot;abc&quot;ä¸€å®šæ˜¯æ”¾åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå°†æ­¤åœ°å€èµ‹ç»™s2</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * æœ€ç»ˆ.javaç¼–è¯‘æˆ.class,å†æ‰§è¡Œ.class</span></span><br><span class="line"><span class="comment">     * String s1 = &quot;abc&quot;;</span></span><br><span class="line"><span class="comment">     * String s2 = &quot;abc&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    System.out.println(s1 == s2); <span class="comment">//true</span></span><br><span class="line">    System.out.println(s1.equals(s2)); <span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä»å­—èŠ‚ç æŒ‡ä»¤çœ‹å‡ºï¼šç¼–è¯‘å™¨åšäº†ä¼˜åŒ–ï¼Œå°† â€œaâ€ + â€œbâ€ + â€œcâ€ ä¼˜åŒ–æˆäº† â€œabcâ€</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: ldc           #<span class="number">2</span>                  <span class="comment">// String abc</span></span><br><span class="line"><span class="number">2</span>: astore_1</span><br><span class="line"><span class="number">3</span>: ldc           #<span class="number">2</span>                  <span class="comment">// String abc</span></span><br><span class="line"><span class="number">5</span>: astore_2</span><br><span class="line"><span class="number">6</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line"><span class="number">9</span>: aload_1</span><br><span class="line"><span class="number">10</span>: aload_2</span><br><span class="line"><span class="number">11</span>: if_acmpne     <span class="number">18</span></span><br><span class="line"><span class="number">14</span>: iconst_1</span><br><span class="line"><span class="number">15</span>: <span class="keyword">goto</span>          <span class="number">19</span></span><br><span class="line"><span class="number">18</span>: iconst_0</span><br><span class="line"><span class="number">19</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Z)V</span></span><br><span class="line"><span class="number">22</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line"><span class="number">25</span>: aload_1</span><br><span class="line"><span class="number">26</span>: aload_2</span><br><span class="line"><span class="number">27</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/lang/String.equals:(Ljava/lang/Object;)Z</span></span><br><span class="line"><span class="number">30</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(Z)V</span></span><br><span class="line"><span class="number">33</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>  IDEA åç¼–è¯‘ class æ–‡ä»¶åï¼Œæ¥çœ‹è¿™ä¸ªé—®é¢˜</p><p>  <img src="/images/jvm_virtual_machine/chapter12/image6.png" alt="Untitled"></p></li><li><p><strong>æ‹¼æ¥å‰åï¼Œåªè¦å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å˜é‡ï¼Œç»“æœå°±åœ¨å †ä¸­</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;javaEEhadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + <span class="string">&quot;hadoop&quot;</span>;<span class="comment">//ç¼–è¯‘æœŸä¼˜åŒ–</span></span><br><span class="line">    <span class="comment">//å¦‚æœæ‹¼æ¥ç¬¦å·çš„å‰åå‡ºç°äº†å˜é‡ï¼Œåˆ™ç›¸å½“äºåœ¨å †ç©ºé—´ä¸­new String()ï¼Œå…·ä½“çš„å†…å®¹ä¸ºæ‹¼æ¥çš„ç»“æœï¼šjavaEEhadoop</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> s1 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s6</span> <span class="operator">=</span> <span class="string">&quot;javaEE&quot;</span> + s2;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s7</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line"></span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//true</span></span><br><span class="line">    System.out.println(s3 == s5);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s3 == s6);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s3 == s7);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s5 == s6);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s5 == s7);<span class="comment">//false</span></span><br><span class="line">    System.out.println(s6 == s7);<span class="comment">//false</span></span><br><span class="line">    <span class="comment">//intern():åˆ¤æ–­å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨javaEEhadoopå€¼ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›å¸¸é‡æ± ä¸­javaEEhadoopçš„åœ°å€ï¼›</span></span><br><span class="line">    <span class="comment">//å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸å­˜åœ¨javaEEhadoopï¼Œåˆ™åœ¨å¸¸é‡æ± ä¸­åŠ è½½ä¸€ä»½javaEEhadoopï¼Œå¹¶è¿”å›æ¬¡å¯¹è±¡çš„åœ°å€ã€‚</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s8</span> <span class="operator">=</span> s6.intern();</span><br><span class="line">    System.out.println(s3 == s8);<span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä»ä¸Šè¿°çš„ç»“æœæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p><p>  ä»å­—èŠ‚ç è§’åº¦æ¥çœ‹ï¼šæ‹¼æ¥å‰åæœ‰å˜é‡ï¼Œéƒ½ä¼šä½¿ç”¨åˆ° StringBuilder ç±»</p><p>  å¦‚æœæ‹¼æ¥ç¬¦å·çš„å‰åå‡ºç°äº†å˜é‡ï¼Œåˆ™ç›¸å½“äºåœ¨å †ç©ºé—´ä¸­new String()ï¼Œå…·ä½“çš„å†…å®¹ä¸ºæ‹¼æ¥çš„ç»“æœ</p><p>  è€Œè°ƒç”¨internæ–¹æ³•ï¼Œåˆ™ä¼šåˆ¤æ–­å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦å­˜åœ¨JavaEEhadoopå€¼ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›å¸¸é‡æ± ä¸­çš„å€¼ï¼Œå¦è€…å°±åœ¨å¸¸é‡æ± ä¸­åˆ›å»º</p></li><li><p><strong>åº•å±‚åŸç†</strong></p><ul><li><p>æ‹¼æ¥æ“ä½œçš„åº•å±‚å…¶å®ä½¿ç”¨äº†StringBuilder</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¦‚ä¸‹çš„s1 + s2 çš„æ‰§è¡Œç»†èŠ‚ï¼š(å˜é‡sæ˜¯æˆ‘ä¸´æ—¶å®šä¹‰çš„ï¼‰</span></span><br><span class="line"><span class="comment">    â‘  StringBuilder s = new StringBuilder();</span></span><br><span class="line"><span class="comment">    â‘¡ s.append(&quot;a&quot;)</span></span><br><span class="line"><span class="comment">    â‘¢ s.append(&quot;b&quot;)</span></span><br><span class="line"><span class="comment">    â‘£ s.toString()  --&gt; çº¦ç­‰äº new String(&quot;ab&quot;)ï¼Œä½†ä¸ç­‰ä»·</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    è¡¥å……ï¼šåœ¨jdk5.0ä¹‹åä½¿ç”¨çš„æ˜¯StringBuilder,åœ¨jdk5.0ä¹‹å‰ä½¿ç”¨çš„æ˜¯StringBuffer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;<span class="comment">//</span></span><br><span class="line">    System.out.println(s3 == s4);<span class="comment">//false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <img src="/images/jvm_virtual_machine/chapter12/image7.png" alt="Untitled"></p></li><li><p>å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œä¸ä¸€å®šä½¿ç”¨çš„æ˜¯StringBuilder</p></li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    1. å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œä¸ä¸€å®šä½¿ç”¨çš„æ˜¯StringBuilder!</span></span><br><span class="line"><span class="comment">       å¦‚æœæ‹¼æ¥ç¬¦å·å·¦å³ä¸¤è¾¹éƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡æˆ–å¸¸é‡å¼•ç”¨ï¼Œåˆ™ä»ç„¶ä½¿ç”¨ç¼–è¯‘æœŸä¼˜åŒ–ï¼Œå³éStringBuilderçš„æ–¹å¼ã€‚</span></span><br><span class="line"><span class="comment">    2. é’ˆå¯¹äºfinalä¿®é¥°ç±»ã€æ–¹æ³•ã€åŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹çš„é‡çš„ç»“æ„æ—¶ï¼Œèƒ½ä½¿ç”¨ä¸Šfinalçš„æ—¶å€™å»ºè®®ä½¿ç”¨ä¸Šã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> s1 + s2;</span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>ä»å­—èŠ‚ç è§’åº¦æ¥çœ‹ï¼šä¸ºå˜é‡ s4 èµ‹å€¼æ—¶ï¼Œç›´æ¥ä½¿ç”¨ #16 ç¬¦å·å¼•ç”¨ï¼Œå³å­—ç¬¦ä¸²å¸¸é‡ â€œabâ€</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> ldc #<span class="number">14</span> &lt;a&gt;</span><br><span class="line"><span class="number">2</span> astore_1</span><br><span class="line"><span class="number">3</span> ldc #<span class="number">15</span> &lt;b&gt;</span><br><span class="line"><span class="number">5</span> astore_2</span><br><span class="line"><span class="number">6</span> ldc #<span class="number">16</span> &lt;ab&gt;</span><br><span class="line"><span class="number">8</span> astore_3</span><br><span class="line"><span class="number">9</span> ldc #<span class="number">16</span> &lt;ab&gt;</span><br><span class="line"><span class="number">11</span> astore <span class="number">4</span></span><br><span class="line"><span class="number">13</span> getstatic #<span class="number">3</span> &lt;java/lang/System.out&gt;</span><br><span class="line"><span class="number">16</span> aload_3</span><br><span class="line"><span class="number">17</span> aload <span class="number">4</span></span><br><span class="line"><span class="number">19</span> if_acmpne <span class="number">26</span> (+<span class="number">7</span>)</span><br><span class="line"><span class="number">22</span> iconst_1</span><br><span class="line"><span class="number">23</span> <span class="keyword">goto</span> <span class="number">27</span> (+<span class="number">4</span>)</span><br><span class="line"><span class="number">26</span> iconst_0</span><br><span class="line"><span class="number">27</span> invokevirtual #<span class="number">4</span> &lt;java/io/PrintStream.println&gt;</span><br><span class="line"><span class="number">30</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>æ‹¼æ¥æ“ä½œå’Œappendæ€§èƒ½å¯¹æ¯”</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">(<span class="type">int</span> highLevel)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">src</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; highLevel; i++) &#123;</span><br><span class="line">        src += <span class="string">&quot;a&quot;</span>; <span class="comment">// æ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªStringBuilderå¯¹è±¡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">(<span class="type">int</span> highLevel)</span> &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; highLevel; i++) &#123;</span><br><span class="line">        sb.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æ–¹æ³•1è€—è´¹çš„æ—¶é—´ï¼š4005msï¼Œæ–¹æ³•2æ¶ˆè€—æ—¶é—´ï¼š7ms</p><p>  ç»“è®ºï¼š</p><ul><li>é€šè¿‡StringBuilderçš„append()æ–¹å¼æ·»åŠ å­—ç¬¦ä¸²çš„æ•ˆç‡ï¼Œè¦è¿œè¿œé«˜äºStringçš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹æ³•</li></ul><p>  å¥½å¤„</p><ul><li>StringBuilderçš„appendçš„æ–¹å¼ï¼Œè‡ªå§‹è‡³ç»ˆåªåˆ›å»ºä¸€ä¸ªStringBuilderçš„å¯¹è±¡</li><li>å¯¹äºå­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼ï¼Œè¿˜éœ€è¦åˆ›å»ºå¾ˆå¤šStringBuilderå¯¹è±¡å’Œ è°ƒç”¨toStringæ—¶å€™åˆ›å»ºçš„Stringå¯¹è±¡</li><li>å†…å­˜ä¸­ç”±äºåˆ›å»ºäº†è¾ƒå¤šçš„StringBuilderå’ŒStringå¯¹è±¡ï¼Œå†…å­˜å ç”¨è¿‡å¤§ï¼Œå¦‚æœè¿›è¡ŒGCé‚£ä¹ˆå°†ä¼šè€—è´¹æ›´å¤šçš„æ—¶é—´</li></ul><p>  æ”¹è¿›çš„ç©ºé—´</p><ul><li>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯StringBuilderçš„ç©ºå‚æ„é€ å™¨ï¼Œé»˜è®¤çš„å­—ç¬¦ä¸²å®¹é‡æ˜¯16ï¼Œç„¶åå°†åŸæ¥çš„å­—ç¬¦ä¸²æ‹·è´åˆ°æ–°çš„å­—ç¬¦ä¸²ä¸­ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥é»˜è®¤åˆå§‹åŒ–æ›´å¤§çš„é•¿åº¦ï¼Œå‡å°‘æ‰©å®¹çš„æ¬¡æ•°</li><li>å› æ­¤åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç¡®å®šï¼Œå‰å‰ååéœ€è¦æ·»åŠ çš„å­—ç¬¦ä¸²ä¸é«˜äºæŸä¸ªé™å®šå€¼ï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨æ„é€ å™¨åˆ›å»ºä¸€ä¸ªé˜ˆå€¼çš„é•¿åº¦</li></ul></li></ul></li><li><p><strong>intern()çš„ä½¿ç”¨</strong></p><ul><li><ul><li><strong>intern() æ–¹æ³•çš„è¯´æ˜</strong></li></ul></li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">intern</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><ol><li><p>internæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯åº•å±‚Cçš„æ–¹æ³•</p></li><li><p>å­—ç¬¦ä¸²å¸¸é‡æ± æ± æœ€åˆæ˜¯ç©ºçš„ï¼Œç”±Stringç±»ç§æœ‰åœ°ç»´æŠ¤ã€‚åœ¨è°ƒç”¨internæ–¹æ³•æ—¶ï¼Œå¦‚æœæ± ä¸­å·²ç»åŒ…å«äº†ç”±equals(object)æ–¹æ³•ç¡®å®šçš„ä¸è¯¥å­—ç¬¦ä¸²å†…å®¹ç›¸ç­‰çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›æ± ä¸­çš„å­—ç¬¦ä¸²åœ°å€ã€‚å¦åˆ™ï¼Œè¯¥å­—ç¬¦ä¸²å¯¹è±¡å°†è¢«æ·»åŠ åˆ°æ± ä¸­ï¼Œå¹¶è¿”å›å¯¹è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„åœ°å€ã€‚ï¼ˆè¿™æ˜¯æºç é‡Œçš„å¤§æ¦‚ç¿»è¯‘ï¼‰</p></li><li><p>å¦‚æœä¸æ˜¯ç”¨åŒå¼•å·å£°æ˜çš„Stringå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨Stringæä¾›çš„internæ–¹æ³•ï¼šinternæ–¹æ³•ä¼šä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥è¯¢å½“å‰å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨å°±ä¼šå°†å½“å‰å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ä¸­ã€‚æ¯”å¦‚ï¼š</p><p> <code>String myInfo = new string(&quot;I love atguigu&quot;).intern();</code></p></li><li><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ä»»æ„å­—ç¬¦ä¸²ä¸Šè°ƒç”¨String.internæ–¹æ³•ï¼Œé‚£ä¹ˆå…¶è¿”å›ç»“æœæ‰€æŒ‡å‘çš„é‚£ä¸ªç±»å®ä¾‹ï¼Œå¿…é¡»å’Œç›´æ¥ä»¥å¸¸é‡å½¢å¼å‡ºç°çš„å­—ç¬¦ä¸²å®ä¾‹å®Œå…¨ç›¸åŒã€‚å› æ­¤ï¼Œä¸‹åˆ—è¡¨è¾¾å¼çš„å€¼å¿…å®šæ˜¯true</p><p> <code>(&quot;a&quot;+&quot;b&quot;+&quot;c&quot;).intern()==&quot;abc&quot;</code></p></li><li><p>é€šä¿—ç‚¹è®²ï¼ŒInterned Stringå°±æ˜¯ç¡®ä¿å­—ç¬¦ä¸²åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä»½æ‹·è´ï¼Œè¿™æ ·å¯ä»¥èŠ‚çº¦å†…å­˜ç©ºé—´ï¼ŒåŠ å¿«å­—ç¬¦ä¸²æ“ä½œä»»åŠ¡çš„æ‰§è¡Œé€Ÿåº¦ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå€¼ä¼šè¢«å­˜æ”¾åœ¨å­—ç¬¦ä¸²å†…éƒ¨æ± ï¼ˆString Intern Poolï¼‰</p></li></ol></li><li><p><strong>new String() çš„è¯´æ˜</strong></p><ul><li><p><strong>new String(â€œabâ€)ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é¢˜ç›®ï¼š</span></span><br><span class="line"><span class="comment"> * new String(&quot;ab&quot;)ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿçœ‹å­—èŠ‚ç ï¼Œå°±çŸ¥é“æ˜¯ä¸¤ä¸ªã€‚</span></span><br><span class="line"><span class="comment"> *     ä¸€ä¸ªå¯¹è±¡æ˜¯ï¼šnewå…³é”®å­—åœ¨å †ç©ºé—´åˆ›å»ºçš„</span></span><br><span class="line"><span class="comment"> *     å¦ä¸€ä¸ªå¯¹è±¡æ˜¯ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡&quot;ab&quot;ã€‚ å­—èŠ‚ç æŒ‡ä»¤ï¼šldc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringNewTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;ab&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å­—èŠ‚ç æŒ‡ä»¤</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="keyword">new</span> #<span class="number">2</span> &lt;java/lang/String&gt;</span><br><span class="line"><span class="number">3</span> dup</span><br><span class="line"><span class="number">4</span> ldc #<span class="number">3</span> &lt;ab&gt;</span><br><span class="line"><span class="number">6</span> invokespecial #<span class="number">4</span> &lt;java/lang/String.&lt;init&gt;&gt;</span><br><span class="line"><span class="number">9</span> astore_1</span><br><span class="line"><span class="number">10</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>  <code>0 new #2 &lt;java/lang/String&gt;</code>ï¼šåœ¨å †ä¸­åˆ›å»ºäº†ä¸€ä¸ª String å¯¹è±¡</p><p>  <code>4 ldc #3 &lt;ab&gt;</code>Â ï¼šåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ”¾å…¥ â€œabâ€ï¼ˆå¦‚æœä¹‹å‰å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰ â€œabâ€ çš„è¯ï¼‰  </p></li><li><p><strong>new String(â€œaâ€) + new String(â€œbâ€) ä¼šåˆ›å»ºå‡ ä¸ªå¯¹è±¡ï¼Ÿ</strong></p><ul><li>ä»£ç </li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ€è€ƒï¼š</span></span><br><span class="line"><span class="comment"> * new String(&quot;a&quot;) + new String(&quot;b&quot;)å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡1ï¼šnew StringBuilder()</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡2ï¼š new String(&quot;a&quot;)</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡3ï¼š å¸¸é‡æ± ä¸­çš„&quot;a&quot;</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡4ï¼š new String(&quot;b&quot;)</span></span><br><span class="line"><span class="comment"> *  å¯¹è±¡5ï¼š å¸¸é‡æ± ä¸­çš„&quot;b&quot;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  æ·±å…¥å‰–æï¼š StringBuilderçš„toString():</span></span><br><span class="line"><span class="comment"> *      å¯¹è±¡6 ï¼šnew String(&quot;ab&quot;)</span></span><br><span class="line"><span class="comment"> *       å¼ºè°ƒä¸€ä¸‹ï¼ŒtoString()çš„è°ƒç”¨ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ²¡æœ‰ç”Ÿæˆ&quot;ab&quot;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringNewTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å­—èŠ‚ç æŒ‡ä»¤</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/lang/StringBuilder</span></span><br><span class="line"><span class="number">3</span>: dup</span><br><span class="line"><span class="number">4</span>: invokespecial #<span class="number">3</span>                  <span class="comment">// Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="number">7</span>: <span class="keyword">new</span>           #<span class="number">4</span>                  <span class="comment">// class java/lang/String</span></span><br><span class="line"><span class="number">10</span>: dup</span><br><span class="line"><span class="number">11</span>: ldc           #<span class="number">5</span>                  <span class="comment">// String a</span></span><br><span class="line"><span class="number">13</span>: invokespecial #<span class="number">6</span>                  <span class="comment">// Method java/lang/String.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span></span><br><span class="line"><span class="number">16</span>: invokevirtual #<span class="number">7</span>                  <span class="comment">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line"><span class="number">19</span>: <span class="keyword">new</span>           #<span class="number">4</span>                  <span class="comment">// class java/lang/String</span></span><br><span class="line"><span class="number">22</span>: dup</span><br><span class="line"><span class="number">23</span>: ldc           #<span class="number">8</span>                  <span class="comment">// String b</span></span><br><span class="line"><span class="number">25</span>: invokespecial #<span class="number">6</span>                  <span class="comment">// Method java/lang/String.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span></span><br><span class="line"><span class="number">28</span>: invokevirtual #<span class="number">7</span>                  <span class="comment">// Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line"><span class="number">31</span>: invokevirtual #<span class="number">9</span>                  <span class="comment">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span></span><br><span class="line"><span class="number">34</span>: astore_1</span><br><span class="line"><span class="number">35</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>  æˆ‘ä»¬åˆ›å»ºäº†6ä¸ªå¯¹è±¡</p><ul><li>å¯¹è±¡1ï¼šnew StringBuilder()</li><li>å¯¹è±¡2ï¼šnew String(â€œaâ€)</li><li>å¯¹è±¡3ï¼šå¸¸é‡æ± çš„ a</li><li>å¯¹è±¡4ï¼šnew String(â€œbâ€)</li><li>å¯¹è±¡5ï¼šå¸¸é‡æ± çš„ b</li><li>å¯¹è±¡6ï¼štoStringä¸­ä¼šåˆ›å»ºä¸€ä¸ª new String(â€œabâ€)<ul><li>è°ƒç”¨toStringæ–¹æ³•ï¼Œä¸ä¼šåœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆab</li></ul></li></ul></li></ul></li><li><p><strong>internçš„ä½¿ç”¨ï¼šJDK6å’ŒJDK7</strong></p><ul><li><p><strong>JDK6ä¸­</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);  <span class="comment">// åœ¨å¸¸é‡æ± ä¸­å·²ç»æœ‰äº†</span></span><br><span class="line">s.intern(); <span class="comment">// å°†è¯¥å¯¹è±¡æ”¾å…¥åˆ°å¸¸é‡æ± ã€‚ä½†æ˜¯è°ƒç”¨æ­¤æ–¹æ³•æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«ï¼Œå› ä¸ºå·²ç»å­˜åœ¨äº†1</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">System.out.println(s == s2); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">s3.intern();</span><br><span class="line"><span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">System.out.println(s3 == s4); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>  è¾“å‡ºç»“æœ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li><p>ä¸ºä»€ä¹ˆå¯¹è±¡ä¼šä¸ä¸€æ ·å‘¢ï¼Ÿ</p><blockquote><p>ä¸€ä¸ªæ˜¯newåˆ›å»ºçš„å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼Œæ˜¾ç„¶ä¸æ˜¯åŒä¸€ä¸ª</p></blockquote></li></ul></li><li><p>å¦‚æœæ˜¯ä¸‹é¢è¿™æ ·çš„ï¼Œé‚£ä¹ˆå°±æ˜¯true</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">s = s.intern();</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">System.out.println(s == s2); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>  è€Œå¯¹äºä¸‹é¢çš„æ¥è¯´ï¼Œå› ä¸º s3å˜é‡è®°å½•çš„åœ°å€æ˜¯ new String(â€œ11â€)ï¼Œç„¶åè¿™æ®µä»£ç æ‰§è¡Œå®Œä»¥åï¼Œå¸¸é‡æ± ä¸­ä¸å­˜åœ¨ â€œ11â€ï¼Œè¿™æ˜¯JDK6çš„å…³ç³»ï¼Œç„¶åæ‰§è¡Œ s3.intern()åï¼Œå°±ä¼šåœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆ â€œ11â€ï¼Œæœ€å s4ç”¨çš„å°±æ˜¯s3çš„åœ°å€</p><blockquote><p>ä¸ºä»€ä¹ˆæœ€åè¾“å‡ºçš„ s3 &#x3D;&#x3D; s4 ä¼šä¸ºfalseå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨JDK6ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ â€œ11â€ï¼Œä¹Ÿå°±æ˜¯æœ‰äº†æ–°çš„åœ°å€ï¼Œ s2 &#x3D; æ–°åœ°å€è€Œåœ¨JDK7ä¸­ï¼Œåœ¨JDK7ä¸­ï¼Œå¹¶æ²¡æœ‰åˆ›æ–°ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œæ˜¯æŒ‡å‘å¸¸é‡æ± ä¸­çš„æ–°å¯¹è±¡</p></blockquote></li><li><p><strong>JDK7ä¸­</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">s.intern();</span><br><span class="line"><span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">System.out.println(s == s2); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">s3.intern();</span><br><span class="line"><span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">System.out.println(s3 == s4); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>  <img src="/images/jvm_virtual_machine/chapter12/image8.png" alt="Untitled"></p></li></ul></li><li><p><strong>æ‰©å±•</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * StringIntern.javaä¸­ç»ƒä¹ çš„æ‹“å±•ï¼š</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringIntern1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œå®Œä¸‹ä¸€è¡Œä»£ç ä»¥åï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ˜¯å¦å­˜åœ¨&quot;11&quot;å‘¢ï¼Ÿç­”æ¡ˆï¼šä¸å­˜åœ¨ï¼ï¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;1&quot;</span>);<span class="comment">//new String(&quot;11&quot;)</span></span><br><span class="line">        <span class="comment">//åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆå¯¹è±¡&quot;11&quot;ï¼Œä»£ç é¡ºåºæ¢ä¸€ä¸‹ï¼Œå®æ‰“å®çš„åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± é‡Œæœ‰ä¸€ä¸ª&quot;11&quot;å¯¹è±¡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s4</span> <span class="operator">=</span> <span class="string">&quot;11&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s5</span> <span class="operator">=</span> s3.intern();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// s3 æ˜¯å †ä¸­çš„ &quot;ab&quot; ï¼Œs4 æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ &quot;ab&quot;</span></span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// s5 æ˜¯ä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å–å›æ¥çš„å¼•ç”¨ï¼Œå½“ç„¶å’Œ s4 ç›¸ç­‰</span></span><br><span class="line">        System.out.println(s5 == s4);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ€»ç»“stringçš„internï¼ˆï¼‰çš„ä½¿ç”¨ï¼š</p><p>  JDK1.6ä¸­ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ã€‚</p><ul><li>å¦‚æœä¸²æ± ä¸­æœ‰ï¼Œåˆ™å¹¶ä¸ä¼šæ”¾å…¥ã€‚è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€</li><li>å¦‚æœæ²¡æœ‰ï¼Œä¼šæŠŠæ­¤<strong>å¯¹è±¡å¤åˆ¶ä¸€ä»½</strong>ï¼Œæ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¯¹è±¡åœ°å€</li></ul><p>  JDK1.7èµ·ï¼Œå°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ã€‚</p><ul><li>å¦‚æœä¸²æ± ä¸­æœ‰ï¼Œåˆ™å¹¶ä¸ä¼šæ”¾å…¥ã€‚è¿”å›å·²æœ‰çš„ä¸²æ± ä¸­çš„å¯¹è±¡çš„åœ°å€</li><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šæŠŠ<strong>å¯¹è±¡çš„å¼•ç”¨åœ°å€</strong>å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œå¹¶è¿”å›ä¸²æ± ä¸­çš„å¼•ç”¨åœ°å€</li></ul></li><li><p>ç»ƒä¹ ï¼š</p><p>  <img src="/images/jvm_virtual_machine/chapter12/image9.png" alt="Untitled"></p><ul><li>åœ¨JDK6ä¸­ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸² â€œabâ€</li><li>åœ¨JDK8ä¸­ï¼Œåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ²¡æœ‰åˆ›å»º â€œabâ€ï¼Œè€Œæ˜¯å°†å †ä¸­çš„åœ°å€å¤åˆ¶åˆ° ä¸²æ± ä¸­ã€‚</li><li>æ‰€ä»¥ä¸Šè¿°ç»“æœï¼Œåœ¨JDK6ä¸­æ˜¯ï¼š</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨JDK8ä¸­æ˜¯</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure><p>  <img src="/images/jvm_virtual_machine/chapter12/image10.png" alt="Untitled"></p><p>  é’ˆå¯¹ä¸‹é¢è¿™é¢˜ï¼Œåœ¨JDK6å’Œ8ä¸­è¡¨ç°çš„æ˜¯ä¸€æ ·çš„</p><p>  <img src="/images/jvm_virtual_machine/chapter12/image11.png" alt="Untitled"></p></li></ul><h3 id="4-StringTableçš„åƒåœ¾å›æ”¶"><a href="#4-StringTableçš„åƒåœ¾å›æ”¶" class="headerlink" title="4.StringTableçš„åƒåœ¾å›æ”¶"></a>4.<strong>StringTableçš„åƒåœ¾å›æ”¶</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.strings;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Stringçš„åƒåœ¾å›æ”¶:</span></span><br><span class="line"><span class="comment"> * -Xms15m -Xmx15m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringGCTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">100000</span>; j++) &#123;</span><br><span class="line">            String.valueOf(j).intern();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen: 4096K-&gt;488K(4608K)] 4096K-&gt;664K(15872K), <span class="number">0.0011215</span> secs] [Times: user=<span class="number">0.02</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 4608K, used 3577K [<span class="number">0x00000000ffb00000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space 4096K, <span class="number">75</span>% used [<span class="number">0x00000000ffb00000</span>,<span class="number">0x00000000ffe04688</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  from space 512K, <span class="number">95</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff7a020</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line">  to   space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000fff80000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line"> ParOldGen       total 11264K, used 176K [<span class="number">0x00000000ff000000</span>, <span class="number">0x00000000ffb00000</span>, <span class="number">0x00000000ffb00000</span>)</span><br><span class="line">  object space 11264K, <span class="number">1</span>% used [<span class="number">0x00000000ff000000</span>,<span class="number">0x00000000ff02c000</span>,<span class="number">0x00000000ffb00000</span>)</span><br><span class="line"> Metaspace       used 3234K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">space</span>    used 350K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line">SymbolTable statistics:</span><br><span class="line">Number of buckets       :     <span class="number">20011</span> =    <span class="number">160088</span> bytes, avg   <span class="number">8.000</span></span><br><span class="line">Number of entries       :     <span class="number">13304</span> =    <span class="number">319296</span> bytes, avg  <span class="number">24.000</span></span><br><span class="line">Number of literals      :     <span class="number">13304</span> =    <span class="number">568608</span> bytes, avg  <span class="number">42.740</span></span><br><span class="line">Total footprint         :           =   <span class="number">1047992</span> bytes</span><br><span class="line">Average bucket size     :     <span class="number">0.665</span></span><br><span class="line">Variance of bucket size :     <span class="number">0.666</span></span><br><span class="line">Std. dev. of bucket size:     <span class="number">0.816</span></span><br><span class="line">Maximum bucket size     :         <span class="number">6</span></span><br><span class="line">StringTable statistics:</span><br><span class="line">Number of buckets       :     <span class="number">60013</span> =    <span class="number">480104</span> bytes, avg   <span class="number">8.000</span></span><br><span class="line">Number of entries       :     <span class="number">57042</span> =   <span class="number">1369008</span> bytes, avg  <span class="number">24.000</span></span><br><span class="line">Number of literals      :     <span class="number">57042</span> =   <span class="number">3253608</span> bytes, avg  <span class="number">57.039</span></span><br><span class="line">Total footprint         :           =   <span class="number">5102720</span> bytes</span><br><span class="line">Average bucket size     :     <span class="number">0.950</span></span><br><span class="line">Variance of bucket size :     <span class="number">0.750</span></span><br><span class="line">Std. dev. of bucket size:     <span class="number">0.866</span></span><br><span class="line">Maximum bucket size     :         <span class="number">5</span></span><br></pre></td></tr></table></figure><h3 id="5-G1-ä¸­çš„-String-å»é‡æ“ä½œ"><a href="#5-G1-ä¸­çš„-String-å»é‡æ“ä½œ" class="headerlink" title="5.G1 ä¸­çš„ String å»é‡æ“ä½œ"></a>5.<strong>G1 ä¸­çš„ String å»é‡æ“ä½œ</strong></h3><p>å®˜æ–¹ï¼š<a href="http://openjdk.java.net/jeps/192">JEP 192: String Deduplication in G1 (java.net)</a></p><p>æ³¨æ„è¿™é‡Œè¯´çš„é‡å¤ï¼ŒæŒ‡çš„æ˜¯åœ¨å †ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å¸¸é‡æ± ä¸­çš„ï¼Œå› ä¸ºå¸¸é‡æ± ä¸­çš„æœ¬èº«å°±ä¸ä¼šé‡å¤</p><ul><li><p><strong>æè¿°</strong></p><ul><li>èƒŒæ™¯ï¼šå¯¹è®¸å¤šJavaåº”ç”¨ï¼ˆæœ‰å¤§çš„ä¹Ÿæœ‰å°çš„ï¼‰åšçš„æµ‹è¯•å¾—å‡ºä»¥ä¸‹ç»“æœï¼š<ul><li>å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢stringå¯¹è±¡å äº†25%</li><li>å †å­˜æ´»æ•°æ®é›†åˆé‡Œé¢é‡å¤çš„stringå¯¹è±¡æœ‰13.5%</li><li>stringå¯¹è±¡çš„å¹³å‡é•¿åº¦æ˜¯45</li></ul></li><li>è®¸å¤šå¤§è§„æ¨¡çš„Javaåº”ç”¨çš„ç“¶é¢ˆåœ¨äºå†…å­˜ï¼Œæµ‹è¯•è¡¨æ˜ï¼Œåœ¨è¿™äº›ç±»å‹çš„åº”ç”¨é‡Œé¢ï¼ŒJavaå †ä¸­å­˜æ´»çš„æ•°æ®é›†åˆå·®ä¸å¤š25%æ˜¯stringå¯¹è±¡ã€‚æ›´è¿›ä¸€æ­¥ï¼Œè¿™é‡Œé¢å·®ä¸å¤šä¸€åŠstringå¯¹è±¡æ˜¯é‡å¤çš„ï¼Œé‡å¤çš„æ„æ€æ˜¯è¯´ï¼š stringl.equalsï¼ˆstring2ï¼‰&#x3D; trueã€‚å †ä¸Šå­˜åœ¨é‡å¤çš„stringå¯¹è±¡å¿…ç„¶æ˜¯ä¸€ç§å†…å­˜çš„æµªè´¹ã€‚è¿™ä¸ªé¡¹ç›®å°†åœ¨G1åƒåœ¾æ”¶é›†å™¨ä¸­å®ç°è‡ªåŠ¨æŒç»­å¯¹é‡å¤çš„stringå¯¹è±¡è¿›è¡Œå»é‡ï¼Œè¿™æ ·å°±èƒ½é¿å…æµªè´¹å†…å­˜ã€‚</li></ul></li><li><p><strong>String å»é‡çš„çš„å®ç°</strong></p><ol><li>å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œçš„æ—¶å€™ï¼Œä¼šè®¿é—®å †ä¸Šå­˜æ´»çš„å¯¹è±¡ã€‚å¯¹æ¯ä¸€ä¸ªè®¿é—®çš„å¯¹è±¡éƒ½ä¼šæ£€æŸ¥æ˜¯å¦æ˜¯å€™é€‰çš„è¦å»é‡çš„Stringå¯¹è±¡ã€‚</li><li>å¦‚æœæ˜¯ï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨æ’å…¥åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…åç»­çš„å¤„ç†ã€‚ä¸€ä¸ªå»é‡çš„çº¿ç¨‹åœ¨åå°è¿è¡Œï¼Œå¤„ç†è¿™ä¸ªé˜Ÿåˆ—ã€‚å¤„ç†é˜Ÿåˆ—çš„ä¸€ä¸ªå…ƒç´ æ„å‘³ç€ä»é˜Ÿåˆ—åˆ é™¤è¿™ä¸ªå…ƒç´ ï¼Œç„¶åå°è¯•å»é‡å®ƒå¼•ç”¨çš„Stringå¯¹è±¡ã€‚</li><li>ä½¿ç”¨ä¸€ä¸ªHashtableæ¥è®°å½•æ‰€æœ‰çš„è¢«Stringå¯¹è±¡ä½¿ç”¨çš„ä¸é‡å¤çš„charæ•°ç»„ã€‚å½“å»é‡çš„æ—¶å€™ï¼Œä¼šæŸ¥è¿™ä¸ªHashtableï¼Œæ¥çœ‹å †ä¸Šæ˜¯å¦å·²ç»å­˜åœ¨ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„charæ•°ç»„ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼ŒStringå¯¹è±¡ä¼šè¢«è°ƒæ•´å¼•ç”¨é‚£ä¸ªæ•°ç»„ï¼Œé‡Šæ”¾å¯¹åŸæ¥çš„æ•°ç»„çš„å¼•ç”¨ï¼Œæœ€ç»ˆä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶æ‰ã€‚</li><li>å¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œcharæ•°ç»„ä¼šè¢«æ’å…¥åˆ°Hashtableï¼Œè¿™æ ·ä»¥åçš„æ—¶å€™å°±å¯ä»¥å…±äº«è¿™ä¸ªæ•°ç»„äº†ã€‚</li></ol></li><li><p><strong>å‘½ä»¤è¡Œé€‰é¡¹</strong></p><ol><li>UseStringDeduplication(bool) ï¼šå¼€å¯Stringå»é‡ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ã€‚</li><li>PrintStringDeduplicationStatistics(bool) ï¼šæ‰“å°è¯¦ç»†çš„å»é‡ç»Ÿè®¡ä¿¡æ¯</li><li>stringDeduplicationAgeThreshold(uintx) ï¼šè¾¾åˆ°è¿™ä¸ªå¹´é¾„çš„Stringå¯¹è±¡è¢«è®¤ä¸ºæ˜¯å»é‡çš„å€™é€‰å¯¹è±¡</li></ol></li></ul>]]></content>
    
    
    <summary type="html">Stringï¼šå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€å¯¹ â€â€ å¼•èµ·æ¥è¡¨ç¤º</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(å)å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81)%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E4%B8%8E%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81)%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E4%B8%8E%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D/</id>
    <published>2023-02-09T16:00:00.000Z</published>
    <updated>2025-09-03T15:19:50.830Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-å-å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-å-å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(å)å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(å)å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½</h2><h3 id="1-åˆ›å»ºå¯¹è±¡"><a href="#1-åˆ›å»ºå¯¹è±¡" class="headerlink" title="1. åˆ›å»ºå¯¹è±¡"></a>1. åˆ›å»ºå¯¹è±¡</h3><p><img src="/images/jvm_virtual_machine/chapter10/image1.png" alt="Untitled"></p><ul><li><p><strong>å¯¹è±¡åˆ›å»ºæ–¹å¼</strong></p><ul><li>newï¼šæœ€å¸¸è§çš„æ–¹å¼ã€å•ä¾‹ç±»ä¸­è°ƒç”¨getInstanceçš„é™æ€ç±»æ–¹æ³•ï¼ŒXXXFactoryçš„é™æ€æ–¹æ³•</li><li>Classçš„newInstanceæ–¹æ³•ï¼šåœ¨JDK9é‡Œé¢è¢«æ ‡è®°ä¸ºè¿‡æ—¶çš„æ–¹æ³•ï¼Œå› ä¸ºåªèƒ½è°ƒç”¨ç©ºå‚æ„é€ å™¨</li><li>Constructorçš„newInstance(XXX)ï¼šåå°„çš„æ–¹å¼ï¼Œå¯ä»¥è°ƒç”¨ç©ºå‚çš„ï¼Œæˆ–è€…å¸¦å‚çš„æ„é€ å™¨</li><li>ä½¿ç”¨clone()ï¼šä¸è°ƒç”¨ä»»ä½•çš„æ„é€ å™¨ï¼Œè¦æ±‚å½“å‰çš„ç±»éœ€è¦å®ç°Cloneableæ¥å£ä¸­çš„cloneæ¥å£</li><li>ä½¿ç”¨åºåˆ—åŒ–ï¼šåºåˆ—åŒ–ä¸€èˆ¬ç”¨äºSocketçš„ç½‘ç»œä¼ è¾“</li><li>ç¬¬ä¸‰æ–¹åº“ Objenesis</li></ul></li><li><p><strong>åˆ›å»ºå¯¹è±¡çš„æ­¥éª¤</strong></p><ol><li><p><strong>åˆ¤æ–­å¯¹è±¡å¯¹åº”çš„ç±»æ˜¯å¦åŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–</strong></p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">2</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/lang/Object</span></span><br><span class="line">         <span class="number">3</span>: dup</span><br><span class="line">         <span class="number">4</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">7</span>: astore_1</span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">6</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">8</span>       <span class="number">1</span>     <span class="number">1</span>   obj   Ljava/lang/Object;</span><br><span class="line">    MethodParameters:</span><br><span class="line">      Name                           Flags</span><br><span class="line">      args</span><br></pre></td></tr></table></figure><p> è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤ï¼Œé¦–å…ˆå»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°èƒ½å¦åœ¨Metaspaceçš„å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œè§£æå’Œåˆå§‹åŒ–ã€‚ï¼ˆå³åˆ¤æ–­ç±»å…ƒä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼‰ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆåœ¨åŒäº²å§”æ´¾æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨ä»¥ClassLoader + åŒ…å + ç±»åä¸ºkeyè¿›è¡ŒæŸ¥æ‰¾å¯¹åº”çš„ .classæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ï¼Œåˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œç±»åŠ è½½ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡ã€‚</p></li><li><p><strong>ä¸ºå¯¹è±¡åˆ†é…å†…å­˜</strong></p><ol><li>é¦–å…ˆè®¡ç®—å¯¹è±¡å ç”¨ç©ºé—´çš„å¤§å°ï¼Œæ¥ç€åœ¨å †ä¸­åˆ’åˆ†ä¸€å—å†…å­˜ç»™æ–°å¯¹è±¡ã€‚å¦‚æœå®ä¾‹æˆå‘˜å˜é‡æ˜¯å¼•ç”¨å˜é‡ï¼Œä»…åˆ†é…å¼•ç”¨å˜é‡ç©ºé—´å³å¯ï¼Œå³4ä¸ªå­—èŠ‚å¤§å°</li><li>å¦‚æœå†…å­˜è§„æ•´ï¼šé‡‡ç”¨æŒ‡é’ˆç¢°æ’åˆ†é…å†…å­˜<ul><li>å¦‚æœå†…å­˜æ˜¯è§„æ•´çš„ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†é‡‡ç”¨çš„æ˜¯æŒ‡é’ˆç¢°æ’æ³•ï¼ˆBump The Pointï¼‰æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚</li><li>æ„æ€æ˜¯æ‰€æœ‰ç”¨è¿‡çš„å†…å­˜åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾å¦å¤–ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œåˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠæŒ‡é’ˆå¾€ç©ºé—²å†…å­˜é‚£è¾¹æŒªåŠ¨ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦»ç½¢äº†ã€‚</li><li>å¦‚æœåƒåœ¾æ”¶é›†å™¨é€‰æ‹©çš„æ˜¯Serial ï¼ŒParNewè¿™ç§åŸºäºå‹ç¼©ç®—æ³•çš„ï¼Œè™šæ‹Ÿæœºé‡‡ç”¨è¿™ç§åˆ†é…æ–¹å¼ã€‚ä¸€èˆ¬ä½¿ç”¨å¸¦Compactï¼ˆæ•´ç†ï¼‰è¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œä½¿ç”¨æŒ‡é’ˆç¢°æ’ã€‚</li><li>æ ‡è®°å‹ç¼©ï¼ˆæ•´ç†ï¼‰ç®—æ³•ä¼šæ•´ç†å†…å­˜ç¢ç‰‡ï¼Œå †å†…å­˜ä¸€å­˜å¯¹è±¡ï¼Œå¦ä¸€è¾¹ä¸ºç©ºé—²åŒºåŸŸ</li></ul></li><li><strong>å¦‚æœå†…å­˜ä¸è§„æ•´</strong><ul><li>å¦‚æœå†…å­˜ä¸æ˜¯è§„æ•´çš„ï¼Œå·²ä½¿ç”¨çš„å†…å­˜å’Œæœªä½¿ç”¨çš„å†…å­˜ç›¸äº’äº¤é”™ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°†é‡‡ç”¨çš„æ˜¯ç©ºé—²åˆ—è¡¨æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚</li><li>æ„æ€æ˜¯è™šæ‹Ÿæœºç»´æŠ¤äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œå†åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„å†…å®¹ã€‚è¿™ç§åˆ†é…æ–¹å¼æˆä¸ºäº† â€œç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰â€</li><li>é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”±Javaå †æ˜¯å¦è§„æ•´æ‰€å†³å®šï¼Œè€ŒJavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†åŠŸèƒ½å†³å®š</li><li>æ ‡è®°æ¸…é™¤ç®—æ³•æ¸…ç†è¿‡åçš„å †å†…å­˜ï¼Œå°±ä¼šå­˜åœ¨å¾ˆå¤šå†…å­˜ç¢ç‰‡ã€‚</li></ul></li></ol></li><li><p><strong>å¤„ç†å¹¶å‘é—®é¢˜</strong></p><ul><li>é‡‡ç”¨CAS+å¤±è´¥é‡è¯•ä¿è¯æ›´æ–°çš„åŸå­æ€§</li><li>æ¯ä¸ªçº¿ç¨‹é¢„å…ˆåˆ†é…TLAB - é€šè¿‡è®¾ç½® -XX:+UseTLABå‚æ•°æ¥è®¾ç½®ï¼ˆåŒºåŸŸåŠ é”æœºåˆ¶ï¼‰</li><li>åœ¨EdenåŒºç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…ä¸€å—åŒºåŸŸ</li></ul></li><li><p><strong>åˆå§‹åŒ–åˆ†é…åˆ°çš„ç©ºé—´</strong></p><ul><li>æ‰€æœ‰å±æ€§è®¾ç½®é»˜è®¤å€¼ï¼Œä¿è¯å¯¹è±¡å®ä¾‹å­—æ®µåœ¨ä¸èµ‹å€¼å¯ä»¥ç›´æ¥ä½¿ç”¨</li><li>ç»™å¯¹è±¡å±æ€§èµ‹å€¼çš„é¡ºåºï¼š<ol><li>å±æ€§çš„é»˜è®¤å€¼åˆå§‹åŒ–</li><li>æ˜¾ç¤ºåˆå§‹åŒ–&#x2F;ä»£ç å—åˆå§‹åŒ–ï¼ˆå¹¶åˆ—å…³ç³»ï¼Œè°å…ˆè°åçœ‹ä»£ç ç¼–å†™çš„é¡ºåºï¼‰</li><li>æ„é€ å™¨åˆå§‹åŒ–</li></ol></li></ul></li><li><p><strong>ç½®å¯¹è±¡çš„å¯¹è±¡å¤´</strong></p><p> å°†å¯¹è±¡çš„æ‰€å±ç±»ï¼ˆå³ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰ã€å¯¹è±¡çš„HashCodeå’Œå¯¹è±¡çš„GCä¿¡æ¯ã€é”ä¿¡æ¯ç­‰æ•°æ®å­˜å‚¨åœ¨å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹çš„å…·ä½“è®¾ç½®æ–¹å¼å–å†³äºJVMå®ç°ã€‚</p></li></ol><p>  6.<strong>æ‰§è¡Œinitæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–</strong></p><ol><li>åœ¨Javaç¨‹åºçš„è§†è§’çœ‹æ¥ï¼Œåˆå§‹åŒ–æ‰æ­£å¼å¼€å§‹ã€‚åˆå§‹åŒ–æˆå‘˜å˜é‡ï¼Œæ‰§è¡Œå®ä¾‹åŒ–ä»£ç å—ï¼Œè°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¹¶æŠŠå †å†…å¯¹è±¡çš„é¦–åœ°å€èµ‹å€¼ç»™å¼•ç”¨å˜é‡</li><li>å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼ˆç”±å­—èŠ‚ç ä¸­è·ŸéšinvokespecialæŒ‡ä»¤æ‰€å†³å®šï¼‰ï¼ŒnewæŒ‡ä»¤ä¹‹åä¼šæ¥ç€å°±æ˜¯æ‰§è¡Œinitæ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œæˆåˆ›å»ºå‡ºæ¥ã€‚</li></ol><p>  <strong>ä»å­—èŠ‚ç è§’åº¦çœ‹ init æ–¹æ³•</strong></p><p>  æºä»£ç </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.area;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line">    String name;</span><br><span class="line">    Account acct;</span><br><span class="line">    &#123;</span><br><span class="line">        name = <span class="string">&quot;åŒ¿åå®¢æˆ·&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Customer</span><span class="params">()</span>&#123;</span><br><span class="line">        acct = <span class="keyword">new</span> <span class="title class_">Account</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å­—èŠ‚ç </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: aload_0</span><br><span class="line"><span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="number">4</span>: aload_0</span><br><span class="line"><span class="number">5</span>: sipush        <span class="number">1001</span></span><br><span class="line"><span class="number">8</span>: putfield      #<span class="number">2</span>                  <span class="comment">// Field id:I</span></span><br><span class="line"><span class="number">11</span>: aload_0</span><br><span class="line"><span class="number">12</span>: ldc           #<span class="number">3</span>                  <span class="comment">// String åŒ¿åå®¢æˆ·</span></span><br><span class="line"><span class="number">14</span>: putfield      #<span class="number">4</span>                  <span class="comment">// Field name:Ljava/lang/String;</span></span><br><span class="line"><span class="number">17</span>: aload_0</span><br><span class="line"><span class="number">18</span>: <span class="keyword">new</span>           #<span class="number">5</span>                  <span class="comment">// class com/peppa/area/Account</span></span><br><span class="line"><span class="number">21</span>: dup</span><br><span class="line"><span class="number">22</span>: invokespecial #<span class="number">6</span>                  <span class="comment">// Method com/peppa/area/Account.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="number">25</span>: putfield      #<span class="number">7</span>                  <span class="comment">// Field acct:Lcom/peppa/area/Account;</span></span><br><span class="line"><span class="number">28</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><ul><li>init() æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ï¼š<ul><li>å±æ€§çš„é»˜è®¤å€¼åˆå§‹åŒ–ï¼š<code>id = 1001;</code></li><li>æ˜¾ç¤ºåˆå§‹åŒ–&#x2F;ä»£ç å—åˆå§‹åŒ–ï¼š<code>name = &quot;åŒ¿åå®¢æˆ·&quot;;</code></li><li>æ„é€ å™¨åˆå§‹åŒ–ï¼š<code>acct = new Account();</code></li></ul></li></ul><h3 id="2-å¯¹è±¡çš„å†…å­˜å¸ƒå±€"><a href="#2-å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="headerlink" title="2. å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a>2. <strong>å¯¹è±¡çš„å†…å­˜å¸ƒå±€</strong></h3><ul><li><p><strong>å¯¹è±¡çš„å†…å­˜å¸ƒå±€æ€ç»´å¯¼å›¾</strong></p><p>  <img src="/images/jvm_virtual_machine/chapter10/image1.png" alt="Untitled"></p></li><li><p><strong>å¯¹è±¡å¤´</strong></p><ul><li>å¯¹è±¡å¤´åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ è¿è¡Œæ—¶å…ƒæ•°æ®ï¼ˆMark Wordï¼‰å’Œ ç±»å‹æŒ‡é’ˆ<ul><li><em>å¦‚æœæ˜¯æ•°ç»„ï¼Œè¿˜éœ€è¦è®°å½•æ•°ç»„çš„é•¿åº¦</em></li></ul></li><li><strong>è¿è¡Œæ—¶å…ƒæ•°æ®</strong><ul><li>å“ˆå¸Œå€¼ï¼ˆHashCodeï¼‰</li><li>GCåˆ†ä»£å¹´é¾„</li><li>é”çŠ¶æ€æ ‡å¿—</li><li>çº¿ç¨‹æŒæœ‰çš„é”</li><li>åå‘çº¿ç¨‹ID</li><li>ç¿©å‘æ—¶é—´æˆ³</li></ul></li><li><strong>ç±»å‹æŒ‡é’ˆ</strong><ul><li>æŒ‡å‘ç±»å…ƒæ•°æ®InstanceKlassï¼Œç¡®å®šè¯¥å¯¹è±¡æ‰€å±çš„ç±»å‹ã€‚æŒ‡å‘çš„å…¶å®æ˜¯æ–¹æ³•åŒºä¸­å­˜æ”¾çš„ç±»å…ƒä¿¡æ¯</li></ul></li></ul></li><li><p><strong>å›¾è§£å†…å­˜å¸ƒå±€</strong></p></li></ul><p>  <img src="/images/jvm_virtual_machine/chapter10/image2.png" alt="Untitled"></p><ul><li><strong>å¯¹è±¡çš„è®¿é—®å®šä½</strong><ul><li><p><strong>JVMæ˜¯å¦‚ä½•é€šè¿‡æ ˆå¸§ä¸­çš„å¯¹è±¡å¼•ç”¨è®¿é—®åˆ°å…¶å†…éƒ¨çš„å¯¹è±¡å®ä¾‹å‘¢ï¼Ÿ</strong></p><p>  å®šä½ï¼Œé€šè¿‡æ ˆä¸Šreferenceè®¿é—®</p><p>  <img src="/images/jvm_virtual_machine/chapter10/image3.png" alt="Untitled"></p></li><li><p><strong>å¯¹è±¡çš„ä¸¤ç§è®¿é—®æ–¹å¼ï¼šå¥æŸ„è®¿é—®å’Œç›´æ¥æŒ‡é’ˆ</strong></p><ul><li><p><strong>å¥æŸ„è®¿é—®</strong></p><ol><li>ç¼ºç‚¹ï¼šåœ¨å †ç©ºé—´ä¸­å¼€è¾Ÿäº†ä¸€å—ç©ºé—´ä½œä¸ºå¥æŸ„æ± ï¼Œå¥æŸ„æ± æœ¬èº«ä¹Ÿä¼šå ç”¨ç©ºé—´ï¼›é€šè¿‡ä¸¤æ¬¡æŒ‡é’ˆè®¿é—®æ‰èƒ½è®¿é—®åˆ°å †ä¸­çš„å¯¹è±¡ï¼Œæ•ˆç‡ä½</li><li>ä¼˜ç‚¹ï¼šreferenceä¸­å­˜å‚¨ç¨³å®šå¥æŸ„åœ°å€ï¼Œå¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡å¾ˆæ™®éï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­å®ä¾‹æ•°æ®æŒ‡é’ˆå³å¯ï¼Œreferenceæœ¬èº«ä¸éœ€è¦è¢«ä¿®æ”¹</li></ol><p>  <img src="/images/jvm_virtual_machine/chapter10/image4.png" alt="Untitled"></p></li></ul></li><li><p><strong>ç›´æ¥æŒ‡é’ˆï¼ˆHotSpoté‡‡ç”¨ï¼‰</strong></p><ol><li><p>ä¼˜ç‚¹ï¼šç›´æ¥æŒ‡é’ˆæ˜¯å±€éƒ¨å˜é‡è¡¨ä¸­çš„å¼•ç”¨ï¼Œç›´æ¥æŒ‡å‘å †ä¸­çš„å®ä¾‹ï¼Œåœ¨å¯¹è±¡å®ä¾‹ä¸­æœ‰ç±»å‹æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯æ–¹æ³•åŒºä¸­çš„å¯¹è±¡ç±»å‹æ•°æ®</p></li><li><p>ç¼ºç‚¹ï¼šå¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡å¾ˆæ™®éï¼‰æ—¶éœ€è¦ä¿®æ”¹ reference çš„å€¼</p><p> <img src="/images/jvm_virtual_machine/chapter10/image5.png" alt="Untitled"></p></li></ol></li></ul></li></ul></li></ul>]]></content>
    
    
    <summary type="html">è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤ï¼Œé¦–å…ˆå»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°èƒ½å¦åœ¨Metaspaceçš„å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œè§£æå’Œåˆå§‹åŒ–ã€‚ï¼ˆå³åˆ¤æ–­ç±»å…ƒä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼‰ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆåœ¨åŒäº²å§”æ´¾æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨å½“å‰ç±»åŠ è½½å™¨ä»¥ClassLoader + åŒ…å + ç±»åä¸ºkeyè¿›è¡ŒæŸ¥æ‰¾å¯¹åº”çš„ .classæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–‡ä»¶ï¼Œåˆ™æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œç±»åŠ è½½ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡ã€‚</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(å)å¯¹è±¡çš„å®ä¾‹åŒ–å†…å­˜å¸ƒå±€ä¸è®¿é—®å®šä½</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E4%B8%80)%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8EExecution%20Engine/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%8D%81%E4%B8%80)%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8EExecution%20Engine/</id>
    <published>2023-02-09T16:00:00.000Z</published>
    <updated>2025-09-03T15:20:32.320Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-åä¸€-æ‰§è¡Œå¼•æ“Execution-Engine"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-åä¸€-æ‰§è¡Œå¼•æ“Execution-Engine" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(åä¸€)æ‰§è¡Œå¼•æ“Execution Engine"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(åä¸€)æ‰§è¡Œå¼•æ“Execution Engine</h2><h3 id="1-æ‰§è¡Œå¼•æ“æ¦‚è¿°"><a href="#1-æ‰§è¡Œå¼•æ“æ¦‚è¿°" class="headerlink" title="1. æ‰§è¡Œå¼•æ“æ¦‚è¿°"></a>1. <strong>æ‰§è¡Œå¼•æ“æ¦‚è¿°</strong></h3><ul><li><p>æ¦‚è¿°</p><ul><li>æ‰§è¡Œå¼•æ“å±äºJVMçš„ä¸‹å±‚ï¼Œé‡Œé¢åŒ…æ‹¬ è§£é‡Šå™¨ã€åŠæ—¶ç¼–è¯‘å™¨ã€åƒåœ¾å›æ”¶å™¨</li><li>æ‰§è¡Œå¼•æ“æ˜¯Javaè™šæ‹Ÿæœºæ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚â€œè™šæ‹Ÿæœºâ€æ˜¯ä¸€ä¸ªç›¸å¯¹äºâ€œç‰©ç†æœºâ€çš„æ¦‚å¿µï¼Œè¿™ä¸¤ç§æœºå™¨éƒ½æœ‰ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œå…¶åŒºåˆ«æ˜¯ç‰©ç†æœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç›´æ¥å»ºç«‹åœ¨å¤„ç†å™¨ã€ç¼“å­˜ã€æŒ‡ä»¤é›†å’Œæ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„ï¼Œè€Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“åˆ™æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå› æ­¤å¯ä»¥ä¸å—ç‰©ç†æ¡ä»¶åˆ¶çº¦åœ°å®šåˆ¶æŒ‡ä»¤é›†ä¸æ‰§è¡Œå¼•æ“çš„ç»“æ„ä½“ç³»ï¼Œèƒ½å¤Ÿæ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶ç›´æ¥æ”¯æŒçš„æŒ‡ä»¤é›†æ ¼å¼ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter11/image.png" alt="Untitled"></p><p>  JVMçš„ä¸»è¦ä»»åŠ¡æ˜¯è´Ÿè´£è£…è½½å­—èŠ‚ç åˆ°å…¶å†…éƒ¨ï¼Œä½†å­—èŠ‚ç å¹¶ä¸èƒ½å¤Ÿç›´æ¥è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œå› ä¸ºå­—èŠ‚ç æŒ‡ä»¤å¹¶éç­‰ä»·äºæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œå®ƒå†…éƒ¨åŒ…å«çš„ä»…ä»…åªæ˜¯ä¸€äº›èƒ½å¤Ÿè¢«JVMæ‰€è¯†åˆ«çš„å­—èŠ‚ç æŒ‡ä»¤ã€ç¬¦å·è¡¨ï¼Œä»¥åŠå…¶ä»–è¾…åŠ©ä¿¡æ¯ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter11/image1.png" alt="Untitled"></p><p>  é‚£ä¹ˆï¼Œå¦‚æœæƒ³è¦è®©ä¸€ä¸ªJavaç¨‹åºè¿è¡Œèµ·æ¥ï¼Œæ‰§è¡Œå¼•æ“ï¼ˆExecution Engineï¼‰çš„ä»»åŠ¡å°±æ˜¯å°†å­—èŠ‚ç æŒ‡ä»¤è§£é‡Š&#x2F;ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°ä¸Šçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰å¯ä»¥ã€‚ç®€å•æ¥è¯´ï¼ŒJVMä¸­çš„æ‰§è¡Œå¼•æ“å……å½“äº†å°†é«˜çº§è¯­è¨€ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€çš„è¯‘è€…ã€‚  </p></li><li><p><strong>æ‰§è¡Œå¼•æ“çš„å·¥ä½œæµç¨‹</strong></p><ul><li>æ‰§è¡Œå¼•æ“åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ç©¶ç«Ÿéœ€è¦æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤å®Œå…¨ä¾èµ–äºPCå¯„å­˜å™¨ã€‚</li><li>æ¯å½“æ‰§è¡Œå®Œä¸€é¡¹æŒ‡ä»¤æ“ä½œåï¼ŒPCå¯„å­˜å™¨å°±ä¼šæ›´æ–°ä¸‹ä¸€æ¡éœ€è¦è¢«æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚</li><li>å½“ç„¶æ–¹æ³•åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œå¼•æ“æœ‰å¯èƒ½ä¼šé€šè¿‡å­˜å‚¨åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„å¯¹è±¡å¼•ç”¨å‡†ç¡®å®šä½åˆ°å­˜å‚¨åœ¨Javaå †åŒºä¸­çš„å¯¹è±¡å®ä¾‹ä¿¡æ¯ï¼Œä»¥åŠé€šè¿‡å¯¹è±¡å¤´ä¸­çš„å…ƒæ•°æ®æŒ‡é’ˆå®šä½åˆ°ç›®æ ‡å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter11/image2.png" alt="Untitled"></p><p>  ä»å¤–è§‚ä¸Šæ¥çœ‹ï¼Œæ‰€æœ‰çš„Javaè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“è¾“å…¥ï¼Œè¾“å‡ºéƒ½æ˜¯ä¸€è‡´çš„ï¼šè¾“å…¥çš„æ˜¯å­—èŠ‚ç äºŒè¿›åˆ¶æµï¼Œå¤„ç†è¿‡ç¨‹æ˜¯å­—èŠ‚ç è§£ææ‰§è¡Œçš„ç­‰æ•ˆè¿‡ç¨‹ï¼Œè¾“å‡ºçš„æ˜¯æ‰§è¡Œè¿‡ç¨‹ã€‚</p></li></ul><h3 id="2-Javaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹"><a href="#2-Javaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="2.Javaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹"></a>2.<strong>Javaä»£ç ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹</strong></h3><ul><li><p><strong>ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹</strong></p><ul><li><p>å¤§éƒ¨åˆ†çš„ç¨‹åºä»£ç è½¬æ¢æˆç‰©ç†æœºçš„ç›®æ ‡ä»£ç æˆ–è™šæ‹Ÿæœºèƒ½æ‰§è¡Œçš„æŒ‡ä»¤é›†ä¹‹å‰ï¼Œéƒ½éœ€è¦ç»è¿‡ä¸Šå›¾ä¸­çš„å„ä¸ªæ­¥éª¤</p><ul><li><p>å‰é¢æ©™è‰²éƒ¨åˆ†æ˜¯ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œå’ŒJVMæ— å…³</p></li><li><p>åé¢è“è‰²å’Œç»¿è‰²æ‰æ˜¯JVMéœ€è¦è€ƒè™‘çš„è¿‡ç¨‹</p><p>  <img src="/images/jvm_virtual_machine/chapter11/image3.png" alt="Untitled"></p></li></ul></li><li><p>Javaä»£ç ç¼–è¯‘æ˜¯ç”±Javaæºç ç¼–è¯‘å™¨æ¥å®Œæˆï¼Œæµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p></li></ul><p>  <img src="/images/jvm_virtual_machine/chapter11/image4.png" alt="Untitled"></p><ul><li>Javaå­—èŠ‚ç çš„æ‰§è¡Œæ˜¯ç”±JVMæ‰§è¡Œå¼•æ“æ¥å®Œæˆï¼Œæµç¨‹å›¾ å¦‚ä¸‹æ‰€ç¤º</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter11/image5.png" alt="Untitled"></p><ul><li>æˆ‘ä»¬ç”¨ä¸€ä¸ªæ€»çš„å›¾ï¼Œæ¥è¯´è¯´ è§£é‡Šå™¨å’Œç¼–è¯‘å™¨</li></ul></li></ul><p><img src="/images/jvm_virtual_machine/chapter11/image6.png" alt="Untitled"></p><ul><li><p><strong>ä»€ä¹ˆæ˜¯è§£é‡Šå™¨ï¼ˆInterpreterï¼‰</strong></p><p>  å½“Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶ä¼šæ ¹æ®é¢„å®šä¹‰çš„è§„èŒƒå¯¹å­—èŠ‚ç é‡‡ç”¨é€è¡Œè§£é‡Šçš„æ–¹å¼æ‰§è¡Œï¼Œå°†æ¯æ¡å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹â€œç¿»è¯‘â€ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚</p></li><li><p><strong>ä»€ä¹ˆæ˜¯JITç¼–è¯‘å™¨</strong></p><ul><li>JITï¼ˆJust In Time Compilerï¼‰ç¼–è¯‘å™¨ï¼šå°±æ˜¯è™šæ‹Ÿæœºå°†æºä»£ç ç›´æ¥ç¼–è¯‘æˆå’Œæœ¬åœ°æœºå™¨å¹³å°ç›¸å…³çš„æœºå™¨è¯­è¨€ã€‚</li></ul></li><li><p><strong>ä¸ºä»€ä¹ˆJavaæ˜¯åŠç¼–è¯‘åŠè§£é‡Šå‹è¯­è¨€</strong></p><p>  JDK1.eæ—¶ä»£ï¼Œå°†Javaè¯­è¨€å®šä½ä¸ºâ€œè§£é‡Šæ‰§è¡Œâ€è¿˜æ˜¯æ¯”è¾ƒå‡†ç¡®çš„ã€‚å†åæ¥ï¼ŒJavaä¹Ÿå‘å±•å‡ºå¯ä»¥ç›´æ¥ç”Ÿæˆæœ¬åœ°ä»£ç çš„ç¼–è¯‘å™¨ã€‚ç°åœ¨JVMåœ¨æ‰§è¡ŒJavaä»£ç çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ä¼šå°†è§£é‡Šæ‰§è¡Œä¸ç¼–è¯‘æ‰§è¡ŒäºŒè€…ç»“åˆèµ·æ¥è¿›è¡Œã€‚</p><p>  ç¿»è¯‘æˆæœ¬åœ°ä»£ç åï¼Œå°±å¯ä»¥åšä¸€ä¸ªç¼“å­˜æ“ä½œï¼Œå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­</p></li><li><p><strong>æœºå™¨ç ã€æŒ‡ä»¤ã€æ±‡ç¼–è¯­è¨€</strong></p><ul><li><p><strong>æœºå™¨ç </strong></p><p>  å„ç§ç”¨äºŒè¿›åˆ¶ç¼–ç æ–¹å¼è¡¨ç¤ºçš„æŒ‡ä»¤ï¼Œå«åšæœºå™¨æŒ‡ä»¤ç ã€‚å¼€å§‹ï¼Œäººä»¬å°±ç”¨å®ƒé‡‡ç¼–å†™ç¨‹åºï¼Œè¿™å°±æ˜¯æœºå™¨è¯­è¨€ã€‚</p><p>  æœºå™¨è¯­è¨€è™½ç„¶èƒ½å¤Ÿè¢«è®¡ç®—æœºç†è§£å’Œæ¥å—ï¼Œä½†å’Œäººä»¬çš„è¯­è¨€å·®åˆ«å¤ªå¤§ï¼Œä¸æ˜“è¢«äººä»¬ç†è§£å’Œè®°å¿†ï¼Œå¹¶ä¸”ç”¨å®ƒç¼–ç¨‹å®¹æ˜“å‡ºå·®é”™ã€‚</p><p>  ç”¨å®ƒç¼–å†™çš„ç¨‹åºä¸€ç»è¾“å…¥è®¡ç®—æœºï¼ŒCPUç›´æ¥è¯»å–è¿è¡Œï¼Œå› æ­¤å’Œå…¶ä»–è¯­è¨€ç¼–çš„ç¨‹åºç›¸æ¯”ï¼Œæ‰§è¡Œé€Ÿåº¦æœ€å¿«ã€‚</p><p>  æœºå™¨æŒ‡ä»¤ä¸CPUç´§å¯†ç›¸å…³ï¼Œæ‰€ä»¥ä¸åŒç§ç±»çš„CPUæ‰€å¯¹åº”çš„æœºå™¨æŒ‡ä»¤ä¹Ÿå°±ä¸åŒã€‚</p></li><li><p><strong>æŒ‡ä»¤</strong></p><p>  ç”±äºæœºå™¨ç æ˜¯æœ‰0å’Œ1ç»„æˆçš„äºŒè¿›åˆ¶åºåˆ—ï¼Œå¯è¯»æ€§å®åœ¨å¤ªå·®ï¼Œäºæ˜¯äººä»¬å‘æ˜äº†æŒ‡ä»¤ã€‚</p><p>  æŒ‡ä»¤å°±æ˜¯æŠŠæœºå™¨ç ä¸­ç‰¹å®šçš„0å’Œ1åºåˆ—ï¼Œç®€åŒ–æˆå¯¹åº”çš„æŒ‡ä»¤ï¼ˆä¸€èˆ¬ä¸ºè‹±æ–‡ç®€å†™ï¼Œå¦‚movï¼Œincç­‰ï¼‰ï¼Œå¯è¯»æ€§ç¨å¥½</p><p>  ç”±äºä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œæ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œå¯¹åº”çš„æœºå™¨ç å¯èƒ½ä¸åŒï¼Œæ‰€ä»¥ä¸åŒçš„ç¡¬ä»¶å¹³å°çš„åŒä¸€ç§æŒ‡ä»¤ï¼ˆæ¯”å¦‚movï¼‰ï¼Œå¯¹åº”çš„æœºå™¨ç ä¹Ÿå¯èƒ½ä¸åŒã€‚</p></li><li><p><strong>æŒ‡ä»¤é›†</strong></p><p>  ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œå„è‡ªæ”¯æŒçš„æŒ‡ä»¤ï¼Œæ˜¯æœ‰å·®åˆ«çš„ã€‚å› æ­¤æ¯ä¸ªå¹³å°æ‰€æ”¯æŒçš„æŒ‡ä»¤ï¼Œç§°ä¹‹ä¸ºå¯¹åº”å¹³å°çš„æŒ‡ä»¤é›†ã€‚ å¦‚å¸¸è§çš„</p><ul><li>x86æŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ˜¯x86æ¶æ„çš„å¹³å°</li><li>ARMæŒ‡ä»¤é›†ï¼Œå¯¹åº”çš„æ˜¯ARMæ¶æ„çš„å¹³å°</li></ul></li><li><p><strong>æ±‡ç¼–è¯­è¨€</strong></p><p>  ç”±äºæŒ‡ä»¤çš„å¯è¯»æ€§è¿˜æ˜¯å¤ªå·®ï¼Œäºæ˜¯äººä»¬åˆå‘æ˜äº†æ±‡ç¼–è¯­è¨€ã€‚</p><p>  åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œç”¨åŠ©è®°ç¬¦ï¼ˆMnemonicsï¼‰ä»£æ›¿æœºå™¨æŒ‡ä»¤çš„æ“ä½œç ï¼Œç”¨åœ°å€ç¬¦å·ï¼ˆSymbo1ï¼‰æˆ–æ ‡å·ï¼ˆLabe1ï¼‰ä»£æ›¿æŒ‡ä»¤æˆ–æ“ä½œæ•°çš„åœ°å€ã€‚åœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ï¼Œæ±‡ç¼–è¯­è¨€å¯¹åº”ç€ä¸åŒçš„æœºå™¨è¯­è¨€æŒ‡ä»¤é›†ï¼Œé€šè¿‡æ±‡ç¼–è¿‡ç¨‹è½¬æ¢æˆæœºå™¨æŒ‡ä»¤ã€‚</p><blockquote><p><em>ç”±äºè®¡ç®—æœºåªè®¤è¯†æŒ‡ä»¤ç ï¼Œæ‰€ä»¥ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ç¨‹åºè¿˜å¿…é¡»ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ç ï¼Œè®¡ç®—æœºæ‰èƒ½è¯†åˆ«å’Œæ‰§è¡Œã€‚</em></p></blockquote></li></ul></li></ul><h3 id="3-é«˜çº§è¯­è¨€"><a href="#3-é«˜çº§è¯­è¨€" class="headerlink" title="3.é«˜çº§è¯­è¨€"></a>3.<strong>é«˜çº§è¯­è¨€</strong></h3><ul><li><p>é«˜çº§è®¡ç®—æœºè¯­è¨€</p><p>  ä¸ºäº†ä½¿è®¡ç®—æœºç”¨æˆ·ç¼–ç¨‹åºæ›´å®¹æ˜“äº›ï¼Œåæ¥å°±å‡ºç°äº†å„ç§é«˜çº§è®¡ç®—æœºè¯­è¨€ã€‚</p><p>  é«˜çº§è¯­è¨€æ¯”æœºå™¨è¯­è¨€ã€æ±‡ç¼–è¯­è¨€æ›´æ¥è¿‘äººçš„è¯­è¨€å½“è®¡ç®—æœºæ‰§è¡Œé«˜çº§è¯­è¨€ç¼–å†™çš„ç¨‹åºæ—¶ï¼Œä»ç„¶éœ€è¦æŠŠç¨‹åºè§£é‡Šå’Œç¼–è¯‘æˆæœºå™¨çš„æŒ‡ä»¤ç ã€‚å®Œæˆè¿™ä¸ªè¿‡ç¨‹çš„ç¨‹åºå°±å«åšè§£é‡Šç¨‹åºæˆ–ç¼–è¯‘ç¨‹åºã€‚</p></li></ul><p><img src="/images/jvm_virtual_machine/chapter11/image7.png" alt="Untitled"></p><p>é«˜çº§è¯­è¨€ä¹Ÿä¸æ˜¯ç›´æ¥ç¿»è¯‘æˆ æœºå™¨æŒ‡ä»¤ï¼Œè€Œæ˜¯ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€å—ï¼Œå¦‚ä¸‹é¢è¯´çš„Cå’ŒC++</p><ul><li><p><strong>Cã€C++æºç¨‹åºæ‰§è¡Œè¿‡ç¨‹</strong></p><p>  ç¼–è¯‘è¿‡ç¨‹åˆå¯ä»¥åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œæ±‡ç¼–ã€‚</p><p>  ç¼–è¯‘è¿‡ç¨‹ï¼šæ˜¯è¯»å–æºç¨‹åºï¼ˆå­—ç¬¦æµï¼‰ï¼Œå¯¹ä¹‹è¿›è¡Œè¯æ³•å’Œè¯­æ³•çš„åˆ†æï¼Œå°†é«˜çº§è¯­è¨€æŒ‡ä»¤è½¬æ¢ä¸ºåŠŸèƒ½ç­‰æ•ˆçš„æ±‡ç¼–ä»£ç </p><p>  æ±‡ç¼–è¿‡ç¨‹ï¼šå®é™…ä¸ŠæŒ‡æŠŠæ±‡ç¼–è¯­è¨€ä»£ç ç¿»è¯‘æˆç›®æ ‡æœºå™¨æŒ‡ä»¤çš„è¿‡ç¨‹ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter11/image8.png" alt="Untitled"></p></li><li><p><strong>å­—èŠ‚ç </strong></p><p>  å­—èŠ‚ç æ˜¯ä¸€ç§ä¸­é—´çŠ¶æ€ï¼ˆä¸­é—´ç ï¼‰çš„äºŒè¿›åˆ¶ä»£ç ï¼ˆæ–‡ä»¶ï¼‰ï¼Œå®ƒæ¯”æœºå™¨ç æ›´æŠ½è±¡ï¼Œéœ€è¦ç›´è¯‘å™¨è½¬è¯‘åæ‰èƒ½æˆä¸ºæœºå™¨ç </p><p>  å­—èŠ‚ç ä¸»è¦ä¸ºäº†å®ç°ç‰¹å®šè½¯ä»¶è¿è¡Œå’Œè½¯ä»¶ç¯å¢ƒã€ä¸ç¡¬ä»¶ç¯å¢ƒæ— å…³ã€‚</p><p>  å­—èŠ‚ç çš„å®ç°æ–¹å¼æ˜¯é€šè¿‡ç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºå™¨ã€‚ç¼–è¯‘å™¨å°†æºç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œç‰¹å®šå¹³å°ä¸Šçš„è™šæ‹Ÿæœºå™¨å°†å­—èŠ‚ç è½¬è¯‘ä¸ºå¯ä»¥ç›´æ¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</p><ul><li>å­—èŠ‚ç å…¸å‹çš„åº”ç”¨ä¸ºï¼šJava bytecode</li></ul></li><li><p><strong>è§£é‡Šå™¨</strong></p><p>  JVMè®¾è®¡è€…ä»¬çš„åˆè¡·ä»…ä»…åªæ˜¯å•çº¯åœ°ä¸ºäº†æ»¡è¶³Javaç¨‹åºå®ç°è·¨å¹³å°ç‰¹æ€§ï¼Œå› æ­¤é¿å…é‡‡ç”¨é™æ€ç¼–è¯‘çš„æ–¹å¼ç›´æ¥ç”Ÿæˆæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œä»è€Œè¯ç”Ÿäº†å®ç°è§£é‡Šå™¨åœ¨è¿è¡Œæ—¶é‡‡ç”¨é€è¡Œè§£é‡Šå­—èŠ‚ç æ‰§è¡Œç¨‹åºçš„æƒ³æ³•ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter11/image9.png" alt="Untitled"></p><p>  ä¸ºä»€ä¹ˆJavaæºæ–‡ä»¶ä¸ç›´æ¥ç¿»è¯‘æˆJMVï¼Œè€Œæ˜¯ç¿»è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Ÿå¯èƒ½æ˜¯å› ä¸ºç›´æ¥ç¿»è¯‘çš„ä»£ç æ˜¯æ¯”è¾ƒå¤§çš„</p><p>  è§£é‡Šå™¨çœŸæ­£æ„ä¹‰ä¸Šæ‰€æ‰¿æ‹…çš„è§’è‰²å°±æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶â€œç¿»è¯‘è€…â€ï¼Œå°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å†…å®¹â€œç¿»è¯‘â€ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚</p><p>  å½“ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤è¢«è§£é‡Šæ‰§è¡Œå®Œæˆåï¼Œæ¥ç€å†æ ¹æ®PCå¯„å­˜å™¨ä¸­è®°å½•çš„ä¸‹ä¸€æ¡éœ€è¦è¢«æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤æ‰§è¡Œè§£é‡Šæ“ä½œã€‚</p></li><li><p><strong>è§£é‡Šå™¨åˆ†ç±»</strong></p><p>  åœ¨Javaçš„å‘å±•å†å²é‡Œï¼Œä¸€å…±æœ‰ä¸¤å¥—è§£é‡Šæ‰§è¡Œå™¨ï¼Œå³å¤è€çš„å­—èŠ‚ç è§£é‡Šå™¨ã€ç°åœ¨æ™®éä½¿ç”¨çš„æ¨¡æ¿è§£é‡Šå™¨ã€‚</p><p>  å­—èŠ‚ç è§£é‡Šå™¨åœ¨æ‰§è¡Œæ—¶é€šè¿‡çº¯è½¯ä»¶ä»£ç æ¨¡æ‹Ÿå­—èŠ‚ç çš„æ‰§è¡Œï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚</p><p>  è€Œæ¨¡æ¿è§£é‡Šå™¨å°†æ¯ä¸€æ¡å­—èŠ‚ç å’Œä¸€ä¸ªæ¨¡æ¿å‡½æ•°ç›¸å…³è”ï¼Œæ¨¡æ¿å‡½æ•°ä¸­ç›´æ¥äº§ç”Ÿè¿™æ¡å­—èŠ‚ç æ‰§è¡Œæ—¶çš„æœºå™¨ç ï¼Œä»è€Œå¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜äº†è§£é‡Šå™¨çš„æ€§èƒ½ã€‚</p><p>  åœ¨HotSpot VMä¸­ï¼Œè§£é‡Šå™¨ä¸»è¦ç”±Interpreteræ¨¡å—å’ŒCodeæ¨¡å—æ„æˆã€‚</p><ul><li>Interpreteræ¨¡å—ï¼šå®ç°äº†è§£é‡Šå™¨çš„æ ¸å¿ƒåŠŸèƒ½</li><li>Codeæ¨¡å—ï¼šç”¨äºç®¡ç†HotSpot VMåœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„æœ¬åœ°æœºå™¨æŒ‡ä»¤</li></ul></li><li><p><strong>ç°çŠ¶</strong></p><p>  ç”±äºè§£é‡Šå™¨åœ¨è®¾è®¡å’Œå®ç°ä¸Šéå¸¸ç®€å•ï¼Œå› æ­¤é™¤äº†Javaè¯­è¨€ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šé«˜çº§è¯­è¨€åŒæ ·ä¹Ÿæ˜¯åŸºäºè§£é‡Šå™¨æ‰§è¡Œçš„ï¼Œæ¯”å¦‚Pythonã€Per1ã€Rubyç­‰ã€‚ä½†æ˜¯åœ¨ä»Šå¤©ï¼ŒåŸºäºè§£é‡Šå™¨æ‰§è¡Œå·²ç»æ²¦è½ä¸ºä½æ•ˆçš„ä»£åè¯ï¼Œå¹¶ä¸”æ—¶å¸¸è¢«ä¸€äº›C&#x2F;C++ç¨‹åºå‘˜æ‰€è°ƒä¾ƒã€‚</p><p>  ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJVMå¹³å°æ”¯æŒä¸€ç§å«ä½œå³æ—¶ç¼–è¯‘çš„æŠ€æœ¯ã€‚å³æ—¶ç¼–è¯‘çš„ç›®çš„æ˜¯é¿å…å‡½æ•°è¢«è§£é‡Šæ‰§è¡Œï¼Œè€Œæ˜¯å°†æ•´ä¸ªå‡½æ•°ä½“ç¼–è¯‘æˆä¸ºæœºå™¨ç ï¼Œæ¯æ¬¡å‡½æ•°æ‰§è¡Œæ—¶ï¼Œåªæ‰§è¡Œç¼–è¯‘åçš„æœºå™¨ç å³å¯ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä½¿æ‰§è¡Œæ•ˆç‡å¤§å¹…åº¦æå‡ã€‚</p><p>  ä¸è¿‡æ— è®ºå¦‚ä½•ï¼ŒåŸºäºè§£é‡Šå™¨çš„æ‰§è¡Œæ¨¡å¼ä»ç„¶ä¸ºä¸­é—´è¯­è¨€çš„å‘å±•åšå‡ºäº†ä¸å¯ç£¨ç­çš„è´¡çŒ®ã€‚</p></li></ul><h3 id="4-JITç¼–è¯‘å™¨"><a href="#4-JITç¼–è¯‘å™¨" class="headerlink" title="4.JITç¼–è¯‘å™¨"></a>4.<strong>JITç¼–è¯‘å™¨</strong></h3><ul><li><p><strong>Javaä»£ç çš„æ‰§è¡Œåˆ†ç±»</strong></p><ol><li>ç¬¬ä¸€ç§æ˜¯å°†æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œç„¶ååœ¨è¿è¡Œæ—¶é€šè¿‡è§£é‡Šå™¨å°†å­—èŠ‚ç æ–‡ä»¶è½¬ä¸ºæœºå™¨ç æ‰§è¡Œ</li><li>ç¬¬äºŒç§æ˜¯ç¼–è¯‘æ‰§è¡Œï¼ˆç›´æ¥ç¼–è¯‘æˆæœºå™¨ç ï¼‰ã€‚ç°ä»£è™šæ‹Ÿæœºä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œä¼šä½¿ç”¨å³æ—¶ç¼–è¯‘æŠ€æœ¯ï¼ˆJITï¼ŒJust In Timeï¼‰å°†æ–¹æ³•ç¼–è¯‘æˆæœºå™¨ç åå†æ‰§è¡Œ</li><li>HotSpot VMæ˜¯ç›®å‰å¸‚é¢ä¸Šé«˜æ€§èƒ½è™šæ‹Ÿæœºçš„ä»£è¡¨ä½œä¹‹ä¸€ã€‚<strong>å®ƒé‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„</strong>ã€‚åœ¨Javaè™šæ‹Ÿæœºè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨å’Œå³æ—¶ç¼–è¯‘å™¨èƒ½å¤Ÿç›¸äº’åä½œï¼Œå„è‡ªå–é•¿è¡¥çŸ­ï¼Œå°½åŠ›å»é€‰æ‹©æœ€åˆé€‚çš„æ–¹å¼æ¥æƒè¡¡ç¼–è¯‘æœ¬åœ°ä»£ç çš„æ—¶é—´å’Œç›´æ¥è§£é‡Šæ‰§è¡Œä»£ç çš„æ—¶é—´ã€‚</li><li>åœ¨ä»Šå¤©ï¼ŒJavaç¨‹åºçš„è¿è¡Œæ€§èƒ½æ—©å·²è„±èƒæ¢éª¨ï¼Œå·²ç»è¾¾åˆ°äº†å¯ä»¥å’ŒC&#x2F;C++ ç¨‹åºä¸€è¾ƒé«˜ä¸‹çš„åœ°æ­¥ã€‚</li></ol></li><li><p><strong>ä¸ºå•¥æˆ‘ä»¬è¿˜éœ€è¦è§£é‡Šå™¨å‘¢ï¼Ÿ</strong></p><ol><li>æœ‰äº›å¼€å‘äººå‘˜ä¼šæ„Ÿè§‰åˆ°è¯§å¼‚ï¼Œæ—¢ç„¶HotSpot VMä¸­å·²ç»å†…ç½®JITç¼–è¯‘å™¨äº†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜éœ€è¦å†ä½¿ç”¨è§£é‡Šå™¨æ¥â€œæ‹–ç´¯â€ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½å‘¢ï¼Ÿæ¯”å¦‚JRockit VMå†…éƒ¨å°±ä¸åŒ…å«è§£é‡Šå™¨ï¼Œå­—èŠ‚ç å…¨éƒ¨éƒ½ä¾é å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åæ‰§è¡Œã€‚</li><li>JRockitè™šæ‹Ÿæœºæ˜¯ç æ‰äº†è§£é‡Šå™¨ï¼Œä¹Ÿå°±æ˜¯åªé‡‡åŠæ—¶ç¼–è¯‘å™¨ã€‚é‚£æ˜¯å› ä¸ºå‘¢JRockitåªéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸€èˆ¬å·²ç»æœ‰æ—¶é—´è®©ä»–è¿›è¡ŒæŒ‡ä»¤ç¼–è¯‘çš„è¿‡ç¨‹äº†ï¼Œå¯¹äºå“åº”æ¥è¯´è¦æ±‚ä¸é«˜ï¼Œç­‰åŠæ—¶ç¼–è¯‘å™¨çš„ç¼–è¯‘å®Œæˆåï¼Œå°±ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½</li></ol></li><li><p><strong>é¦–å…ˆæ˜ç¡®ä¸¤ç‚¹ï¼š</strong></p><ol><li>å½“ç¨‹åºå¯åŠ¨åï¼Œè§£é‡Šå™¨å¯ä»¥é©¬ä¸Šå‘æŒ¥ä½œç”¨ï¼Œ<strong>å“åº”é€Ÿåº¦å¿«</strong>ï¼Œçœå»ç¼–è¯‘çš„æ—¶é—´ï¼Œç«‹å³æ‰§è¡Œã€‚</li><li>ç¼–è¯‘å™¨è¦æƒ³å‘æŒ¥ä½œç”¨ï¼ŒæŠŠä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œ<strong>éœ€è¦ä¸€å®šçš„æ‰§è¡Œæ—¶é—´</strong>ï¼Œä½†ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç åï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚</li></ol><p>  <strong>æ‰€ä»¥ï¼š</strong></p><ol><li>å°½ç®¡JRockit VMä¸­ç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ä¼šéå¸¸é«˜æ•ˆï¼Œä½†ç¨‹åºåœ¨å¯åŠ¨æ—¶å¿…ç„¶éœ€è¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´æ¥è¿›è¡Œç¼–è¯‘ã€‚å¯¹äºæœåŠ¡ç«¯åº”ç”¨æ¥è¯´ï¼Œå¯åŠ¨æ—¶é—´å¹¶éæ˜¯å…³æ³¨é‡ç‚¹ï¼Œä½†å¯¹äºé‚£äº›çœ‹ä¸­å¯åŠ¨æ—¶é—´çš„åº”ç”¨åœºæ™¯è€Œè¨€ï¼Œæˆ–è®¸å°±éœ€è¦é‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„æ¥æ¢å–ä¸€ä¸ªå¹³è¡¡ç‚¹ã€‚</li><li>åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œåœ¨Javaè™šæ‹Ÿå™¨å¯åŠ¨æ—¶ï¼Œè§£é‡Šå™¨å¯ä»¥é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œè€Œä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨å…¨éƒ¨ç¼–è¯‘å®Œæˆåå†æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥çœå»è®¸å¤šä¸å¿…è¦çš„ç¼–è¯‘æ—¶é—´ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œç¼–è¯‘å™¨å‘æŒ¥ä½œç”¨ï¼ŒæŠŠè¶Šæ¥è¶Šå¤šçš„ä»£ç ç¼–è¯‘æˆæœ¬åœ°ä»£ç ï¼Œè·å¾—æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚</li><li>åŒæ—¶ï¼Œè§£é‡Šæ‰§è¡Œåœ¨ç¼–è¯‘å™¨è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ä¸æˆç«‹çš„æ—¶å€™ï¼Œä½œä¸ºç¼–è¯‘å™¨çš„â€œé€ƒç”Ÿé—¨â€ï¼ˆåå¤‡æ–¹æ¡ˆï¼‰ã€‚</li></ol><p>  <strong>æ¡ˆä¾‹</strong></p><p>  æ³¨æ„è§£é‡Šæ‰§è¡Œä¸ç¼–è¯‘æ‰§è¡Œåœ¨çº¿ä¸Šç¯å¢ƒå¾®å¦™çš„è¾©è¯å…³ç³»ã€‚æœºå™¨åœ¨çƒ­æœºçŠ¶æ€å¯ä»¥æ‰¿å—çš„è´Ÿè½½è¦å¤§äºå†·æœºçŠ¶æ€ã€‚å¦‚æœä»¥çƒ­æœºçŠ¶æ€æ—¶çš„æµé‡è¿›è¡Œåˆ‡æµï¼Œå¯èƒ½ä½¿å¤„äºå†·æœºçŠ¶æ€çš„æœåŠ¡å™¨å› æ— æ³•æ‰¿è½½æµé‡è€Œå‡æ­»ã€‚</p><p>  åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œä»¥åˆ†æ‰¹çš„æ–¹å¼è¿›è¡Œå‘å¸ƒï¼Œæ ¹æ®æœºå™¨æ•°é‡åˆ’åˆ†æˆå¤šä¸ªæ‰¹æ¬¡ï¼Œæ¯ä¸ªæ‰¹æ¬¡çš„æœºå™¨æ•°è‡³å¤šå åˆ°æ•´ä¸ªé›†ç¾¤çš„1&#x2F;8ã€‚æ›¾ç»æœ‰è¿™æ ·çš„æ•…éšœæ¡ˆä¾‹ï¼šæŸç¨‹åºå‘˜åœ¨å‘å¸ƒå¹³å°è¿›è¡Œåˆ†æ‰¹å‘å¸ƒï¼Œåœ¨è¾“å…¥å‘å¸ƒæ€»æ‰¹æ•°æ—¶ï¼Œè¯¯å¡«å†™æˆåˆ†ä¸ºä¸¤æ‰¹å‘å¸ƒã€‚å¦‚æœæ˜¯çƒ­æœºçŠ¶æ€ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸€åŠçš„æœºå™¨å¯ä»¥å‹‰å¼ºæ‰¿è½½æµé‡ï¼Œä½†ç”±äºåˆšå¯åŠ¨çš„JVMå‡æ˜¯è§£é‡Šæ‰§è¡Œï¼Œè¿˜æ²¡æœ‰è¿›è¡Œçƒ­ç‚¹ä»£ç ç»Ÿè®¡å’ŒJITåŠ¨æ€ç¼–è¯‘ï¼Œå¯¼è‡´æœºå™¨å¯åŠ¨ä¹‹åï¼Œå½“å‰1&#x2F;2å‘å¸ƒæˆåŠŸçš„æœåŠ¡å™¨é©¬ä¸Šå…¨éƒ¨å®•æœºï¼Œæ­¤æ•…éšœè¯´æ˜äº†JITçš„å­˜åœ¨ã€‚â€”é˜¿é‡Œå›¢é˜Ÿ</p><p>  <img src="/images/jvm_virtual_machine/chapter11/image10.png" alt="Untitled">  </p></li><li><p><strong>JITç¼–è¯‘å™¨ç›¸å…³æ¦‚å¿µ</strong></p><ol><li>Java è¯­è¨€çš„â€œç¼–è¯‘æœŸâ€å…¶å®æ˜¯ä¸€æ®µâ€œä¸ç¡®å®šâ€çš„æ“ä½œè¿‡ç¨‹ï¼Œå› ä¸ºå®ƒå¯èƒ½æ˜¯æŒ‡ä¸€ä¸ªå‰ç«¯ç¼–è¯‘å™¨ï¼ˆå…¶å®å«â€œç¼–è¯‘å™¨çš„å‰ç«¯â€æ›´å‡†ç¡®ä¸€äº›ï¼‰æŠŠ.javaæ–‡ä»¶è½¬å˜æˆ.classæ–‡ä»¶çš„è¿‡ç¨‹ã€‚</li><li>ä¹Ÿå¯èƒ½æ˜¯æŒ‡è™šæ‹Ÿæœºçš„åç«¯è¿è¡ŒæœŸç¼–è¯‘å™¨ï¼ˆJITç¼–è¯‘å™¨ï¼ŒJust In Time Compilerï¼‰æŠŠå­—èŠ‚ç è½¬å˜æˆæœºå™¨ç çš„è¿‡ç¨‹ã€‚</li><li>è¿˜å¯èƒ½æ˜¯æŒ‡ä½¿ç”¨é™æ€æå‰ç¼–è¯‘å™¨ï¼ˆAOTç¼–è¯‘å™¨ï¼ŒAhead of Time Compilerï¼‰ç›´æ¥æŠŠ.javaæ–‡ä»¶ç¼–è¯‘æˆæœ¬åœ°æœºå™¨ä»£ç çš„è¿‡ç¨‹ã€‚ï¼ˆå¯èƒ½æ˜¯åç»­å‘å±•çš„è¶‹åŠ¿ï¼‰</li></ol><p>  <strong>å…¸å‹çš„ç¼–è¯‘å™¨ï¼š</strong></p><ol><li>å‰ç«¯ç¼–è¯‘å™¨ï¼šSunçš„javacã€Eclipse JDTä¸­çš„å¢é‡å¼ç¼–è¯‘å™¨ï¼ˆECJï¼‰ã€‚</li><li>JITç¼–è¯‘å™¨ï¼šHotSpot VMçš„C1ã€C2ç¼–è¯‘å™¨ã€‚</li><li>AOT ç¼–è¯‘å™¨ï¼šGNU Compiler for the Javaï¼ˆGCJï¼‰ã€Excelsior JETã€‚</li></ol></li><li><p><strong>çƒ­ç‚¹ä»£ç åŠæ¢æµ‹æ–¹å¼</strong></p><ol><li>å½“ç„¶æ˜¯å¦éœ€è¦å¯åŠ¨JITç¼–è¯‘å™¨å°†å­—èŠ‚ç ç›´æ¥ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œåˆ™éœ€è¦æ ¹æ®ä»£ç è¢«è°ƒç”¨<strong>æ‰§è¡Œçš„é¢‘ç‡</strong>è€Œå®šã€‚</li><li>å…³äºé‚£äº›éœ€è¦è¢«ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç çš„å­—èŠ‚ç ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸º**â€œçƒ­ç‚¹ä»£ç â€<strong>ï¼ŒJITç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶ä¼šé’ˆå¯¹é‚£äº›é¢‘ç¹è¢«è°ƒç”¨çš„â€œçƒ­ç‚¹ä»£ç â€åšå‡º</strong>æ·±åº¦ä¼˜åŒ–**ï¼Œå°†å…¶ç›´æ¥ç¼–è¯‘ä¸ºå¯¹åº”å¹³å°çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œä»¥æ­¤æå‡Javaç¨‹åºçš„æ‰§è¡Œæ€§èƒ½ã€‚</li><li>ä¸€ä¸ªè¢«å¤šæ¬¡è°ƒç”¨çš„æ–¹æ³•ï¼Œæˆ–è€…æ˜¯ä¸€-ä¸ªæ–¹æ³•ä½“å†…éƒ¨å¾ªç¯æ¬¡æ•°è¾ƒå¤šçš„å¾ªç¯ä½“éƒ½å¯ä»¥è¢«ç§°ä¹‹ä¸ºâ€œçƒ­ç‚¹ä»£ç â€ï¼Œå› æ­¤éƒ½å¯ä»¥é€šè¿‡JITç¼–è¯‘å™¨ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤ã€‚ç”±äºè¿™ç§ç¼–è¯‘æ–¹å¼å‘ç”Ÿåœ¨æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¹‹ä¸ºæ ˆä¸Šæ›¿æ¢ï¼Œæˆ–ç®€ç§°ä¸ºOSR (On StackReplacement)ç¼–è¯‘ã€‚</li><li>ä¸€ä¸ªæ–¹æ³•ç©¶ç«Ÿè¦è¢«è°ƒç”¨å¤šå°‘æ¬¡ï¼Œæˆ–è€…ä¸€ä¸ªå¾ªç¯ä½“ç©¶ç«Ÿéœ€è¦æ‰§è¡Œå¤šå°‘æ¬¡å¾ªç¯æ‰å¯ä»¥è¾¾åˆ°è¿™ä¸ªæ ‡å‡†ï¼Ÿå¿…ç„¶éœ€è¦ä¸€ä¸ªæ˜ç¡®çš„é˜ˆå€¼ï¼ŒJITç¼–è¯‘å™¨æ‰ä¼šå°†è¿™äº›â€œçƒ­ç‚¹ä»£ç â€ç¼–è¯‘ä¸ºæœ¬åœ°æœºå™¨æŒ‡ä»¤æ‰§è¡Œã€‚è¿™é‡Œä¸»è¦ä¾é çƒ­ç‚¹æ¢æµ‹åŠŸèƒ½ã€‚</li><li><strong>ç›®å‰HotSpot VMæ‰€é‡‡ç”¨çš„çƒ­ç‚¹æ¢æµ‹æ–¹å¼æ˜¯åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹</strong>ã€‚</li><li>é‡‡ç”¨åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼ŒHotSpot VMå°†ä¼šä¸ºæ¯ä¸€ä¸ªæ–¹æ³•éƒ½å»ºç«‹2ä¸ªä¸åŒç±»å‹çš„è®¡æ•°å™¨ï¼Œåˆ†åˆ«ä¸ºæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼ˆInvocation Counterï¼‰å’Œå›è¾¹è®¡æ•°å™¨ï¼ˆBack Edge Counterï¼‰ã€‚<ol><li>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ç”¨äºç»Ÿè®¡æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°</li><li>å›è¾¹è®¡æ•°å™¨åˆ™ç”¨äºç»Ÿè®¡å¾ªç¯ä½“æ‰§è¡Œçš„å¾ªç¯æ¬¡æ•°</li></ol></li></ol></li><li><p><strong>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨</strong></p><ol><li><p>è¿™ä¸ªè®¡æ•°å™¨å°±ç”¨äºç»Ÿè®¡æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°ï¼Œå®ƒçš„é»˜è®¤é˜€å€¼åœ¨Clientæ¨¡å¼ä¸‹æ˜¯1500æ¬¡ï¼Œåœ¨Serveræ¨¡å¼ä¸‹æ˜¯10000æ¬¡ã€‚è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œå°±ä¼šè§¦å‘JITç¼–è¯‘ã€‚</p></li><li><p>è¿™ä¸ªé˜€å€¼å¯ä»¥é€šè¿‡è™šæ‹Ÿæœºå‚æ•° -XX:CompileThreshold æ¥äººä¸ºè®¾å®šã€‚</p></li><li><p>å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦å­˜åœ¨è¢«JITç¼–è¯‘è¿‡çš„ç‰ˆæœ¬</p><ul><li>å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨ç¼–è¯‘åçš„æœ¬åœ°ä»£ç æ¥æ‰§è¡Œ</li><li>å¦‚æœä¸å­˜åœ¨å·²è¢«ç¼–è¯‘è¿‡çš„ç‰ˆæœ¬ï¼Œåˆ™å°†æ­¤æ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å€¼åŠ 1ï¼Œç„¶ååˆ¤æ–­æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ä¸å›è¾¹è®¡æ•°å™¨å€¼ä¹‹å’Œæ˜¯å¦è¶…è¿‡æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨çš„é˜€å€¼ã€‚<ul><li>å¦‚æœå·²è¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°†ä¼šå‘å³æ—¶ç¼–è¯‘å™¨æäº¤ä¸€ä¸ªè¯¥æ–¹æ³•çš„ä»£ç ç¼–è¯‘è¯·æ±‚ã€‚</li><li>å¦‚æœæœªè¶…è¿‡é˜ˆå€¼ï¼Œåˆ™ä½¿ç”¨è§£é‡Šå™¨å¯¹å­—èŠ‚ç æ–‡ä»¶è§£é‡Šæ‰§è¡Œ</li></ul></li></ul><p> <img src="/images/jvm_virtual_machine/chapter11/image11.png" alt="Untitled"></p></li></ol></li><li><p><strong>çƒ­åº¦è¡°å‡</strong></p><ol><li>å¦‚æœä¸åšä»»ä½•è®¾ç½®ï¼Œæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ç»Ÿè®¡çš„å¹¶ä¸æ˜¯æ–¹æ³•è¢«è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªç›¸å¯¹çš„æ‰§è¡Œé¢‘ç‡ï¼Œå³<strong>ä¸€æ®µæ—¶é—´ä¹‹å†…æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°</strong>ã€‚å½“è¶…è¿‡ä¸€å®šçš„æ—¶é—´é™åº¦ï¼Œå¦‚æœæ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ä»ç„¶ä¸è¶³ä»¥è®©å®ƒæäº¤ç»™å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œé‚£è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è®¡æ•°å™¨å°±ä¼šè¢«å‡å°‘ä¸€åŠï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨çƒ­åº¦çš„è¡°å‡ï¼ˆCounter Decayï¼‰ï¼Œè€Œè¿™æ®µæ—¶é—´å°±ç§°ä¸ºæ­¤æ–¹æ³•ç»Ÿè®¡çš„åŠè¡°å‘¨æœŸï¼ˆCounter Half Life Timeï¼‰ï¼ˆåŠè¡°å‘¨æœŸæ˜¯åŒ–å­¦ä¸­çš„æ¦‚å¿µï¼Œæ¯”å¦‚å‡ºåœŸçš„æ–‡ç‰©é€šè¿‡æŸ¥çœ‹C60æ¥è·å¾—æ–‡ç‰©çš„å¹´é¾„ï¼‰</li><li>è¿›è¡Œçƒ­åº¦è¡°å‡çš„åŠ¨ä½œæ˜¯åœ¨è™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶é¡ºä¾¿è¿›è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨è™šæ‹Ÿæœºå‚æ•° -XX:-UseCounterDecay æ¥å…³é—­çƒ­åº¦è¡°å‡ï¼Œè®©æ–¹æ³•è®¡æ•°å™¨ç»Ÿè®¡æ–¹æ³•è°ƒç”¨çš„ç»å¯¹æ¬¡æ•°ï¼Œè¿™æ ·çš„è¯ï¼Œåªè¦ç³»ç»Ÿè¿è¡Œæ—¶é—´è¶³å¤Ÿé•¿ï¼Œç»å¤§éƒ¨åˆ†æ–¹æ³•éƒ½ä¼šè¢«ç¼–è¯‘æˆæœ¬åœ°ä»£ç ã€‚</li><li>å¦å¤–ï¼Œå¯ä»¥ä½¿ç”¨-XX:CounterHalfLifeTimeå‚æ•°è®¾ç½®åŠè¡°å‘¨æœŸçš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚</li></ol></li><li><p><strong>å›è¾¹è®¡æ•°å™¨</strong></p><p>  å®ƒçš„ä½œç”¨æ˜¯ç»Ÿè®¡ä¸€ä¸ªæ–¹æ³•ä¸­å¾ªç¯ä½“ä»£ç æ‰§è¡Œçš„æ¬¡æ•°ï¼Œåœ¨å­—èŠ‚ç ä¸­é‡åˆ°æ§åˆ¶æµå‘åè·³è½¬çš„æŒ‡ä»¤ç§°ä¸ºâ€œå›è¾¹â€ï¼ˆBack Edgeï¼‰ã€‚æ˜¾ç„¶ï¼Œå»ºç«‹å›è¾¹è®¡æ•°å™¨ç»Ÿè®¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§¦å‘OSRç¼–è¯‘ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter11/image12.png" alt="Untitled"></p></li><li><p><strong>HotSpotVM å¯ä»¥è®¾ç½®ç¨‹åºæ‰§è¡Œæ–¹æ³•</strong></p><p>  ç¼ºçœæƒ…å†µä¸‹HotSpot VMæ˜¯é‡‡ç”¨è§£é‡Šå™¨ä¸å³æ—¶ç¼–è¯‘å™¨å¹¶å­˜çš„æ¶æ„ï¼Œå½“ç„¶å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯ï¼Œé€šè¿‡å‘½ä»¤æ˜¾å¼åœ°ä¸ºJavaè™šæ‹ŸæœºæŒ‡å®šåœ¨è¿è¡Œæ—¶åˆ°åº•æ˜¯å®Œå…¨é‡‡ç”¨è§£é‡Šå™¨æ‰§è¡Œï¼Œè¿˜æ˜¯å®Œå…¨é‡‡ç”¨å³æ—¶ç¼–è¯‘å™¨æ‰§è¡Œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>Xintï¼šå®Œå…¨é‡‡ç”¨è§£é‡Šå™¨æ¨¡å¼æ‰§è¡Œç¨‹åºï¼›</li><li>Xcompï¼šå®Œå…¨é‡‡ç”¨å³æ—¶ç¼–è¯‘å™¨æ¨¡å¼æ‰§è¡Œç¨‹åºã€‚å¦‚æœå³æ—¶ç¼–è¯‘å‡ºç°é—®é¢˜ï¼Œè§£é‡Šå™¨ä¼šä»‹å…¥æ‰§è¡Œ</li><li>Xmixedï¼šé‡‡ç”¨è§£é‡Šå™¨+å³æ—¶ç¼–è¯‘å™¨çš„æ··åˆæ¨¡å¼å…±åŒæ‰§è¡Œç¨‹åºã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter11/image13.png" alt="Untitled">  </p></li><li><p><strong>HotSpotVM JIT åˆ†ç±»</strong></p><p>  åœ¨HotSpot VMä¸­å†…åµŒæœ‰ä¸¤ä¸ªJITç¼–è¯‘å™¨ï¼Œåˆ†åˆ«ä¸ºClient Compilerå’ŒServer Compilerï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ç®€ç§°ä¸ºC1ç¼–è¯‘å™¨ å’Œ C2ç¼–è¯‘å™¨ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ˜¾å¼æŒ‡å®šJavaè™šæ‹Ÿæœºåœ¨è¿è¡Œæ—¶åˆ°åº•ä½¿ç”¨å“ªä¸€ç§å³æ—¶ç¼–è¯‘å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ol><li>clientï¼šæŒ‡å®šJavaè™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹ï¼Œå¹¶ä½¿ç”¨C1ç¼–è¯‘å™¨ï¼›<ul><li>C1ç¼–è¯‘å™¨ä¼šå¯¹å­—èŠ‚ç è¿›è¡Œç®€å•å’Œå¯é çš„ä¼˜åŒ–ï¼Œè€—æ—¶çŸ­ï¼Œä»¥è¾¾åˆ°æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦ã€‚</li></ul></li><li>serverï¼šæŒ‡å®šJavaè™šæ‹Ÿæœºè¿è¡Œåœ¨serveræ¨¡å¼ä¸‹ï¼Œå¹¶ä½¿ç”¨C2ç¼–è¯‘å™¨ã€‚<ul><li>C2è¿›è¡Œè€—æ—¶è¾ƒé•¿çš„ä¼˜åŒ–ï¼Œä»¥åŠæ¿€è¿›ä¼˜åŒ–ï¼Œä½†ä¼˜åŒ–çš„ä»£ç æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚ï¼ˆä½¿ç”¨C++ï¼‰</li></ul></li></ol></li><li><p><strong>C1å’ŒC2ç¼–è¯‘å™¨ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥</strong></p><ol><li>åœ¨ä¸åŒçš„ç¼–è¯‘å™¨ä¸Šæœ‰ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ï¼ŒC1ç¼–è¯‘å™¨ä¸Šä¸»è¦æœ‰æ–¹æ³•å†…è”ï¼Œå»è™šæ‹ŸåŒ–ã€å…ƒä½™æ¶ˆé™¤ã€‚<ul><li>æ–¹æ³•å†…è”ï¼šå°†å¼•ç”¨çš„å‡½æ•°ä»£ç ç¼–è¯‘åˆ°å¼•ç”¨ç‚¹å¤„ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ ˆå¸§çš„ç”Ÿæˆï¼Œå‡å°‘å‚æ•°ä¼ é€’ä»¥åŠè·³è½¬è¿‡ç¨‹</li><li>å»è™šæ‹ŸåŒ–ï¼šå¯¹å”¯ä¸€çš„å®ç°æ¨Šè¿›è¡Œå†…è”</li><li>å†—ä½™æ¶ˆé™¤ï¼šåœ¨è¿è¡ŒæœŸé—´æŠŠä¸€äº›ä¸ä¼šæ‰§è¡Œçš„ä»£ç æŠ˜å æ‰</li></ul></li><li>C2çš„ä¼˜åŒ–ä¸»è¦æ˜¯åœ¨å…¨å±€å±‚é¢ï¼Œé€ƒé€¸åˆ†ææ˜¯ä¼˜åŒ–çš„åŸºç¡€ã€‚åŸºäºé€ƒé€¸åˆ†æåœ¨C2ä¸Šæœ‰å¦‚ä¸‹å‡ ç§ä¼˜åŒ–ï¼š<ul><li>æ ‡é‡æ›¿æ¢ï¼šç”¨æ ‡é‡å€¼ä»£æ›¿èšåˆå¯¹è±¡çš„å±æ€§å€¼</li><li>æ ˆä¸Šåˆ†é…ï¼šå¯¹äºæœªé€ƒé€¸çš„å¯¹è±¡åˆ†é…å¯¹è±¡åœ¨æ ˆè€Œä¸æ˜¯å †</li><li>åŒæ­¥æ¶ˆé™¤ï¼šæ¸…é™¤åŒæ­¥æ“ä½œï¼Œé€šå¸¸æŒ‡synchronized</li></ul></li></ol></li><li><p><strong>åˆ†å±‚ç¼–è¯‘ç­–ç•¥</strong></p><ol><li>åˆ†å±‚ç¼–è¯‘ï¼ˆTiered Compilationï¼‰ç­–ç•¥ï¼šç¨‹åºè§£é‡Šæ‰§è¡Œï¼ˆä¸å¼€å¯æ€§èƒ½ç›‘æ§ï¼‰å¯ä»¥è§¦å‘C1ç¼–è¯‘ï¼Œå°†å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ï¼Œå¯ä»¥è¿›è¡Œç®€å•ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šæ€§èƒ½ç›‘æ§ï¼ŒC2ç¼–è¯‘ä¼šæ ¹æ®æ€§èƒ½ç›‘æ§ä¿¡æ¯è¿›è¡Œæ¿€è¿›ä¼˜åŒ–ã€‚</li><li>ä¸è¿‡åœ¨Java7ç‰ˆæœ¬ä¹‹åï¼Œä¸€æ—¦å¼€å‘äººå‘˜åœ¨ç¨‹åºä¸­æ˜¾å¼æŒ‡å®šå‘½ä»¤â€œ-serverâ€æ—¶ï¼Œé»˜è®¤å°†ä¼šå¼€å¯åˆ†å±‚ç¼–è¯‘ç­–ç•¥ï¼Œç”±C1ç¼–è¯‘å™¨å’ŒC2ç¼–è¯‘å™¨ç›¸äº’åä½œå…±åŒæ¥æ‰§è¡Œç¼–è¯‘ä»»åŠ¡ã€‚</li><li>ä¸€èˆ¬æ¥è®²ï¼ŒJITç¼–è¯‘å‡ºæ¥çš„æœºå™¨ç æ€§èƒ½æ¯”è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œçš„æ€§èƒ½é«˜</li><li>C2ç¼–è¯‘å™¨å¯åŠ¨æ—¶é•¿æ¯”C1æ…¢ï¼Œç³»ç»Ÿç¨³å®šæ‰§è¡Œä»¥åï¼ŒC2ç¼–è¯‘å™¨æ‰§è¡Œé€Ÿåº¦è¿œå¿«äºC1ç¼–è¯‘å™¨</li></ol></li><li><p><strong>Graal ç¼–è¯‘å™¨</strong></p><ul><li>è‡ªJDK10èµ·ï¼ŒHotSpotåˆåŠ å…¥äº†ä¸€ä¸ªå…¨æ–°çš„å³æ—¶ç¼–è¯‘å™¨ï¼šGraalç¼–è¯‘å™¨</li><li>ç¼–è¯‘æ•ˆæœçŸ­çŸ­å‡ å¹´æ—¶é—´å°±è¿½å¹³äº†G2ç¼–è¯‘å™¨ï¼Œæœªæ¥å¯æœŸï¼ˆå¯¹åº”è¿˜å‡ºç°äº†Graalè™šæ‹Ÿæœºï¼Œæ˜¯æœ‰å¯èƒ½æ›¿ä»£Hotspotçš„è™šæ‹Ÿæœºçš„ï¼‰</li><li>ç›®å‰ï¼Œå¸¦ç€å®éªŒçŠ¶æ€æ ‡ç­¾ï¼Œéœ€è¦ä½¿ç”¨å¼€å…³å‚æ•°å»æ¿€æ´»æ‰èƒ½ä½¿ç”¨<ul><li>XX:+UnlockExperimentalvMOptions -XX:+UseJVMCICompiler</li></ul></li></ul></li><li><p><strong>AOTç¼–è¯‘å™¨</strong></p><ol><li><p>jdk9å¼•å…¥äº†AoTç¼–è¯‘å™¨ï¼ˆé™æ€æå‰ç¼–è¯‘å™¨ï¼ŒAhead of Time Compilerï¼‰</p></li><li><p>Java 9å¼•å…¥äº†å®éªŒæ€§AOTç¼–è¯‘å·¥å…·jaotcã€‚å®ƒå€ŸåŠ©äº†Graalç¼–è¯‘å™¨ï¼Œå°†æ‰€è¾“å…¥çš„Javaç±»æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜æ”¾è‡³ç”Ÿæˆçš„åŠ¨æ€å…±äº«åº“ä¹‹ä¸­ã€‚</p></li><li><p>æ‰€è°“AOTç¼–è¯‘ï¼Œæ˜¯ä¸å³æ—¶ç¼–è¯‘ç›¸å¯¹ç«‹çš„ä¸€ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå³æ—¶ç¼–è¯‘æŒ‡çš„æ˜¯<strong>åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­</strong>ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºå¯åœ¨ç¡¬ä»¶ä¸Šç›´æ¥è¿è¡Œçš„æœºå™¨ç ï¼Œå¹¶éƒ¨ç½²è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„è¿‡ç¨‹ã€‚è€ŒAOTç¼–è¯‘æŒ‡çš„åˆ™æ˜¯ï¼Œ<strong>åœ¨ç¨‹åºè¿è¡Œä¹‹å‰</strong>ï¼Œä¾¿å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç çš„è¿‡ç¨‹ã€‚</p><p> .java -&gt; .class -&gt; (ä½¿ç”¨jaotc) -&gt; .so</p></li></ol></li><li><p><strong>AOTç¼–è¯‘å™¨ç¼–è¯‘å™¨çš„ä¼˜ç¼ºç‚¹</strong></p><p>  <strong>æœ€å¤§çš„å¥½å¤„ï¼š</strong></p><ol><li>Javaè™šæ‹ŸæœºåŠ è½½å·²ç»é¢„ç¼–è¯‘æˆäºŒè¿›åˆ¶åº“ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚</li><li>ä¸å¿…ç­‰å¾…å³æ—¶ç¼–è¯‘å™¨çš„é¢„çƒ­ï¼Œå‡å°‘Javaåº”ç”¨ç»™äººå¸¦æ¥â€œç¬¬ä¸€æ¬¡è¿è¡Œæ…¢â€ çš„ä¸è‰¯ä½“éªŒ</li></ol><p>  <strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>ç ´åäº† java â€œ ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªä¸åŒçš„ç¡¬ä»¶ï¼ŒOSç¼–è¯‘å¯¹åº”çš„å‘è¡ŒåŒ…</li><li>é™ä½äº†Javaé“¾æ¥è¿‡ç¨‹çš„åŠ¨æ€æ€§ï¼ŒåŠ è½½çš„ä»£ç åœ¨ç¼–è¯‘å™¨å°±å¿…é¡»å…¨éƒ¨å·²çŸ¥ã€‚</li><li>è¿˜éœ€è¦ç»§ç»­ä¼˜åŒ–ä¸­ï¼Œæœ€åˆåªæ”¯æŒLinux X64 java base</li></ol></li><li><p><strong>æœ€å</strong></p><ul><li>è‡ªJDK10èµ·ï¼ŒHotSpotåˆåŠ å…¥äº†ä¸€ä¸ªå…¨æ–°çš„åŠæ—¶ç¼–è¯‘å™¨ï¼šGraalç¼–è¯‘å™¨</li><li>ç¼–è¯‘æ•ˆæœçŸ­çŸ­å‡ å¹´æ—¶é—´å°±è¿½è¯„äº†G2ç¼–è¯‘å™¨ï¼Œæœªæ¥å¯æœŸ</li><li>ç›®å‰ï¼Œå¸¦ç€å®éªŒçŠ¶æ€æ ‡ç­¾ï¼Œéœ€è¦ä½¿ç”¨å¼€å…³å‚æ•°å»æ¿€æ´»æ‰èƒ½ä½¿ç”¨</li></ul></li></ul>]]></content>
    
    
    <summary type="html">æ‰§è¡Œå¼•æ“å±äºJVMçš„ä¸‹å±‚ï¼Œé‡Œé¢åŒ…æ‹¬ è§£é‡Šå™¨ã€åŠæ—¶ç¼–è¯‘å™¨ã€åƒåœ¾å›æ”¶å™¨ã€‚æ‰§è¡Œå¼•æ“æ˜¯Javaè™šæ‹Ÿæœºæ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ã€‚â€œè™šæ‹Ÿæœºâ€æ˜¯ä¸€ä¸ªç›¸å¯¹äºâ€œç‰©ç†æœºâ€çš„æ¦‚å¿µï¼Œè¿™ä¸¤ç§æœºå™¨éƒ½æœ‰ä»£ç æ‰§è¡Œèƒ½åŠ›ï¼Œå…¶åŒºåˆ«æ˜¯ç‰©ç†æœºçš„æ‰§è¡Œå¼•æ“æ˜¯ç›´æ¥å»ºç«‹åœ¨å¤„ç†å™¨ã€ç¼“å­˜ã€æŒ‡ä»¤é›†å’Œæ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„ï¼Œè€Œè™šæ‹Ÿæœºçš„æ‰§è¡Œå¼•æ“åˆ™æ˜¯ç”±è½¯ä»¶è‡ªè¡Œå®ç°çš„ï¼Œå› æ­¤å¯ä»¥ä¸å—ç‰©ç†æ¡ä»¶åˆ¶çº¦åœ°å®šåˆ¶æŒ‡ä»¤é›†ä¸æ‰§è¡Œå¼•æ“çš„ç»“æ„ä½“ç³»ï¼Œèƒ½å¤Ÿæ‰§è¡Œé‚£äº›ä¸è¢«ç¡¬ä»¶ç›´æ¥æ”¯æŒçš„æŒ‡ä»¤é›†æ ¼å¼ã€‚</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(å››)**è¿è¡Œæ—¶æ•°æ®åŒºæ¦‚è¿°åŠçº¿ç¨‹</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%9B%9B)%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%BA%BF%E7%A8%8B/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%9B%9B)%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%BA%BF%E7%A8%8B/</id>
    <published>2023-02-09T16:00:00.000Z</published>
    <updated>2025-09-03T15:25:05.814Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-å››-è¿è¡Œæ—¶æ•°æ®åŒºæ¦‚è¿°åŠçº¿ç¨‹"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-å››-è¿è¡Œæ—¶æ•°æ®åŒºæ¦‚è¿°åŠçº¿ç¨‹" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(å››)è¿è¡Œæ—¶æ•°æ®åŒºæ¦‚è¿°åŠçº¿ç¨‹"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(å››)<strong>è¿è¡Œæ—¶æ•°æ®åŒºæ¦‚è¿°åŠçº¿ç¨‹</strong></h2><h3 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h3><p>æœ¬èŠ‚ä¸»è¦è®²çš„æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾è¿™éƒ¨åˆ†ï¼Œå®ƒæ˜¯åœ¨ç±»åŠ è½½å®Œæˆåçš„é˜¶æ®µ</p><p><img src="/images/jvm_virtual_machine/chapter4/image.png" alt="Untitled"></p><p>å½“æˆ‘ä»¬é€šè¿‡å‰é¢çš„ï¼šç±»çš„åŠ è½½-&gt; éªŒè¯ -&gt; å‡†å¤‡ -&gt; è§£æ -&gt; åˆå§‹åŒ– è¿™å‡ ä¸ªé˜¶æ®µå®Œæˆåï¼Œå°±ä¼šç”¨åˆ°æ‰§è¡Œå¼•æ“å¯¹æˆ‘ä»¬çš„ç±»è¿›è¡Œä½¿ç”¨ï¼ŒåŒæ—¶æ‰§è¡Œå¼•æ“å°†ä¼šä½¿ç”¨åˆ°æˆ‘ä»¬è¿è¡Œæ—¶æ•°æ®åŒº</p><p><img src="/images/jvm_virtual_machine/chapter4/image1.png" alt="Untitled"></p><p>ä¹Ÿå°±æ˜¯å¤§å¨åšé¥­ï¼Œæˆ‘ä»¬æŠŠå¤§å¨åé¢çš„ä¸œè¥¿ï¼ˆåˆ‡å¥½çš„èœï¼Œåˆ€ï¼Œè°ƒæ–™ï¼‰ï¼Œæ¯”ä½œæ˜¯è¿è¡Œæ—¶æ•°æ®åŒºã€‚è€Œå¨å¸ˆå¯ä»¥ç±»æ¯”äºæ‰§è¡Œå¼•æ“ï¼Œå°†é€šè¿‡å‡†å¤‡çš„ä¸œè¥¿è¿›è¡Œåˆ¶ä½œæˆç²¾ç¾çš„èœå“</p><p><img src="/images/jvm_virtual_machine/chapter4/image2.png" alt="Untitled"></p><p>å†…å­˜æ˜¯éå¸¸é‡è¦çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯ç¡¬ç›˜å’ŒCPUçš„ä¸­é—´ä»“åº“åŠæ¡¥æ¢ï¼Œæ‰¿è½½ç€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å®æ—¶è¿è¡ŒJVMå†…å­˜å¸ƒå±€è§„å®šäº†Javaåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ã€åˆ†é…ã€ç®¡ç†çš„ç­–ç•¥ï¼Œä¿è¯äº†JVMçš„é«˜æ•ˆç¨³å®šè¿è¡Œã€‚ä¸åŒçš„JVMå¯¹äºå†…å­˜çš„åˆ’åˆ†æ–¹å¼å’Œç®¡ç†æœºåˆ¶å­˜åœ¨ç€éƒ¨åˆ†å·®å¼‚ã€‚ç»“åˆJVMè™šæ‹Ÿæœºè§„èŒƒï¼Œæ¥æ¢è®¨ä¸€ä¸‹ç»å…¸çš„JVMå†…å­˜å¸ƒå±€ã€‚</p><blockquote><p><em>æˆ‘ä»¬é€šè¿‡ç£ç›˜æˆ–è€…ç½‘ç»œIOå¾—åˆ°çš„æ•°æ®ï¼Œéƒ½éœ€è¦å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åCPUä»å†…å­˜ä¸­è·å–æ•°æ®è¿›è¡Œè¯»å–ï¼Œä¹Ÿå°±æ˜¯è¯´å†…å­˜å……å½“äº†CPUå’Œç£ç›˜ä¹‹é—´çš„æ¡¥æ¢</em></p></blockquote><ul><li><p><strong>è¿è¡Œæ—¶æ•°æ®åŒºçš„å®Œæ•´å›¾</strong></p><p>  <img src="/images/jvm_virtual_machine/chapter4/image3.png" alt="Untitled"></p><p>  Javaè™šæ‹Ÿæœºå®šä¹‰äº†è‹¥å¹²ç§ç¨‹åºè¿è¡ŒæœŸé—´ä¼šä½¿ç”¨åˆ°çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¼šéšç€è™šæ‹Ÿæœºå¯åŠ¨è€Œåˆ›å»ºï¼Œéšç€è™šæ‹Ÿæœºé€€å‡ºè€Œé”€æ¯ã€‚å¦å¤–ä¸€äº›åˆ™æ˜¯ä¸çº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ï¼Œè¿™äº›ä¸çº¿ç¨‹å¯¹åº”çš„æ•°æ®åŒºåŸŸä¼šéšç€çº¿ç¨‹å¼€å§‹å’Œç»“æŸè€Œåˆ›å»ºå’Œé”€æ¯ã€‚</p><p>  ç°è‰²çš„ä¸ºå•ç‹¬çº¿ç¨‹ç§æœ‰çš„ï¼Œçº¢è‰²çš„ä¸ºå¤šä¸ªçº¿ç¨‹å…±äº«çš„ã€‚å³ï¼š</p><ul><li>æ¯ä¸ªçº¿ç¨‹ï¼šç‹¬ç«‹åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€æ ˆã€æœ¬åœ°æ ˆã€‚</li><li>çº¿ç¨‹é—´å…±äº«ï¼šå †ã€å †å¤–å†…å­˜ï¼ˆæ°¸ä¹…ä»£æˆ–å…ƒç©ºé—´ã€ä»£ç ç¼“å­˜ï¼‰</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter4/image4.png" alt="Untitled"></p></li></ul><h3 id="2-çº¿ç¨‹"><a href="#2-çº¿ç¨‹" class="headerlink" title="2. çº¿ç¨‹"></a>2. çº¿ç¨‹</h3><ul><li><strong>JVM çº¿ç¨‹</strong><ol><li>çº¿ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºé‡Œçš„è¿è¡Œå•å…ƒã€‚JVMå…è®¸ä¸€ä¸ªåº”ç”¨æœ‰å¤šä¸ªçº¿ç¨‹å¹¶è¡Œçš„æ‰§è¡Œ</li><li><strong>åœ¨Hotspot JVMé‡Œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¸æ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ç›´æ¥æ˜ å°„</strong><ul><li>å½“ä¸€ä¸ªJavaçº¿ç¨‹å‡†å¤‡å¥½æ‰§è¡Œä»¥åï¼Œæ­¤æ—¶ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„æœ¬åœ°çº¿ç¨‹ä¹ŸåŒæ—¶åˆ›å»ºã€‚Javaçº¿ç¨‹æ‰§è¡Œç»ˆæ­¢åï¼Œæœ¬åœ°çº¿ç¨‹ä¹Ÿä¼šå›æ”¶</li></ul></li><li>æ“ä½œç³»ç»Ÿè´Ÿè´£å°†çº¿ç¨‹å®‰æ’è°ƒåº¦åˆ°ä»»ä½•ä¸€ä¸ªå¯ç”¨çš„CPUä¸Šã€‚ä¸€æ—¦æœ¬åœ°çº¿ç¨‹åˆå§‹åŒ–æˆåŠŸï¼Œå®ƒå°±ä¼šè°ƒç”¨Javaçº¿ç¨‹ä¸­çš„run()æ–¹æ³•</li></ol></li><li><strong>JVM ç³»ç»Ÿçº¿ç¨‹</strong><ul><li>å¦‚æœä½ ä½¿ç”¨jconsoleæˆ–è€…æ˜¯ä»»ä½•ä¸€ä¸ªè°ƒè¯•å·¥å…·ï¼Œéƒ½èƒ½çœ‹åˆ°åœ¨åå°æœ‰è®¸å¤šçº¿ç¨‹åœ¨è¿è¡Œã€‚è¿™äº›åå°çº¿ç¨‹ä¸åŒ…æ‹¬è°ƒç”¨<code>public static void main(String[])</code>çš„mainçº¿ç¨‹ä»¥åŠæ‰€æœ‰è¿™ä¸ªmainçº¿ç¨‹è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ã€‚</li><li>è¿™äº›ä¸»è¦çš„åå°ç³»ç»Ÿçº¿ç¨‹åœ¨Hotspot JVMé‡Œä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªï¼š<ol><li><strong>è™šæ‹Ÿæœºçº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹çš„æ“ä½œæ˜¯éœ€è¦JVMè¾¾åˆ°å®‰å…¨ç‚¹æ‰ä¼šå‡ºç°ã€‚è¿™äº›æ“ä½œå¿…é¡»åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å‘ç”Ÿçš„åŸå› æ˜¯ä»–ä»¬éƒ½éœ€è¦JVMè¾¾åˆ°å®‰å…¨ç‚¹ï¼Œè¿™æ ·å †æ‰ä¸ä¼šå˜åŒ–ã€‚è¿™ç§çº¿ç¨‹çš„æ‰§è¡Œç±»å‹æ‹¬â€stop-the-worldâ€çš„åƒåœ¾æ”¶é›†ï¼Œçº¿ç¨‹æ ˆæ”¶é›†ï¼Œçº¿ç¨‹æŒ‚èµ·ä»¥åŠåå‘é”æ’¤é”€</li><li><strong>å‘¨æœŸä»»åŠ¡çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹æ˜¯æ—¶é—´å‘¨æœŸäº‹ä»¶çš„ä½“ç°ï¼ˆæ¯”å¦‚ä¸­æ–­ï¼‰ï¼Œä»–ä»¬ä¸€èˆ¬ç”¨äºå‘¨æœŸæ€§æ“ä½œçš„è°ƒåº¦æ‰§è¡Œ</li><li><strong>GCçº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹å¯¹åœ¨JVMé‡Œä¸åŒç§ç±»çš„åƒåœ¾æ”¶é›†è¡Œä¸ºæä¾›äº†æ”¯æŒ</li><li><strong>ç¼–è¯‘çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹åœ¨è¿è¡Œæ—¶ä¼šå°†å­—èŠ‚ç ç¼–è¯‘æˆåˆ°æœ¬åœ°ä»£ç </li><li><strong>ä¿¡å·è°ƒåº¦çº¿ç¨‹</strong>ï¼šè¿™ç§çº¿ç¨‹æ¥æ”¶ä¿¡å·å¹¶å‘é€ç»™JVMï¼Œåœ¨å®ƒå†…éƒ¨é€šè¿‡è°ƒç”¨é€‚å½“çš„æ–¹æ³•è¿›è¡Œå¤„ç†</li></ol></li></ul></li></ul>]]></content>
    
    
    <summary type="html">å½“æˆ‘ä»¬é€šè¿‡å‰é¢çš„ï¼šç±»çš„åŠ è½½-&gt; éªŒè¯ -&gt; å‡†å¤‡ -&gt; è§£æ -&gt; åˆå§‹åŒ– è¿™å‡ ä¸ªé˜¶æ®µå®Œæˆåï¼Œå°±ä¼šç”¨åˆ°æ‰§è¡Œå¼•æ“å¯¹æˆ‘ä»¬çš„ç±»è¿›è¡Œä½¿ç”¨ï¼ŒåŒæ—¶æ‰§è¡Œå¼•æ“å°†ä¼šä½¿ç”¨åˆ°æˆ‘ä»¬è¿è¡Œæ—¶æ•°æ®åŒº</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(ä¹)æ–¹æ³•åŒº**Method Area</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%B9%9D)%E6%96%B9%E6%B3%95%E5%8C%BAMethod%20Area/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%B9%9D)%E6%96%B9%E6%B3%95%E5%8C%BAMethod%20Area/</id>
    <published>2023-02-08T16:00:00.000Z</published>
    <updated>2025-09-03T15:18:45.538Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-ä¹-æ–¹æ³•åŒºMethod-Area"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-ä¹-æ–¹æ³•åŒºMethod-Area" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(ä¹)æ–¹æ³•åŒºMethod Area"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(ä¹)æ–¹æ³•åŒº<strong>Method Area</strong></h2><h3 id="1-æ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»"><a href="#1-æ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»" class="headerlink" title="1. æ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»"></a>1. <strong>æ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»</strong></h3><ul><li><p><strong>ä»çº¿ç¨‹å…±äº«ä¸å¦çš„è§’åº¦æ¥çœ‹</strong></p><ul><li>ThreadLocalï¼šå¦‚ä½•ä¿è¯å¤šä¸ªçº¿ç¨‹åœ¨å¹¶å‘ç¯å¢ƒä¸‹çš„å®‰å…¨æ€§ï¼Ÿå…¸å‹åœºæ™¯å°±æ˜¯æ•°æ®åº“è¿æ¥ç®¡ç†ï¼Œä»¥åŠä¼šè¯ç®¡ç†ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter9/image.png" alt="Untitled"></p><ul><li><p>ä»çº¿ç¨‹å…±äº«ä¸å¦çš„è§’åº¦æ¥çœ‹</p><p>  ThreadLocalï¼šå¦‚ä½•ä¿è¯å¤šä¸ªçº¿ç¨‹åœ¨å¹¶å‘ç¯å¢ƒä¸‹çš„å®‰å…¨æ€§ï¼Ÿå…¸å‹åº”ç”¨å°±æ˜¯æ•°æ®åº“è¿æ¥ç®¡ç†ï¼Œä»¥åŠä¼šè¯ç®¡ç†</p></li></ul><p>  <img src="/images/jvm_virtual_machine/chapter9/image1.png" alt="Untitled">  </p></li><li><p><strong>æ ˆã€å †ã€æ–¹æ³•åŒºçš„äº¤äº’å…³ç³»</strong></p><ul><li>ä¸‹é¢å°±æ¶‰åŠäº†å¯¹è±¡çš„è®¿é—®å®šä½</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter9/image2.png" alt="Untitled"></p><ul><li>Personï¼šå­˜æ”¾åœ¨å…ƒç©ºé—´ï¼Œä¹Ÿå¯ä»¥è¯´æ–¹æ³•åŒº</li><li>personï¼šå­˜æ”¾åœ¨Javaæ ˆçš„å±€éƒ¨å˜é‡è¡¨ä¸­</li><li>new Person()ï¼šå­˜æ”¾åœ¨Javaå †ä¸­</li></ul></li><li><p><strong>æ–¹æ³•åŒºçš„ç†è§£</strong></p><ul><li>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­æ˜ç¡®è¯´æ˜ï¼šâ€œå°½ç®¡æ‰€æœ‰çš„æ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šæ˜¯å±äºå †çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸€äº›ç®€å•çš„å®ç°å¯èƒ½ä¸ä¼šé€‰æ‹©å»è¿›è¡Œåƒåœ¾æ”¶é›†æˆ–è€…è¿›è¡Œå‹ç¼©ã€‚â€ä½†å¯¹äºHotSpotJVMè€Œè¨€ï¼Œæ–¹æ³•åŒºè¿˜æœ‰ä¸€ä¸ªåˆ«åå«åšNon-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„å°±æ˜¯è¦å’Œå †åˆ†å¼€ã€‚æ‰€ä»¥ï¼Œæ–¹æ³•åŒºçœ‹ä½œæ˜¯ä¸€å—ç‹¬ç«‹äºJavaå †çš„å†…å­˜ç©ºé—´ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter9/image3.png" alt="Untitled"></p><p>  æ–¹æ³•åŒºä¸»è¦å­˜æ”¾çš„æ˜¯ Classï¼Œè€Œå †ä¸­ä¸»è¦å­˜æ”¾çš„æ˜¯ å®ä¾‹åŒ–çš„å¯¹è±¡</p><ul><li>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸Javaå †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚</li><li>æ–¹æ³•åŒºåœ¨JVMå¯åŠ¨çš„æ—¶å€™è¢«åˆ›å»ºï¼Œå¹¶ä¸”å®ƒçš„å®é™…çš„ç‰©ç†å†…å­˜ç©ºé—´ä¸­å’ŒJavaå †åŒºä¸€æ ·éƒ½å¯ä»¥æ˜¯ä¸è¿ç»­çš„ã€‚</li><li>æ–¹æ³•åŒºçš„å¤§å°ï¼Œè·Ÿå †ç©ºé—´ä¸€æ ·ï¼Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‰©å±•ã€‚</li><li>æ–¹æ³•åŒºçš„å¤§å°å†³å®šäº†ç³»ç»Ÿå¯ä»¥ä¿å­˜å¤šå°‘ä¸ªç±»ï¼Œå¦‚æœç³»ç»Ÿå®šä¹‰äº†å¤ªå¤šçš„ç±»ï¼Œå¯¼è‡´æ–¹æ³•åŒºæº¢å‡ºï¼Œè™šæ‹ŸæœºåŒæ ·ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºé”™è¯¯ï¼šava.lang.OutofMemoryErrorï¼šPermGen space æˆ–è€…java.lang.OutOfMemoryError:Metaspace<ul><li>åŠ è½½å¤§é‡çš„ç¬¬ä¸‰æ–¹çš„jaråŒ…</li><li>Tomcatéƒ¨ç½²çš„å·¥ç¨‹è¿‡å¤šï¼ˆ30~50ä¸ªï¼‰</li><li>å¤§é‡åŠ¨æ€çš„ç”Ÿæˆåå°„ç±»</li></ul></li><li>å…³é—­JVMå°±ä¼šé‡Šæ”¾è¿™ä¸ªåŒºåŸŸçš„å†…å­˜ã€‚</li></ul></li><li><p><strong>HotSpotä¸­æ–¹æ³•åŒºçš„æ¼”è¿›</strong></p><p>  åœ¨jdk7åŠä»¥å‰ï¼Œä¹ æƒ¯ä¸ŠæŠŠæ–¹æ³•åŒºï¼Œç§°ä¸ºæ°¸ä¹…ä»£ã€‚jdk8å¼€å§‹ï¼Œä½¿ç”¨å…ƒç©ºé—´å–ä»£äº†æ°¸ä¹…ä»£ã€‚</p><ul><li>JDK 1.8åï¼Œå…ƒç©ºé—´å­˜æ”¾åœ¨å †å¤–å†…å­˜ä¸­</li></ul><p>  æœ¬è´¨ä¸Šï¼Œæ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£å¹¶ä¸ç­‰ä»·ã€‚ä»…æ˜¯å¯¹hotspotè€Œè¨€çš„ã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹å¦‚ä½•å®ç°æ–¹æ³•åŒºï¼Œä¸åšç»Ÿä¸€è¦æ±‚ã€‚ä¾‹å¦‚ï¼šBEAJRockit &#x2F; IBM J9 ä¸­ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µã€‚</p><p>  <em>ç°åœ¨æ¥çœ‹ï¼Œå½“å¹´ä½¿ç”¨æ°¸ä¹…ä»£ï¼Œä¸æ˜¯å¥½çš„ideaã€‚å¯¼è‡´Javaç¨‹åºæ›´å®¹æ˜“oomï¼ˆè¶…è¿‡-XX:MaxPermsizeä¸Šé™ï¼‰</em></p><p>  <img src="/images/jvm_virtual_machine/chapter9/image4.png" alt="Untitled"></p><p>  è€Œåˆ°äº†JDK8ï¼Œç»ˆäºå®Œå…¨åºŸå¼ƒäº†æ°¸ä¹…ä»£çš„æ¦‚å¿µï¼Œæ”¹ç”¨ä¸JRockitã€J9ä¸€æ ·åœ¨æœ¬åœ°å†…å­˜ä¸­å®ç°çš„å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰æ¥ä»£æ›¿</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image5.png" alt="Untitled"></p><p>  å…ƒç©ºé—´çš„æœ¬è´¨å’Œæ°¸ä¹…ä»£ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹JVMè§„èŒƒä¸­æ–¹æ³•åŒºçš„å®ç°ã€‚ä¸è¿‡å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºè®¾ç½®çš„å†…å­˜ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜</p><p>  æ°¸ä¹…ä»£ã€å…ƒç©ºé—´äºŒè€…å¹¶ä¸åªæ˜¯åå­—å˜äº†ï¼Œå†…éƒ¨ç»“æ„ä¹Ÿè°ƒæ•´äº†</p><p>  æ ¹æ®ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„è§„å®šï¼Œå¦‚æœæ–¹æ³•åŒºæ— æ³•æ»¡è¶³æ–°çš„å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOOMå¼‚å¸¸  </p></li><li><p><strong>è®¾ç½®æ–¹æ³•åŒºå¤§å°ä¸OOM</strong></p><ul><li>æ–¹æ³•åŒºçš„å¤§å°ä¸å¿…æ˜¯å›ºå®šçš„ï¼ŒJVMå¯ä»¥æ ¹æ®åº”ç”¨çš„éœ€è¦åŠ¨æ€è°ƒæ•´ã€‚</li></ul></li><li><p><strong>jdk7åŠä»¥å‰</strong></p><ul><li><p>é€šè¿‡-xx:Permsizeæ¥è®¾ç½®æ°¸ä¹…ä»£åˆå§‹åˆ†é…ç©ºé—´ã€‚é»˜è®¤å€¼æ˜¯20.75M</p></li><li><p>XX:MaxPermsizeæ¥è®¾å®šæ°¸ä¹…ä»£æœ€å¤§å¯åˆ†é…ç©ºé—´ã€‚32ä½æœºå™¨é»˜è®¤æ˜¯64Mï¼Œ64ä½æœºå™¨æ¨¡å¼æ˜¯82M</p></li><li><p>å½“JVMåŠ è½½çš„ç±»ä¿¡æ¯å®¹é‡è¶…è¿‡äº†è¿™ä¸ªå€¼ï¼Œä¼šæŠ¥å¼‚å¸¸OutofMemoryError:PermGen spaceã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image6.png" alt="Untitled"></p></li><li><p><strong>JDK8ä»¥å</strong></p><p>  å…ƒæ•°æ®åŒºå¤§å°å¯ä»¥ä½¿ç”¨å‚æ•° -XX:MetaspaceSize å’Œ -XX:MaxMetaspaceSizeæŒ‡å®š</p><p>  é»˜è®¤å€¼ä¾èµ–äºå¹³å°ã€‚windowsä¸‹ï¼Œ-XX:MetaspaceSizeæ˜¯21Mï¼Œ-XX:MaxMetaspaceSizeçš„å€¼æ˜¯-1ï¼Œå³æ²¡æœ‰é™åˆ¶ã€‚</p><p>  ä¸æ°¸ä¹…ä»£ä¸åŒï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè™šæ‹Ÿæœºä¼šè€—å°½æ‰€æœ‰çš„å¯ç”¨ç³»ç»Ÿå†…å­˜ã€‚å¦‚æœå…ƒæ•°æ®åŒºå‘ç”Ÿæº¢å‡ºï¼Œè™šæ‹Ÿæœºä¸€æ ·ä¼šæŠ›å‡ºå¼‚å¸¸OutOfMemoryError:Metaspace</p><ul><li>XX:MetaspaceSizeï¼šè®¾ç½®åˆå§‹çš„å…ƒç©ºé—´å¤§å°ã€‚å¯¹äºä¸€ä¸ª64ä½çš„æœåŠ¡å™¨ç«¯JVMæ¥è¯´ï¼Œå…¶é»˜è®¤çš„-xx:MetaspaceSizeå€¼ä¸º21MBã€‚è¿™å°±æ˜¯åˆå§‹çš„é«˜æ°´ä½çº¿ï¼Œä¸€æ—¦è§¦åŠè¿™ä¸ªæ°´ä½çº¿ï¼ŒFul1GCå°†ä¼šè¢«è§¦å‘å¹¶å¸è½½æ²¡ç”¨çš„ç±»ï¼ˆå³è¿™äº›ç±»å¯¹åº”çš„ç±»åŠ è½½å™¨ä¸å†å­˜æ´»ï¼‰ç„¶åè¿™ä¸ªé«˜æ°´ä½çº¿å°†ä¼šé‡ç½®ã€‚æ–°çš„é«˜æ°´ä½çº¿çš„å€¼å–å†³äºGCåé‡Šæ”¾äº†å¤šå°‘å…ƒç©ºé—´ã€‚å¦‚æœé‡Šæ”¾çš„ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆåœ¨ä¸è¶…è¿‡MaxMetaspaceSizeæ—¶ï¼Œé€‚å½“æé«˜è¯¥å€¼ã€‚å¦‚æœé‡Šæ”¾ç©ºé—´è¿‡å¤šï¼Œåˆ™é€‚å½“é™ä½è¯¥å€¼ã€‚</li></ul><p>  å¦‚æœåˆå§‹åŒ–çš„é«˜æ°´ä½çº¿è®¾ç½®è¿‡ä½ï¼Œä¸Šè¿°é«˜æ°´ä½çº¿è°ƒæ•´æƒ…å†µä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ã€‚é€šè¿‡åƒåœ¾å›æ”¶å™¨çš„æ—¥å¿—å¯ä»¥è§‚å¯Ÿåˆ°Ful1GCå¤šæ¬¡è°ƒç”¨ã€‚ä¸ºäº†é¿å…é¢‘ç¹åœ°GCï¼Œå»ºè®®å°†-XX:MetaspaceSizeè®¾ç½®ä¸ºä¸€ä¸ªç›¸å¯¹è¾ƒé«˜çš„å€¼ã€‚</p></li></ul></li><li><p><strong>å¦‚ä½•è§£å†³è¿™äº›OOM</strong></p><ul><li>è¦è§£å†³ooMå¼‚å¸¸æˆ–heap spaceçš„å¼‚å¸¸ï¼Œä¸€èˆ¬çš„æ‰‹æ®µæ˜¯é¦–å…ˆé€šè¿‡å†…å­˜æ˜ åƒåˆ†æå·¥å…·ï¼ˆå¦‚Ec1ipse Memory Analyzerï¼‰å¯¹dumpå‡ºæ¥çš„å †è½¬å‚¨å¿«ç…§è¿›è¡Œåˆ†æï¼Œé‡ç‚¹æ˜¯ç¡®è®¤å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦æ˜¯å¿…è¦çš„ï¼Œä¹Ÿå°±æ˜¯è¦å…ˆåˆ†æ¸…æ¥šåˆ°åº•æ˜¯å‡ºç°äº†å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰è¿˜æ˜¯å†…å­˜æº¢å‡ºï¼ˆMemory Overflowï¼‰<ul><li>å†…å­˜æ³„æ¼å°±æ˜¯ æœ‰å¤§é‡çš„å¼•ç”¨æŒ‡å‘æŸäº›å¯¹è±¡ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡ä»¥åä¸ä¼šä½¿ç”¨äº†ï¼Œä½†æ˜¯å› ä¸ºå®ƒä»¬è¿˜å’ŒGC ROOTæœ‰å…³è”ï¼Œæ‰€ä»¥å¯¼è‡´ä»¥åè¿™äº›å¯¹è±¡ä¹Ÿä¸ä¼šè¢«å›æ”¶ï¼Œè¿™å°±æ˜¯å†…å­˜æ³„æ¼çš„é—®é¢˜</li></ul></li><li>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œå¯è¿›ä¸€æ­¥é€šè¿‡å·¥å…·æŸ¥çœ‹æ³„æ¼å¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾ã€‚äºæ˜¯å°±èƒ½æ‰¾åˆ°æ³„æ¼å¯¹è±¡æ˜¯é€šè¿‡æ€æ ·çš„è·¯å¾„ä¸GCRootsç›¸å…³è”å¹¶å¯¼è‡´åƒåœ¾æ”¶é›†å™¨æ— æ³•è‡ªåŠ¨å›æ”¶å®ƒä»¬çš„ã€‚æŒæ¡äº†æ³„æ¼å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ï¼Œä»¥åŠGCRootså¼•ç”¨é“¾çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥æ¯”è¾ƒå‡†ç¡®åœ°å®šä½å‡ºæ³„æ¼ä»£ç çš„ä½ç½®ã€‚</li><li>å¦‚æœä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œæ¢å¥è¯è¯´å°±æ˜¯å†…å­˜ä¸­çš„å¯¹è±¡ç¡®å®éƒ½è¿˜å¿…é¡»å­˜æ´»ç€ï¼Œé‚£å°±åº”å½“æ£€æŸ¥è™šæ‹Ÿæœºçš„å †å‚æ•°ï¼ˆ-Xmxä¸-Xmsï¼‰ï¼Œä¸æœºå™¨ç‰©ç†å†…å­˜å¯¹æ¯”çœ‹æ˜¯å¦è¿˜å¯ä»¥è°ƒå¤§ï¼Œä»ä»£ç ä¸Šæ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¿‡é•¿ã€æŒæœ‰çŠ¶æ€æ—¶é—´è¿‡é•¿çš„æƒ…å†µï¼Œå°è¯•å‡å°‘ç¨‹åºè¿è¡ŒæœŸçš„å†…å­˜æ¶ˆè€—ã€‚</li></ul></li></ul><h3 id="2-æ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„"><a href="#2-æ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„" class="headerlink" title="2.æ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„"></a>2.<strong>æ–¹æ³•åŒºçš„å†…éƒ¨ç»“æ„</strong></h3><ul><li><p>å…³ç³»å›¾</p><p>  ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¹¦ä¸­å¯¹æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰å­˜å‚¨å†…å®¹æè¿°å¦‚ä¸‹ï¼šå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰ã€‚</p></li></ul><p><img src="/images/jvm_virtual_machine/chapter9/image7.png" alt="Untitled"></p><p><img src="/images/jvm_virtual_machine/chapter9/image8.png" alt="Untitled"></p><ul><li><p><strong>ç±»å‹ä¿¡æ¯</strong></p><p>  å¯¹æ¯ä¸ªåŠ è½½çš„ç±»å‹ï¼ˆç±»classã€æ¥å£interfaceã€æšä¸¾enumã€æ³¨è§£annotationï¼‰ï¼ŒJVmå¿…é¡»åœ¨æ–¹æ³•åŒºä¸­å­˜å‚¨ä»¥ä¸‹ç±»å‹ä¿¡æ¯ï¼š</p><ul><li>è¿™ä¸ªç±»å‹çš„å®Œæ•´æœ‰æ•ˆåç§°ï¼ˆå…¨å&#x3D;åŒ…å.ç±»åï¼‰</li><li>è¿™ä¸ªç±»å‹ç›´æ¥çˆ¶ç±»çš„å®Œæ•´æœ‰æ•ˆåï¼ˆå¯¹äºinterfaceæˆ–æ˜¯java.lang.objectï¼Œéƒ½æ²¡æœ‰çˆ¶ç±»ï¼‰</li><li>è¿™ä¸ªç±»å‹çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œabstractï¼Œfinalçš„æŸä¸ªå­é›†ï¼‰</li><li>è¿™ä¸ªç±»å‹ç›´æ¥æ¥å£çš„ä¸€ä¸ªæœ‰åºåˆ—è¡¨</li></ul></li><li><p><strong>åŸŸä¿¡æ¯</strong></p><p>  JVMå¿…é¡»åœ¨æ–¹æ³•åŒºä¸­ä¿å­˜ç±»å‹çš„æ‰€æœ‰åŸŸçš„ç›¸å…³ä¿¡æ¯ä»¥åŠåŸŸçš„å£°æ˜é¡ºåºã€‚</p><p>  åŸŸçš„ç›¸å…³ä¿¡æ¯åŒ…æ‹¬ï¼šåŸŸåç§°ã€åŸŸç±»å‹ã€åŸŸä¿®é¥°ç¬¦ï¼ˆpublicï¼Œprivateï¼Œprotectedï¼Œstaticï¼Œfinalï¼Œvolatileï¼Œtransientçš„æŸä¸ªå­é›†ï¼‰</p></li><li><p><strong>æ–¹æ³•ï¼ˆMethodï¼‰ä¿¡æ¯</strong></p><p>  JVMå¿…é¡»ä¿å­˜æ‰€æœ‰æ–¹æ³•çš„ä»¥ä¸‹ä¿¡æ¯ï¼ŒåŒåŸŸä¿¡æ¯ä¸€æ ·åŒ…æ‹¬å£°æ˜é¡ºåºï¼š</p><ul><li>æ–¹æ³•åç§°</li><li>æ–¹æ³•çš„è¿”å›ç±»å‹ï¼ˆæˆ–voidï¼‰</li><li>æ–¹æ³•å‚æ•°çš„æ•°é‡å’Œç±»å‹ï¼ˆæŒ‰é¡ºåºï¼‰</li><li>æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼ˆpublicï¼Œprivateï¼Œprotectedï¼Œstaticï¼Œfinalï¼Œsynchronizedï¼Œnativeï¼Œabstractçš„ä¸€ä¸ªå­é›†ï¼‰</li><li>æ–¹æ³•çš„å­—èŠ‚ç ï¼ˆbytecodesï¼‰ã€æ“ä½œæ•°æ ˆã€å±€éƒ¨å˜é‡è¡¨åŠå¤§å°ï¼ˆabstractå’Œnativeæ–¹æ³•é™¤å¤–ï¼‰</li><li>å¼‚å¸¸è¡¨ï¼ˆabstractå’Œnativeæ–¹æ³•é™¤å¤–ï¼‰</li></ul><blockquote><p>æ¯ä¸ªå¼‚å¸¸å¤„ç†çš„å¼€å§‹ä½ç½®ã€ç»“æŸä½ç½®ã€ä»£ç å¤„ç†åœ¨ç¨‹åºè®¡æ•°å™¨ä¸­çš„åç§»åœ°å€ã€è¢«æ•è·çš„å¼‚å¸¸ç±»çš„å¸¸é‡æ± ç´¢å¼•</p></blockquote></li><li><p><strong>non-finalçš„ç±»å˜é‡</strong></p><p>  é™æ€å˜é‡å’Œç±»å…³è”åœ¨ä¸€èµ·ï¼Œéšç€ç±»çš„åŠ è½½è€ŒåŠ è½½ï¼Œä»–ä»¬æˆä¸ºç±»æ•°æ®åœ¨é€»è¾‘ä¸Šçš„ä¸€éƒ¨åˆ†</p><p>  ç±»å˜é‡è¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ï¼Œå³ä½¿æ²¡æœ‰ç±»å®ä¾‹æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥è®¿é—®å®ƒ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.area;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * non-finalçš„ç±»å˜é‡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-02-12 18:42:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">        order.hello();</span><br><span class="line">        System.out.println(order.count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// hello!</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>  å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œå³ä½¿æˆ‘ä»¬æŠŠorderè®¾ç½®ä¸ºnullï¼Œä¹Ÿä¸ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸</p></li><li><p><strong>å…¨å±€å¸¸é‡ï¼šstatic final</strong></p><ol><li>å…¨å±€å¸¸é‡å°±æ˜¯ä½¿ç”¨ static final è¿›è¡Œä¿®é¥°</li><li>è¢«å£°æ˜ä¸ºfinalçš„ç±»å˜é‡çš„å¤„ç†æ–¹æ³•åˆ™ä¸åŒï¼Œæ¯ä¸ªå…¨å±€å¸¸é‡åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šè¢«åˆ†é…äº†ã€‚</li></ol><p>  æŸ¥çœ‹ä¸Šé¢ä»£ç ï¼Œè¿™éƒ¨åˆ†çš„å­—èŠ‚ç æŒ‡ä»¤</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> count;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> number;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: <span class="type">int</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>  å¯ä»¥å‘ç° staitcå’ŒfinalåŒæ—¶ä¿®é¥°çš„number çš„å€¼åœ¨ç¼–è¯‘ä¸Šçš„æ—¶å€™å·²ç»å†™æ­»åœ¨å­—èŠ‚ç æ–‡ä»¶ä¸­äº†ã€‚****</p></li></ul><h3 id="3-å¸¸é‡æ± "><a href="#3-å¸¸é‡æ± " class="headerlink" title="3.å¸¸é‡æ± "></a>3.<strong>å¸¸é‡æ± </strong></h3><ul><li><p><strong>å¸¸é‡æ± æ¦‚è¿°</strong></p><ul><li><p><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html</a></p><p>  <img src="/images/jvm_virtual_machine/chapter9/image9.png" alt="Untitled"></p><ul><li>æ–¹æ³•åŒºï¼Œå†…éƒ¨åŒ…å«äº†è¿è¡Œæ—¶å¸¸é‡æ± </li><li>å­—èŠ‚ç æ–‡ä»¶ï¼Œå†…éƒ¨åŒ…å«äº†å¸¸é‡æ± </li><li>è¦å¼„æ¸…æ¥šæ–¹æ³•åŒºï¼Œéœ€è¦ç†è§£æ¸…æ¥šC1assFileï¼Œå› ä¸ºåŠ è½½ç±»çš„ä¿¡æ¯éƒ½åœ¨æ–¹æ³•åŒºã€‚</li><li>è¦å¼„æ¸…æ¥šæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œéœ€è¦ç†è§£æ¸…æ¥šclassFileä¸­çš„å¸¸é‡æ± ã€‚</li></ul></li></ul></li><li><p><strong>å¸¸é‡æ± </strong></p><p>  ä¸€ä¸ªæœ‰æ•ˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­é™¤äº†åŒ…å«ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ã€å­—æ®µã€æ–¹æ³•ä»¥åŠæ¥å£ç­‰æè¿°ç¬¦ä¿¡æ¯å¤–ï¼Œè¿˜åŒ…å«ä¸€é¡¹ä¿¡æ¯å°±æ˜¯å¸¸é‡æ± è¡¨ï¼ˆConstant Pool Tableï¼‰ï¼ŒåŒ…æ‹¬å„ç§å­—é¢é‡å’Œå¯¹ç±»å‹ã€åŸŸå’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image10.png" alt="Untitled"></p></li><li><p><strong>ä¸ºä»€ä¹ˆéœ€è¦å¸¸é‡æ± </strong></p><p>  ä¸€ä¸ªjavaæºæ–‡ä»¶ä¸­çš„ç±»ã€æ¥å£ï¼Œç¼–è¯‘åäº§ç”Ÿä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ã€‚è€ŒJavaä¸­çš„å­—èŠ‚ç éœ€è¦æ•°æ®æ”¯æŒï¼Œé€šå¸¸è¿™ç§æ•°æ®ä¼šå¾ˆå¤§ä»¥è‡³äºä¸èƒ½ç›´æ¥å­˜åˆ°å­—èŠ‚ç é‡Œï¼Œæ¢å¦ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥å­˜åˆ°å¸¸é‡æ± ï¼Œè¿™ä¸ªå­—èŠ‚ç åŒ…å«äº†æŒ‡å‘å¸¸é‡æ± çš„å¼•ç”¨ã€‚råœ¨åŠ¨æ€é“¾æ¥çš„æ—¶å€™ä¼šç”¨åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œä¹‹å‰æœ‰ä»‹ç»ã€‚</p><p>  æ¯”å¦‚ï¼šå¦‚ä¸‹çš„ä»£ç ï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>è™½ç„¶ä¸Šè¿°ä»£ç åªæœ‰194å­—èŠ‚ï¼Œä½†æ˜¯é‡Œé¢å´ä½¿ç”¨äº†Stringã€Systemã€PrintStreamåŠObjectç­‰ç»“æ„ã€‚</li><li>æ¯”å¦‚è¯´æˆ‘ä»¬è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰6ä¸ªåœ°æ–¹ç”¨åˆ°äº†â€helloâ€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœä¸ç”¨å¸¸é‡æ± ï¼Œå°±éœ€è¦åœ¨6ä¸ªåœ°æ–¹å…¨å†™ä¸€éï¼Œé€ æˆè‡ƒè‚¿ã€‚æˆ‘ä»¬å¯ä»¥å°†â€helloâ€ç­‰æ‰€éœ€ç”¨åˆ°çš„ç»“æ„ä¿¡æ¯è®°å½•åœ¨å¸¸é‡æ± ä¸­ï¼Œå¹¶é€šè¿‡<strong>å¼•ç”¨çš„æ–¹å¼</strong>ï¼Œæ¥åŠ è½½ã€è°ƒç”¨æ‰€éœ€çš„ç»“æ„</li><li>è¿™é‡Œçš„ä»£ç é‡å…¶å®å¾ˆå°‘äº†ï¼Œå¦‚æœä»£ç å¤šçš„è¯ï¼Œå¼•ç”¨çš„ç»“æ„å°†ä¼šæ›´å¤šï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°å¸¸é‡æ± äº†ã€‚</li></ol></li><li><p><strong>å¸¸é‡æ± ä¸­æœ‰å•¥ï¼Ÿ</strong></p><ol><li>æ•°é‡å€¼</li><li>å­—ç¬¦ä¸²å€¼</li><li>ç±»å¼•ç”¨</li><li>å­—æ®µå¼•ç”¨</li><li>æ–¹æ³•å¼•ç”¨</li></ol><p>  ä¾‹å¦‚ä¸‹é¢è¿™æ®µä»£ç </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.area;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaTest2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å°†ä¼šè¢«ç¿»è¯‘æˆå¦‚ä¸‹å­—èŠ‚ç </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/lang/Object</span></span><br><span class="line"><span class="number">3</span>: dup</span><br><span class="line"><span class="number">4</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line"><span class="number">7</span>: astore_1</span><br><span class="line"><span class="number">8</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å¸¸é‡æ± æ€»ç»“</strong></p><p>  å¸¸é‡æ± ã€å¯ä»¥çœ‹åšæ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ç­‰ç±»å‹ã€‚</p></li></ul><h3 id="4-è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#4-è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="4.è¿è¡Œæ—¶å¸¸é‡æ± "></a>4.<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong></h3><ul><li><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong></p><ol><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚</li><li>å¸¸é‡æ± è¡¨ï¼ˆConstant Pool Tableï¼‰æ˜¯Classå­—èŠ‚ç æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ä¸ç¬¦å·å¼•ç”¨ï¼Œ<strong>è¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­</strong>ã€‚ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± å°±æ˜¯å¸¸é‡æ± åœ¨ç¨‹åºè¿è¡Œæ—¶çš„ç§°å‘¼ï¼‰</li><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œåœ¨åŠ è½½ç±»å’Œæ¥å£åˆ°è™šæ‹Ÿæœºåï¼Œå°±ä¼šåˆ›å»ºå¯¹åº”çš„è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li><li>JVMä¸ºæ¯ä¸ªå·²åŠ è½½çš„ç±»å‹ï¼ˆç±»æˆ–æ¥å£ï¼‰éƒ½ç»´æŠ¤ä¸€ä¸ªå¸¸é‡æ± ã€‚æ± ä¸­çš„æ•°æ®é¡¹åƒæ•°ç»„é¡¹ä¸€æ ·ï¼Œæ˜¯é€šè¿‡ç´¢å¼•è®¿é—®çš„ã€‚</li><li>è¿è¡Œæ—¶å¸¸é‡æ± ä¸­åŒ…å«å¤šç§ä¸åŒçš„å¸¸é‡ï¼ŒåŒ…æ‹¬ç¼–è¯‘æœŸå°±å·²ç»æ˜ç¡®çš„æ•°å€¼å­—é¢é‡ï¼Œä¹ŸåŒ…æ‹¬åˆ°è¿è¡ŒæœŸè§£æåæ‰èƒ½å¤Ÿè·å¾—çš„æ–¹æ³•æˆ–è€…å­—æ®µå¼•ç”¨ã€‚<strong>æ­¤æ—¶ä¸å†æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·åœ°å€äº†ï¼Œè¿™é‡Œæ¢ä¸ºçœŸå®åœ°å€</strong>ã€‚<ul><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œç›¸å¯¹äºClassæ–‡ä»¶å¸¸é‡æ± çš„å¦ä¸€é‡è¦ç‰¹å¾æ˜¯ï¼šå…·å¤‡åŠ¨æ€æ€§ã€‚</li></ul></li><li>è¿è¡Œæ—¶å¸¸é‡æ± ç±»ä¼¼äºä¼ ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­çš„ç¬¦å·è¡¨ï¼ˆsymbol tableï¼‰ï¼Œä½†æ˜¯å®ƒæ‰€åŒ…å«çš„æ•°æ®å´æ¯”ç¬¦å·è¡¨è¦æ›´åŠ ä¸°å¯Œä¸€äº›ã€‚</li><li>å½“åˆ›å»ºç±»æˆ–æ¥å£çš„è¿è¡Œæ—¶å¸¸é‡æ± æ—¶ï¼Œå¦‚æœæ„é€ è¿è¡Œæ—¶å¸¸é‡æ± æ‰€éœ€çš„å†…å­˜ç©ºé—´è¶…è¿‡äº†æ–¹æ³•åŒºæ‰€èƒ½æä¾›çš„æœ€å¤§å€¼ï¼Œåˆ™JVMä¼šæŠ›OutofMemoryErrorå¼‚å¸¸ã€‚</li></ol></li><li><p><strong>æ–¹æ³•åŒºçš„ä½¿ç”¨ä¸¾ä¾‹</strong></p><ul><li><p>ä»£ç </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.area;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">500</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> x / y;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">        System.out.println(a + b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å­—èŠ‚ç </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.peppa.area.MethodAreaDemo</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">5.</span>#<span class="number">25</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">26.</span>#<span class="number">27</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">3</span> = Methodref          #<span class="number">28.</span>#<span class="number">29</span>        <span class="comment">// java/io/PrintStream.println:(I)V</span></span><br><span class="line">   #<span class="number">4</span> = Class              #<span class="number">30</span>            <span class="comment">// com/peppa/area/MethodAreaDemo</span></span><br><span class="line">   #<span class="number">5</span> = Class              #<span class="number">31</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">   #<span class="number">6</span> = Utf8               &lt;init&gt;</span><br><span class="line">   #<span class="number">7</span> = Utf8               ()V</span><br><span class="line">   #<span class="number">8</span> = Utf8               Code</span><br><span class="line">   #<span class="number">9</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">10</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">11</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">12</span> = Utf8               Lcom/peppa/area/MethodAreaDemo;</span><br><span class="line">  #<span class="number">13</span> = Utf8               main</span><br><span class="line">  #<span class="number">14</span> = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #<span class="number">15</span> = Utf8               args</span><br><span class="line">  #<span class="number">16</span> = Utf8               [Ljava/lang/String;</span><br><span class="line">  #<span class="number">17</span> = Utf8               x</span><br><span class="line">  #<span class="number">18</span> = Utf8               I</span><br><span class="line">  #<span class="number">19</span> = Utf8               y</span><br><span class="line">  #<span class="number">20</span> = Utf8               a</span><br><span class="line">  #<span class="number">21</span> = Utf8               b</span><br><span class="line">  #<span class="number">22</span> = Utf8               MethodParameters</span><br><span class="line">  #<span class="number">23</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">24</span> = Utf8               MethodAreaDemo.java</span><br><span class="line">  #<span class="number">25</span> = NameAndType        #<span class="number">6</span>:#<span class="number">7</span>          <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">26</span> = Class              #<span class="number">32</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">27</span> = NameAndType        #<span class="number">33</span>:#<span class="number">34</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">28</span> = Class              #<span class="number">35</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">29</span> = NameAndType        #<span class="number">36</span>:#<span class="number">37</span>        <span class="comment">// println:(I)V</span></span><br><span class="line">  #<span class="number">30</span> = Utf8               com/peppa/area/MethodAreaDemo</span><br><span class="line">  #<span class="number">31</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">32</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">33</span> = Utf8               out</span><br><span class="line">  #<span class="number">34</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">35</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">36</span> = Utf8               println</span><br><span class="line">  #<span class="number">37</span> = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.peppa.area.MethodAreaDemo();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/peppa/area/MethodAreaDemo;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">3</span>, locals=<span class="number">5</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: sipush        <span class="number">500</span></span><br><span class="line">         <span class="number">3</span>: istore_1</span><br><span class="line">         <span class="number">4</span>: bipush        <span class="number">100</span></span><br><span class="line">         <span class="number">6</span>: istore_2</span><br><span class="line">         <span class="number">7</span>: iload_1</span><br><span class="line">         <span class="number">8</span>: iload_2</span><br><span class="line">         <span class="number">9</span>: idiv</span><br><span class="line">        <span class="number">10</span>: istore_3</span><br><span class="line">        <span class="number">11</span>: bipush        <span class="number">50</span></span><br><span class="line">        <span class="number">13</span>: istore        <span class="number">4</span></span><br><span class="line">        <span class="number">15</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">18</span>: iload_3</span><br><span class="line">        <span class="number">19</span>: iload         <span class="number">4</span></span><br><span class="line">        <span class="number">21</span>: iadd</span><br><span class="line">        <span class="number">22</span>: invokevirtual #<span class="number">3</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line">        <span class="number">25</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">5</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">6</span>: <span class="number">4</span></span><br><span class="line">        line <span class="number">7</span>: <span class="number">7</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">11</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">15</span></span><br><span class="line">        line <span class="number">10</span>: <span class="number">25</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">26</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">4</span>      <span class="number">22</span>     <span class="number">1</span>     x   I</span><br><span class="line">            <span class="number">7</span>      <span class="number">19</span>     <span class="number">2</span>     y   I</span><br><span class="line">           <span class="number">11</span>      <span class="number">15</span>     <span class="number">3</span>     a   I</span><br><span class="line">           <span class="number">15</span>      <span class="number">11</span>     <span class="number">4</span>     b   I</span><br><span class="line">    MethodParameters:</span><br><span class="line">      Name                           Flags</span><br><span class="line">      args</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å›¾è§£å­—èŠ‚ç æŒ‡ä»¤æ‰§è¡Œæµç¨‹</strong></p><p>  <img src="/images/jvm_virtual_machine/chapter9/image11.png" alt="Untitled"></p><p>  é¦–å…ˆç°å°†æ“ä½œæ•°500æ”¾å…¥åˆ°æ“ä½œæ•°æ ˆä¸­</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image12.png" alt="Untitled"></p><p>  ç„¶åå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image13.png" alt="Untitled"></p><p>  ç„¶åé‡å¤ä¸€æ¬¡ï¼ŒæŠŠ100æ”¾å…¥å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œæœ€åå†å°†å˜é‡è¡¨ä¸­çš„500 å’Œ 100 å–å‡ºï¼Œè¿›è¡Œæ“ä½œ</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image14.png" alt="Untitled"></p><p>  å°†500 å’Œ 100 è¿›è¡Œä¸€ä¸ªé™¤æ³•è¿ç®—ï¼Œåœ¨æŠŠç»“æœå…¥æ ˆ</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image15.png" alt="Untitled"></p><p>  åœ¨æœ€åå°±æ˜¯è¾“å‡ºæµï¼Œéœ€è¦è°ƒç”¨è¿è¡Œæ—¶å¸¸é‡æ± çš„å¸¸é‡</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image16.png" alt="Untitled"></p><p>  æœ€åè°ƒç”¨invokevirtualï¼ˆè™šæ–¹æ³•è°ƒç”¨ï¼‰ï¼Œç„¶åè¿”å›</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image17.png" alt="Untitled"></p><p>  è¿”å›æ—¶</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image18.png" alt="Untitled"></p><p>  ç¨‹åºè®¡æ•°å™¨å§‹ç»ˆè®¡ç®—çš„éƒ½æ˜¯å½“å‰ä»£ç è¿è¡Œçš„ä½ç½®ï¼Œç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿è®°å½• æ–¹æ³•è°ƒç”¨åèƒ½å¤Ÿæ­£å¸¸è¿”å›ï¼Œæˆ–è€…æ˜¯è¿›è¡Œäº†CPUåˆ‡æ¢åï¼Œä¹Ÿèƒ½å›æ¥åˆ°åŸæ¥çš„ä»£ç è¿›è¡Œæ‰§è¡Œã€‚</p><p>  <strong>ç¬¦å·å¼•ç”¨ â€“&gt; ç›´æ¥å¼•ç”¨ï¼š</strong></p><ol><li>ä¸Šé¢ä»£ç è°ƒç”¨ System.out.println() æ–¹æ³•æ—¶ï¼Œé¦–å…ˆéœ€è¦çœ‹çœ‹ System ç±»æœ‰æ²¡æœ‰åŠ è½½ï¼Œå†çœ‹çœ‹ PrintStream ç±»æœ‰æ²¡æœ‰åŠ è½½</li><li>å¦‚æœæ²¡æœ‰åŠ è½½ï¼Œåˆ™æ‰§è¡ŒåŠ è½½ï¼Œæ‰§è¡Œæ—¶ï¼Œå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨ï¼ˆå­—é¢é‡ï¼‰è½¬æ¢ä¸ºè¿è¡Œæ—¶å¸¸é‡æ± çš„ç›´æ¥å¼•ç”¨ï¼ˆçœŸæ­£çš„åœ°å€å€¼ï¼‰</li></ol></li></ul><h3 id="5-æ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚"><a href="#5-æ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚" class="headerlink" title="5.æ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚"></a>5.<strong>æ–¹æ³•åŒºçš„æ¼”è¿›ç»†èŠ‚</strong></h3><ul><li><p><strong>æ°¸ä¹…ä»£æ¼”è¿›è¿‡ç¨‹</strong></p><ul><li>é¦–å…ˆæ˜ç¡®ï¼šåªæœ‰Hotspotæ‰æœ‰æ°¸ä¹…ä»£ã€‚BEA JRockitã€IBMJ9ç­‰æ¥è¯´ï¼Œæ˜¯ä¸å­˜åœ¨æ°¸ä¹…ä»£çš„æ¦‚å¿µçš„ã€‚åŸåˆ™ä¸Šå¦‚ä½•å®ç°æ–¹æ³•åŒºå±äºè™šæ‹Ÿæœºå®ç°ç»†èŠ‚ï¼Œä¸å—ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ç®¡æŸï¼Œå¹¶ä¸è¦æ±‚ç»Ÿä¸€ã€‚</li></ul></li><li><p>Hotspotä¸­æ–¹æ³•åŒºçš„å˜åŒ–ï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JDK1<span class="number">.6</span>åŠä»¥å‰  æœ‰æ°¸ä¹…ä»£ï¼ˆpermanent generationï¼‰ï¼Œé™æ€å˜é‡å­˜å‚¨åœ¨æ°¸ä¹…ä»£ä¸Š</span><br><span class="line">JDK1<span class="number">.7</span>       æœ‰æ°¸ä¹…ä»£ï¼Œä½†å·²ç»é€æ­¥ â€œå»æ°¸ä¹…ä»£â€ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œé™æ€å˜é‡ç§»é™¤ï¼Œä¿å­˜åœ¨å †ä¸­</span><br><span class="line">JDK1<span class="number">.8</span>       æ— æ°¸ä¹…ä»£ï¼Œç±»å‹ä¿¡æ¯ï¼Œå­—æ®µï¼Œæ–¹æ³•ï¼Œå¸¸é‡ä¿å­˜åœ¨æœ¬åœ°å†…å­˜çš„å…ƒç©ºé—´ï¼Œä½†å­—ç¬¦ä¸²å¸¸é‡æ± ã€é™æ€å˜é‡ä»ç„¶åœ¨å †ä¸­ã€‚</span><br></pre></td></tr></table></figure></li><li><p><strong>JDK6</strong></p><p>  æ–¹æ³•åŒºç”±æ°¸ä¹…ä»£å®ç°ï¼Œä½¿ç”¨ JVM è™šæ‹Ÿæœºå†…å­˜ï¼ˆè™šæ‹Ÿçš„å†…å­˜ï¼‰</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image19.png" alt="Untitled"></p></li><li><p><strong>JDK7</strong></p><p>  æ–¹æ³•åŒºç”±æ°¸ä¹…ä»£å®ç°ï¼Œä½¿ç”¨ JVM è™šæ‹Ÿæœºå†…å­˜</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image20.png" alt="Untitled"></p></li><li><p>JDK8</p><p>  å…ƒç©ºé—´å¤§å°åªå—ç‰©ç†å†…å­˜å½±å“</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image21.png" alt="Untitled"></p></li><li><p><strong>æ°¸ä¹…ä»£ä¸ºä»€ä¹ˆè¦è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ</strong></p><blockquote><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://openjdk.java.net/jeps/122">JEP 122: Remove the Permanent Generation (java.net)</a></p></blockquote><ul><li>éšç€Java8çš„åˆ°æ¥ï¼ŒHotSpot VMä¸­å†ä¹Ÿè§ä¸åˆ°æ°¸ä¹…ä»£äº†ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ä¹Ÿæ¶ˆå¤±äº†ã€‚è¿™äº›æ•°æ®è¢«ç§»åˆ°äº†ä¸€ä¸ªä¸å †ä¸ç›¸è¿çš„æœ¬åœ°å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸå«åšå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‚</li><li>ç”±äºç±»çš„å…ƒæ•°æ®åˆ†é…åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œå…ƒç©ºé—´çš„æœ€å¤§å¯åˆ†é…ç©ºé—´å°±æ˜¯ç³»ç»Ÿå¯ç”¨å†…å­˜ç©ºé—´ã€‚</li><li>è¿™é¡¹æ”¹åŠ¨æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼ŒåŸå› æœ‰ï¼š<ol><li>ä¸ºæ°¸ä¹…ä»£è®¾ç½®ç©ºé—´å¤§å°æ˜¯å¾ˆéš¾ç¡®å®šçš„ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¦‚æœåŠ¨æ€åŠ è½½ç±»è¿‡å¤šï¼Œå®¹æ˜“äº§ç”ŸPermåŒºçš„OOMã€‚æ¯”å¦‚æŸä¸ªå®é™…Webå·¥ç¨‹ä¸­ï¼Œå› ä¸ºåŠŸèƒ½ç‚¹æ¯”è¾ƒå¤šï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè¦ä¸æ–­åŠ¨æ€åŠ è½½å¾ˆå¤šç±»ï¼Œç»å¸¸å‡ºç°è‡´å‘½é”™è¯¯ã€‚<code>Exception in thread &#39;dubbo client x.x connector&#39; java.lang.OutOfMemoryError:PermGen space</code>è€Œå…ƒç©ºé—´å’Œæ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚ å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç©ºé—´çš„å¤§å°ä»…å—æœ¬åœ°å†…å­˜é™åˆ¶ã€‚</li><li>å¯¹æ°¸ä¹…ä»£è¿›è¡Œè°ƒä¼˜æ˜¯å¾ˆå›°éš¾çš„ã€‚æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šå¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ç”¨çš„ç±»å‹ï¼Œæ–¹æ³•åŒºçš„è°ƒä¼˜ä¸»è¦æ˜¯ä¸ºäº†é™ä½<strong>Full GC</strong><ol><li>æœ‰äº›äººè®¤ä¸ºæ–¹æ³•åŒºï¼ˆå¦‚HotSpotè™šæ‹Ÿæœºä¸­çš„å…ƒç©ºé—´æˆ–è€…æ°¸ä¹…ä»£ï¼‰æ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†è¡Œä¸ºçš„ï¼Œå…¶å®ä¸ç„¶ã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹æ–¹æ³•åŒºçš„çº¦æŸæ˜¯éå¸¸å®½æ¾çš„ï¼Œæåˆ°è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºåœ¨æ–¹æ³•åŒºä¸­å®ç°åƒåœ¾æ”¶é›†ã€‚äº‹å®ä¸Šä¹Ÿç¡®å®æœ‰æœªå®ç°æˆ–æœªèƒ½å®Œæ•´å®ç°æ–¹æ³•åŒºç±»å‹å¸è½½çš„æ”¶é›†å™¨å­˜åœ¨ï¼ˆå¦‚JDK11æ—¶æœŸçš„ZGCæ”¶é›†å™¨å°±ä¸æ”¯æŒç±»å¸è½½ï¼‰ã€‚</li><li>ä¸€èˆ¬æ¥è¯´è¿™ä¸ªåŒºåŸŸçš„å›æ”¶æ•ˆæœæ¯”è¾ƒéš¾ä»¤äººæ»¡æ„ï¼Œå°¤å…¶æ˜¯ç±»å‹çš„å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»**ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶æœ‰æ—¶åˆç¡®å®æ˜¯å¿…è¦çš„ã€‚ä»¥å‰Sunå…¬å¸çš„Bugåˆ—è¡¨ä¸­ï¼Œæ›¾å‡ºç°è¿‡çš„è‹¥å¹²ä¸ªä¸¥é‡çš„Bugå°±æ˜¯ç”±äºä½ç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºå¯¹æ­¤åŒºåŸŸæœªå®Œå…¨å›æ”¶è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li></ol></li></ol></li></ul></li><li><p><strong>å­—ç¬¦ä¸²å¸¸é‡æ±  StringTable ä¸ºä»€ä¹ˆè¦è°ƒæ•´ä½ç½®ï¼Ÿ</strong></p><ul><li>JDK7ä¸­å°†StringTableæ”¾åˆ°äº†å †ç©ºé—´ä¸­ã€‚å› ä¸ºæ°¸ä¹…ä»£çš„å›æ”¶æ•ˆç‡å¾ˆä½ï¼Œåœ¨Full GCçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œæ°¸ä¹…ä»£çš„åƒåœ¾å›æ”¶ï¼Œè€ŒFull GCæ˜¯è€å¹´ä»£çš„ç©ºé—´ä¸è¶³ã€æ°¸ä¹…ä»£ä¸è¶³æ—¶æ‰ä¼šè§¦å‘ã€‚</li><li>è¿™å°±å¯¼è‡´StringTableå›æ”¶æ•ˆç‡ä¸é«˜ï¼Œè€Œæˆ‘ä»¬å¼€å‘ä¸­ä¼šæœ‰å¤§é‡çš„å­—ç¬¦ä¸²è¢«åˆ›å»ºï¼Œå›æ”¶æ•ˆç‡ä½ï¼Œå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜ä¸è¶³ã€‚æ”¾åˆ°å †é‡Œï¼Œèƒ½åŠæ—¶å›æ”¶å†…å­˜ã€‚</li></ul></li><li><p><strong>æ–¹æ³•åŒºçš„åƒåœ¾å›æ”¶</strong></p><ul><li><p>æœ‰äº›äººè®¤ä¸ºæ–¹æ³•åŒºï¼ˆå¦‚Hotspotè™šæ‹Ÿæœºä¸­çš„å…ƒç©ºé—´æˆ–è€…æ°¸ä¹…ä»£ï¼‰æ˜¯æ²¡æœ‰åƒåœ¾æ”¶é›†è¡Œä¸ºçš„ï¼Œå…¶å®ä¸ç„¶ã€‚ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹å¯¹æ–¹æ³•åŒºçš„çº¦æŸæ˜¯éå¸¸å®½æ¾çš„ï¼Œæåˆ°è¿‡å¯ä»¥ä¸è¦æ±‚è™šæ‹Ÿæœºåœ¨æ–¹æ³•åŒºä¸­å®ç°åƒåœ¾æ”¶é›†ã€‚äº‹å®ä¸Šä¹Ÿç¡®å®æœ‰æœªå®ç°æˆ–æœªèƒ½å®Œæ•´å®ç°æ–¹æ³•åŒºç±»å‹å¸è½½çš„æ”¶é›†å™¨å­˜åœ¨ï¼ˆå¦‚JDK11æ—¶æœŸçš„zGCæ”¶é›†å™¨å°±ä¸æ”¯æŒç±»å¸è½½ï¼‰ã€‚</p></li><li><p>ä¸€èˆ¬æ¥è¯´è¿™ä¸ªåŒºåŸŸçš„å›æ”¶æ•ˆæœæ¯”è¾ƒéš¾ä»¤äººæ»¡æ„ï¼Œå°¤å…¶æ˜¯ç±»å‹çš„å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†åŒºåŸŸçš„å›æ”¶æœ‰æ—¶åˆç¡®å®æ˜¯å¿…è¦çš„ã€‚ä»¥å‰sunå…¬å¸çš„Bugåˆ—è¡¨ä¸­ï¼Œæ›¾å‡ºç°è¿‡çš„è‹¥å¹²ä¸ªä¸¥é‡çš„Bugå°±æ˜¯ç”±äºä½ç‰ˆæœ¬çš„HotSpotè™šæ‹Ÿæœºå¯¹æ­¤åŒºåŸŸæœªå®Œå…¨å›æ”¶è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p></li><li><p>æ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ä¸»è¦å›æ”¶ä¸¤éƒ¨åˆ†å†…å®¹ï¼šå¸¸é‡æ± ä¸­åºŸå¼ƒçš„å¸¸é‡å’Œä¸å†ä½¿ç”¨çš„ç±»å‹ã€‚</p></li><li><p>å…ˆæ¥è¯´è¯´æ–¹æ³•åŒºå†…å¸¸é‡æ± ä¹‹ä¸­ä¸»è¦å­˜æ”¾çš„ä¸¤å¤§ç±»å¸¸é‡ï¼š<strong>å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</strong>ã€‚å­—é¢é‡æ¯”è¾ƒæ¥è¿‘Javaè¯­è¨€å±‚æ¬¡çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰ã€‚è€Œç¬¦å·å¼•ç”¨åˆ™å±äºç¼–è¯‘åŸç†æ–¹é¢çš„æ¦‚å¿µï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š</p><ul><li>ç±»å’Œæ¥å£çš„å…¨é™å®šå</li><li>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</li><li>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</li></ul></li><li><p>HotSpotè™šæ‹Ÿæœºå¯¹å¸¸é‡æ± çš„å›æ”¶ç­–ç•¥æ˜¯å¾ˆæ˜ç¡®çš„ï¼Œåªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡æ²¡æœ‰è¢«ä»»ä½•åœ°æ–¹å¼•ç”¨ï¼Œå°±å¯ä»¥è¢«å›æ”¶ã€‚</p></li><li><p>å›æ”¶åºŸå¼ƒå¸¸é‡ä¸å›æ”¶Javaå †ä¸­çš„å¯¹è±¡éå¸¸ç±»ä¼¼ã€‚ï¼ˆå…³äºå¸¸é‡çš„å›æ”¶æ¯”è¾ƒç®€å•ï¼Œé‡ç‚¹æ˜¯ç±»çš„å›æ”¶ï¼‰</p></li></ul></li><li><p><strong>ç±»å¸è½½</strong></p><ul><li>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦â€œåºŸå¼ƒâ€è¿˜æ˜¯ç›¸å¯¹ç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»å‹æ˜¯å¦å±äºâ€œä¸å†è¢«ä½¿ç”¨çš„ç±»â€çš„æ¡ä»¶å°±æ¯”è¾ƒè‹›åˆ»äº†ã€‚éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ï¼š<ul><li><strong>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»åŠå…¶ä»»ä½•æ´¾ç”Ÿå­ç±»çš„å®ä¾‹ã€‚</strong></li><li><strong>åŠ è½½è¯¥ç±»çš„ç±»åŠ è½½å™¨å·²ç»è¢«å›æ”¶ï¼Œè¿™ä¸ªæ¡ä»¶é™¤éæ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„å¯æ›¿æ¢ç±»åŠ è½½å™¨çš„åœºæ™¯ï¼Œå¦‚OSGiã€JSPçš„é‡åŠ è½½ç­‰ï¼Œå¦åˆ™é€šå¸¸æ˜¯å¾ˆéš¾è¾¾æˆçš„ã€‚</strong></li><li><strong>è¯¥ç±»å¯¹åº”çš„java.lang.C1asså¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</strong></li></ul></li><li>Javaè™šæ‹Ÿæœºè¢«å…è®¸å¯¹æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œè¢«å…è®¸â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ï¼Œæ²¡æœ‰å¼•ç”¨äº†å°±å¿…ç„¶ä¼šå›æ”¶ã€‚å…³äºæ˜¯å¦è¦å¯¹ç±»å‹è¿›è¡Œå›æ”¶ï¼ŒHotSpotè™šæ‹Ÿæœºæä¾›äº†-Xnoclassgcå‚æ•°è¿›è¡Œæ§åˆ¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨**<code>-verbose:class ä»¥åŠ -XXï¼š+TraceClass-Loadingã€-XXï¼š+TraceClassUnLoading</code>**æŸ¥çœ‹ç±»åŠ è½½å’Œå¸è½½ä¿¡æ¯</li><li><strong>åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLibç­‰å­—èŠ‚ç æ¡†æ¶ï¼ŒåŠ¨æ€ç”ŸæˆJSPä»¥åŠoSGiè¿™ç±»é¢‘ç¹è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„åœºæ™¯ä¸­ï¼Œé€šå¸¸éƒ½éœ€è¦Javaè™šæ‹Ÿæœºå…·å¤‡ç±»å‹å¸è½½çš„èƒ½åŠ›</strong>ï¼Œä»¥ä¿è¯ä¸ä¼šå¯¹æ–¹æ³•åŒºé€ æˆè¿‡å¤§çš„å†…å­˜å‹åŠ›ã€‚</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter9/image22.png" alt="Untitled"></p></li></ul><h3 id="6-ç›´æ¥å†…å­˜-Direct-Memory"><a href="#6-ç›´æ¥å†…å­˜-Direct-Memory" class="headerlink" title="6.ç›´æ¥å†…å­˜ Direct Memory"></a>6.<strong>ç›´æ¥å†…å­˜ Direct Memory</strong></h3><ul><li><p><strong>ç›´æ¥å†…å­˜æ¦‚è¿°</strong></p><ol><li>ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚</li><li>ç›´æ¥å†…å­˜æ˜¯åœ¨Javaå †å¤–çš„ã€ç›´æ¥å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜åŒºé—´ã€‚</li><li>æ¥æºäºNIOï¼Œé€šè¿‡å­˜åœ¨å †ä¸­çš„DirectByteBufferæ“ä½œNativeå†…å­˜</li><li>é€šå¸¸ï¼Œè®¿é—®ç›´æ¥å†…å­˜çš„é€Ÿåº¦ä¼šä¼˜äºJavaå †ã€‚å³è¯»å†™æ€§èƒ½é«˜ã€‚</li><li>å› æ­¤å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œè¯»å†™é¢‘ç¹çš„åœºåˆå¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨ç›´æ¥å†…å­˜ã€‚</li><li>Javaçš„NIOåº“å…è®¸Javaç¨‹åºä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒº</li></ol></li><li><p>ä½¿ç”¨ä¸‹åˆ—ä»£ç ï¼Œç›´æ¥åˆ†é…æœ¬åœ°å†…å­˜ç©ºé—´</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">BUFFER</span> <span class="operator">=</span> <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1024</span>; <span class="comment">// 1GB</span></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(BUFFER);</span><br></pre></td></tr></table></figure><ul><li><strong>éç›´æ¥ç¼“å­˜åŒºå’Œç¼“å­˜åŒº</strong></li></ul><p>NIOçš„æ–¹å¼ä½¿ç”¨äº†ç¼“å­˜åŒºçš„æ¦‚å¿µ</p><p><img src="/images/jvm_virtual_machine/chapter9/image23.png" alt="Untitled"></p><ul><li><p><strong>å­˜åœ¨çš„é—®é¢˜</strong></p><p>  ä¹Ÿå¯èƒ½å¯¼è‡´outofMemoryErrorå¼‚å¸¸</p><p>  ç”±äºç›´æ¥å†…å­˜åœ¨Javaå †å¤–ï¼Œå› æ­¤å®ƒçš„å¤§å°ä¸ä¼šç›´æ¥å—é™äº-xmxæŒ‡å®šçš„æœ€å¤§å †å¤§å°ï¼Œä½†æ˜¯ç³»ç»Ÿå†…å­˜æ˜¯æœ‰é™çš„ï¼ŒJavaå †å’Œç›´æ¥å†…å­˜çš„æ€»å’Œä¾ç„¶å—é™äºæ“ä½œç³»ç»Ÿèƒ½ç»™å‡ºçš„æœ€å¤§å†…å­˜ã€‚ ç¼ºç‚¹</p><ul><li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜</li><li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li></ul><p>  ç›´æ¥å†…å­˜å¤§å°å¯ä»¥é€šè¿‡MaxDirectMemorySizeè®¾ç½®</p><p>  å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸å †çš„æœ€å¤§å€¼-xmxå‚æ•°å€¼ä¸€è‡´</p><p>  <img src="/images/jvm_virtual_machine/chapter9/image24.png" alt="Untitled"></p></li></ul>]]></content>
    
    
    <summary type="html">æ–¹æ³•åŒºä¸»è¦å­˜æ”¾çš„æ˜¯ Classï¼Œè€Œå †ä¸­ä¸»è¦å­˜æ”¾çš„æ˜¯ å®ä¾‹åŒ–çš„å¯¹è±¡</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(å…«)å †Heap</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%85%AB)%E5%A0%86Heap/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%85%AB)%E5%A0%86Heap/</id>
    <published>2023-02-07T16:00:00.000Z</published>
    <updated>2025-09-03T15:17:12.886Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-å…«-å †Heap"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-å…«-å †Heap" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(å…«)å †Heap"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(å…«)å †Heap</h2><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h3><ul><li>æ¦‚è¿°<ul><li>Java è™šæ‹Ÿæœºæœ‰ä¸€ä¸ªå †ï¼Œå®ƒåœ¨æ‰€æœ‰ Java è™šæ‹Ÿæœºçº¿ç¨‹ä¹‹é—´å…±äº«ã€‚å †æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œä»ä¸­åˆ†é…æ‰€æœ‰ç±»å®ä¾‹å’Œæ•°ç»„çš„å†…å­˜ã€‚</li><li>åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºå †ã€‚å¯¹è±¡çš„å †å­˜å‚¨ç”±è‡ªåŠ¨å­˜å‚¨ç®¡ç†ç³»ç»Ÿ(ç§°ä¸ºåƒåœ¾æ”¶é›†å™¨)å›æ”¶; å¯¹è±¡æ°¸è¿œä¸ä¼šæ˜¾å¼é‡Šæ”¾ã€‚Java è™šæ‹Ÿæœºæ²¡æœ‰ç‰¹å®šç±»å‹çš„è‡ªåŠ¨å­˜å‚¨ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥æ ¹æ®å®ç°è€…çš„ç³»ç»Ÿéœ€æ±‚é€‰æ‹©å­˜å‚¨ç®¡ç†æŠ€æœ¯ã€‚å †çš„å¤§å°å¯ä»¥æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è®¡ç®—çš„éœ€è¦è¿›è¡Œæ‰©å±•ï¼Œå¦‚æœä¸éœ€è¦æ›´å¤§çš„å †ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ”¶ç¼©ã€‚å †çš„å†…å­˜ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚</li><li><em>ä¸€ä¸ª Java è™šæ‹Ÿæœºå®ç°å¯ä»¥æä¾›ç¨‹åºå‘˜æˆ–ç”¨æˆ·å¯¹å †çš„åˆå§‹å¤§å°çš„æ§åˆ¶ï¼Œä»¥åŠï¼Œå¦‚æœå †å¯ä»¥åŠ¨æ€æ‰©å±•æˆ–æ”¶ç¼©ï¼Œå¯¹å †çš„æœ€å¤§å’Œæœ€å°å¤§å°çš„æ§åˆ¶ã€‚</em></li><li>æ‰€æœ‰çš„çº¿ç¨‹å…±äº«Javaå †ï¼Œåœ¨è¿™é‡Œè¿˜å¯ä»¥åˆ’åˆ†çº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼Œ<strong>TLAB</strong>ï¼‰ã€‚</li><li>ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¯¹Javaå †çš„æè¿°æ˜¯ï¼š<strong>æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°ç»„éƒ½åº”å½“åœ¨è¿è¡Œæ—¶åˆ†é…åœ¨å †ä¸Š</strong>ã€‚ï¼ˆThe heap is the run-time data area from which memory for all class instances and arrays is allocatedï¼‰â€¢ ä»å®é™…ä½¿ç”¨è§’åº¦çœ‹ï¼šâ€œå‡ ä¹â€æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨å †åˆ†é…å†…å­˜ï¼Œä½†å¹¶éå…¨éƒ¨ã€‚å› ä¸ºè¿˜æœ‰ä¸€äº›å¯¹è±¡æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼ˆé€ƒé€¸åˆ†æï¼Œæ ‡é‡æ›¿æ¢ï¼‰</li><li>æ•°ç»„å’Œå¯¹è±¡å¯èƒ½æ°¸è¿œä¸ä¼šå­˜å‚¨åœ¨æ ˆä¸Šï¼ˆ<strong>ä¸ä¸€å®š</strong>ï¼‰ï¼Œå› ä¸ºæ ˆå¸§ä¸­ä¿å­˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æŒ‡å‘å¯¹è±¡æˆ–è€…æ•°ç»„åœ¨å †ä¸­çš„ä½ç½®ã€‚</li><li>åœ¨æ–¹æ³•ç»“æŸåï¼Œå †ä¸­çš„å¯¹è±¡ä¸ä¼šé©¬ä¸Šè¢«ç§»é™¤ï¼Œä»…ä»…åœ¨åƒåœ¾æ”¶é›†çš„æ—¶å€™æ‰ä¼šè¢«ç§»é™¤ã€‚<ul><li>ä¹Ÿå°±æ˜¯è§¦å‘äº†GCçš„æ—¶å€™ï¼Œæ‰ä¼šè¿›è¡Œå›æ”¶</li><li>å¦‚æœå †ä¸­å¯¹è±¡é©¬ä¸Šè¢«å›æ”¶ï¼Œé‚£ä¹ˆç”¨æˆ·çº¿ç¨‹å°±ä¼šæ”¶åˆ°å½±å“ï¼Œå› ä¸ºæœ‰stop the word</li></ul></li><li>å †ï¼Œæ˜¯GCï¼ˆGarbage Collectionï¼Œåƒåœ¾æ”¶é›†å™¨ï¼‰æ‰§è¡Œåƒåœ¾å›æ”¶çš„é‡ç‚¹åŒºåŸŸã€‚</li></ul></li><li><strong>ä¸‹åˆ—å¼‚å¸¸æƒ…å†µä¸å †ç›¸å…³è”:</strong><ul><li>å¦‚æœè®¡ç®—éœ€è¦æ¯”è‡ªåŠ¨å­˜å‚¨ç®¡ç†ç³»ç»Ÿæ‰€èƒ½æä¾›çš„æ›´å¤šçš„å †ï¼Œé‚£ä¹ˆ Java è™šæ‹Ÿæœºå°†æŠ›å‡º OutOfMemoryError é”™è¯¯ã€‚</li></ul></li><li>é»˜è®¤å †å¤§å°ï¼š<ul><li>Xmsï¼šåˆå§‹å¤§å°å†…å­˜ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜64&#x2F;1ï¼Œç­‰ä»·äº-XX:InitialHeapSize</li><li>Xmxï¼šæœ€å¤§åˆ†é…å†…å­˜ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„4&#x2F;1ï¼Œç­‰ä»·äºï¼š-XXMaxHeapSize</li></ul></li></ul><p>å®˜ç½‘ï¼š<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.6">ChapterÂ 2.Â The Structure of the Java Virtual Machine (oracle.com)</a></p><p><img src="/Untitled.png" alt="Untitled"></p><p><img src="/Untitled%201.png" alt="Untitled"></p><ul><li><p><strong>å †å†…å­˜ç»†åˆ†</strong></p><p>  ç°ä»£åƒåœ¾æ”¶é›†å™¨å¤§éƒ¨åˆ†éƒ½åŸºäºåˆ†ä»£æ”¶é›†ç†è®ºè®¾è®¡ï¼Œå †ç©ºé—´ç»†åˆ†ä¸ºï¼š</p><ol><li>Java7 åŠä¹‹å‰å †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”Ÿä»£+è€å¹´ä»£+æ°¸ä¹…åŒº<ul><li>Young Generation Space æ–°ç”Ÿä»£ Young&#x2F;New<ul><li>åˆè¢«åˆ’åˆ†ä¸ºEdenåŒºå’ŒSurvivoråŒº</li></ul></li><li>Old generation space è€å¹´ä»£ Old&#x2F;Tenure</li><li>Permanent Space æ°¸ä¹…åŒº Perm</li></ul></li><li>Java 8åŠä¹‹åå †å†…å­˜é€»è¾‘ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ–°ç”Ÿä»£+è€å¹´ä»£+å…ƒç©ºé—´</li></ol><ul><li>Young Generation Space æ–°ç”Ÿä»£ï¼Œåˆè¢«åˆ’åˆ†ä¸ºEdenåŒºå’ŒSurvivoråŒº</li><li>Old generation space è€å¹´ä»£</li><li>Meta Space å…ƒç©ºé—´ Meta</li></ul><p>  <img src="/Untitled%202.png" alt="Untitled"></p></li></ul><p>å †ç©ºé—´å†…éƒ¨ç»“æ„ï¼ŒJDK1.8ä¹‹å‰ä»æ°¸ä¹…ä»£ æ›¿æ¢æˆ å…ƒç©ºé—´</p><p><img src="/Untitled%203.png" alt="Untitled"></p><h3 id="2-JVisualVMå¯è§†åŒ–æŸ¥çœ‹å †å†…å­˜"><a href="#2-JVisualVMå¯è§†åŒ–æŸ¥çœ‹å †å†…å­˜" class="headerlink" title="2.JVisualVMå¯è§†åŒ–æŸ¥çœ‹å †å†…å­˜"></a>2.<strong>JVisualVMå¯è§†åŒ–æŸ¥çœ‹å †å†…å­˜</strong></h3><p>è¿è¡Œä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start...&quot;</span>);</span><br><span class="line">        TimeUnit.MINUTES.sleep(<span class="number">30</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;end...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ã€åŒå‡»jdkç›®å½•ä¸‹çš„è¿™ä¸ªæ–‡ä»¶</p><p><img src="/Untitled%204.png" alt="Untitled"></p><p>2ã€å·¥å…· -&gt; æ’ä»¶ -&gt; å®‰è£…Visual GCæ’ä»¶</p><p><img src="/Untitled%205.png" alt="Untitled"></p><p>3ã€è¿è¡Œä¸Šé¢çš„ä»£ç </p><h3 id="3-è®¾ç½®å †å†…å­˜å¤§å°ä¸OOM"><a href="#3-è®¾ç½®å †å†…å­˜å¤§å°ä¸OOM" class="headerlink" title="3.è®¾ç½®å †å†…å­˜å¤§å°ä¸OOM"></a>3.<strong>è®¾ç½®å †å†…å­˜å¤§å°ä¸OOM</strong></h3><ul><li><p><strong>è®¾ç½®å †å†…å­˜</strong></p><ol><li><p>Javaå †åŒºç”¨äºå­˜å‚¨Javaå¯¹è±¡å®ä¾‹ï¼Œé‚£ä¹ˆå †çš„å¤§å°åœ¨JVMå¯åŠ¨æ—¶å°±å·²ç»è®¾å®šå¥½äº†ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡é€‰é¡¹â€-Xmsâ€å’Œâ€-Xmxâ€æ¥è¿›è¡Œè®¾ç½®ã€‚</p><ul><li><strong>Xms</strong>ç”¨äºè¡¨ç¤ºå †åŒºçš„èµ·å§‹å†…å­˜ï¼Œç­‰ä»·äº**-XX:InitialHeapSize**</li><li><strong>Xmx</strong>åˆ™ç”¨äºè¡¨ç¤ºå †åŒºçš„æœ€å¤§å†…å­˜ï¼Œç­‰ä»·äº**-XX:MaxHeapSize**</li></ul></li><li><p>ä¸€æ—¦å †åŒºä¸­çš„å†…å­˜å¤§å°è¶…è¿‡â€œ-Xmxâ€æ‰€æŒ‡å®šçš„æœ€å¤§å†…å­˜æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutofMemoryErrorå¼‚å¸¸ã€‚</p></li><li><p>é€šå¸¸ä¼šå°†-Xmså’Œ-Xmxä¸¤ä¸ªå‚æ•°é…ç½®ç›¸åŒçš„å€¼ï¼Œå…¶ç›®çš„æ˜¯<strong>ä¸ºäº†èƒ½å¤Ÿåœ¨avaåƒåœ¾å›æ”¶æœºåˆ¶æ¸…ç†å®Œå †åŒºåä¸éœ€è¦é‡æ–°åˆ†éš”è®¡ç®—å †åŒºçš„å¤§å°ï¼Œä»è€Œæé«˜æ€§èƒ½</strong>ã€‚</p><ul><li>åŸå› ï¼šå‡è®¾ä¸¤ä¸ªä¸ä¸€æ ·ï¼Œåˆå§‹å†…å­˜å°ï¼Œæœ€å¤§å†…å­˜å¤§ã€‚åœ¨è¿è¡ŒæœŸé—´å¦‚æœå †å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œä¼šä¸€ç›´æ‰©å®¹ç›´åˆ°æœ€å¤§å†…å­˜ã€‚å¦‚æœå†…å­˜å¤Ÿç”¨ä¸”å¤šäº†ï¼Œä¹Ÿä¼šä¸æ–­çš„ç¼©å®¹é‡Šæ”¾ã€‚é¢‘ç¹çš„æ‰©å®¹å’Œé‡Šæ”¾é€ æˆä¸å¿…è¦çš„å‹åŠ›ï¼Œé¿å…åœ¨GCä¹‹åè°ƒæ•´å †å†…å­˜ç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›ã€‚</li><li>å¦‚æœä¸¤ä¸ªè®¾ç½®ä¸€æ ·çš„å°±å°‘äº†é¢‘ç¹æ‰©å®¹å’Œç¼©å®¹çš„æ­¥éª¤ã€‚å†…å­˜ä¸å¤Ÿäº†å°±ç›´æ¥æŠ¥OOM</li></ul></li><li><p>é»˜è®¤æƒ…å†µä¸‹:</p><ul><li>åˆå§‹å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°&#x2F;64</li><li>æœ€å¤§å†…å­˜å¤§å°ï¼šç‰©ç†ç”µè„‘å†…å­˜å¤§å°&#x2F;4</li></ul> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.heap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -Xms ç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰çš„åˆå§‹å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment"> *  -Xï¼šæ˜¯jvmè¿è¡Œå‚æ•°</span></span><br><span class="line"><span class="comment"> *  msï¼šmemory start</span></span><br><span class="line"><span class="comment"> * -Xmxï¼šç”¨æ¥è®¾ç½®å †ç©ºé—´ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰çš„æœ€å¤§å†…å­˜å¤§å°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-11 14:33:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapSpaceInitial</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è¿”å›Javaè™šæ‹Ÿæœºä¸­çš„å †å†…å­˜æ€»é‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">initialMemory</span> <span class="operator">=</span> Runtime.getRuntime().totalMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line">        <span class="comment">// è¿”å›Javaè™šæ‹Ÿæœºè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å †å†…å­˜</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">maxMemory</span> <span class="operator">=</span> Runtime.getRuntime().maxMemory() / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;-Xms:&quot;</span> + initialMemory + <span class="string">&quot;M&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;-Xmx:&quot;</span> + maxMemory + <span class="string">&quot;M&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">-Xms:303M</span><br><span class="line">-Xmx:4482M</span><br></pre></td></tr></table></figure></li></ol></li><li><p>å¦‚ä½•æŸ¥çœ‹å †å†…å­˜çš„å†…å­˜åˆ†é…æƒ…å†µ</p><ul><li><p><code>jps  -&gt;  staat -gc  è¿›ç¨‹id</code></p><p>  å‚æ•°è¯´æ˜ï¼š</p><ul><li>SOC: S0åŒºæ€»å…±å®¹é‡</li><li>S1C: S1åŒºæ€»å…±å®¹é‡</li><li>S0U: S0åŒºä½¿ç”¨çš„é‡</li><li>S1U: S1åŒºä½¿ç”¨çš„é‡</li><li>EC: ä¼Šç”¸å›­åŒºæ€»å…±å®¹é‡</li><li>EU: ä¼Šç”¸å›­åŒºä½¿ç”¨çš„é‡</li><li>OC: è€å¹´ä»£æ€»å…±å®¹é‡</li><li>OU: è€å¹´ä»£ä½¿ç”¨çš„é‡</li></ul><p>  <img src="/Untitled%206.png" alt="Untitled"></p><p>  <code>-XX:+PrintGCDetails</code></p><p>  <img src="/Untitled%207.png" alt="Untitled"></p></li></ul></li><li><p><strong>OutOfMemory</strong>æµ‹è¯•</p></li></ul><p>æ·»åŠ å‚æ•°ï¼šXms600m -Xmx600m -XX:+PrintGCDetails</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OutOfMemoryTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;<span class="type">byte</span>[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">1024</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> æ‰§è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\bin\java.exe -Xms600m -Xmx600m -XX:+PrintGCDetails <span class="string">&quot;-javaagent:D:\Program Files\JetBrains\IntelliJ IDEA 2021.3.1\lib\idea_rt.jar=4979:D:\Program Files\JetBrains\IntelliJ IDEA 2021.3.1\bin&quot;</span> -Dfile.encoding=UTF-<span class="number">8</span> -classpath D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\charsets.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\deploy.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\access-bridge-<span class="number">64.</span>jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\cldrdata.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\dnsns.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\jaccess.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\jfxrt.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\localedata.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\nashorn.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\sunec.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\sunjce_provider.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\sunmscapi.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\sunpkcs11.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\ext\zipfs.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\javaws.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\jce.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\jfr.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\jfxswt.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\jsse.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\management-agent.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\plugin.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\resources.jar;D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\jre\lib\rt.jar;E:\workspace\IdeaWork\other\peppa-platform\peppa-jvm\target\classes com.peppa.heap.OutOfMemoryTest</span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 152578K-&gt;25384K(179200K)] 152578K-&gt;145202K(588800K), <span class="number">0.0190912</span> secs] [Times: user=<span class="number">0.05</span> sys=<span class="number">0.08</span>, real=<span class="number">0.02</span> secs] </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 178893K-&gt;25336K(179200K)] 298711K-&gt;297740K(588800K), <span class="number">0.0233429</span> secs] [Times: user=<span class="number">0.05</span> sys=<span class="number">0.06</span>, real=<span class="number">0.02</span> secs] </span><br><span class="line">[Full <span class="title function_">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 25336K-&gt;0K(179200K)] [ParOldGen: 272404K-&gt;297589K(409600K)] 297740K-&gt;297589K(588800K), [Metaspace: 3229K-&gt;3229K(1056768K)], <span class="number">0.0556161</span> secs] [Times: user=<span class="number">0.28</span> sys=<span class="number">0.00</span>, real=<span class="number">0.05</span> secs] </span><br><span class="line">[Full <span class="title function_">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 153530K-&gt;37888K(179200K)] [ParOldGen: 297589K-&gt;409208K(409600K)] 451120K-&gt;447096K(588800K), [Metaspace: 3229K-&gt;3229K(1056768K)], <span class="number">0.0254560</span> secs] [Times: user=<span class="number">0.06</span> sys=<span class="number">0.05</span>, real=<span class="number">0.03</span> secs] </span><br><span class="line">[Full <span class="title function_">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 153506K-&gt;152578K(179200K)] [ParOldGen: 409208K-&gt;409208K(409600K)] 562714K-&gt;561786K(588800K), [Metaspace: 3229K-&gt;3229K(1056768K)], <span class="number">0.0175328</span> secs] [Times: user=<span class="number">0.11</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] </span><br><span class="line">[Full <span class="title function_">GC</span> <span class="params">(Allocation Failure)</span> [PSYoungGen: 152578K-&gt;152578K(179200K)] [ParOldGen: 409208K-&gt;409190K(409600K)] 561786K-&gt;561768K(588800K), [Metaspace: 3229K-&gt;3229K(1056768K)], <span class="number">0.0235650</span> secs] [Times: user=<span class="number">0.11</span> sys=<span class="number">0.00</span>, real=<span class="number">0.02</span> secs] </span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 179200K, used 153600K [<span class="number">0x00000000f3800000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space 153600K, <span class="number">100</span>% used [<span class="number">0x00000000f3800000</span>,<span class="number">0x00000000fce00000</span>,<span class="number">0x00000000fce00000</span>)</span><br><span class="line">  from space 25600K, <span class="number">0</span>% used [<span class="number">0x00000000fe700000</span>,<span class="number">0x00000000fe700000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line">  to   space 25600K, <span class="number">0</span>% used [<span class="number">0x00000000fce00000</span>,<span class="number">0x00000000fce00000</span>,<span class="number">0x00000000fe700000</span>)</span><br><span class="line"> ParOldGen       total 409600K, used 409194K [<span class="number">0x00000000da800000</span>, <span class="number">0x00000000f3800000</span>, <span class="number">0x00000000f3800000</span>)</span><br><span class="line">  object space 409600K, <span class="number">99</span>% used [<span class="number">0x00000000da800000</span>,<span class="number">0x00000000f379abf0</span>,<span class="number">0x00000000f3800000</span>)</span><br><span class="line"> Metaspace       used 3260K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">space</span>    used 353K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line"></span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: **Java heap space**</span><br><span class="line">at com.peppa.heap.OutOfMemoryTest.main(OutOfMemoryTest.java:<span class="number">10</span>)</span><br></pre></td></tr></table></figure><h3 id="4-å¹´è½»ä»£ä¸è€å¹´ä»£"><a href="#4-å¹´è½»ä»£ä¸è€å¹´ä»£" class="headerlink" title="4.å¹´è½»ä»£ä¸è€å¹´ä»£"></a>4.<strong>å¹´è½»ä»£ä¸è€å¹´ä»£</strong></h3><ul><li><p>å­˜å‚¨å¯¹è±¡åˆ’åˆ†ï¼š</p><ul><li>å­˜å‚¨åœ¨JVMä¸­çš„Javaå¯¹è±¡å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ç±»ï¼š<ul><li>ä¸€ç±»æ˜¯ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„ç¬æ—¶å¯¹è±¡ï¼Œè¿™ç±»å¯¹è±¡çš„åˆ›å»ºå’Œæ¶ˆäº¡éƒ½éå¸¸è¿…é€Ÿï¼Œç”Ÿå‘½å‘¨æœŸçŸ­çš„ï¼ŒåŠæ—¶å›æ”¶å³å¯ã€‚</li><li>å¦å¤–ä¸€ç±»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå´éå¸¸é•¿ï¼Œåœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹è¿˜èƒ½å¤Ÿä¸JVMçš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´</li></ul></li><li>Javaå †åŒºè¿›ä¸€æ­¥ç»†åˆ†çš„è¯ï¼Œå¯ä»¥åˆ’åˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoungGenï¼‰å’Œè€å¹´ä»£ï¼ˆoldGenï¼‰</li><li>å…¶ä¸­å¹´è½»ä»£åˆå¯ä»¥åˆ’åˆ†ä¸ºEdenç©ºé—´ã€Survivor0ç©ºé—´å’ŒSurvivor1ç©ºé—´ï¼ˆæœ‰æ—¶ä¹Ÿå«åšfromåŒºã€toåŒºï¼‰</li></ul><p>  <img src="/Untitled%208.png" alt="Untitled"></p><p>  ä¸‹é¢è¿™å‚æ•°å¼€å‘ä¸­ä¸€èˆ¬ä¸ä¼šè°ƒï¼š</p><p>  <img src="/Untitled%209.png" alt="Untitled"></p><ul><li>é…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”<ul><li>é»˜è®¤**-XX:NewRatio**&#x3D;2ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 2ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1&#x2F;3</li><li>å¯ä»¥ä¿®æ”¹**-XX:NewRatio**&#x3D;4ï¼Œè¡¨ç¤ºæ–°ç”Ÿä»£å 1ï¼Œè€å¹´ä»£å 4ï¼Œæ–°ç”Ÿä»£å æ•´ä¸ªå †çš„1&#x2F;5</li></ul></li></ul><ol><li>åœ¨HotSpotä¸­ï¼ŒEdenç©ºé—´å’Œå¦å¤–ä¸¤ä¸ªsurvivorç©ºé—´ç¼ºçœæ‰€å çš„æ¯”ä¾‹æ˜¯8 : 1 : 1ï¼Œ</li><li>å½“ç„¶å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹**-XX:SurvivorRatio**è°ƒæ•´è¿™ä¸ªç©ºé—´æ¯”ä¾‹ã€‚æ¯”å¦‚-XX:SurvivorRatio&#x3D;8</li><li>å‡ ä¹æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½æ˜¯åœ¨EdenåŒºè¢«newå‡ºæ¥çš„ã€‚</li><li>ç»å¤§éƒ¨åˆ†çš„Javaå¯¹è±¡çš„é”€æ¯éƒ½åœ¨æ–°ç”Ÿä»£è¿›è¡Œäº†ï¼ˆæœ‰äº›å¤§çš„å¯¹è±¡åœ¨EdenåŒºæ— æ³•å­˜å‚¨æ—¶å€™ï¼Œå°†ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼‰ï¼ŒIBMå…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­80%çš„å¯¹è±¡éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ã€‚</li><li>å¯ä»¥ä½¿ç”¨é€‰é¡¹â€-Xmnâ€è®¾ç½®æ–°ç”Ÿä»£æœ€å¤§å†…å­˜å¤§å°ï¼Œä½†è¿™ä¸ªå‚æ•°ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼å°±å¯ä»¥äº†ã€‚</li></ol><p>  <img src="/Untitled%2010.png" alt="Untitled"></p></li></ul><h3 id="5-å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹"><a href="#5-å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹" class="headerlink" title="5.å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹"></a>5.<strong>å›¾è§£å¯¹è±¡åˆ†é…è¿‡ç¨‹</strong></h3><ul><li><p><strong>æ¦‚å¿µ</strong></p><p>  ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜æ˜¯ä¸€ä»¶éå¸¸ä¸¥è°¨å’Œå¤æ‚çš„ä»»åŠ¡ï¼ŒJMçš„è®¾è®¡è€…ä»¬ä¸ä»…éœ€è¦è€ƒè™‘å†…å­˜å¦‚ä½•åˆ†é…ã€åœ¨å“ªé‡Œåˆ†é…ç­‰é—®é¢˜ï¼Œå¹¶ä¸”ç”±äºå†…å­˜åˆ†é…ç®—æ³•ä¸å†…å­˜å›æ”¶ç®—æ³•å¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥è¿˜éœ€è¦è€ƒè™‘GCæ‰§è¡Œå®Œå†…å­˜å›æ”¶åæ˜¯å¦ä¼šåœ¨å†…å­˜ç©ºé—´ä¸­äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</p><ul><li>newçš„å¯¹è±¡å…ˆæ”¾ä¼Šç”¸å›­åŒºã€‚æ­¤åŒºæœ‰å¤§å°é™åˆ¶ã€‚</li><li>å½“ä¼Šç”¸å›­çš„ç©ºé—´å¡«æ»¡æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVMçš„åƒåœ¾å›æ”¶å™¨å°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinorGCï¼‰ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­çš„ä¸å†è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ã€‚å†åŠ è½½æ–°çš„å¯¹è±¡æ”¾åˆ°ä¼Šç”¸å›­åŒº</li><li>ç„¶åå°†ä¼Šç”¸å›­ä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€…0åŒºã€‚</li><li>å¦‚æœå†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€…0åŒºçš„ï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€…1åŒºã€‚</li><li>å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾å›å¹¸å­˜è€…0åŒºï¼Œæ¥ç€å†å»å¹¸å­˜è€…1åŒºã€‚</li><li>å•¥æ—¶å€™èƒ½å»å…»è€åŒºå‘¢ï¼Ÿå¯ä»¥è®¾ç½®æ¬¡æ•°ã€‚é»˜è®¤æ˜¯15æ¬¡ã€‚</li><li>åœ¨å…»è€åŒºï¼Œç›¸å¯¹æ‚ é—²ã€‚å½“å…»è€åŒºå†…å­˜ä¸è¶³æ—¶ï¼Œå†æ¬¡è§¦å‘GCï¼šMajor GCï¼Œè¿›è¡Œå…»è€åŒºçš„å†…å­˜æ¸…ç†</li><li>è‹¥å…»è€åŒºæ‰§è¡Œäº†Major GCä¹‹åï¼Œå‘ç°ä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”ŸOOMå¼‚å¸¸ã€‚</li></ul><p>  å¯ä»¥è®¾ç½®å‚æ•°ï¼š-Xx:MaxTenuringThreshold&#x3D; Nè¿›è¡Œè®¾ç½®  </p></li><li><p><strong>å›¾è§£è¿‡ç¨‹</strong></p><p>  æˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸€èˆ¬éƒ½æ˜¯å­˜æ”¾åœ¨EdenåŒºçš„ï¼Œå½“æˆ‘ä»¬EdenåŒºæ»¡äº†åï¼Œå°±ä¼šè§¦å‘GCæ“ä½œï¼Œä¸€èˆ¬è¢«ç§°ä¸º YGC &#x2F; Minor GCæ“ä½œ</p><p>  <img src="/Untitled%2011.png" alt="Untitled"></p><p>  å½“æˆ‘ä»¬è¿›è¡Œä¸€æ¬¡åƒåœ¾æ”¶é›†åï¼Œçº¢è‰²çš„å°†ä¼šè¢«å›æ”¶ï¼Œè€Œç»¿è‰²çš„è¿˜ä¼šè¢«å ç”¨ç€ï¼Œå­˜æ”¾åœ¨S0(Survivor From)åŒºã€‚åŒæ—¶æˆ‘ä»¬ç»™æ¯ä¸ªå¯¹è±¡è®¾ç½®äº†ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œä¸€æ¬¡å›æ”¶åå°±æ˜¯1ã€‚</p><p>  åŒæ—¶EdenåŒºç»§ç»­å­˜æ”¾å¯¹è±¡ï¼Œå½“EdenåŒºå†æ¬¡å­˜æ»¡çš„æ—¶å€™ï¼Œåˆä¼šè§¦å‘ä¸€ä¸ªMinorGCæ“ä½œï¼Œæ­¤æ—¶GCå°†ä¼šæŠŠ Edenå’ŒSurvivor Fromä¸­çš„å¯¹è±¡ è¿›è¡Œä¸€æ¬¡æ”¶é›†ï¼ŒæŠŠå­˜æ´»çš„å¯¹è±¡æ”¾åˆ° Survivor ToåŒºï¼ŒåŒæ—¶è®©å¹´é¾„ + 1</p><p>  <img src="/Untitled%2012.png" alt="Untitled"></p><p>  æˆ‘ä»¬ç»§ç»­ä¸æ–­çš„è¿›è¡Œå¯¹è±¡ç”Ÿæˆ å’Œ åƒåœ¾å›æ”¶ï¼Œå½“Survivorä¸­çš„å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°15çš„æ—¶å€™ï¼Œå°†ä¼šè§¦å‘ä¸€æ¬¡ Promotionæ™‹å‡çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å°†å¹´è½»ä»£ä¸­çš„å¯¹è±¡ æ™‹å‡åˆ° è€å¹´ä»£ä¸­</p><p>  <img src="/Untitled%2013.png" alt="Untitled"></p></li><li><p><strong>å¹¸å­˜åŒºåŒºæ»¡äº†åï¼Ÿ</strong></p><p>  ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨EdenåŒºæ»¡äº†çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘MinorGCï¼Œè€Œå¹¸å­˜è€…åŒºæ»¡äº†åï¼Œä¸ä¼šè§¦å‘MinorGCæ“ä½œ</p><p>  å¦‚æœSurvivoråŒºæ»¡äº†åï¼Œå°†ä¼šè§¦å‘ä¸€äº›ç‰¹æ®Šçš„è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯å¯èƒ½ç›´æ¥æ™‹å‡è€å¹´ä»£</p></li><li><p><strong>å¯¹è±¡åˆ†é…çš„ç‰¹æ®Šæƒ…å†µ</strong></p><ol><li>å¦‚æœæ¥äº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå…ˆçœ‹çœ‹ Eden æ˜¯å¦æ”¾çš„ä¸‹ï¼Ÿ<ul><li>å¦‚æœ Eden æ”¾å¾—ä¸‹ï¼Œåˆ™ç›´æ¥æ”¾åˆ° Eden åŒº</li><li>å¦‚æœ Eden æ”¾ä¸ä¸‹ï¼Œåˆ™è§¦å‘ YGC ï¼Œæ‰§è¡Œåƒåœ¾å›æ”¶ï¼Œçœ‹çœ‹è¿˜èƒ½ä¸èƒ½æ”¾ä¸‹ï¼Ÿ</li></ul></li><li>å°†å¯¹è±¡æ”¾åˆ°è€å¹´åŒºåˆæœ‰ä¸¤ç§æƒ…å†µï¼š<ul><li>å¦‚æœ Eden æ‰§è¡Œäº† YGC è¿˜æ˜¯æ— æ³•æ”¾ä¸ä¸‹è¯¥å¯¹è±¡ï¼Œé‚£æ²¡å¾—åŠæ³•ï¼Œåªèƒ½è¯´æ˜æ˜¯è¶…å¤§å¯¹è±¡ï¼Œåªèƒ½ç›´æ¥æ”¾åˆ°è€å¹´ä»£</li><li>é‚£ä¸‡ä¸€è€å¹´ä»£éƒ½æ”¾ä¸ä¸‹ï¼Œåˆ™å…ˆè§¦å‘FullGC ï¼Œå†çœ‹çœ‹èƒ½ä¸èƒ½æ”¾ä¸‹ï¼Œæ”¾å¾—ä¸‹æœ€å¥½ï¼Œä½†å¦‚æœè¿˜æ˜¯æ”¾ä¸ä¸‹ï¼Œé‚£åªèƒ½æŠ¥ OOM</li></ul></li><li>å¦‚æœ Eden åŒºæ»¡äº†ï¼Œå°†å¯¹è±¡å¾€å¹¸å­˜åŒºæ‹·è´æ—¶ï¼Œå‘ç°å¹¸å­˜åŒºæ”¾ä¸ä¸‹å•¦ï¼Œé‚£åªèƒ½ä¾¿å®œäº†æŸäº›æ–°å¯¹è±¡ï¼Œè®©ä»–ä»¬ç›´æ¥æ™‹å‡è‡³è€å¹´åŒº</li></ol><p>  <img src="/Untitled%2014.png" alt="Untitled">  </p></li><li><p><strong>ä»£ç æ¼”ç¤ºå¯¹è±¡åˆ†é…è¿‡ç¨‹</strong></p></li></ul><p>æˆ‘ä»¬ä¸æ–­çš„åˆ›å»ºå¤§å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç æ¼”ç¤ºå¯¹è±¡åˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-02-11 17:27:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapInstanceTest</span> &#123;</span><br><span class="line">    <span class="type">byte</span> [] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">1024</span> * <span class="number">200</span>)];</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        ArrayList&lt;HeapInstanceTest&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">HeapInstanceTest</span>());</span><br><span class="line">            Thread.sleep(<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè®¾ç½®JVMå‚æ•°ï¼š<code>-Xms600m -Xmx600m</code></p><p>æ‰“å¼€VisualVMå›¾å½¢åŒ–ç•Œé¢</p><p><img src="/Untitled.gif" alt="Untitled"></p><p>æœ€ç»ˆï¼Œåœ¨è€å¹´ä»£å’Œæ–°ç”Ÿä»£éƒ½æ»¡äº†ï¼Œå°±å‡ºç°OOM</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\software\Java\jdk1<span class="number">.8</span>\jdk1<span class="number">.8</span><span class="number">.0_241</span>\bin\java.exe -Xms600m -Xmx600m</span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at com.peppa.heap.HeapInstanceTest.&lt;init&gt;(HeapInstanceTest.java:<span class="number">12</span>)</span><br><span class="line">at com.peppa.heap.HeapInstanceTest.main(HeapInstanceTest.java:<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">1</span></span><br></pre></td></tr></table></figure><ul><li><p><strong>å¸¸ç”¨è°ƒä¼˜å·¥å…·</strong></p><ol><li>JDKå‘½ä»¤è¡Œ</li><li>Eclipseï¼šMemory Analyzer Tool</li><li>Jconsole</li><li>Visual VMï¼ˆå®æ—¶ç›‘æ§ï¼Œæ¨èï¼‰</li><li>Jprofilerï¼ˆIDEAæ’ä»¶ï¼‰</li><li>Java Flight Recorderï¼ˆå®æ—¶ç›‘æ§ï¼‰</li><li>GCViewer</li><li>GCEasy</li></ol></li><li><p><strong>GCåˆ†ç±»</strong></p><ul><li><p><strong>Minor GCï¼ŒMajorGCã€Full GC</strong></p><ul><li>Minor GCï¼šæ–°ç”Ÿä»£çš„GC</li><li>Major GCï¼šè€å¹´ä»£çš„GC</li><li>Full GCï¼šæ•´å †æ”¶é›†ï¼Œæ”¶é›†æ•´ä¸ªJavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†</li></ul><blockquote><p><em>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒJVMçš„è°ƒä¼˜çš„ä¸€ä¸ªç¯èŠ‚ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†ï¼Œæˆ‘ä»¬éœ€è¦å°½é‡çš„é¿å…åƒåœ¾å›æ”¶ï¼Œå› ä¸ºåœ¨åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå®¹æ˜“å‡ºç°STWçš„é—®é¢˜ï¼Œè€Œ Major GC å’Œ Full GCå‡ºç°STWçš„æ—¶é—´ï¼Œæ˜¯Minor GCçš„10å€ä»¥ä¸Š</em></p></blockquote></li><li><p><strong>éƒ¨åˆ†æ”¶é›†ï¼ˆPartial GCï¼‰&amp;&amp; æ•´å †æ”¶é›†ï¼ˆFullGCï¼‰</strong></p><ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinorGC&#x2F;YoungGCï¼‰ï¼šåªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajorGC&#x2F;o1dGCï¼‰ï¼šåªæ˜¯è€å¹´ä»£çš„åœ¾æ”¶é›†ã€‚<ul><li>ç›®å‰ï¼Œåªæœ‰CMSGCä¼šæœ‰å•ç‹¬æ”¶é›†è€å¹´ä»£çš„è¡Œä¸ºã€‚</li><li>æ³¨æ„ï¼Œå¾ˆå¤šæ—¶å€™Major GCä¼šå’ŒFu11GCæ··æ·†ä½¿ç”¨ï¼Œéœ€è¦å…·ä½“åˆ†è¾¨æ˜¯è€å¹´ä»£å›æ”¶è¿˜æ˜¯æ•´å †å›æ”¶ã€‚</li></ul></li></ul></li><li><p><strong>æ•´å †æ”¶é›†ï¼ˆFullGCï¼‰</strong>ï¼šæ”¶é›†æ•´ä¸ªjavaå †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</p></li><li><p><strong>Young GC</strong></p><p>  å½“å¹´è½»ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘MinorGCï¼Œè¿™é‡Œçš„å¹´è½»ä»£æ»¡æŒ‡çš„æ˜¯Edenä»£æ»¡ï¼ŒSurvivoræ»¡ä¸ä¼šå¼•å‘GCã€‚ï¼ˆæ¯æ¬¡Minor GCä¼šæ¸…ç†å¹´è½»ä»£çš„å†…å­˜ã€‚ï¼‰</p><p>  å› ä¸ºJavaå¯¹è±¡å¤§å¤šéƒ½å…·å¤‡Â <strong>æœç”Ÿå¤•ç­</strong>Â çš„ç‰¹æ€§ï¼Œæ‰€ä»¥Minor GCéå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚è¿™ä¸€å®šä¹‰æ—¢æ¸…æ™°åˆæ˜“äºç†è§£ã€‚</p><p>  Minor GCä¼šå¼•å‘STWï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åƒåœ¾å›æ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œ</p><p>  <img src="/Untitled%2015.png" alt="Untitled"></p></li><li><p><strong>è€å¹´ä»£GCï¼ˆMajorGCï¼‰è§¦å‘æœºåˆ¶</strong></p><ol><li>æŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œå¯¹è±¡ä»è€å¹´ä»£æ¶ˆå¤±æ—¶ï¼Œæˆ‘ä»¬è¯´ â€œMajor Gcâ€ æˆ– â€œFull GCâ€ å‘ç”Ÿäº†</li><li>å‡ºç°äº†MajorGcï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GCã€‚ï¼ˆä½†éç»å¯¹çš„ï¼Œåœ¨Parallel Scavengeæ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡ŒMajorGCçš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ï¼‰<ul><li>ä¹Ÿå°±æ˜¯åœ¨è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå…ˆå°è¯•è§¦å‘Minor GCï¼ˆå“ˆï¼Ÿæˆ‘æœ‰ç‚¹è¿·ï¼Ÿï¼‰ï¼Œå¦‚æœä¹‹åç©ºé—´è¿˜ä¸è¶³ï¼Œåˆ™è§¦å‘Major GC</li></ul></li><li>Major GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCæ…¢10å€ä»¥ä¸Šï¼ŒSTWçš„æ—¶é—´æ›´é•¿ã€‚</li><li>å¦‚æœMajor GCåï¼Œå†…å­˜è¿˜ä¸è¶³ï¼Œå°±æŠ¥OOMäº†</li></ol></li><li><p><strong>è§¦å‘Full GCæ‰§è¡Œçš„æƒ…å†µæœ‰å¦‚ä¸‹äº”ç§ï¼š</strong></p><ol><li>è°ƒç”¨System.gc()æ—¶ï¼Œç³»ç»Ÿå»ºè®®æ‰§è¡ŒFullGCï¼Œä½†æ˜¯ä¸å¿…ç„¶æ‰§è¡Œ</li><li>è€å¹´ä»£ç©ºé—´ä¸è¶³</li><li>æ–¹æ³•åŒºç©ºé—´ä¸è¶³</li><li>é€šè¿‡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¹³å‡å¤§å°å¤§äºè€å¹´ä»£çš„å¯ç”¨å†…å­˜</li><li>ç”±EdenåŒºã€survivor space0ï¼ˆFrom Spaceï¼‰åŒºå‘survivor space1ï¼ˆTo Spaceï¼‰åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äºTo Spaceå¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°</li></ol></li></ul></li><li><p><strong>GCæ—¥å¿—åˆ†æ</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.gc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•MinorGC ã€ MajorGCã€FullGC</span></span><br><span class="line"><span class="comment"> * -Xms9m -Xmx9m -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> shkstart  shkstart@126.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2020  14:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GCTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;this is peppa&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                list.add(a);</span><br><span class="line">                a = a + a;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            t.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;éå†æ¬¡æ•°ä¸ºï¼š&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  è¾“å‡ºï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen: 1964K-&gt;510K(2560K)] 1964K-&gt;826K(9728K), <span class="number">0.0008721</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 2361K-&gt;496K(2560K)] 2677K-&gt;1489K(9728K), <span class="number">0.0007112</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 1796K-&gt;384K(2560K)] 2790K-&gt;2417K(9728K), <span class="number">0.0009442</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[Full <span class="title function_">GC</span> <span class="params">(Ergonomics)</span> [PSYoungGen: 2151K-&gt;0K(2560K)] [ParOldGen: 7025K-&gt;5682K(7168K)] 9177K-&gt;5682K(9728K), [Metaspace: 3227K-&gt;3227K(1056768K)], <span class="number">0.0029911</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[GC (Allocation Failure) [PSYoungGen: 0K-&gt;0K(2560K)] 5682K-&gt;5682K(9728K), <span class="number">0.0004552</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">[Full <span class="title function_">GC</span> <span class="params">(Allocation Failure)</span> [PSYoungGen: 0K-&gt;0K(2560K)] [ParOldGen: 5682K-&gt;5599K(7168K)] 5682K-&gt;5599K(9728K), [Metaspace: 3227K-&gt;3227K(1056768K)], <span class="number">0.0058927</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.01</span> secs] </span><br><span class="line">éå†æ¬¡æ•°ä¸ºï¼š<span class="number">16</span></span><br><span class="line">Heap</span><br><span class="line"> PSYoungGen      total 2560K, used 101K [<span class="number">0x00000000ffd00000</span>, <span class="number">0x0000000100000000</span>, <span class="number">0x0000000100000000</span>)</span><br><span class="line">  eden space 2048K, <span class="number">4</span>% used [<span class="number">0x00000000ffd00000</span>,<span class="number">0x00000000ffd19568</span>,<span class="number">0x00000000fff00000</span>)</span><br><span class="line">  from space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff80000</span>,<span class="number">0x00000000fff80000</span>,<span class="number">0x0000000100000000</span>)</span><br><span class="line">  to   space 512K, <span class="number">0</span>% used [<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff00000</span>,<span class="number">0x00000000fff80000</span>)</span><br><span class="line"> ParOldGen       total 7168K, used 5599K [<span class="number">0x00000000ff600000</span>, <span class="number">0x00000000ffd00000</span>, <span class="number">0x00000000ffd00000</span>)</span><br><span class="line">  object space 7168K, <span class="number">78</span>% used [<span class="number">0x00000000ff600000</span>,<span class="number">0x00000000ffb77d90</span>,<span class="number">0x00000000ffd00000</span>)</span><br><span class="line"> Metaspace       used 3259K, capacity 4496K, committed 4864K, reserved 1056768K</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">space</span>    used 353K, capacity 388K, committed 512K, reserved 1048576K</span><br><span class="line">java.lang.OutOfMemoryError: Java heap space</span><br><span class="line">at java.util.Arrays.copyOf(Arrays.java:<span class="number">3332</span>)</span><br><span class="line">at java.lang.AbstractStringBuilder.ensureCapacityInternal(AbstractStringBuilder.java:<span class="number">124</span>)</span><br><span class="line">at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:<span class="number">448</span>)</span><br><span class="line">at java.lang.StringBuilder.append(StringBuilder.java:<span class="number">136</span>)</span><br><span class="line">at com.peppa.gc.GCTest.main(GCTest.java:<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen: 1964K-&gt;510K(2560K)] 1964K-&gt;826K(9728K), <span class="number">0.0008721</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br></pre></td></tr></table></figure><ul><li>[PSYoungGen: 1964K-&gt;510K(2560K)]ï¼šå¹´è½»ä»£æ€»ç©ºé—´ä¸º 2560K ï¼Œå½“å‰å ç”¨ 1964K ï¼Œç»è¿‡åƒåœ¾å›æ”¶åå‰©ä½™510K****</li><li>1964K-&gt;826K(9728K)ï¼šå †å†…å­˜æ€»ç©ºé—´ä¸º 9728K ï¼Œå½“å‰å ç”¨1964Kï¼Œç»è¿‡åƒåœ¾å›æ”¶åå‰©ä½™826K</li></ul><p>  <img src="/Untitled%2016.png" alt="Untitled"></p><p>  <img src="/Untitled%2017.png" alt="Untitled">  </p></li><li><p><strong>å †ç©ºé—´åˆ†ä»£æ€æƒ³</strong></p><p>  ä¸ºä»€ä¹ˆè¦æŠŠJavaå †åˆ†ä»£ï¼Ÿä¸åˆ†ä»£å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†å—ï¼Ÿç»ç ”ç©¶ï¼Œä¸åŒå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸åŒã€‚70%-99%çš„å¯¹è±¡æ˜¯ä¸´æ—¶å¯¹è±¡ã€‚</p><ul><li>æ–°ç”Ÿä»£ï¼šæœ‰Edenã€ä¸¤å—å¤§å°ç›¸åŒçš„survivorï¼ˆåˆç§°ä¸ºfrom&#x2F;toæˆ–s0&#x2F;s1ï¼‰æ„æˆï¼Œtoæ€»ä¸ºç©ºã€‚</li><li>è€å¹´ä»£ï¼šå­˜æ”¾æ–°ç”Ÿä»£ä¸­ç»å†å¤šæ¬¡GCä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚</li></ul><p>  <img src="/Untitled%2018.png" alt="Untitled"></p><p>  å…¶å®ä¸åˆ†ä»£å®Œå…¨å¯ä»¥ï¼Œåˆ†ä»£çš„å”¯ä¸€ç†ç”±å°±æ˜¯ä¼˜åŒ–GCæ€§èƒ½ã€‚å¦‚æœæ²¡æœ‰åˆ†ä»£ï¼Œé‚£æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ä¸€å—ï¼Œå°±å¦‚åŒæŠŠä¸€ä¸ªå­¦æ ¡çš„äººéƒ½å…³åœ¨ä¸€ä¸ªæ•™å®¤ã€‚GCçš„æ—¶å€™è¦æ‰¾åˆ°å“ªäº›å¯¹è±¡æ²¡ç”¨ï¼Œè¿™æ ·å°±ä¼šå¯¹å †çš„æ‰€æœ‰åŒºåŸŸè¿›è¡Œæ‰«æã€‚è€Œå¾ˆå¤šå¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ï¼Œå¦‚æœåˆ†ä»£çš„è¯ï¼ŒæŠŠæ–°åˆ›å»ºçš„å¯¹è±¡æ”¾åˆ°æŸä¸€åœ°æ–¹ï¼Œå½“GCçš„æ—¶å€™å…ˆæŠŠè¿™å—å­˜å‚¨â€œæœç”Ÿå¤•æ­»â€å¯¹è±¡çš„åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè¿™æ ·å°±ä¼šè…¾å‡ºå¾ˆå¤§çš„ç©ºé—´å‡ºæ¥ã€‚</p><p>  <img src="/Untitled%2019.png" alt="Untitled">  </p></li><li><p><strong>å†…å­˜åˆ†é…ç­–ç•¥</strong></p><p>  å¦‚æœå¯¹è±¡åœ¨Edenå‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡Minor GCåä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢«Survivorå®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ°survivorç©ºé—´ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º1ã€‚å¯¹è±¡åœ¨survivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡MinorGCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º15å²ï¼Œå…¶å®æ¯ä¸ªJVMã€æ¯ä¸ªGCéƒ½æœ‰æ‰€ä¸åŒï¼‰æ—¶ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£</p><p>  å¯¹è±¡æ™‹å‡è€å¹´ä»£çš„å¹´é¾„é˜€å€¼ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹-xx:MaxTenuringThresholdæ¥è®¾ç½®</p><p>  é’ˆå¯¹ä¸åŒå¹´é¾„æ®µçš„å¯¹è±¡åˆ†é…åŸåˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>ä¼˜å…ˆåˆ†é…åˆ°Eden<ul><li>å¼€å‘ä¸­æ¯”è¾ƒé•¿çš„å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼Œä¼šç›´æ¥å­˜åœ¨è€å¹´ä»£ï¼Œä½†æ˜¯å› ä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡ éƒ½æ˜¯ æœç”Ÿå¤•æ­»çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå¤§å¯¹è±¡å¯èƒ½ä¹Ÿå¾ˆå¿«è¢«å›æ”¶ï¼Œä½†æ˜¯å› ä¸ºè€å¹´ä»£è§¦å‘Major GCçš„æ¬¡æ•°æ¯” Minor GCè¦æ›´å°‘ï¼Œå› æ­¤å¯èƒ½å›æ”¶èµ·æ¥å°±ä¼šæ¯”è¾ƒæ…¢</li></ul></li><li>å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£<ul><li>å°½é‡é¿å…ç¨‹åºä¸­å‡ºç°è¿‡å¤šçš„å¤§å¯¹è±¡</li></ul></li><li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡åˆ†é…åˆ°è€å¹´ä»£</li><li>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤æ–­<ul><li>å¦‚æœsurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— é¡»ç­‰åˆ°MaxTenuringThreshold ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</li></ul></li></ul><p>  ç©ºé—´åˆ†é…æ‹…ä¿ï¼š -Xx:HandlePromotionFailure</p><ul><li>ä¹Ÿå°±æ˜¯ç»è¿‡Minor GCåï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å­˜æ´»ï¼Œå› ä¸ºSurvivoræ¯”è¾ƒå°ï¼Œæ‰€ä»¥å°±éœ€è¦å°†Survivoræ— æ³•å®¹çº³çš„å¯¹è±¡ï¼Œå­˜æ”¾åˆ°è€å¹´ä»£ä¸­ã€‚</li></ul></li><li><p><strong>ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼šTLAB</strong></p><ul><li><p><strong>é—®é¢˜ï¼šå †ç©ºé—´éƒ½æ˜¯å…±äº«çš„ä¹ˆï¼Ÿ</strong></p><p>  ä¸ä¸€å®šï¼Œå› ä¸ºè¿˜æœ‰TLABè¿™ä¸ªæ¦‚å¿µï¼Œåœ¨å †ä¸­åˆ’åˆ†å‡ºä¸€å—åŒºåŸŸï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹æ‰€ç‹¬å </p></li><li><p><strong>ä¸ºä»€ä¹ˆæœ‰TLABï¼Ÿ</strong></p><p>  ä»å†…å­˜æ¨¡å‹è€Œä¸æ˜¯åƒåœ¾æ”¶é›†çš„è§’åº¦ï¼Œå¯¹EdenåŒºåŸŸç»§ç»­è¿›è¡Œåˆ’åˆ†ï¼ŒJVMä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªç§æœ‰ç¼“å­˜åŒºåŸŸï¼Œå®ƒåŒ…å«åœ¨Edenç©ºé—´å†…ã€‚</p><p>  å¤šçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œä½¿ç”¨TLABå¯ä»¥é¿å…ä¸€ç³»åˆ—çš„éçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿæå‡å†…å­˜åˆ†é…çš„ååé‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¿™ç§å†…å­˜åˆ†é…æ–¹å¼ç§°ä¹‹ä¸ºå¿«é€Ÿåˆ†é…ç­–ç•¥ã€‚</p><p>  æ®æˆ‘æ‰€çŸ¥æ‰€æœ‰OpenJDKè¡ç”Ÿå‡ºæ¥çš„JVMéƒ½æä¾›äº†TLABçš„è®¾è®¡ã€‚</p><p>  <img src="/Untitled%2020.png" alt="Untitled"></p><p>  å°½ç®¡ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½èƒ½å¤Ÿåœ¨TLABä¸­æˆåŠŸåˆ†é…å†…å­˜ï¼Œä½†JVMç¡®å®æ˜¯å°†TLABä½œä¸ºå†…å­˜åˆ†é…çš„é¦–é€‰ã€‚</p><p>  åœ¨ç¨‹åºä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡é€‰é¡¹â€œ-Xx:UseTLABâ€è®¾ç½®æ˜¯å¦å¼€å¯TLABç©ºé—´ã€‚</p><p>  é»˜è®¤æƒ…å†µä¸‹ï¼ŒTLABç©ºé—´çš„å†…å­˜éå¸¸å°ï¼Œä»…å æœ‰æ•´ä¸ªEdenç©ºé—´çš„1ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰é¡¹â€œ-Xx:TLABWasteTargetPercentâ€è®¾ç½®TLABç©ºé—´æ‰€å ç”¨Edenç©ºé—´çš„ç™¾åˆ†æ¯”å¤§å°ã€‚</p><p>  ä¸€æ—¦å¯¹è±¡åœ¨TLABç©ºé—´åˆ†é…å†…å­˜å¤±è´¥æ—¶ï¼ŒJVMå°±ä¼šå°è¯•ç€é€šè¿‡ä½¿ç”¨åŠ é”æœºåˆ¶ç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§ï¼Œä»è€Œç›´æ¥åœ¨Edenç©ºé—´ä¸­åˆ†é…å†…å­˜ã€‚</p></li><li><p><strong>TLABåˆ†é…è¿‡ç¨‹</strong></p><p>  å¯¹è±¡é¦–å…ˆæ˜¯é€šè¿‡TLABå¼€è¾Ÿç©ºé—´ï¼Œå¦‚æœä¸èƒ½æ”¾å…¥ï¼Œé‚£ä¹ˆéœ€è¦é€šè¿‡Edenæ¥è¿›è¡Œåˆ†é…</p><p>  <img src="/Untitled%2021.png" alt="Untitled"></p></li></ul></li><li><p><strong>å°ç»“ï¼šå †ç©ºé—´çš„å‚æ•°è®¾ç½®</strong></p><ul><li>XXï¼š+PrintFlagsInitialï¼šæŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„é»˜è®¤åˆå§‹å€¼</li><li>XXï¼š+PrintFlagsFinalï¼šæŸ¥çœ‹æ‰€æœ‰çš„å‚æ•°çš„æœ€ç»ˆå€¼ï¼ˆå¯èƒ½ä¼šå­˜åœ¨ä¿®æ”¹ï¼Œä¸å†æ˜¯åˆå§‹å€¼ï¼‰</li><li><strong>Xmsï¼šåˆå§‹å †ç©ºé—´å†…å­˜ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;64ï¼‰</strong></li><li><strong>Xmxï¼šæœ€å¤§å †ç©ºé—´å†…å­˜ï¼ˆé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„1&#x2F;4ï¼‰</strong></li><li>Xmnï¼šè®¾ç½®æ–°ç”Ÿä»£çš„å¤§å°ã€‚ï¼ˆåˆå§‹å€¼åŠæœ€å¤§å€¼ï¼‰</li><li>XX:NewRatioï¼šé…ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£åœ¨å †ç»“æ„çš„å æ¯”</li><li>XX:SurvivorRatioï¼šè®¾ç½®æ–°ç”Ÿä»£ä¸­Edenå’ŒS0&#x2F;S1ç©ºé—´çš„æ¯”ä¾‹</li><li>XX:MaxTenuringThresholdï¼šè®¾ç½®æ–°ç”Ÿä»£åƒåœ¾çš„æœ€å¤§å¹´é¾„</li><li>XXï¼š+PrintGCDetailsï¼šè¾“å‡ºè¯¦ç»†çš„GCå¤„ç†æ—¥å¿—<ul><li>æ‰“å°gcç®€è¦ä¿¡æ¯ï¼šâ‘ -Xxï¼š+PrintGC â‘¡ - verbose:gc</li></ul></li><li>XX:HandlePromotionFalilureï¼šæ˜¯å¦è®¾ç½®ç©ºé—´åˆ†é…æ‹…ä¿</li></ul><p>  åœ¨å‘ç”ŸMinor GCä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„æ€»ç©ºé—´ã€‚</p><ul><li>å¦‚æœå¤§äºï¼Œåˆ™æ­¤æ¬¡Minor GCæ˜¯å®‰å…¨çš„</li><li>å¦‚æœå°äºï¼Œåˆ™è™šæ‹Ÿæœºä¼šæŸ¥çœ‹-xx:HandlePromotionFailureè®¾ç½®å€¼æ˜¯å¦å…æ‹…ä¿å¤±è´¥ã€‚<ul><li>å¦‚æœHandlePromotionFailure&#x3D;trueï¼Œé‚£ä¹ˆä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°ã€‚</li><li>å¦‚æœå¤§äºï¼Œåˆ™å°è¯•è¿›è¡Œä¸€æ¬¡Minor GCï¼Œä½†è¿™æ¬¡Minor GCä¾ç„¶æ˜¯æœ‰é£é™©çš„ï¼›</li><li>å¦‚æœå°äºï¼Œåˆ™æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡FullGCã€‚</li><li>å¦‚æœHandlePromotionFailure&#x3D;falseï¼Œåˆ™æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full GC</li></ul></li></ul><p>  åœ¨JDK6 Update24ä¹‹åï¼ŒHandlePromotionFailureå‚æ•°ä¸ä¼šå†å½±å“åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´åˆ†é…æ‹…ä¿ç­–ç•¥ï¼Œè§‚å¯ŸopenJDKä¸­çš„æºç å˜åŒ–ï¼Œè™½ç„¶æºç ä¸­è¿˜å®šä¹‰äº†HandlePromotionFailureå‚æ•°ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­å·²ç»ä¸ä¼šå†ä½¿ç”¨å®ƒã€‚JDK6 Update 24ä¹‹åçš„è§„åˆ™å˜ä¸ºåªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°æˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°å°±ä¼šè¿›è¡ŒMinor GCï¼Œå¦åˆ™å°†è¿›è¡ŒFullGCã€‚</p></li><li><p><strong>å †æ˜¯åˆ†é…å¯¹è±¡çš„å”¯ä¸€é€‰æ‹©ä¹ˆï¼Ÿ</strong></p><p>  <strong>åœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­å…³äºJavaå †å†…å­˜æœ‰è¿™æ ·ä¸€æ®µæè¿°ï¼š</strong></p><ol><li>éšç€JITç¼–è¯‘æœŸçš„å‘å±•ä¸<strong>é€ƒé€¸åˆ†ææŠ€æœ¯</strong>é€æ¸æˆç†Ÿï¼Œ<strong>æ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢</strong>ä¼˜åŒ–æŠ€æœ¯å°†ä¼šå¯¼è‡´ä¸€äº›å¾®å¦™çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åˆ°å †ä¸Šä¹Ÿæ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚</li><li>åœ¨Javaè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡æ˜¯åœ¨Javaå †ä¸­åˆ†é…å†…å­˜çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®éçš„å¸¸è¯†ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œé‚£å°±æ˜¯<strong>å¦‚æœç»è¿‡é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰åå‘ç°ï¼Œä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…</strong>ã€‚è¿™æ ·å°±æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œä¹Ÿæ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„å †å¤–å­˜å‚¨æŠ€æœ¯ã€‚</li><li>æ­¤å¤–ï¼Œå‰é¢æåˆ°çš„åŸºäºOpenJDKæ·±åº¦å®šåˆ¶çš„TaoBao VMï¼Œå…¶ä¸­åˆ›æ–°çš„GCIHï¼ˆGC invisible heapï¼‰æŠ€æœ¯å®ç°off-heapï¼Œå°†ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„Javaå¯¹è±¡ä»heapä¸­ç§»è‡³heapå¤–ï¼Œå¹¶ä¸”GCä¸èƒ½ç®¡ç†GCIHå†…éƒ¨çš„Javaå¯¹è±¡ï¼Œä»¥æ­¤è¾¾åˆ°é™ä½GCçš„å›æ”¶é¢‘ç‡å’Œæå‡GCçš„å›æ”¶æ•ˆç‡çš„ç›®çš„ã€‚</li></ol></li></ul><h3 id="6-é€ƒé€¸åˆ†æ"><a href="#6-é€ƒé€¸åˆ†æ" class="headerlink" title="6.é€ƒé€¸åˆ†æ"></a>6.<strong>é€ƒé€¸åˆ†æ</strong></h3><ul><li><p><strong>é€ƒé€¸åˆ†æ</strong></p><ol><li>å¦‚ä½•å°†å †ä¸Šçš„å¯¹è±¡åˆ†é…åˆ°æ ˆï¼Œéœ€è¦ä½¿ç”¨é€ƒé€¸åˆ†ææ‰‹æ®µã€‚</li><li>è¿™æ˜¯ä¸€ç§å¯ä»¥æœ‰æ•ˆå‡å°‘Javaç¨‹åºä¸­åŒæ­¥è´Ÿè½½å’Œå†…å­˜å †åˆ†é…å‹åŠ›çš„è·¨å‡½æ•°å…¨å±€æ•°æ®æµåˆ†æç®—æ³•ã€‚</li><li>é€šè¿‡é€ƒé€¸åˆ†æï¼ŒJava Hotspotç¼–è¯‘å™¨èƒ½å¤Ÿåˆ†æå‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡çš„å¼•ç”¨çš„ä½¿ç”¨èŒƒå›´ä»è€Œå†³å®šæ˜¯å¦è¦å°†è¿™ä¸ªå¯¹è±¡åˆ†é…åˆ°å †ä¸Šã€‚</li><li>é€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼š<ul><li>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå¯¹è±¡åªåœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œåˆ™è®¤ä¸ºæ²¡æœ‰å‘ç”Ÿé€ƒé€¸ã€‚</li><li>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå®ƒè¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œåˆ™è®¤ä¸ºå‘ç”Ÿé€ƒé€¸ã€‚ä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ä¸­ã€‚</li></ul></li></ol></li><li><p><strong>é€ƒé€¸åˆ†æä¸¾ä¾‹</strong></p><ul><li>æ²¡æœ‰å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥åˆ†é…åˆ°æ ˆï¼ˆæ— çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰ä¸Šï¼Œéšç€æ–¹æ³•æ‰§è¡Œçš„ç»“æŸï¼Œæ ˆç©ºé—´å°±è¢«ç§»é™¤ï¼ˆä¹Ÿå°±æ— éœ€GCï¼‰</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">my_method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">V</span> <span class="variable">v</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">V</span>();</span><br><span class="line">    <span class="comment">// use v</span></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    v = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸‹é¢ä»£ç ä¸­çš„ StringBuffer sb å‘ç”Ÿäº†é€ƒé€¸ï¼Œä¸èƒ½åœ¨æ ˆä¸Šåˆ†é…</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> StringBuffer <span class="title function_">createStringBuffer</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæƒ³è¦StringBuffer sbä¸å‘ç”Ÿé€ƒé€¸ï¼Œå¯ä»¥è¿™æ ·å†™</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createStringBuffer</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€ƒé€¸åˆ†æ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  å¦‚ä½•å¿«é€Ÿçš„åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†é€ƒé€¸åˆ†æï¼Œå¤§å®¶å°±çœ‹newçš„å¯¹è±¡å®ä½“æ˜¯å¦æœ‰å¯èƒ½åœ¨æ–¹æ³•å¤–è¢«è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EscapeAnalysis</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> EscapeAnalysis obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ–¹æ³•è¿”å›EscapeAnalysiså¯¹è±¡ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> EscapeAnalysis <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj == <span class="literal">null</span>? <span class="keyword">new</span> <span class="title class_">EscapeAnalysis</span>() : obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ä¸ºæˆå‘˜å±æ€§èµ‹å€¼ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setObj</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.obj = <span class="keyword">new</span> <span class="title class_">EscapeAnalysis</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ€è€ƒï¼šå¦‚æœå½“å‰çš„objå¼•ç”¨å£°æ˜ä¸ºstaticçš„ï¼Ÿä»ç„¶ä¼šå‘ç”Ÿé€ƒé€¸ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹è±¡çš„ä½œç”¨åŸŸä»…åœ¨å½“å‰æ–¹æ³•ä¸­æœ‰æ•ˆï¼Œæ²¡æœ‰å‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useEscapeAnalysis</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">EscapeAnalysis</span> <span class="variable">e</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EscapeAnalysis</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¼•ç”¨æˆå‘˜å˜é‡çš„å€¼ï¼Œå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">useEscapeAnalysis1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">EscapeAnalysis</span> <span class="variable">e</span> <span class="operator">=</span> getInstance();</span><br><span class="line">        <span class="comment">//getInstance().xxx()åŒæ ·ä¼šå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>é€ƒé€¸åˆ†æå‚æ•°è®¾ç½®</strong></p><ol><li>åœ¨JDK 1.7 ç‰ˆæœ¬ä¹‹åï¼ŒHotSpotä¸­é»˜è®¤å°±å·²ç»å¼€å¯äº†é€ƒé€¸åˆ†æ</li><li>å¦‚æœä½¿ç”¨çš„æ˜¯è¾ƒæ—©çš„ç‰ˆæœ¬ï¼Œå¼€å‘äººå‘˜åˆ™å¯ä»¥é€šè¿‡ï¼š<ul><li>é€‰é¡¹â€œ-XX:+DoEscapeAnalysisâ€æ˜¾å¼å¼€å¯é€ƒé€¸åˆ†æ</li><li>é€šè¿‡é€‰é¡¹â€œ-XX:+PrintEscapeAnalysisâ€æŸ¥çœ‹é€ƒé€¸åˆ†æçš„ç­›é€‰ç»“æœ</li></ul></li></ol></li><li><p><strong>ç»“è®º</strong></p><p>  å¼€å‘ä¸­èƒ½ä½¿ç”¨å±€éƒ¨å˜é‡çš„ï¼Œå°±ä¸è¦ä½¿ç”¨åœ¨æ–¹æ³•å¤–å®šä¹‰ã€‚</p><p>  ä½¿ç”¨é€ƒé€¸åˆ†æï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç åšå¦‚ä¸‹ä¼˜åŒ–ï¼š</p><ul><li>æ ˆä¸Šåˆ†é…ï¼šå°†å †åˆ†é…è½¬åŒ–ä¸ºæ ˆåˆ†é…ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨å­ç¨‹åºä¸­è¢«åˆ†é…ï¼Œè¦ä½¿æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆæ°¸è¿œä¸ä¼šå‘ç”Ÿé€ƒé€¸ï¼Œå¯¹è±¡å¯èƒ½æ˜¯æ ˆä¸Šåˆ†é…çš„å€™é€‰ï¼Œè€Œä¸æ˜¯å †ä¸Šåˆ†é…</li><li>åŒæ­¥çœç•¥ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å‘ç°åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå¯¹è±¡çš„æ“ä½œå¯ä»¥ä¸è€ƒè™‘åŒæ­¥ã€‚</li><li>åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢ï¼šæœ‰çš„å¯¹è±¡å¯èƒ½ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªè¿ç»­çš„å†…å­˜ç»“æ„å­˜åœ¨ä¹Ÿå¯ä»¥è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹è±¡çš„éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰å¯ä»¥ä¸å­˜å‚¨åœ¨å†…å­˜ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨CPUå¯„å­˜å™¨ä¸­ã€‚</li></ul></li></ul><h3 id="7-æ ˆä¸Šåˆ†é…"><a href="#7-æ ˆä¸Šåˆ†é…" class="headerlink" title="7.æ ˆä¸Šåˆ†é…"></a>7.<strong>æ ˆä¸Šåˆ†é…</strong></h3><ul><li><p><strong>æ ˆä¸Šåˆ†é…ä¸¾ä¾‹</strong></p><ul><li>JITç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´æ ¹æ®é€ƒé€¸åˆ†æçš„ç»“æœï¼Œå‘ç°å¦‚æœä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰é€ƒé€¸å‡ºæ–¹æ³•çš„è¯ï¼Œå°±å¯èƒ½è¢«ä¼˜åŒ–æˆæ ˆä¸Šåˆ†é…ã€‚åˆ†é…å®Œæˆåï¼Œç»§ç»­åœ¨è°ƒç”¨æ ˆå†…æ‰§è¡Œï¼Œæœ€åçº¿ç¨‹ç»“æŸï¼Œæ ˆç©ºé—´è¢«å›æ”¶ï¼Œå±€éƒ¨å˜é‡å¯¹è±¡ä¹Ÿè¢«å›æ”¶ã€‚è¿™æ ·å°±æ— é¡»è¿›è¡Œåƒåœ¾å›æ”¶äº†ã€‚</li><li>å¸¸è§çš„æ ˆä¸Šåˆ†é…çš„åœºæ™¯ï¼šåœ¨é€ƒé€¸åˆ†æä¸­ï¼Œå·²ç»è¯´æ˜äº†ï¼Œåˆ†åˆ«æ˜¯ç»™æˆå‘˜å˜é‡èµ‹å€¼ã€æ–¹æ³•è¿”å›å€¼ã€å®ä¾‹å¼•ç”¨ä¼ é€’ã€‚</li></ul></li><li><p>ä¸¾ä¾‹</p><ul><li><p>è®¾ç½®JVMå‚æ•°ï¼Œè¡¨ç¤ºæœªå¼€å¯é€ƒé€¸åˆ†æ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.heap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ˆä¸Šåˆ†é…ï¼š</span></span><br><span class="line"><span class="comment"> * -Xmx1G -Xms1G -XX:-DoEscapeAnalysis -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> * å¼€å¯é€ƒé€¸åˆ†æï¼š</span></span><br><span class="line"><span class="comment"> * -Xmx1G -Xms1G -XX:+DoEscapeAnalysis -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StackAllocation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            alloc();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹æ‰§è¡Œæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š &quot;</span> + (end - start) + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">        <span class="comment">// ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹å †å†…å­˜ä¸­å¯¹è±¡ä¸ªæ•°ï¼Œçº¿ç¨‹sleep</span></span><br><span class="line">        TimeUnit.MINUTES.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">alloc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();<span class="comment">//æœªå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> String age;</span><br><span class="line">        <span class="keyword">private</span> String gender;</span><br><span class="line">        <span class="keyword">private</span> String phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‚æ•°ï¼š<code>-Xmx1G -Xms1G -XX:-DoEscapeAnalysis -XX:+PrintGCDetails</code></p></li><li><p>è¿è¡Œç»“æœï¼ŒåŒæ—¶è¿˜è§¦å‘äº†GCæ“ä½œ</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[GC (Allocation Failure) [PSYoungGen: 262144K-&gt;728K(305664K)] 262144K-&gt;736K(1005056K), <span class="number">0.0007353</span> secs] [Times: user=<span class="number">0.00</span> sys=<span class="number">0.00</span>, real=<span class="number">0.00</span> secs] </span><br><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">120</span> ms</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æˆ‘ä»¬å¼€å¯é€ƒé€¸åˆ†æ</p><ul><li><p>å‚æ•°ï¼š<code>-Xmx1G -Xms1G -XX:+DoEscapeAnalysis -XX:+PrintGCDetails</code></p></li><li><p>è¿è¡Œç»“æœï¼šæ—¥å¿—æ‰“å°ï¼šå¹¶æ²¡æœ‰å‘ç”Ÿ GC ï¼Œè€—æ—¶5ms ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š <span class="number">5</span> ms</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="8-åŒæ­¥çœç•¥"><a href="#8-åŒæ­¥çœç•¥" class="headerlink" title="8.åŒæ­¥çœç•¥"></a>8.<strong>åŒæ­¥çœç•¥</strong></h3><ul><li><p>æ¦‚è¿°ï¼šçº¿ç¨‹åŒæ­¥çš„ä»£ä»·æ˜¯ç›¸å½“é«˜çš„ï¼ŒåŒæ­¥çš„åæœæ˜¯é™ä½å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚</p><p>  åœ¨åŠ¨æ€ç¼–è¯‘åŒæ­¥å—çš„æ—¶å€™ï¼ŒJITç¼–è¯‘å™¨å¯ä»¥å€ŸåŠ©é€ƒé€¸åˆ†ææ¥åˆ¤æ–­åŒæ­¥å—æ‰€ä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å¦åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®è€Œæ²¡æœ‰è¢«å‘å¸ƒåˆ°å…¶ä»–çº¿ç¨‹ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆJITç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªåŒæ­¥å—çš„æ—¶å€™å°±ä¼šå–æ¶ˆå¯¹è¿™éƒ¨åˆ†ä»£ç çš„åŒæ­¥ã€‚è¿™æ ·å°±èƒ½å¤§å¤§æé«˜å¹¶å‘æ€§å’Œæ€§èƒ½ã€‚è¿™ä¸ªå–æ¶ˆåŒæ­¥çš„è¿‡ç¨‹å°±å«åŒæ­¥çœç•¥ï¼Œä¹Ÿå«é”æ¶ˆé™¤ã€‚</p><p>  ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">hellis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">synchronized</span>(hellis) &#123;</span><br><span class="line">        System.out.println(hellis);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä»£ç ä¸­å¯¹hellisè¿™ä¸ªå¯¹è±¡åŠ é”ï¼Œä½†æ˜¯helliså¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåªåœ¨f()æ–¹æ³•ä¸­ï¼Œå¹¶ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€è®¿é—®åˆ°ï¼Œæ‰€ä»¥åœ¨JITç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«ä¼˜åŒ–æ‰ï¼Œä¼˜åŒ–æˆï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">hellis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">System.out.println(hellis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="keyword">new</span> #<span class="number">2</span> &lt;java/lang/Object&gt;</span><br><span class="line"><span class="number">3</span> dup</span><br><span class="line"><span class="number">4</span> invokespecial #<span class="number">1</span> &lt;java/lang/Object.&lt;init&gt;&gt;</span><br><span class="line"><span class="number">7</span> astore_1</span><br><span class="line"><span class="number">8</span> aload_1</span><br><span class="line"><span class="number">9</span> dup</span><br><span class="line"><span class="number">10</span> astore_2</span><br><span class="line"><span class="number">11</span> monitorenter</span><br><span class="line"><span class="number">12</span> getstatic #<span class="number">3</span> &lt;java/lang/System.out&gt;</span><br><span class="line"><span class="number">15</span> aload_1</span><br><span class="line"><span class="number">16</span> invokevirtual #<span class="number">4</span> &lt;java/io/PrintStream.println&gt;</span><br><span class="line"><span class="number">19</span> aload_2</span><br><span class="line"><span class="number">20</span> monitorexit</span><br><span class="line"><span class="number">21</span> <span class="keyword">goto</span> <span class="number">29</span> (+<span class="number">8</span>)</span><br><span class="line"><span class="number">24</span> astore_3</span><br><span class="line"><span class="number">25</span> aload_2</span><br><span class="line"><span class="number">26</span> monitorexit</span><br><span class="line"><span class="number">27</span> aload_3</span><br><span class="line"><span class="number">28</span> athrow</span><br><span class="line"><span class="number">29</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>  æ³¨æ„ï¼šå­—èŠ‚ç æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥çœ‹åˆ°åŠ é”å’Œé‡Šæ”¾é”çš„æ“ä½œä¾ç„¶å­˜åœ¨ï¼Œ<strong>åŒæ­¥çœç•¥æ“ä½œæ˜¯åœ¨è§£é‡Šè¿è¡Œæ—¶å‘ç”Ÿçš„</strong></p></li></ul><h3 id="9-åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢"><a href="#9-åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢" class="headerlink" title="9.åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢"></a>9.<strong>åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢</strong></h3><ol><li>æ ‡é‡ï¼ˆscalarï¼‰æ˜¯æŒ‡ä¸€ä¸ªæ— æ³•å†åˆ†è§£æˆæ›´å°çš„æ•°æ®çš„æ•°æ®ã€‚Javaä¸­çš„åŸå§‹æ•°æ®ç±»å‹å°±æ˜¯æ ‡é‡ã€‚</li><li>ç›¸å¯¹çš„ï¼Œé‚£äº›è¿˜å¯ä»¥åˆ†è§£çš„æ•°æ®å«åš<strong>èšåˆé‡ï¼ˆAggregateï¼‰</strong>ï¼ŒJavaä¸­çš„å¯¹è±¡å°±æ˜¯èšåˆé‡ï¼Œå› ä¸ºä»–å¯ä»¥åˆ†è§£æˆå…¶ä»–èšåˆé‡å’Œæ ‡é‡ã€‚</li><li>åœ¨JITé˜¶æ®µï¼Œå¦‚æœç»è¿‡é€ƒé€¸åˆ†æï¼Œå‘ç°ä¸€ä¸ªå¯¹è±¡ä¸ä¼šè¢«å¤–ç•Œè®¿é—®çš„è¯ï¼Œé‚£ä¹ˆç»è¿‡JITä¼˜åŒ–ï¼Œå°±ä¼šæŠŠè¿™ä¸ªå¯¹è±¡æ‹†è§£æˆè‹¥å¹²ä¸ªå…¶ä¸­åŒ…å«çš„è‹¥å¹²ä¸ªæˆå‘˜å˜é‡æ¥ä»£æ›¿ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ ‡é‡æ›¿æ¢ã€‚</li></ol><ul><li><p><strong>æ ‡é‡æ›¿æ¢ä¸¾ä¾‹</strong></p><ul><li>ä»£ç </li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">    alloc();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">alloc</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Point</span> <span class="variable">point</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Point</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;point.x&quot;</span> + point.x + <span class="string">&quot;;point.y&quot;</span> + point.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»¥ä¸Šä»£ç ï¼Œç»è¿‡æ ‡é‡æ›¿æ¢åï¼Œå°±ä¼šå˜æˆ</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">alloc</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;point.x = &quot;</span> + x + <span class="string">&quot;; point.y=&quot;</span> + y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¯ä»¥çœ‹åˆ°ï¼ŒPointè¿™ä¸ªèšåˆé‡ç»è¿‡é€ƒé€¸åˆ†æåï¼Œå‘ç°ä»–å¹¶æ²¡æœ‰é€ƒé€¸ï¼Œå°±è¢«æ›¿æ¢æˆä¸¤ä¸ªèšåˆé‡äº†ã€‚é‚£ä¹ˆæ ‡é‡æ›¿æ¢æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå°±æ˜¯å¯ä»¥å¤§å¤§å‡å°‘å †å†…å­˜çš„å ç”¨ã€‚å› ä¸ºä¸€æ—¦ä¸éœ€è¦åˆ›å»ºå¯¹è±¡äº†ï¼Œé‚£ä¹ˆå°±ä¸å†éœ€è¦åˆ†é…å †å†…å­˜äº†ã€‚ æ ‡é‡æ›¿æ¢ä¸ºæ ˆä¸Šåˆ†é…æä¾›äº†å¾ˆå¥½çš„åŸºç¡€ã€‚  </p></li><li><p><strong>æ ‡é‡æ›¿æ¢å‚æ•°è®¾ç½®</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.heap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸å¼€å¯æ ‡é‡æ›¿æ¢ï¼š</span></span><br><span class="line"><span class="comment"> *  -Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:-EliminateAllocations</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  25600K-&gt;816K(98304K), 0.0007805 secs]</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  26416K-&gt;832K(98304K), 0.0005552 secs]</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  26432K-&gt;704K(98304K), 0.0010244 secs]</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  26304K-&gt;752K(98304K), 0.0006991 secs]</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  26352K-&gt;704K(98304K), 0.0006366 secs]</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  26304K-&gt;720K(101376K), 0.0008407 secs]</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  32464K-&gt;652K(101376K), 0.0010512 secs]</span></span><br><span class="line"><span class="comment"> * [GC (Allocation Failure)  32396K-&gt;652K(100352K), 0.0003788 secs]</span></span><br><span class="line"><span class="comment"> * èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š 64 ms</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å¼€å¯æ ‡é‡æ›¿æ¢ï¼š</span></span><br><span class="line"><span class="comment"> *  -Xmx100m -Xms100m -XX:+DoEscapeAnalysis -XX:+PrintGC -XX:+EliminateAllocations</span></span><br><span class="line"><span class="comment"> *  èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š 4 ms</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScalarReplace</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line">        <span class="keyword">public</span> String name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">alloc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();<span class="comment">//æœªå‘ç”Ÿé€ƒé€¸</span></span><br><span class="line">        u.id = <span class="number">5</span>;</span><br><span class="line">        u.name = <span class="string">&quot;peppa&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            alloc();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;èŠ±è´¹çš„æ—¶é—´ä¸ºï¼š &quot;</span> + (end - start) + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>é€ƒé€¸åˆ†æçš„ä¸è¶³</strong></p><ol><li>å…³äºé€ƒé€¸åˆ†æçš„è®ºæ–‡åœ¨1999å¹´å°±å·²ç»å‘è¡¨äº†ï¼Œä½†ç›´åˆ°JDK1.6æ‰æœ‰å®ç°ï¼Œè€Œä¸”è¿™é¡¹æŠ€æœ¯åˆ°å¦‚ä»Šä¹Ÿå¹¶ä¸æ˜¯ååˆ†æˆç†Ÿçš„ã€‚</li><li>å…¶æ ¹æœ¬åŸå› å°±æ˜¯æ— æ³•ä¿è¯é€ƒé€¸åˆ†æçš„æ€§èƒ½æ¶ˆè€—ä¸€å®šèƒ½é«˜äºä»–çš„æ¶ˆè€—ã€‚è™½ç„¶ç»è¿‡é€ƒé€¸åˆ†æå¯ä»¥åšæ ‡é‡æ›¿æ¢ã€æ ˆä¸Šåˆ†é…ã€å’Œé”æ¶ˆé™¤ã€‚ä½†æ˜¯é€ƒé€¸åˆ†æè‡ªèº«ä¹Ÿæ˜¯éœ€è¦è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„åˆ†æçš„ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹è€—æ—¶çš„è¿‡ç¨‹ã€‚</li><li>ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œå°±æ˜¯ç»è¿‡é€ƒé€¸åˆ†æä¹‹åï¼Œå‘ç°æ²¡æœ‰ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸é€ƒé€¸çš„ã€‚é‚£è¿™ä¸ªé€ƒé€¸åˆ†æçš„è¿‡ç¨‹å°±ç™½ç™½æµªè´¹æ‰äº†ã€‚</li><li>è™½ç„¶è¿™é¡¹æŠ€æœ¯å¹¶ä¸ååˆ†æˆç†Ÿï¼Œä½†æ˜¯å®ƒä¹Ÿæ˜¯å³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–æŠ€æœ¯ä¸­ä¸€ä¸ªååˆ†é‡è¦çš„æ‰‹æ®µã€‚</li><li>æ³¨æ„åˆ°æœ‰ä¸€äº›è§‚ç‚¹ï¼Œè®¤ä¸ºé€šè¿‡é€ƒé€¸åˆ†æï¼ŒJVMä¼šåœ¨æ ˆä¸Šåˆ†é…é‚£äº›ä¸ä¼šé€ƒé€¸çš„å¯¹è±¡ï¼Œè¿™åœ¨ç†è®ºä¸Šæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å–å†³äºJVMè®¾è®¡è€…çš„é€‰æ‹©ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œ<strong>Oracle Hotspot JVMä¸­å¹¶æœªè¿™ä¹ˆåš</strong>ï¼ˆåˆšåˆšæ¼”ç¤ºçš„æ•ˆæœï¼Œæ˜¯å› ä¸ºHotSpotå®ç°äº†æ ‡é‡æ›¿æ¢ï¼‰ï¼Œè¿™ä¸€ç‚¹åœ¨é€ƒé€¸åˆ†æç›¸å…³çš„æ–‡æ¡£é‡Œå·²ç»è¯´æ˜ï¼Œ<strong>æ‰€ä»¥å¯ä»¥æ˜ç¡®åœ¨HotSpotè™šæ‹Ÿæœºä¸Šï¼Œæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ›å»ºåœ¨å †ä¸Š</strong>ã€‚</li><li>ç›®å‰å¾ˆå¤šä¹¦ç±è¿˜æ˜¯åŸºäºJDK7ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒJDKå·²ç»å‘ç”Ÿäº†å¾ˆå¤§å˜åŒ–ï¼Œinternå­—ç¬¦ä¸²çš„ç¼“å­˜å’Œé™æ€å˜é‡æ›¾ç»éƒ½è¢«åˆ†é…åœ¨æ°¸ä¹…ä»£ä¸Šï¼Œè€Œæ°¸ä¹…ä»£å·²ç»è¢«å…ƒæ•°æ®åŒºå–ä»£ã€‚ä½†æ˜¯<strong>internå­—ç¬¦ä¸²ç¼“å­˜å’Œé™æ€å˜é‡å¹¶ä¸æ˜¯è¢«è½¬ç§»åˆ°å…ƒæ•°æ®åŒºï¼Œè€Œæ˜¯ç›´æ¥åœ¨å †ä¸Šåˆ†é…</strong>ï¼Œ<strong>æ‰€ä»¥è¿™ä¸€ç‚¹åŒæ ·ç¬¦åˆå‰é¢ä¸€ç‚¹çš„ç»“è®ºï¼šå¯¹è±¡å®ä¾‹éƒ½æ˜¯åˆ†é…åœ¨å †ä¸Š</strong>ã€‚</li></ol></li><li><p><strong>å°ç»“</strong></p><ol><li>å¹´è½»ä»£æ˜¯å¯¹è±¡çš„è¯ç”Ÿã€æˆé•¿ã€æ¶ˆäº¡çš„åŒºåŸŸï¼Œä¸€ä¸ªå¯¹è±¡åœ¨è¿™é‡Œäº§ç”Ÿã€åº”ç”¨ï¼Œæœ€åè¢«åƒåœ¾å›æ”¶å™¨æ”¶é›†ã€ç»“æŸç”Ÿå‘½ã€‚</li><li>è€å¹´ä»£æ”¾ç½®é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œé€šå¸¸éƒ½æ˜¯ä»SurvivoråŒºåŸŸç­›é€‰æ‹·è´è¿‡æ¥çš„Javaå¯¹è±¡ã€‚</li><li>å½“ç„¶ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬çŸ¥é“æ™®é€šçš„å¯¹è±¡å¯èƒ½ä¼šè¢«åˆ†é…åœ¨TLABä¸Šï¼›</li><li>å¦‚æœå¯¹è±¡è¾ƒå¤§ï¼Œæ— æ³•åˆ†é…åœ¨ TLAB ä¸Šï¼Œåˆ™JVMä¼šè¯•å›¾ç›´æ¥åˆ†é…åœ¨Edenå…¶ä»–ä½ç½®ä¸Šï¼›</li><li>å¦‚æœå¯¹è±¡å¤ªå¤§ï¼Œå®Œå…¨æ— æ³•åœ¨æ–°ç”Ÿä»£æ‰¾åˆ°è¶³å¤Ÿé•¿çš„è¿ç»­ç©ºé—²ç©ºé—´ï¼ŒJVMå°±ä¼šç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚</li><li>å½“GCåªå‘ç”Ÿåœ¨å¹´è½»ä»£ä¸­ï¼Œå›æ”¶å¹´è½»ä»£å¯¹è±¡çš„è¡Œä¸ºè¢«ç§°ä¸ºMinor GCã€‚</li><li>å½“GCå‘ç”Ÿåœ¨è€å¹´ä»£æ—¶åˆ™è¢«ç§°ä¸ºMajor GCæˆ–è€…Full GCã€‚</li><li>ä¸€èˆ¬çš„ï¼ŒMinor GCçš„å‘ç”Ÿé¢‘ç‡è¦æ¯”Major GCé«˜å¾ˆå¤šï¼Œå³è€å¹´ä»£ä¸­åƒåœ¾å›æ”¶å‘ç”Ÿçš„é¢‘ç‡å°†å¤§å¤§ä½äºå¹´è½»ä»£ã€‚</li></ol></li></ul>]]></content>
    
    
    <summary type="html">æ¦‚è¿°:Java è™šæ‹Ÿæœºæœ‰ä¸€ä¸ªå †ï¼Œå®ƒåœ¨æ‰€æœ‰ Java è™šæ‹Ÿæœºçº¿ç¨‹ä¹‹é—´å…±äº«ã€‚å †æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œä»ä¸­åˆ†é…æ‰€æœ‰ç±»å®ä¾‹å’Œæ•°ç»„çš„å†…å­˜ã€‚</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>VMè™šæ‹Ÿæœºè¯¦è§£(ä¸ƒ)**è™šæ‹Ÿæœºæ ˆVirtual Machine Stacks</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%B8%83)%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88Virtual%20Machine%20Stacks/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%B8%83)%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88Virtual%20Machine%20Stacks/</id>
    <published>2023-02-06T16:00:00.000Z</published>
    <updated>2025-09-03T15:16:25.428Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-ä¸ƒ-è™šæ‹Ÿæœºæ ˆVirtual-Machine-Stacks"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-ä¸ƒ-è™šæ‹Ÿæœºæ ˆVirtual-Machine-Stacks" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(ä¸ƒ)è™šæ‹Ÿæœºæ ˆVirtual Machine Stacks"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(ä¸ƒ)<strong>è™šæ‹Ÿæœºæ ˆVirtual Machine Stacks</strong></h2><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h3><p>æ¯ä¸ª Java è™šæ‹Ÿæœºçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸“ç”¨çš„ Java è™šæ‹Ÿæœºå †æ ˆï¼Œä¸çº¿ç¨‹åŒæ—¶åˆ›å»ºã€‚Java è™šæ‹Ÿæœºå †æ ˆå­˜å‚¨å¸§(2.6)ã€‚Java è™šæ‹Ÿæœºå †æ ˆç±»ä¼¼äºä¼ ç»Ÿè¯­è¨€(å¦‚ c)çš„å †æ ˆ: å®ƒä¿å­˜å±€éƒ¨å˜é‡å’Œéƒ¨åˆ†ç»“æœï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›ä¸­å‘æŒ¥ä½œç”¨ã€‚å› ä¸º Java è™šæ‹Ÿæœºå †æ ˆä»æ¥ä¸ä¼šè¢«ç›´æ¥æ“ä½œï¼Œé™¤äº†æ¨é€å’Œå¼¹å‡ºæ¡†æ¶ï¼Œæ¡†æ¶å¯èƒ½ä¼šè¢«åˆ†é…åˆ°å †ä¸­ã€‚Java è™šæ‹Ÿæœºå †æ ˆçš„å†…å­˜ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚</p><p><em>åœ¨ Java è™šæ‹Ÿæœºè§„èŒƒçš„ç¬¬ä¸€ç‰ˆä¸­ï¼ŒJava è™šæ‹Ÿæœºå †æ ˆè¢«ç§°ä¸º Java å †æ ˆã€‚</em></p><p>è¯¥è§„èŒƒå…è®¸ Java è™šæ‹Ÿæœºå †æ ˆå…·æœ‰å›ºå®šçš„å¤§å°ï¼Œæˆ–è€…æ ¹æ®è®¡ç®—çš„éœ€è¦åŠ¨æ€æ‰©å±•å’Œæ”¶ç¼©ã€‚å¦‚æœ Java è™šæ‹Ÿæœºå †æ ˆçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºè¯¥å †æ ˆæ—¶å¯ä»¥ç‹¬ç«‹åœ°é€‰æ‹©æ¯ä¸ª Java è™šæ‹Ÿæœºå †æ ˆçš„å¤§å°ã€‚</p><p>ä¸€ä¸ª Java è™šæ‹Ÿæœºå®ç°å¯ä»¥ä¸ºç¨‹åºå‘˜æˆ–ç”¨æˆ·æä¾›å¯¹ Java è™šæ‹Ÿæœºå †æ ˆåˆå§‹å¤§å°çš„æ§åˆ¶ï¼Œä»¥åŠï¼Œåœ¨åŠ¨æ€æ‰©å±•æˆ–æ”¶ç¼© Java è™šæ‹Ÿæœºå †æ ˆçš„æƒ…å†µä¸‹ï¼Œå¯¹æœ€å¤§å’Œæœ€å°å¤§å°çš„æ§åˆ¶ã€‚</p><ul><li><strong>ä¸‹åˆ—å¼‚å¸¸æƒ…å†µä¸ Java è™šæ‹Ÿæœºå †æ ˆç›¸å…³:</strong><ul><li>å¦‚æœçº¿ç¨‹ä¸­çš„è®¡ç®—éœ€è¦æ¯”å…è®¸çš„æ›´å¤§çš„ Java è™šæ‹Ÿæœºå †æ ˆï¼Œåˆ™ Java è™šæ‹ŸæœºæŠ›å‡º StackOverflowErrorã€‚</li><li>å¦‚æœ Java è™šæ‹Ÿæœºå †æ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¹¶ä¸”å°è¯•æ‰©å±•ï¼Œä½†æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥å®ç°æ‰©å±•ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥ä¸ºæ–°çº¿ç¨‹åˆ›å»ºåˆå§‹çš„ Java è™šæ‹Ÿæœºå †æ ˆï¼ŒJava è™šæ‹ŸæœºæŠ›å‡º OutOfMemoryErrorã€‚</li></ul></li><li>é»˜è®¤å †å¤§å°ï¼š<ul><li>Xmsï¼šåˆå§‹å¤§å°å†…å­˜ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜64&#x2F;1ï¼Œç­‰ä»·äº-XX:InitialHeapSize</li><li>Xmxï¼šæœ€å¤§åˆ†é…å†…å­˜ï¼Œé»˜è®¤ä¸ºç‰©ç†å†…å­˜çš„4&#x2F;1ï¼Œç­‰ä»·äºï¼š-XXMaxHeapSize</li></ul></li><li>é»˜è®¤æ ˆå¤§å°ï¼š<ul><li>XX:ThreadStackSizeè®¾ä¸º0ï¼Œå°±æ˜¯ä½¿ç”¨â€œç³»ç»Ÿé»˜è®¤å€¼â€ã€‚è€Œåœ¨Linux x64ä¸ŠHotSpot VMç»™Javaæ ˆå®šä¹‰çš„â€œç³»ç»Ÿé»˜è®¤â€å¤§å°ä¹Ÿæ˜¯1MBã€‚</li></ul></li></ul><p>å®˜ç½‘ï¼š<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.6">ChapterÂ 2.Â The Structure of the Java Virtual Machine (oracle.com)</a></p><ul><li>é¦–å…ˆæ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œå †æ˜¯å­˜å‚¨çš„å•ä½<ul><li><p>æ ˆè§£å†³ç¨‹åºçš„è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œæˆ–è€…è¯´å¦‚ä½•å¤„ç†æ•°æ®ã€‚</p></li><li><p>å †è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ï¼Œæ”¾å“ªé‡Œ</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image.png" alt="Untitled"></p></li></ul></li></ul><p>Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰ï¼Œæ—©æœŸä¹Ÿå«Javaæ ˆã€‚æ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œå…¶å†…éƒ¨ä¿å­˜ä¸€ä¸ªä¸ªçš„æ ˆå¸§ï¼ˆStack Frameï¼‰ï¼Œå¯¹åº”ç€ä¸€æ¬¡æ¬¡çš„Javaæ–¹æ³•è°ƒç”¨ã€‚</p><p><img src="/images/jvm_virtual_machine/chapter7/image1.png" alt="Untitled"></p><ul><li><p><strong>ç”Ÿå‘½å‘¨æœŸ</strong></p><p>  ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ç»“æŸäº†ï¼Œè¯¥è™šæ‹Ÿæœºæ ˆä¹Ÿé”€æ¯äº†</p></li><li><h2 id="ä½œç”¨-ä¸»ç®¡Javaç¨‹åºçš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚-å±€éƒ¨å˜é‡ï¼Œå®ƒæ˜¯ç›¸æ¯”äºæˆå‘˜å˜é‡æ¥è¯´çš„ï¼ˆæˆ–å±æ€§ï¼‰-åŸºæœ¬æ•°æ®ç±»å‹å˜é‡-VS-å¼•ç”¨ç±»å‹å˜é‡ï¼ˆç±»ã€æ•°ç»„ã€æ¥å£ï¼‰"><a href="#ä½œç”¨-ä¸»ç®¡Javaç¨‹åºçš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚-å±€éƒ¨å˜é‡ï¼Œå®ƒæ˜¯ç›¸æ¯”äºæˆå‘˜å˜é‡æ¥è¯´çš„ï¼ˆæˆ–å±æ€§ï¼‰-åŸºæœ¬æ•°æ®ç±»å‹å˜é‡-VS-å¼•ç”¨ç±»å‹å˜é‡ï¼ˆç±»ã€æ•°ç»„ã€æ¥å£ï¼‰" class="headerlink" title="ä½œç”¨  - ä¸»ç®¡Javaç¨‹åºçš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚  - å±€éƒ¨å˜é‡ï¼Œå®ƒæ˜¯ç›¸æ¯”äºæˆå‘˜å˜é‡æ¥è¯´çš„ï¼ˆæˆ–å±æ€§ï¼‰  - åŸºæœ¬æ•°æ®ç±»å‹å˜é‡ VS å¼•ç”¨ç±»å‹å˜é‡ï¼ˆç±»ã€æ•°ç»„ã€æ¥å£ï¼‰"></a><strong>ä½œç”¨</strong><br>  - ä¸»ç®¡Javaç¨‹åºçš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€éƒ¨åˆ†ç»“æœï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›ã€‚<br>  - <em>å±€éƒ¨å˜é‡ï¼Œå®ƒæ˜¯ç›¸æ¯”äºæˆå‘˜å˜é‡æ¥è¯´çš„ï¼ˆæˆ–å±æ€§ï¼‰</em><br>  - <em>åŸºæœ¬æ•°æ®ç±»å‹å˜é‡ VS å¼•ç”¨ç±»å‹å˜é‡ï¼ˆç±»ã€æ•°ç»„ã€æ¥å£ï¼‰</em></h2></li><li><p><strong>è™šæ‹Ÿæœºæ ˆçš„ç‰¹ç‚¹</strong></p><ul><li>æ ˆæ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„åˆ†é…å­˜å‚¨æ–¹å¼ï¼Œè®¿é—®é€Ÿåº¦ä»…æ¬¡äºç¨‹åºè®¡æ•°å™¨ã€‚</li><li>JVMç›´æ¥å¯¹Javaæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼š<ul><li>æ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€<strong>è¿›æ ˆ</strong>ï¼ˆå…¥æ ˆã€å‹æ ˆï¼‰</li><li>æ‰§è¡Œç»“æŸåçš„<strong>å‡ºæ ˆ</strong>å·¥ä½œ</li></ul></li></ul></li><li><p>å¯¹äºæ ˆæ¥è¯´ä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜</p><ul><li>æ ˆä¸éœ€è¦GCï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨OOM</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter7/image2.png" alt="Untitled">  </p></li><li><p><strong>è®¾ç½®æ ˆå†…å­˜å¤§å°</strong></p><ul><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°Â <strong>-Xss</strong>Â é€‰é¡¹æ¥è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦ã€‚</li></ul><blockquote><p>Sets the thread stack size (in bytes). Append the letterÂ kÂ orÂ KÂ to indicate KB,Â mÂ orÂ MÂ to indicate MB, andÂ gÂ orÂ GÂ to indicate GB. The default value depends on the platform:</p><ul><li>Linux&#x2F;x64 (64-bit): 1024 KB</li><li>macOS (64-bit): 1024 KB</li><li>Oracle Solaris&#x2F;x64 (64-bit): 1024 KB</li><li>Windows: The default value depends on virtual memory</li></ul></blockquote><p>  The following examples set the thread stack size to 1024 KB in different units:</p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-Xss1m</span></span><br><span class="line"><span class="literal">-Xss1024k</span></span><br><span class="line"><span class="literal">-Xss1048576</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸¾ä¾‹ï¼š</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.stack;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¼”ç¤ºæ ˆä¸­çš„å¼‚å¸¸ï¼šStackOverflowError</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-02-10 15:35:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StackErrorTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤å‚æ•°ï¼šå½“æ ˆæ·±åº¦è¾¾åˆ°ï¼š9826ï¼Œå‡ºç°å†…å­˜ç©ºé—´ä¸è¶³ã€‚æŠ¥é”™ï¼šException in thread &quot;main&quot; java.lang.StackOverflowError</span></span><br><span class="line"><span class="comment">     * æ·»åŠ å‚æ•°ï¼š-Xss128kï¼Œå½“æ ˆæ·±åº¦è¾¾åˆ°ï¼š982ã€‚æŠ¥é”™ï¼šException in thread &quot;main&quot; java.lang.StackOverflowError</span></span><br><span class="line"><span class="comment">     * at java.io.PrintStream.write(PrintStream.java:526)</span></span><br><span class="line"><span class="comment">     * at java.io.PrintStream.print(PrintStream.java:597)</span></span><br><span class="line"><span class="comment">     * at java.io.PrintStream.println(PrintStream.java:736)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(count++);</span><br><span class="line">        main(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-æ ˆçš„å­˜å‚¨å•ä½"><a href="#2-æ ˆçš„å­˜å‚¨å•ä½" class="headerlink" title="2.æ ˆçš„å­˜å‚¨å•ä½"></a>2.<strong>æ ˆçš„å­˜å‚¨å•ä½</strong></h3><ul><li><p><strong>æ ˆä¸­å­˜å‚¨ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œæ ˆä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥æ ˆå¸§ï¼ˆStack Frameï¼‰çš„æ ¼å¼å­˜åœ¨ã€‚</li><li>åœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªå¯¹åº”ä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ã€‚</li><li>æ ˆå¸§æ˜¯ä¸€ä¸ªå†…å­˜åŒºå—ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç»´ç³»ç€æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ•°æ®ä¿¡æ¯ã€‚</li></ul></li><li><p><strong>æ ˆè¿è¡ŒåŸç†</strong></p><ol><li>JVMç›´æ¥å¯¹Javaæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯å¯¹æ ˆå¸§çš„<strong>å‹æ ˆå’Œå‡ºæ ˆ</strong>ï¼Œéµå¾ªå…ˆè¿›åå‡ºï¼ˆåè¿›å…ˆå‡ºï¼‰åŸåˆ™</li><li>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆæ ˆé¡¶æ ˆå¸§ï¼‰æ˜¯æœ‰æ•ˆçš„ã€‚è¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸º<strong>å½“å‰æ ˆå¸§ï¼ˆCurrent Frameï¼‰</strong>ï¼Œä¸å½“å‰æ ˆå¸§ç›¸å¯¹åº”çš„æ–¹æ³•å°±æ˜¯<strong>å½“å‰æ–¹æ³•ï¼ˆCurrent Methodï¼‰</strong>ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯<strong>å½“å‰ç±»ï¼ˆCurrent Classï¼‰</strong></li><li>æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œã€‚</li><li>å¦‚æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„æ–°çš„æ ˆå¸§ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œæˆä¸ºæ–°çš„å½“å‰å¸§ã€‚</li><li><strong>ä¸åŒçº¿ç¨‹ä¸­æ‰€åŒ…å«çš„æ ˆå¸§æ˜¯ä¸å…è®¸å­˜åœ¨ç›¸äº’å¼•ç”¨çš„</strong>ï¼Œå³ä¸å¯èƒ½åœ¨ä¸€ä¸ªæ ˆå¸§ä¹‹ä¸­å¼•ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¸§ã€‚</li><li>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ä¹‹é™…ï¼Œå½“å‰æ ˆå¸§ä¼šä¼ å›æ­¤æ–¹æ³•çš„æ‰§è¡Œç»“æœç»™å‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¥ç€ï¼Œè™šæ‹Ÿæœºä¼šä¸¢å¼ƒå½“å‰æ ˆå¸§ï¼Œä½¿å¾—å‰ä¸€ä¸ªæ ˆå¸§é‡æ–°æˆä¸ºå½“å‰æ ˆå¸§ã€‚</li><li>Javaæ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ã€‚<ul><li>ä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨returnæŒ‡ä»¤ã€‚</li><li>å¦ä¸€ç§æ˜¯æ–¹æ³•æ‰§è¡Œä¸­å‡ºç°æœªæ•è·å¤„ç†çš„å¼‚å¸¸ï¼Œä»¥æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼ç»“æŸã€‚</li><li>ä½†ä¸ç®¡ä½¿ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡ºã€‚</li></ul></li></ol><p>  <img src="/images/jvm_virtual_machine/chapter7/image3.png" alt="Untitled">  </p></li><li><p><strong>æ ˆå¸§çš„å†…éƒ¨ç»“æ„</strong></p><p>  æ¯ä¸ªæ ˆå¸§ä¸­å­˜å‚¨ç€ï¼š</p><ul><li><p>å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰</p></li><li><p>æ“ä½œæ•°æ ˆï¼ˆoperand Stackï¼‰ï¼ˆæˆ–è¡¨è¾¾å¼æ ˆï¼‰</p></li><li><p>åŠ¨æ€é“¾æ¥ï¼ˆDynamicLinkingï¼‰ï¼ˆæˆ–æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼‰</p></li><li><p>æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰ï¼ˆæˆ–æ–¹æ³•æ­£å¸¸é€€å‡ºæˆ–è€…å¼‚å¸¸é€€å‡ºçš„å®šä¹‰ï¼‰</p></li><li><p>ä¸€äº›é™„åŠ ä¿¡æ¯</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image4.png" alt="Untitled"></p><p>  å¹¶è¡Œæ¯ä¸ªçº¿ç¨‹ä¸‹çš„æ ˆéƒ½æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±å„è‡ªçš„æ ˆï¼Œå¹¶ä¸”æ¯ä¸ªæ ˆé‡Œé¢éƒ½æœ‰å¾ˆå¤šæ ˆå¸§ï¼Œæ ˆå¸§çš„å¤§å°ä¸»è¦ç”±å±€éƒ¨å˜é‡è¡¨ å’Œ æ“ä½œæ•°æ ˆå†³å®šçš„</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image5.png" alt="Untitled"></p></li></ul></li></ul><h3 id="3-å±€éƒ¨å˜é‡è¡¨"><a href="#3-å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="3.å±€éƒ¨å˜é‡è¡¨"></a>3.<strong>å±€éƒ¨å˜é‡è¡¨</strong></h3><ul><li><p>æ¦‚è¿°ï¼š</p><ol><li>å±€éƒ¨å˜é‡è¡¨ä¹Ÿè¢«ç§°ä¹‹ä¸ºå±€éƒ¨å˜é‡æ•°ç»„æˆ–æœ¬åœ°å˜é‡è¡¨</li><li><strong>å®šä¹‰ä¸ºä¸€ä¸ªæ•°å­—æ•°ç»„ï¼Œä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡</strong>ï¼Œè¿™äº›æ•°æ®ç±»å‹åŒ…æ‹¬å„ç±»åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œä»¥åŠreturnAddressè¿”å›å€¼ç±»å‹ã€‚</li><li>ç”±äºå±€éƒ¨å˜é‡è¡¨æ˜¯å»ºç«‹åœ¨çº¿ç¨‹çš„æ ˆä¸Šï¼Œæ˜¯çº¿ç¨‹çš„ç§æœ‰æ•°æ®ï¼Œå› æ­¤<strong>ä¸å­˜åœ¨æ•°æ®å®‰å…¨é—®é¢˜</strong></li><li><strong>å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å®¹é‡å¤§å°æ˜¯åœ¨ç¼–è¯‘æœŸç¡®å®šä¸‹æ¥çš„</strong>ï¼Œå¹¶ä¿å­˜åœ¨æ–¹æ³•çš„Codeå±æ€§çš„<strong>maximum local variables</strong>æ•°æ®é¡¹ä¸­ã€‚åœ¨æ–¹æ³•è¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°çš„ã€‚</li><li>æ–¹æ³•åµŒå¥—è°ƒç”¨çš„æ¬¡æ•°ç”±æ ˆçš„å¤§å°å†³å®šã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ ˆè¶Šå¤§ï¼Œæ–¹æ³•åµŒå¥—è°ƒç”¨æ¬¡æ•°è¶Šå¤šã€‚<ul><li>å¯¹ä¸€ä¸ªå‡½æ•°è€Œè¨€ï¼Œå®ƒçš„å‚æ•°å’Œå±€éƒ¨å˜é‡è¶Šå¤šï¼Œä½¿å¾—å±€éƒ¨å˜é‡è¡¨è†¨èƒ€ï¼Œå®ƒçš„æ ˆå¸§å°±è¶Šå¤§ï¼Œä»¥æ»¡è¶³æ–¹æ³•è°ƒç”¨æ‰€éœ€ä¼ é€’çš„ä¿¡æ¯å¢å¤§çš„éœ€æ±‚ã€‚</li><li>è¿›è€Œå‡½æ•°è°ƒç”¨å°±ä¼šå ç”¨æ›´å¤šçš„æ ˆç©ºé—´ï¼Œå¯¼è‡´å…¶åµŒå¥—è°ƒç”¨æ¬¡æ•°å°±ä¼šå‡å°‘ã€‚</li></ul></li><li>å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡åªåœ¨å½“å‰æ–¹æ³•è°ƒç”¨ä¸­æœ‰æ•ˆã€‚<ul><li>åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºé€šè¿‡ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆå‚æ•°å€¼åˆ°å‚æ•°å˜é‡åˆ—è¡¨çš„ä¼ é€’è¿‡ç¨‹ã€‚</li><li>å½“æ–¹æ³•è°ƒç”¨ç»“æŸåï¼Œéšç€æ–¹æ³•æ ˆå¸§çš„é”€æ¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚</li></ul></li></ol></li><li><p><strong>å…³äºSlotçš„ç†è§£</strong></p><ul><li><p>å‚æ•°å€¼çš„å­˜æ”¾æ€»æ˜¯åœ¨å±€éƒ¨å˜é‡æ•°ç»„çš„index0å¼€å§‹ï¼Œåˆ°æ•°ç»„é•¿åº¦-1çš„ç´¢å¼•ç»“æŸã€‚</p></li><li><p>å±€éƒ¨å˜é‡è¡¨ï¼Œæœ€åŸºæœ¬çš„å­˜å‚¨å•å…ƒæ˜¯Slotï¼ˆå˜é‡æ§½ï¼‰å±€éƒ¨å˜é‡è¡¨ä¸­å­˜æ”¾ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ8ç§ï¼‰ï¼Œå¼•ç”¨ç±»å‹ï¼ˆreferenceï¼‰ï¼ŒreturnAddressç±»å‹çš„å˜é‡ã€‚</p></li><li><p>åœ¨å±€éƒ¨å˜é‡è¡¨é‡Œï¼Œ32ä½ä»¥å†…çš„ç±»å‹åªå ç”¨ä¸€ä¸ªslotï¼ˆåŒ…æ‹¬returnAddressç±»å‹ï¼‰ï¼Œ64ä½çš„ç±»å‹ï¼ˆ1ongå’Œdoubleï¼‰å ç”¨ä¸¤ä¸ªslotã€‚</p><ul><li>byteã€shortã€char åœ¨å­˜å‚¨å‰è¢«è½¬æ¢ä¸ºintï¼Œbooleanä¹Ÿè¢«è½¬æ¢ä¸ºintï¼Œ0è¡¨ç¤ºfalseï¼Œé0è¡¨ç¤ºtrueã€‚ 1ongå’Œdoubleåˆ™å æ®ä¸¤ä¸ªslotã€‚</li></ul></li><li><p>JVMä¼šä¸ºå±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªSlotéƒ½åˆ†é…ä¸€ä¸ªè®¿é—®ç´¢å¼•ï¼Œé€šè¿‡è¿™ä¸ªç´¢å¼•å³å¯æˆåŠŸè®¿é—®åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­æŒ‡å®šçš„å±€éƒ¨å˜é‡å€¼ï¼Œå½“ä¸€ä¸ªå®ä¾‹æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒçš„æ–¹æ³•å‚æ•°å’Œæ–¹æ³•ä½“å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡å°†ä¼šæŒ‰ç…§é¡ºåºè¢«å¤åˆ¶åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ¯ä¸€ä¸ªslotä¸Šï¼Œå¦‚æœéœ€è¦è®¿é—®å±€éƒ¨å˜é‡è¡¨ä¸­ä¸€ä¸ª64bitçš„å±€éƒ¨å˜é‡å€¼æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨å‰ä¸€ä¸ªç´¢å¼•å³å¯ã€‚ï¼ˆæ¯”å¦‚ï¼šè®¿é—®1ongæˆ–doub1eç±»å‹å˜é‡ï¼‰</p></li><li><p>å¦‚æœå½“å‰å¸§æ˜¯ç”±æ„é€ æ–¹æ³•æˆ–è€…å®ä¾‹æ–¹æ³•åˆ›å»ºçš„ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å¼•ç”¨thiså°†ä¼šå­˜æ”¾åœ¨indexä¸º0çš„s1otå¤„ï¼Œå…¶ä½™çš„å‚æ•°æŒ‰ç…§å‚æ•°è¡¨é¡ºåºç»§ç»­æ’åˆ—ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image6.png" alt="Untitled"></p></li></ul></li><li><p><strong>Slotçš„é‡å¤åˆ©ç”¨</strong></p><p>  æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­çš„æ§½ä½æ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œå¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¿‡äº†å…¶ä½œç”¨åŸŸï¼Œé‚£ä¹ˆåœ¨å…¶ä½œç”¨åŸŸä¹‹åç”³æ˜çš„æ–°çš„å±€éƒ¨å˜å°±å¾ˆæœ‰å¯èƒ½ä¼šå¤ç”¨è¿‡æœŸå±€éƒ¨å˜é‡çš„æ§½ä½ï¼Œä»è€Œè¾¾åˆ°èŠ‚çœèµ„æºçš„ç›®çš„ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            b = a + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å˜é‡cä½¿ç”¨ä¹‹å‰å·²ç»é”€æ¯çš„å˜é‡bå æ®çš„slotçš„ä½ç½®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> a + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>  å±€éƒ¨å˜é‡ c é‡ç”¨äº†å±€éƒ¨å˜é‡ b çš„ slot ä½ç½®</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image7.png" alt="Untitled"></p></li><li><p><strong>é™æ€å˜é‡ä¸å±€éƒ¨å˜é‡çš„å¯¹æ¯”</strong></p><ul><li><p>æŒ‰æ•°æ®ç±»å‹åˆ†ï¼šåŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹</p></li><li><p>æŒ‰ç±»ä¸­å£°æ˜çš„ä½ç½®åˆ†ï¼šæˆå‘˜å˜é‡ï¼ˆç±»å˜é‡ï¼Œå®ä¾‹å˜é‡ï¼‰ã€å±€éƒ¨å˜é‡</p><ul><li>ç±»å˜é‡ï¼šlinkingçš„paperé˜¶æ®µï¼Œç»™ç±»å˜é‡é»˜è®¤èµ‹å€¼ï¼Œinité˜¶æ®µç»™ç±»å˜é‡æ˜¾ç¤ºèµ‹å€¼å³é™æ€ä»£ç å—</li><li>å®ä¾‹å˜é‡ï¼šéšç€å¯¹è±¡åˆ›å»ºï¼Œä¼šåœ¨å †ç©ºé—´ä¸­åˆ†é…å®ä¾‹å˜é‡ç©ºé—´ï¼Œå¹¶è¿›è¡Œé»˜è®¤èµ‹å€¼</li><li>å±€éƒ¨å˜é‡ï¼šåœ¨ä½¿ç”¨å‰å¿…é¡»è¿›è¡Œæ˜¾å¼èµ‹å€¼ï¼Œä¸ç„¶ç¼–è¯‘ä¸é€šè¿‡ã€‚</li></ul></li><li><p>å‚æ•°è¡¨åˆ†é…å®Œæ¯•ä¹‹åï¼Œå†æ ¹æ®æ–¹æ³•ä½“å†…å®šä¹‰çš„å˜é‡çš„é¡ºåºå’Œä½œç”¨åŸŸåˆ†é…ã€‚</p><p>  æˆ‘ä»¬çŸ¥é“ç±»å˜é‡è¡¨æœ‰ä¸¤æ¬¡åˆå§‹åŒ–çš„æœºä¼šï¼Œç¬¬ä¸€æ¬¡æ˜¯åœ¨â€œå‡†å¤‡é˜¶æ®µâ€ï¼Œæ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ–ï¼Œå¯¹ç±»å˜é‡è®¾ç½®é›¶å€¼ï¼Œå¦ä¸€æ¬¡åˆ™æ˜¯åœ¨â€œåˆå§‹åŒ–â€é˜¶æ®µï¼Œèµ‹äºˆç¨‹åºå‘˜åœ¨ä»£ç ä¸­å®šä¹‰çš„åˆå§‹å€¼ã€‚</p><p>  å’Œç±»å˜é‡åˆå§‹åŒ–ä¸åŒçš„æ˜¯ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸å­˜åœ¨ç³»ç»Ÿåˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦å®šä¹‰äº†å±€éƒ¨å˜é‡åˆ™å¿…é¡»äººä¸ºçš„åˆå§‹åŒ–ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ã€‚</p></li><li><p><strong>è¡¥å……è¯´æ˜</strong></p><p>  åœ¨æ ˆå¸§ä¸­ï¼Œä¸æ€§èƒ½è°ƒä¼˜å…³ç³»æœ€ä¸ºå¯†åˆ‡çš„éƒ¨åˆ†å°±æ˜¯å‰é¢æåˆ°çš„å±€éƒ¨å˜é‡è¡¨ã€‚åœ¨æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿæœºä½¿ç”¨å±€éƒ¨å˜é‡è¡¨å®Œæˆæ–¹æ³•çš„ä¼ é€’ã€‚</p><p>  å±€éƒ¨å˜é‡è¡¨ä¸­çš„å˜é‡ä¹Ÿæ˜¯é‡è¦çš„åƒåœ¾å›æ”¶æ ¹èŠ‚ç‚¹ï¼Œåªè¦è¢«å±€éƒ¨å˜é‡è¡¨ä¸­ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ã€‚</p></li></ul></li></ul><h3 id="4-æ“ä½œæ•°æ ˆ"><a href="#4-æ“ä½œæ•°æ ˆ" class="headerlink" title="4.æ“ä½œæ•°æ ˆ"></a>4.<strong>æ“ä½œæ•°æ ˆ</strong></h3><p>æ“ä½œæ•°æ ˆï¼šOperand Stack</p><ul><li><p><strong>æ“ä½œæ•°æ ˆçš„ç‰¹ç‚¹</strong></p><ol><li><p>æ¯ä¸€ä¸ªç‹¬ç«‹çš„æ ˆå¸§é™¤äº†åŒ…å«å±€éƒ¨å˜é‡è¡¨ä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLast - In - First -Outï¼‰çš„ æ“ä½œæ•°æ ˆï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º<strong>è¡¨è¾¾å¼æ ˆ</strong>ï¼ˆExpression Stackï¼‰</p></li><li><p>æ“ä½œæ•°æ ˆï¼Œåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œ<strong>æ ¹æ®å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¾€æ ˆä¸­å†™å…¥æ•°æ®æˆ–æå–æ•°æ®</strong>ï¼Œå³å…¥æ ˆï¼ˆpushï¼‰å’Œ å‡ºæ ˆï¼ˆpopï¼‰</p><ul><li>æŸäº›å­—èŠ‚ç æŒ‡ä»¤å°†å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼Œå…¶ä½™çš„å­—èŠ‚ç æŒ‡ä»¤å°†æ“ä½œæ•°å–å‡ºæ ˆã€‚ä½¿ç”¨å®ƒä»¬åå†æŠŠç»“æœå‹å…¥æ ˆï¼Œ</li><li>æ¯”å¦‚ï¼šæ‰§è¡Œå¤åˆ¶ã€äº¤æ¢ã€æ±‚å’Œç­‰æ“ä½œ</li></ul><p> <img src="/images/jvm_virtual_machine/chapter7/image8.png" alt="Untitled"></p><p> <img src="/images/jvm_virtual_machine/chapter7/image9.png" alt="Untitled"></p></li></ol><p>  æ“ä½œæ•°æ ˆï¼Œä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>  æ“ä½œæ•°æ ˆå°±æ˜¯JVMæ‰§è¡Œå¼•æ“çš„ä¸€ä¸ªå·¥ä½œåŒºï¼Œå½“ä¸€ä¸ªæ–¹æ³•åˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ–°çš„æ ˆå¸§ä¹Ÿä¼šéšä¹‹è¢«åˆ›å»ºå‡ºæ¥ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ“ä½œæ•°æ ˆæ˜¯ç©ºçš„ã€‚.</p><blockquote><p>è¿™ä¸ªæ—¶å€™æ•°ç»„æ˜¯æœ‰é•¿åº¦çš„ï¼Œå› ä¸ºæ•°ç»„ä¸€æ—¦åˆ›å»ºï¼Œé‚£ä¹ˆå°±æ˜¯ä¸å¯å˜çš„</p></blockquote><p>  æ¯ä¸€ä¸ªæ“ä½œæ•°æ ˆéƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ˆæ·±åº¦ç”¨äºå­˜å‚¨æ•°å€¼ï¼Œå…¶æ‰€éœ€çš„æœ€å¤§æ·±åº¦åœ¨ç¼–è¯‘æœŸå°±å®šä¹‰å¥½äº†ï¼Œä¿å­˜åœ¨æ–¹æ³•çš„Codeå±æ€§ä¸­ï¼Œä¸ºmaxstackçš„å€¼ã€‚</p><p>  æ ˆä¸­çš„ä»»ä½•ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯å¯ä»¥ä»»æ„çš„Javaæ•°æ®ç±»å‹</p><ul><li>32bitçš„ç±»å‹å ç”¨ä¸€ä¸ªæ ˆå•ä½æ·±åº¦</li><li>64bitçš„ç±»å‹å ç”¨ä¸¤ä¸ªæ ˆå•ä½æ·±åº¦</li></ul><p>  æ“ä½œæ•°æ ˆå¹¶éé‡‡ç”¨è®¿é—®ç´¢å¼•çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®è®¿é—®çš„ï¼Œè€Œæ˜¯åªèƒ½é€šè¿‡æ ‡å‡†çš„å…¥æ ˆå’Œå‡ºæ ˆæ“ä½œæ¥å®Œæˆä¸€æ¬¡æ•°æ®è®¿é—®</p><p>  å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•å¸¦æœ‰è¿”å›å€¼çš„è¯ï¼Œå…¶è¿”å›å€¼å°†ä¼šè¢«å‹å…¥å½“å‰æ ˆå¸§çš„æ“ä½œæ•°æ ˆä¸­ï¼Œå¹¶æ›´æ–°PCå¯„å­˜å™¨ä¸­ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p><p>  æ“ä½œæ•°æ ˆä¸­å…ƒç´ çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å­—èŠ‚ç æŒ‡ä»¤çš„åºåˆ—ä¸¥æ ¼åŒ¹é…ï¼Œè¿™ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å™¨æœŸé—´è¿›è¡ŒéªŒè¯ï¼ŒåŒæ—¶åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„ç±»æ£€éªŒé˜¶æ®µçš„æ•°æ®æµåˆ†æé˜¶æ®µè¦å†æ¬¡éªŒè¯ã€‚|</p><p>  å¦å¤–ï¼Œæˆ‘ä»¬è¯´Javaè™šæ‹Ÿæœºçš„è§£é‡Šå¼•æ“æ˜¯åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“ï¼Œå…¶ä¸­çš„æ ˆæŒ‡çš„å°±æ˜¯æ“ä½œæ•°æ ˆã€‚  </p></li><li><p><strong>ä»£ç è¿½è¸ª</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAddOperation</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">byte</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">15</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i + j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ä½¿ç”¨javap å‘½ä»¤åç¼–è¯‘classæ–‡ä»¶ï¼š javap -v ç±»å.class</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image10.png" alt="Untitled"></p><p>  <em>byteã€shortã€charã€boolean å†…éƒ¨éƒ½æ˜¯ä½¿ç”¨intå‹æ¥è¿›è¡Œä¿å­˜çš„</em></p><p>  <em>ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡bipushå¯¹æ“ä½œæ•° 15 å’Œ 8è¿›è¡Œå…¥æ ˆæ“ä½œ</em></p><p>  <em>åŒæ—¶ä½¿ç”¨çš„æ˜¯ iaddæ–¹æ³•è¿›è¡Œç›¸åŠ æ“ä½œï¼Œi -&gt; ä»£è¡¨çš„å°±æ˜¯ intï¼Œä¹Ÿå°±æ˜¯intç±»å‹çš„åŠ æ³•æ“ä½œ</em></p></li><li><p><strong>ä¸€æ­¥ä¸€æ­¥çœ‹æµç¨‹</strong></p><ol><li>é¦–å…ˆæ‰§è¡Œç¬¬ä¸€æ¡è¯­å¥ï¼ŒPCå¯„å­˜å™¨æŒ‡å‘çš„æ˜¯0ï¼Œä¹Ÿå°±æ˜¯æŒ‡ä»¤åœ°å€ä¸º0ï¼Œç„¶åä½¿ç”¨bipushè®©æ“ä½œæ•°15å…¥æ“ä½œæ•°æ ˆã€‚</li></ol><p>  <img src="/images/jvm_virtual_machine/chapter7/image11.png" alt="Untitled"></p><p>  æ‰§è¡Œå®Œåï¼Œè®©PC + 1ï¼ŒæŒ‡å‘ä¸‹ä¸€è¡Œä»£ç ï¼Œä¸‹ä¸€è¡Œä»£ç å°±æ˜¯å°†æ“ä½œæ•°æ ˆçš„å…ƒç´ å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨1çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å±€éƒ¨å˜é‡è¡¨çš„å·²ç»å¢åŠ äº†ä¸€ä¸ªå…ƒç´ </p><p>  <img src="/images/jvm_virtual_machine/chapter7/image12.png" alt="Untitled"></p><p>  <em>ä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡è¡¨ä¸æ˜¯ä»0å¼€å§‹çš„å‘¢ï¼Ÿ</em></p><p>  <em>å…¶å®å±€éƒ¨å˜é‡è¡¨ä¹Ÿæ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯å› ä¸º0å·ä½ç½®å­˜å‚¨çš„æ˜¯thisæŒ‡é’ˆï¼Œæ‰€ä»¥è¯´å°±ç›´æ¥çœç•¥äº†~</em></p><p>  ç„¶åPC+1ï¼ŒæŒ‡å‘çš„æ˜¯ä¸‹ä¸€è¡Œã€‚è®©æ“ä½œæ•°8ä¹Ÿå…¥æ ˆï¼ŒåŒæ—¶æ‰§è¡Œstoreæ“ä½œï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨ä¸­</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image13.png" alt="Untitled"></p><p>  <img src="/images/jvm_virtual_machine/chapter7/image14.png" alt="Untitled"></p><p>  ç„¶åä»å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œä¾æ¬¡å°†æ•°æ®æ”¾åœ¨æ“ä½œæ•°æ ˆä¸­</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image15.png" alt="Untitled"></p><p>  <img src="/images/jvm_virtual_machine/chapter7/image16.png" alt="Untitled"></p><p>  ç„¶åå°†æ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªå…ƒç´ æ‰§è¡Œç›¸åŠ æ“ä½œï¼Œå¹¶å­˜å‚¨åœ¨å±€éƒ¨å˜é‡è¡¨3çš„ä½ç½®</p><p>  <img src="/images/jvm_virtual_machine/chapter7/image17.png" alt="Untitled"></p><p>  <img src="/images/jvm_virtual_machine/chapter7/image18.png" alt="Untitled"></p><p>  æœ€åPCå¯„å­˜å™¨çš„ä½ç½®æŒ‡å‘10ï¼Œä¹Ÿå°±æ˜¯returnæ–¹æ³•ï¼Œåˆ™ç›´æ¥é€€å‡ºæ–¹æ³•  </p></li><li><p><strong>æ ˆé¡¶ç¼“å­˜æŠ€æœ¯</strong></p><p>  æ ˆé¡¶ç¼“å­˜æŠ€æœ¯ï¼šTop Of Stack Cashing</p><p>  å‰é¢æè¿‡ï¼ŒåŸºäºæ ˆå¼æ¶æ„çš„è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„é›¶åœ°å€æŒ‡ä»¤æ›´åŠ ç´§å‡‘ï¼Œä½†å®Œæˆä¸€é¡¹æ“ä½œçš„æ—¶å€™å¿…ç„¶éœ€è¦ä½¿ç”¨æ›´å¤šçš„å…¥æ ˆå’Œå‡ºæ ˆæŒ‡ä»¤ï¼Œè¿™åŒæ—¶ä¹Ÿå°±æ„å‘³ç€å°†éœ€è¦æ›´å¤šçš„æŒ‡ä»¤åˆ†æ´¾ï¼ˆinstruction dispatchï¼‰æ¬¡æ•°å’Œå†…å­˜è¯»&#x2F;å†™æ¬¡æ•°ã€‚</p><p>  ç”±äºæ“ä½œæ•°æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œå› æ­¤é¢‘ç¹åœ°æ‰§è¡Œå†…å­˜è¯»&#x2F;å†™æ“ä½œå¿…ç„¶ä¼šå½±å“æ‰§è¡Œé€Ÿåº¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHotSpot JVMçš„è®¾è®¡è€…ä»¬æå‡ºäº†æ ˆé¡¶ç¼“å­˜ï¼ˆTosï¼ŒTop-of-Stack Cashingï¼‰æŠ€æœ¯ï¼Œå°†æ ˆé¡¶å…ƒç´ å…¨éƒ¨ç¼“å­˜åœ¨ç‰©ç†CPUçš„å¯„å­˜å™¨ä¸­ï¼Œä»¥æ­¤é™ä½å¯¹å†…å­˜çš„è¯»&#x2F;å†™æ¬¡æ•°ï¼Œæå‡æ‰§è¡Œå¼•æ“çš„æ‰§è¡Œæ•ˆç‡ã€‚</p></li></ul><h3 id="5-åŠ¨æ€é“¾æ¥"><a href="#5-åŠ¨æ€é“¾æ¥" class="headerlink" title="5.åŠ¨æ€é“¾æ¥"></a>5.<strong>åŠ¨æ€é“¾æ¥</strong></h3><p>åŠ¨æ€é“¾æ¥ï¼šDynamic Linking</p><p><img src="/images/jvm_virtual_machine/chapter7/image19.png" alt="Untitled"></p><p><em>åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›åœ°å€ã€é™„åŠ ä¿¡æ¯ ï¼š æœ‰äº›åœ°æ–¹è¢«ç§°ä¸ºå¸§æ•°æ®åŒº</em></p><ol><li>æ¯ä¸€ä¸ªæ ˆå¸§å†…éƒ¨éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨åŒ…å«è¿™ä¸ªå¼•ç”¨çš„ç›®çš„å°±æ˜¯ä¸ºäº†æ”¯æŒå½“å‰æ–¹æ³•çš„ä»£ç èƒ½å¤Ÿå®ç°åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰ã€‚æ¯”å¦‚ï¼šinvokedynamicæŒ‡ä»¤</li><li>åœ¨Javaæºæ–‡ä»¶è¢«ç¼–è¯‘åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä½œä¸ºç¬¦å·å¼•ç”¨ï¼ˆsymbolic Referenceï¼‰ä¿å­˜åœ¨classæ–‡ä»¶çš„å¸¸é‡æ± é‡Œã€‚</li></ol><p>æ¯”å¦‚ï¼šæè¿°ä¸€ä¸ªæ–¹æ³•è°ƒç”¨äº†å¦å¤–çš„å…¶ä»–æ–¹æ³•æ—¶ï¼Œå°±æ˜¯é€šè¿‡å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ¥è¡¨ç¤ºçš„ï¼Œé‚£ä¹ˆåŠ¨æ€é“¾æ¥çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°†è¿™äº›ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ã€‚</p><p>æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.linking;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicLinkingTest</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;methodA()....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;methodB()....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        methodA();</span><br><span class="line"></span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">com</span>.peppa.linking.DynamicLinkingTest</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #<span class="number">1</span> = Methodref          #<span class="number">9.</span>#<span class="number">23</span>         <span class="comment">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">   #<span class="number">2</span> = Fieldref           #<span class="number">8.</span>#<span class="number">24</span>         <span class="comment">// com/peppa/linking/DynamicLinkingTest.num:I</span></span><br><span class="line">   #<span class="number">3</span> = Fieldref           #<span class="number">25.</span>#<span class="number">26</span>        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #<span class="number">4</span> = String             #<span class="number">27</span>            <span class="comment">// methodA()....</span></span><br><span class="line">   #<span class="number">5</span> = Methodref          #<span class="number">28.</span>#<span class="number">29</span>        <span class="comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">   #<span class="number">6</span> = String             #<span class="number">30</span>            <span class="comment">// methodB()....</span></span><br><span class="line">   #<span class="number">7</span> = Methodref          #<span class="number">8.</span>#<span class="number">31</span>         <span class="comment">// com/peppa/linking/DynamicLinkingTest.methodA:()V</span></span><br><span class="line">   #<span class="number">8</span> = Class              #<span class="number">32</span>            <span class="comment">// com/peppa/linking/DynamicLinkingTest</span></span><br><span class="line">   #<span class="number">9</span> = Class              #<span class="number">33</span>            <span class="comment">// java/lang/Object</span></span><br><span class="line">  #<span class="number">10</span> = Utf8               num</span><br><span class="line">  #<span class="number">11</span> = Utf8               I</span><br><span class="line">  #<span class="number">12</span> = Utf8               &lt;init&gt;</span><br><span class="line">  #<span class="number">13</span> = Utf8               ()V</span><br><span class="line">  #<span class="number">14</span> = Utf8               Code</span><br><span class="line">  #<span class="number">15</span> = Utf8               LineNumberTable</span><br><span class="line">  #<span class="number">16</span> = Utf8               LocalVariableTable</span><br><span class="line">  #<span class="number">17</span> = Utf8               <span class="built_in">this</span></span><br><span class="line">  #<span class="number">18</span> = Utf8               Lcom/peppa/linking/DynamicLinkingTest;</span><br><span class="line">  #<span class="number">19</span> = Utf8               methodA</span><br><span class="line">  #<span class="number">20</span> = Utf8               methodB</span><br><span class="line">  #<span class="number">21</span> = Utf8               SourceFile</span><br><span class="line">  #<span class="number">22</span> = Utf8               DynamicLinkingTest.java</span><br><span class="line">  #<span class="number">23</span> = NameAndType        #<span class="number">12</span>:#<span class="number">13</span>        <span class="comment">// &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">  #<span class="number">24</span> = NameAndType        #<span class="number">10</span>:#<span class="number">11</span>        <span class="comment">// num:I</span></span><br><span class="line">  #<span class="number">25</span> = Class              #<span class="number">34</span>            <span class="comment">// java/lang/System</span></span><br><span class="line">  #<span class="number">26</span> = NameAndType        #<span class="number">35</span>:#<span class="number">36</span>        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #<span class="number">27</span> = Utf8               <span class="title function_">methodA</span><span class="params">()</span>....</span><br><span class="line">  #<span class="number">28</span> = Class              #<span class="number">37</span>            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #<span class="number">29</span> = NameAndType        #<span class="number">38</span>:#<span class="number">39</span>        <span class="comment">// println:(Ljava/lang/String;)V</span></span><br><span class="line">  #<span class="number">30</span> = Utf8               <span class="title function_">methodB</span><span class="params">()</span>....</span><br><span class="line">  #<span class="number">31</span> = NameAndType        #<span class="number">19</span>:#<span class="number">13</span>        <span class="comment">// methodA:()V</span></span><br><span class="line">  #<span class="number">32</span> = Utf8               com/peppa/linking/DynamicLinkingTest</span><br><span class="line">  #<span class="number">33</span> = Utf8               java/lang/Object</span><br><span class="line">  #<span class="number">34</span> = Utf8               java/lang/System</span><br><span class="line">  #<span class="number">35</span> = Utf8               out</span><br><span class="line">  #<span class="number">36</span> = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #<span class="number">37</span> = Utf8               java/io/PrintStream</span><br><span class="line">  #<span class="number">38</span> = Utf8               println</span><br><span class="line">  #<span class="number">39</span> = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> num;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags:</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> com.peppa.linking.DynamicLinkingTest();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="number">1</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">4</span>: aload_0</span><br><span class="line">         <span class="number">5</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">7</span>: putfield      #<span class="number">2</span>                  <span class="comment">// Field num:I</span></span><br><span class="line">        <span class="number">10</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">4</span>: <span class="number">4</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">11</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/peppa/linking/DynamicLinkingTest;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">3</span>: ldc           #<span class="number">4</span>                  <span class="comment">// String methodA()....</span></span><br><span class="line">         <span class="number">5</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/peppa/linking/DynamicLinkingTest;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodB</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">3</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">         <span class="number">3</span>: ldc           #<span class="number">6</span>                  <span class="comment">// String methodB()....</span></span><br><span class="line">         <span class="number">5</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">         <span class="number">8</span>: aload_0</span><br><span class="line">         <span class="number">9</span>: invokevirtual #<span class="number">7</span>                  <span class="comment">// Method methodA:()V</span></span><br><span class="line">        <span class="number">12</span>: aload_0</span><br><span class="line">        <span class="number">13</span>: dup</span><br><span class="line">        <span class="number">14</span>: getfield      #<span class="number">2</span>                  <span class="comment">// Field num:I</span></span><br><span class="line">        <span class="number">17</span>: iconst_1</span><br><span class="line">        <span class="number">18</span>: iadd</span><br><span class="line">        <span class="number">19</span>: putfield      #<span class="number">2</span>                  <span class="comment">// Field num:I</span></span><br><span class="line">        <span class="number">22</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">11</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">8</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">12</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">22</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">23</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lcom/peppa/linking/DynamicLinkingTest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ã€åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼ŒmethodB() æ–¹æ³•ä¸­é€šè¿‡ invokevirtual #7 æŒ‡ä»¤è°ƒç”¨äº†æ–¹æ³• A ï¼Œé‚£ä¹ˆ #7 æ˜¯ä¸ªå•¥å‘¢ï¼Ÿ</p><p>2ã€å¾€ä¸Šé¢ç¿»ï¼Œæ‰¾åˆ°å¸¸é‡æ± çš„å®šä¹‰ï¼š<code>#7 = Methodref #8.#31</code></p><ul><li>å…ˆæ‰¾ #8 ï¼š<ul><li><code>#8 = Class #32</code>Â ï¼šå»æ‰¾ #32</li><li><code>#32 = Utf8 com/peppa/linking/DynamicLinkingTest</code></li><li>ç»“è®ºï¼šé€šè¿‡ #8 æˆ‘ä»¬æ‰¾åˆ°äº†Â <code>DynamicLinkingTest</code>Â è¿™ä¸ªç±»</li></ul></li><li>å†æ¥æ‰¾ #31ï¼š<ul><li><code>#31 = NameAndType #19:#13</code>Â ï¼šå»æ‰¾ #19 å’Œ #13</li><li><code>#19 = Utf8 methodA</code>Â ï¼šæ–¹æ³•åä¸º methodA</li><li><code>#13 = Utf8 ()V</code>Â ï¼šæ–¹æ³•æ²¡æœ‰å½¢å‚ï¼Œè¿”å›å€¼ä¸º void</li></ul></li></ul><p>3ã€ç»“è®ºï¼šé€šè¿‡ #7 æˆ‘ä»¬å°±èƒ½æ‰¾åˆ°éœ€è¦è°ƒç”¨çš„ methodA() æ–¹æ³•ï¼Œå¹¶è¿›è¡Œè°ƒç”¨</p><p>4ã€åœ¨ä¸Šé¢ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šç¬¦å·å¼•ç”¨ï¼Œæ¯”å¦‚ Objectã€Systemã€PrintStream ç­‰ç­‰</p><p><img src="/images/jvm_virtual_machine/chapter7/image20.png" alt="Untitled"></p><p><em>ä¸ºä»€ä¹ˆéœ€è¦è¿è¡Œæ—¶å¸¸é‡æ± ï¼Ÿ</em></p><p><em>å› ä¸ºåœ¨ä¸åŒçš„æ–¹æ³•ï¼Œéƒ½å¯èƒ½è°ƒç”¨å¸¸é‡æˆ–è€…æ–¹æ³•ï¼Œæ‰€ä»¥åªéœ€è¦å­˜å‚¨ä¸€ä»½å³å¯ï¼ŒèŠ‚çœäº†ç©ºé—´</em></p><p><em>å¸¸é‡æ± çš„ä½œç”¨ï¼šå°±æ˜¯ä¸ºäº†æä¾›ä¸€äº›ç¬¦å·å’Œå¸¸é‡ï¼Œä¾¿äºæŒ‡ä»¤çš„è¯†åˆ«</em></p><ul><li><p><strong>æ–¹æ³•è°ƒç”¨ï¼šè§£æä¸åˆ†é…</strong></p><ul><li><p><strong>é™æ€é“¾æ¥ä¸åŠ¨æ€é“¾æ¥</strong></p><p>  åœ¨JVMä¸­ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºè°ƒç”¨æ–¹æ³•çš„ç›´æ¥å¼•ç”¨ä¸æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ç›¸å…³</p><ul><li>**é™æ€é“¾æ¥ï¼š**å½“ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶è¢«è£…è½½è¿›JVMå†…éƒ¨æ—¶ï¼Œå¦‚æœè¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹å°†è°ƒç”¨æ–¹æ³•çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºé™æ€é“¾æ¥</li><li><strong>åŠ¨æ€é“¾æ¥ï¼š<strong>å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸå°†è°ƒç”¨çš„æ–¹æ³•çš„ç¬¦å·è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œç”±äºè¿™ç§å¼•ç”¨è½¬æ¢è¿‡ç¨‹å…·å¤‡åŠ¨æ€æ€§ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¹‹ä¸ºåŠ¨æ€é“¾æ¥ã€‚</strong></strong></li></ul></li><li><p><strong>æ—©æœŸç»‘å®šä¸æ™šæœŸç»‘å®š</strong></p><p>  é™æ€é“¾æ¥ä¸åŠ¨æ€é“¾æ¥é’ˆå¯¹çš„æ˜¯æ–¹æ³•ã€‚æ—©æœŸç»‘å®šå’Œæ™šæœŸç»‘å®šèŒƒå›´æ›´å¹¿ã€‚æ—©æœŸç»‘å®šæ¶µç›–äº†é™æ€é“¾æ¥ï¼Œæ™šæœŸç»‘å®šæ¶µç›–äº†åŠ¨æ€é“¾æ¥ã€‚é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥å¯¹åº”çš„æ–¹æ³•çš„ç»‘å®šæœºåˆ¶ä¸ºï¼šæ—©æœŸç»‘å®šï¼ˆEarly Bindingï¼‰å’Œæ™šæœŸç»‘å®šï¼ˆLate Bindingï¼‰ã€‚<strong>ç»‘å®šæ˜¯ä¸€ä¸ªå­—æ®µã€æ–¹æ³•æˆ–è€…ç±»åœ¨ç¬¦å·å¼•ç”¨è¢«æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</strong>ï¼Œè¿™ä»…ä»…å‘ç”Ÿä¸€æ¬¡ã€‚</p><ul><li><p><strong>æ—©æœŸç»‘å®š</strong></p><p>  æ—©æœŸç»‘å®šå°±æ˜¯æŒ‡è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•å¦‚æœåœ¨ç¼–è¯‘æœŸå¯çŸ¥ï¼Œä¸”è¿è¡ŒæœŸä¿æŒä¸å˜æ—¶ï¼Œå³å¯å°†è¿™ä¸ªæ–¹æ³•ä¸æ‰€å±çš„ç±»å‹è¿›è¡Œç»‘å®šï¼Œè¿™æ ·ä¸€æ¥ï¼Œç”±äºæ˜ç¡®äº†è¢«è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ç©¶ç«Ÿæ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤ä¹Ÿå°±<strong>å¯ä»¥ä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹å¼å°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</strong>ã€‚</p></li><li><p><strong>æ™šæœŸç»‘å®š</strong></p><p>  å¦‚æœè¢«è°ƒç”¨çš„æ–¹æ³•åœ¨ç¼–è¯‘æœŸæ— æ³•è¢«ç¡®å®šä¸‹æ¥ï¼Œ<strong>åªèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸæ ¹æ®å®é™…çš„ç±»å‹ç»‘å®šç›¸å…³çš„æ–¹æ³•</strong>ï¼Œè¿™ç§ç»‘å®šæ–¹å¼ä¹Ÿå°±è¢«ç§°ä¹‹ä¸ºæ™šæœŸç»‘å®šã€‚</p></li></ul></li><li><p><strong>æ—©æ™šæœŸç»‘å®šçš„å‘å±•å†å²</strong></p><p>  éšç€é«˜çº§è¯­è¨€çš„æ¨ªç©ºå‡ºä¸–ï¼Œç±»ä¼¼äºJavaä¸€æ ·çš„åŸºäºé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€å¦‚ä»Šè¶Šæ¥è¶Šå¤šï¼Œå°½ç®¡è¿™ç±»ç¼–ç¨‹è¯­è¨€åœ¨è¯­æ³•é£æ ¼ä¸Šå­˜åœ¨ä¸€å®šçš„å·®åˆ«ï¼Œä½†æ˜¯å®ƒä»¬å½¼æ­¤ä¹‹é—´å§‹ç»ˆä¿æŒç€ä¸€ä¸ªå…±æ€§ï¼Œé‚£å°±æ˜¯éƒ½æ”¯æŒå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ç­‰é¢å‘å¯¹è±¡ç‰¹æ€§ï¼Œæ—¢ç„¶è¿™ä¸€ç±»çš„ç¼–ç¨‹è¯­è¨€å…·å¤‡å¤šæ€ç‰¹æ‚„ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±å…·å¤‡æ—©æœŸç»‘å®šå’Œæ™šæœŸç»‘å®šä¸¤ç§ç»‘å®šæ–¹å¼ã€‚</p><p>  Javaä¸­ä»»ä½•ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•å…¶å®éƒ½å…·å¤‡è™šå‡½æ•°çš„ç‰¹å¾ï¼Œå®ƒä»¬ç›¸å½“äºC++è¯­è¨€ä¸­çš„è™šå‡½æ•°ï¼ˆC++ä¸­åˆ™éœ€è¦ä½¿ç”¨å…³é”®å­—virtualæ¥æ˜¾å¼å®šä¹‰ï¼‰ã€‚å¦‚æœåœ¨Javaç¨‹åºä¸­ä¸å¸Œæœ›æŸä¸ªæ–¹æ³•æ‹¥æœ‰è™šå‡½æ•°çš„ç‰¹å¾æ—¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å…³é”®å­—finalæ¥æ ‡è®°è¿™ä¸ªæ–¹æ³•ã€‚</p></li><li><p><strong>è™šæ–¹æ³•å’Œéè™šæ–¹æ³•</strong></p><ul><li>å¦‚æœæ–¹æ³•åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†å…·ä½“çš„è°ƒç”¨ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬åœ¨è¿è¡Œæ—¶æ˜¯ä¸å¯å˜çš„ã€‚è¿™æ ·çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ã€‚</li><li>é™æ€æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€fina1æ–¹æ³•ã€å®ä¾‹æ„é€ å™¨ã€çˆ¶ç±»æ–¹æ³•éƒ½æ˜¯éè™šæ–¹æ³•ã€‚</li><li>å…¶ä»–æ–¹æ³•ç§°ä¸ºè™šæ–¹æ³•ã€‚</li></ul></li><li><p><strong>å­ç±»å¯¹è±¡çš„å¤šæ€çš„ä½¿ç”¨å‰æï¼š</strong></p><ol><li>ç±»çš„ç»§æ‰¿å…³ç³»</li><li>æ–¹æ³•çš„é‡å†™</li></ol></li><li><p><strong>è™šæ‹Ÿæœºä¸­æä¾›äº†ä»¥ä¸‹å‡ æ¡æ–¹æ³•è°ƒç”¨æŒ‡ä»¤ï¼š</strong></p><ul><li><p><strong>æ™®é€šè°ƒç”¨æŒ‡ä»¤ï¼š</strong></p><ul><li>invokestaticï¼šè°ƒç”¨é™æ€æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</li><li>invokespecialï¼šè°ƒç”¨æ–¹æ³•ã€ç§æœ‰åŠçˆ¶ç±»æ–¹æ³•ï¼Œè§£æé˜¶æ®µç¡®å®šå”¯ä¸€æ–¹æ³•ç‰ˆæœ¬</li><li>invokevirtualï¼šè°ƒç”¨æ‰€æœ‰è™šæ–¹æ³•</li><li>invokeinterfaceï¼šè°ƒç”¨æ¥å£æ–¹æ³•</li></ul></li><li><p><strong>åŠ¨æ€è°ƒç”¨æŒ‡ä»¤ï¼š</strong></p><ul><li><p>invokedynamicï¼šåŠ¨æ€è§£æå‡ºéœ€è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œ</p><p>  å‰å››æ¡æŒ‡ä»¤å›ºåŒ–åœ¨è™šæ‹Ÿæœºå†…éƒ¨ï¼Œæ–¹æ³•çš„è°ƒç”¨æ‰§è¡Œä¸å¯äººä¸ºå¹²é¢„ï¼Œè€ŒinvokedynamicæŒ‡ä»¤åˆ™æ”¯æŒç”±ç”¨æˆ·ç¡®å®šæ–¹æ³•ç‰ˆæœ¬ã€‚å…¶ä¸­invokestaticæŒ‡ä»¤å’ŒinvokespecialæŒ‡ä»¤è°ƒç”¨çš„æ–¹æ³•ç§°ä¸ºéè™šæ–¹æ³•ï¼Œå…¶ä½™çš„ï¼ˆfina1ä¿®é¥°çš„é™¤å¤–ï¼‰ç§°ä¸ºè™šæ–¹æ³•ã€‚</p></li></ul></li></ul></li><li><p><strong>invokednamicæŒ‡ä»¤</strong></p><ol><li>JVMå­—èŠ‚ç æŒ‡ä»¤é›†ä¸€ç›´æ¯”è¾ƒç¨³å®šï¼Œä¸€ç›´åˆ°Java7ä¸­æ‰å¢åŠ äº†ä¸€ä¸ªinvokedynamicæŒ‡ä»¤ï¼Œè¿™æ˜¯Javaä¸ºäº†å®ç°ã€åŠ¨æ€ç±»å‹è¯­è¨€ã€‘æ”¯æŒè€Œåšçš„ä¸€ç§æ”¹è¿›ã€‚</li><li>ä½†æ˜¯åœ¨Java7ä¸­å¹¶æ²¡æœ‰æä¾›ç›´æ¥ç”ŸæˆinvokedynamicæŒ‡ä»¤çš„æ–¹æ³•ï¼Œéœ€è¦å€ŸåŠ©ASMè¿™ç§åº•å±‚å­—èŠ‚ç å·¥å…·æ¥äº§ç”ŸinvokedynamicæŒ‡ä»¤ã€‚ç›´åˆ°Java8çš„Lambdaè¡¨è¾¾å¼çš„å‡ºç°ï¼ŒinvokedynamicæŒ‡ä»¤çš„ç”Ÿæˆï¼Œåœ¨Javaä¸­æ‰æœ‰äº†ç›´æ¥çš„ç”Ÿæˆæ–¹å¼ã€‚</li><li>Java7ä¸­å¢åŠ çš„åŠ¨æ€è¯­è¨€ç±»å‹æ”¯æŒçš„æœ¬è´¨æ˜¯å¯¹Javaè™šæ‹Ÿæœºè§„èŒƒçš„ä¿®æ”¹ï¼Œè€Œä¸æ˜¯å¯¹Javaè¯­è¨€è§„åˆ™çš„ä¿®æ”¹ï¼Œè¿™ä¸€å—ç›¸å¯¹æ¥è®²æ¯”è¾ƒå¤æ‚ï¼Œå¢åŠ äº†è™šæ‹Ÿæœºä¸­çš„æ–¹æ³•è°ƒç”¨ï¼Œæœ€ç›´æ¥çš„å—ç›Šè€…å°±æ˜¯è¿è¡Œåœ¨Javaå¹³å°çš„åŠ¨æ€è¯­è¨€çš„ç¼–è¯‘å™¨ã€‚</li></ol></li><li><p><strong>åŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€</strong></p><ol><li>åŠ¨æ€ç±»å‹è¯­è¨€å’Œé™æ€ç±»å‹è¯­è¨€ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äº<strong>å¯¹ç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨ç¼–è¯‘æœŸè¿˜æ˜¯åœ¨è¿è¡ŒæœŸ</strong>ï¼Œæ»¡è¶³å‰è€…å°±æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œåä¹‹æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ã€‚</li><li>è¯´çš„å†ç›´ç™½ä¸€ç‚¹å°±æ˜¯ï¼Œé™æ€ç±»å‹è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡è‡ªèº«çš„ç±»å‹ä¿¡æ¯ï¼›åŠ¨æ€ç±»å‹è¯­è¨€æ˜¯åˆ¤æ–­å˜é‡å€¼çš„ç±»å‹ä¿¡æ¯ï¼Œå˜é‡æ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œå˜é‡å€¼æ‰æœ‰ç±»å‹ä¿¡æ¯ï¼Œè¿™æ˜¯åŠ¨æ€è¯­è¨€çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ã€‚</li></ol>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Javaï¼š<span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> <span class="string">&quot;mogu blog&quot;</span>; (Javaæ˜¯é™æ€ç±»å‹è¯­è¨€çš„ï¼Œä¼šå…ˆç¼–è¯‘å°±è¿›è¡Œç±»å‹æ£€æŸ¥) </span><br><span class="line">JSï¼š<span class="type">var</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;shkstart&quot;</span>; <span class="type">var</span> <span class="variable">name</span> <span class="operator">=</span> <span class="number">10</span>; ï¼ˆè¿è¡Œæ—¶æ‰è¿›è¡Œæ£€æŸ¥ï¼‰</span><br><span class="line">Python: info = <span class="number">130.5</span> (è¿è¡Œæ—¶æ‰æ£€æŸ¥)</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Javaè¯­è¨€ä¸­æ–¹æ³•é‡å†™çš„æœ¬è´¨</strong></p><ul><li><p><strong>ä»€ä¹ˆæ˜¯åŠ¨æ€åˆ†æ´¾ï¼Ÿ</strong></p><ol><li>æ‰¾åˆ°æ“ä½œæ•°æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€æ‰§è¡Œçš„å¯¹è±¡çš„å®é™…ç±»å‹ï¼Œè®°ä½œCã€‚</li><li>å¦‚æœåœ¨ç±»å‹Cä¸­æ‰¾åˆ°ä¸å¸¸é‡ä¸­çš„æè¿°ç¬¦åˆç®€å•åç§°éƒ½ç›¸ç¬¦çš„æ–¹æ³•ï¼Œåˆ™è¿›è¡Œè®¿é—®æƒé™æ ¡éªŒã€‚<ul><li>å¦‚æœé€šè¿‡åˆ™è¿”å›è¿™ä¸ªæ–¹æ³•çš„ç›´æ¥å¼•ç”¨ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹ç»“æŸ</li><li>å¦‚æœä¸é€šè¿‡ï¼Œåˆ™è¿”å›java.lang.IllegalAccessError å¼‚å¸¸</li></ul></li><li>å¦åˆ™ï¼ŒæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸‹å¾€ä¸Šä¾æ¬¡å¯¹Cçš„å„ä¸ªçˆ¶ç±»è¿›è¡Œç¬¬2æ­¥çš„æœç´¢å’ŒéªŒè¯è¿‡ç¨‹ã€‚</li><li>å¦‚æœå§‹ç»ˆæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„æ–¹æ³•ï¼Œåˆ™æŠ›å‡ºjava.lang.AbstractMethodErrorå¼‚å¸¸ã€‚</li></ol></li><li><p><strong>IllegalAccessErrorä»‹ç»</strong></p><p>  ç¨‹åºè¯•å›¾è®¿é—®æˆ–ä¿®æ”¹ä¸€ä¸ªå±æ€§æˆ–è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œä½ æ²¡æœ‰æƒé™è®¿é—®ã€‚ä¸€èˆ¬çš„ï¼Œè¿™ä¸ªä¼šå¼•èµ·ç¼–è¯‘å™¨å¼‚å¸¸ã€‚è¿™ä¸ªé”™è¯¯å¦‚æœå‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œå°±è¯´æ˜ä¸€ä¸ªç±»å‘ç”Ÿäº†ä¸å…¼å®¹çš„æ”¹å˜ã€‚</p></li><li><p><strong>æ–¹æ³•çš„è°ƒç”¨ï¼šè™šæ–¹æ³•è¡¨</strong></p><ol><li>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œä¼šå¾ˆé¢‘ç¹çš„ä½¿ç”¨åˆ°<strong>åŠ¨æ€åˆ†æ´¾</strong>ï¼Œå¦‚æœåœ¨æ¯æ¬¡åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ä¸­éƒ½è¦é‡æ–°åœ¨ç±»çš„æ–¹æ³•å…ƒæ•°æ®ä¸­æœç´¢åˆé€‚çš„ç›®æ ‡çš„è¯å°±å¯èƒ½å½±å“åˆ°æ‰§è¡Œæ•ˆç‡ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œ<strong>JVMé‡‡ç”¨åœ¨ç±»çš„æ–¹æ³•åŒºå»ºç«‹ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼ˆvirtual method tableï¼‰æ¥å®ç°</strong>ï¼Œéè™šæ–¹æ³•ä¸ä¼šå‡ºç°åœ¨è¡¨ä¸­ã€‚ä½¿ç”¨ç´¢å¼•è¡¨æ¥ä»£æ›¿æŸ¥æ‰¾ã€‚ã€ä¸Šé¢åŠ¨æ€åˆ†æ´¾çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœå­ç±»æ‰¾ä¸åˆ°ï¼Œè¿˜è¦ä»ä¸‹å¾€ä¸Šæ‰¾å…¶çˆ¶ç±»ï¼Œéå¸¸è€—æ—¶ã€‘</li><li>æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªè™šæ–¹æ³•è¡¨ï¼Œè¡¨ä¸­å­˜æ”¾ç€å„ä¸ªæ–¹æ³•çš„å®é™…å…¥å£ã€‚</li><li>è™šæ–¹æ³•è¡¨æ˜¯ä»€ä¹ˆæ—¶å€™è¢«åˆ›å»ºçš„å‘¢ï¼Ÿè™šæ–¹æ³•è¡¨ä¼šåœ¨ç±»åŠ è½½çš„é“¾æ¥é˜¶æ®µè¢«åˆ›å»ºå¹¶å¼€å§‹åˆå§‹åŒ–ï¼Œç±»çš„å˜é‡åˆå§‹å€¼å‡†å¤‡å®Œæˆä¹‹åï¼ŒJVMä¼šæŠŠè¯¥ç±»çš„è™šæ–¹æ³•è¡¨ä¹Ÿåˆå§‹åŒ–å®Œæ¯•ã€‚</li></ol><p>  <img src="/images/jvm_virtual_machine/chapter7/image21.png" alt="Untitled"></p><p>  å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šå¦‚æœç±»ä¸­é‡å†™äº†æ–¹æ³•ï¼Œé‚£ä¹ˆè°ƒç”¨çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥åœ¨è™šæ–¹æ³•è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦åˆ™å°†ä¼šç›´æ¥è¿æ¥åˆ°Objectçš„æ–¹æ³•ä¸­ã€‚</p></li></ul></li></ul><h3 id="6-æ–¹æ³•è¿”å›åœ°å€"><a href="#6-æ–¹æ³•è¿”å›åœ°å€" class="headerlink" title="6.æ–¹æ³•è¿”å›åœ°å€"></a>6.<strong>æ–¹æ³•è¿”å›åœ°å€</strong></h3><ul><li><p>æ–¹æ³•çš„ç»“æŸ</p><ul><li>å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„pcå¯„å­˜å™¨çš„å€¼ã€‚ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š<ul><li>æ­£å¸¸æ‰§è¡Œå®Œæˆ</li><li>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</li></ul></li><li>æ— è®ºé€šè¿‡å“ªç§æ–¹å¼é€€å‡ºï¼Œåœ¨æ–¹æ³•é€€å‡ºåéƒ½è¿”å›åˆ°è¯¥æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ã€‚æ–¹æ³•æ­£å¸¸é€€å‡ºæ—¶ï¼Œ<strong>è°ƒç”¨è€…çš„pcè®¡æ•°å™¨çš„å€¼ä½œä¸ºè¿”å›åœ°å€ï¼Œå³è°ƒç”¨è¯¥æ–¹æ³•çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€</strong>ã€‚è€Œé€šè¿‡å¼‚å¸¸é€€å‡ºçš„ï¼Œè¿”å›åœ°å€æ˜¯è¦é€šè¿‡å¼‚å¸¸è¡¨æ¥ç¡®å®šï¼Œæ ˆå¸§ä¸­ä¸€èˆ¬ä¸ä¼šä¿å­˜è¿™éƒ¨åˆ†ä¿¡æ¯ã€‚</li><li>æœ¬è´¨ä¸Šï¼Œæ–¹æ³•çš„é€€å‡ºå°±æ˜¯å½“å‰æ ˆå¸§å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œéœ€è¦æ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å°†è¿”å›å€¼å‹å…¥è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆã€è®¾ç½®PCå¯„å­˜å™¨å€¼ç­‰ï¼Œè®©è°ƒç”¨è€…æ–¹æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</li><li>æ­£å¸¸å®Œæˆå‡ºå£å’Œå¼‚å¸¸å®Œæˆå‡ºå£çš„åŒºåˆ«åœ¨äºï¼šé€šè¿‡å¼‚å¸¸å®Œæˆå‡ºå£é€€å‡ºçš„ä¸ä¼šç»™ä»–çš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•çš„è¿”å›å€¼ã€‚</li></ul></li><li><p><strong>æ–¹æ³•é€€å‡ºçš„ä¸¤ç§æ–¹å¼</strong></p><p>  å½“ä¸€ä¸ªæ–¹æ³•å¼€å§‹æ‰§è¡Œåï¼Œåªæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥é€€å‡ºè¿™ä¸ªæ–¹æ³•ï¼Œ</p><ul><li><p><strong>æ­£å¸¸é€€å‡ºï¼š</strong></p><ol><li>æ‰§è¡Œå¼•æ“é‡åˆ°ä»»æ„ä¸€ä¸ªæ–¹æ³•è¿”å›çš„å­—èŠ‚ç æŒ‡ä»¤ï¼ˆreturnï¼‰ï¼Œä¼šæœ‰è¿”å›å€¼ä¼ é€’ç»™ä¸Šå±‚çš„æ–¹æ³•è°ƒç”¨è€…ï¼Œç®€ç§°<strong>æ­£å¸¸å®Œæˆå‡ºå£</strong>ï¼›</li><li>ä¸€ä¸ªæ–¹æ³•åœ¨æ­£å¸¸è°ƒç”¨å®Œæˆä¹‹åï¼Œç©¶ç«Ÿéœ€è¦ä½¿ç”¨å“ªä¸€ä¸ªè¿”å›æŒ‡ä»¤ï¼Œè¿˜éœ€è¦æ ¹æ®æ–¹æ³•è¿”å›å€¼çš„å®é™…æ•°æ®ç±»å‹è€Œå®šã€‚</li><li>åœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­ï¼Œè¿”å›æŒ‡ä»¤åŒ…å«ï¼š<ul><li>ireturnï¼šå½“è¿”å›å€¼æ˜¯booleanï¼Œbyteï¼Œcharï¼Œshortå’Œintç±»å‹æ—¶ä½¿ç”¨</li><li>lreturnï¼šLongç±»å‹</li><li>freturnï¼šFloatç±»å‹</li><li>dreturnï¼šDoubleç±»å‹</li><li>areturnï¼šå¼•ç”¨ç±»å‹</li><li>returnï¼šè¿”å›å€¼ç±»å‹ä¸ºvoidçš„æ–¹æ³•ã€å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç±»å’Œæ¥å£çš„åˆå§‹åŒ–æ–¹æ³•</li></ul></li></ol></li><li><p><strong>å¼‚å¸¸é€€å‡ºï¼š</strong></p><ol><li>åœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸ï¼ˆExceptionï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå¼‚å¸¸æ²¡æœ‰åœ¨æ–¹æ³•å†…è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯åªè¦åœ¨æœ¬æ–¹æ³•çš„å¼‚å¸¸è¡¨ä¸­æ²¡æœ‰æœç´¢åˆ°åŒ¹é…çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå°±ä¼šå¯¼è‡´æ–¹æ³•é€€å‡ºï¼Œç®€ç§°<strong>å¼‚å¸¸å®Œæˆå‡ºå£</strong>ã€‚</li><li>æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºå¼‚å¸¸æ—¶çš„å¼‚å¸¸å¤„ç†ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªå¼‚å¸¸å¤„ç†è¡¨ï¼Œæ–¹ä¾¿åœ¨å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™æ‰¾åˆ°å¤„ç†å¼‚å¸¸çš„ä»£ç </li></ol><p>  <img src="/images/jvm_virtual_machine/chapter7/image22.png" alt="Untitled"></p><p>  å¼‚å¸¸å¤„ç†è¡¨ï¼š</p><ul><li>åç¼–è¯‘å­—èŠ‚ç æ–‡ä»¶ï¼Œå¯å¾—åˆ° Exception table</li><li>from ï¼šå­—èŠ‚ç æŒ‡ä»¤èµ·å§‹åœ°å€</li><li>to ï¼šå­—èŠ‚ç æŒ‡ä»¤ç»“æŸåœ°å€</li><li>target ï¼šå‡ºç°å¼‚å¸¸è·³è½¬è‡³åœ°å€ä¸º 11 çš„æŒ‡ä»¤æ‰§è¡Œ</li><li>type ï¼šæ•è·å¼‚å¸¸çš„ç±»å‹</li></ul></li></ul><p>  æœ¬è´¨ä¸Šï¼Œæ–¹æ³•çš„é€€å‡ºå°±æ˜¯å½“å‰æ ˆå¸§å‡ºæ ˆçš„è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œéœ€è¦æ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€å°†è¿”å›å€¼å‹å…¥è°ƒç”¨è€…æ ˆå¸§çš„æ“ä½œæ•°æ ˆã€è®¾ç½®PCå¯„å­˜å™¨å€¼ç­‰ï¼Œè®©è°ƒç”¨è€…æ–¹æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p><p>  æ­£å¸¸å®Œæˆå‡ºå£å’Œå¼‚å¸¸å®Œæˆå‡ºå£çš„åŒºåˆ«åœ¨äºï¼šé€šè¿‡å¼‚å¸¸å®Œæˆå‡ºå£é€€å‡ºçš„ä¸ä¼šç»™ä»–çš„ä¸Šå±‚è°ƒç”¨è€…äº§ç”Ÿä»»ä½•çš„è¿”å›å€¼ã€‚</p></li></ul><h3 id="7-ä¸€äº›é™„åŠ ä¿¡æ¯"><a href="#7-ä¸€äº›é™„åŠ ä¿¡æ¯" class="headerlink" title="7.ä¸€äº›é™„åŠ ä¿¡æ¯"></a>7.<strong>ä¸€äº›é™„åŠ ä¿¡æ¯</strong></h3><p>è™šæ‹Ÿæœºè§„èŒƒå…è®¸å…·ä½“çš„è™šæ‹Ÿæœºå®ç°å¢åŠ ä¸€äº›è§„èŒƒé‡Œæ²¡æœ‰æè¿°çš„ä¿¡æ¯åˆ°æ ˆå¸§ä¸­ï¼Œä¾‹å¦‚ä¸è°ƒè¯•ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™éƒ¨åˆ†ä¿¡æ¯å®Œå…¨å–å†³äºå…·ä½“çš„è™šæ‹Ÿæœºå®ç°ã€‚å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¼šæŠŠåŠ¨æ€è¿æ¥ã€æ–¹æ³•è¿”å›åœ°å€ä¸å…¶ä»–é™„åŠ ä¿¡æ¯å…¨éƒ¨å½’ä¸ºä¸€ç±»ï¼Œæˆä¸ºæ ˆå¸§ä¿¡æ¯ã€‚</p>]]></content>
    
    
    <summary type="html">æ¯ä¸ª Java è™šæ‹Ÿæœºçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¸“ç”¨çš„ Java è™šæ‹Ÿæœºå †æ ˆï¼Œä¸çº¿ç¨‹åŒæ—¶åˆ›å»ºã€‚Java è™šæ‹Ÿæœºå †æ ˆå­˜å‚¨å¸§(2.6)ã€‚Java è™šæ‹Ÿæœºå †æ ˆç±»ä¼¼äºä¼ ç»Ÿè¯­è¨€(å¦‚ c)çš„å †æ ˆï¼šå®ƒä¿å­˜å±€éƒ¨å˜é‡å’Œéƒ¨åˆ†ç»“æœï¼Œå¹¶åœ¨æ–¹æ³•è°ƒç”¨å’Œè¿”å›ä¸­å‘æŒ¥ä½œç”¨ã€‚å› ä¸º Java è™šæ‹Ÿæœºå †æ ˆä»æ¥ä¸ä¼šè¢«ç›´æ¥æ“ä½œï¼Œé™¤äº†æ¨é€å’Œå¼¹å‡ºæ¡†æ¶ï¼Œæ¡†æ¶å¯èƒ½ä¼šè¢«åˆ†é…åˆ°å †ä¸­ã€‚Java è™šæ‹Ÿæœºå †æ ˆçš„å†…å­˜ä¸éœ€è¦æ˜¯è¿ç»­çš„ã€‚</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(å…­)**æœ¬åœ°æ–¹æ³•æ ˆNative Method Stacks</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%85%AD)%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88Native%20Method%20Stacks/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E5%85%AD)%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88Native%20Method%20Stacks/</id>
    <published>2023-02-05T16:00:00.000Z</published>
    <updated>2025-09-03T15:14:27.441Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-å…­-æœ¬åœ°æ–¹æ³•æ ˆNative-Method-Stacks"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-å…­-æœ¬åœ°æ–¹æ³•æ ˆNative-Method-Stacks" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(å…­)æœ¬åœ°æ–¹æ³•æ ˆNative Method Stacks"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(å…­)<strong>æœ¬åœ°æ–¹æ³•æ ˆNative Method Stacks</strong></h2><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h3><p>Java è™šæ‹Ÿæœºçš„å®ç°å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„æ ˆ(é€šå¸¸ç§°ä¸ºâ€œ c æ ˆâ€)æ¥æ”¯æŒæœ¬æœºæ–¹æ³•(ç”¨ Java ç¼–ç¨‹è¯­è¨€ä»¥å¤–çš„è¯­è¨€ç¼–å†™çš„æ–¹æ³•)ã€‚æœ¬æœºæ–¹æ³•å †æ ˆä¹Ÿå¯ä»¥ç”¨äº Java è™šæ‹ŸæœºæŒ‡ä»¤é›†çš„è§£é‡Šå™¨çš„å®ç°ï¼Œå¦‚ c è¯­è¨€çš„ Java è™šæ‹Ÿæœºå®ç°ï¼Œä¸èƒ½åŠ è½½æœ¬æœºæ–¹æ³•ï¼Œä¹Ÿä¸ä¾èµ–äºä¼ ç»Ÿçš„å †æ ˆï¼Œä¸éœ€è¦æä¾›æœ¬æœºæ–¹æ³•å †æ ˆã€‚å¦‚æœæä¾›ï¼Œé€šå¸¸åœ¨åˆ›å»ºæ¯ä¸ªçº¿ç¨‹æ—¶ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æœ¬æœºæ–¹æ³•å †æ ˆã€‚</p><p>è¯¥è§„èŒƒå…è®¸æœ¬æœºæ–¹æ³•å †æ ˆå…·æœ‰å›ºå®šçš„å¤§å°ï¼Œæˆ–è€…æ ¹æ®è®¡ç®—çš„éœ€è¦åŠ¨æ€æ‰©å±•å’Œæ”¶ç¼©ã€‚å¦‚æœæœ¬æœºæ–¹æ³•å †æ ˆçš„å¤§å°å›ºå®šï¼Œåˆ™åœ¨åˆ›å»ºè¯¥å †æ ˆæ—¶å¯ä»¥ç‹¬ç«‹é€‰æ‹©æ¯ä¸ªæœ¬æœºæ–¹æ³•å †æ ˆçš„å¤§å°ã€‚</p><p>Java è™šæ‹Ÿæœºå®ç°å¯ä»¥ä¸ºç¨‹åºå‘˜æˆ–ç”¨æˆ·æä¾›å¯¹æœ¬æœºæ–¹æ³•å †æ ˆåˆå§‹å¤§å°çš„æ§åˆ¶ï¼Œä»¥åŠå¯¹äºä¸åŒå¤§å°çš„æœ¬æœºæ–¹æ³•å †æ ˆï¼Œå¯¹æœ€å¤§å’Œæœ€å°æ–¹æ³•å †æ ˆå¤§å°çš„æ§åˆ¶ã€‚</p><ul><li>ä¸‹é¢çš„å¼‚å¸¸æƒ…å†µä¸æœ¬æœºæ–¹æ³•å †æ ˆç›¸å…³è”:<ul><li>å¦‚æœçº¿ç¨‹ä¸­çš„è®¡ç®—éœ€è¦æ¯”å…è®¸çš„æ›´å¤§çš„æœ¬æœºæ–¹æ³•å †æ ˆï¼Œé‚£ä¹ˆ Java è™šæ‹ŸæœºæŠ›å‡ºä¸€ä¸ª StackOverflowErrorã€‚</li><li>å¦‚æœæœ¬æœºæ–¹æ³•å †æ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œæœ¬æœºæ–¹æ³•å †æ ˆæ‰©å±•å¯ä»¥å°è¯•ï¼Œä½†æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ç”¨ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å¯ç”¨æ¥ä¸ºæ–°çº¿ç¨‹åˆ›å»ºåˆå§‹çš„æœ¬æœºæ–¹æ³•å †æ ˆï¼ŒJava è™šæ‹Ÿæœºå°†æŠ›å‡º OutOfMemoryErrorã€‚</li></ul></li></ul><p>å®˜ç½‘ï¼š<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.6">ChapterÂ 2.Â The Structure of the Java Virtual Machine (oracle.com)</a></p><p><img src="/images/jvm_virtual_machine/chapter6/image" alt="Untitled"></p><p>ç®€å•åœ°è®²ï¼Œä¸€ä¸ªNative Methodtæ˜¯ä¸€ä¸ªJavaè°ƒç”¨éJavaä»£ç çš„æ¥å›—ã€‚ä¸€ä¸ªNative Methodæ˜¯è¿™æ ·ä¸€ä¸ªJavaæ–¹æ³•ï¼šè¯¥æ–¹æ³•çš„å®ç°ç”±éJavaè¯­è¨€å®ç°ï¼Œæ¯”å¦‚Cã€‚è¿™ä¸ªç‰¹å¾å¹¶éJavaæ‰€ç‰¹æœ‰ï¼Œå¾ˆå¤šå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è¿™ä¸€æœºåˆ¶ï¼Œæ¯”å¦‚åœ¨C++ä¸­ï¼Œä½ å¯ä»¥ç”¨extern â€œcâ€ å‘ŠçŸ¥c++ç¼–è¯‘å™¨å»è°ƒç”¨ä¸€ä¸ªcçš„å‡½æ•°ã€‚</p><p>â€œA native method is a Java method whose implementation is provided by non-java code.â€ï¼ˆæœ¬åœ°æ–¹æ³•æ˜¯ä¸€ä¸ªéJavaçš„æ–¹æ³•ï¼Œå®ƒçš„å…·ä½“å®ç°æ˜¯éJavaä»£ç çš„å®ç°ï¼‰</p><p>åœ¨å®šä¹‰ä¸€ä¸ªnative methodæ—¶ï¼Œå¹¶ä¸æä¾›å®ç°ä½“ï¼ˆæœ‰äº›åƒå®šä¹‰ä¸€ä¸ªJava interfaceï¼‰ï¼Œå› ä¸ºå…¶å®ç°ä½“æ˜¯ç”±éjavaè¯­è¨€åœ¨å¤–é¢å®ç°çš„ã€‚</p><p>æœ¬åœ°æ¥å£çš„ä½œç”¨æ˜¯èåˆä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸ºJavaæ‰€ç”¨ï¼Œå®ƒçš„åˆè¡·æ˜¯èåˆC&#x2F;C++ç¨‹åºã€‚</p><ul><li><p><strong>ä»£ç ä¸¾ä¾‹è¯´æ˜Nativeæ–¹æ³•æ˜¯å¦‚ä½•ç¼–å†™çš„</strong></p><p>  éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ ‡è¯†ç¬¦nativeå¯ä»¥ä¸å…¶å®ƒjavaæ ‡è¯†ç¬¦è¿ç”¨ï¼Œä½†æ˜¯abstracté™¤å¤–</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IHaveNatives</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">Native1</span><span class="params">(<span class="type">int</span> x)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">Native2</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">synchronized</span> <span class="type">float</span> <span class="title function_">Native3</span><span class="params">(Object o)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">Native4</span><span class="params">(<span class="type">int</span>[] ary)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨Native Methodï¼Ÿ</strong></p><ul><li>Javaä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œç„¶è€Œæœ‰äº›å±‚æ¬¡çš„ä»»åŠ¡ç”¨Javaå®ç°èµ·æ¥ä¸å®¹æ˜“ï¼Œæˆ–è€…æˆ‘ä»¬å¯¹ç¨‹åºçš„æ•ˆç‡å¾ˆåœ¨æ„æ—¶ï¼Œé—®é¢˜å°±æ¥äº†ã€‚</li></ul></li><li><p><strong>ä¸Javaç¯å¢ƒçš„äº¤äº’</strong></p><ul><li>æœ‰æ—¶Javaåº”ç”¨éœ€è¦ä¸Javaå¤–é¢çš„ç¯å¢ƒäº¤äº’ï¼Œè¿™æ˜¯æœ¬åœ°æ–¹æ³•å­˜åœ¨çš„ä¸»è¦åŸå› ã€‚ä½ å¯ä»¥æƒ³æƒ³Javaéœ€è¦ä¸ä¸€äº›åº•å±‚ç³»ç»Ÿï¼Œå¦‚æ“ä½œç³»ç»Ÿæˆ–æŸäº›ç¡¬ä»¶äº¤æ¢ä¿¡æ¯æ—¶çš„æƒ…å†µã€‚æœ¬åœ°æ–¹æ³•æ­£æ˜¯è¿™æ ·ä¸€ç§äº¤æµæœºåˆ¶ï¼šå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªéå¸¸ç®€æ´çš„æ¥å£ï¼Œè€Œä¸”æˆ‘ä»¬æ— éœ€å»äº†è§£Javaåº”ç”¨ä¹‹å¤–çš„ç¹ççš„ç»†èŠ‚ã€‚</li></ul></li><li><p><strong>ä¸æ“ä½œç³»ç»Ÿçš„äº¤äº’</strong></p><ul><li>JVMæ”¯æŒç€Javaè¯­è¨€æœ¬èº«å’Œè¿è¡Œæ—¶åº“ï¼Œå®ƒæ˜¯Javaç¨‹åºèµ–ä»¥ç”Ÿå­˜çš„å¹³å°ï¼Œå®ƒç”±ä¸€ä¸ªè§£é‡Šå™¨ï¼ˆè§£é‡Šå­—èŠ‚ç ï¼‰å’Œä¸€äº›è¿æ¥åˆ°æœ¬åœ°ä»£ç çš„åº“ç»„æˆã€‚ç„¶è€Œä¸ç®¡æ€æ ·ï¼Œå®ƒæ¯•ç«Ÿä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿï¼Œå®ƒç»å¸¸ä¾èµ–äºä¸€åº•å±‚ç³»ç»Ÿçš„æ”¯æŒã€‚è¿™äº›åº•å±‚ç³»ç»Ÿå¸¸å¸¸æ˜¯å¼ºå¤§çš„æ“ä½œç³»ç»Ÿã€‚é€šè¿‡ä½¿ç”¨æœ¬åœ°æ–¹æ³•ï¼Œæˆ‘ä»¬å¾—ä»¥ç”¨Javaå®ç°äº†jreçš„ä¸åº•å±‚ç³»ç»Ÿçš„äº¤äº’ï¼Œç”šè‡³JVMçš„ä¸€äº›éƒ¨åˆ†å°±æ˜¯ç”¨cå†™çš„ã€‚è¿˜æœ‰ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ä¸€äº›Javaè¯­è¨€æœ¬èº«æ²¡æœ‰æä¾›å°è£…çš„æ“ä½œç³»ç»Ÿçš„ç‰¹æ€§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨æœ¬åœ°æ–¹æ³•ã€‚</li></ul></li><li><p><strong>Sunâ€™s Java</strong></p><ul><li>Sunçš„è§£é‡Šå™¨æ˜¯ç”¨Cå®ç°çš„ï¼Œè¿™ä½¿å¾—å®ƒèƒ½åƒä¸€äº›æ™®é€šçš„Cä¸€æ ·ä¸å¤–éƒ¨äº¤äº’ã€‚jreå¤§éƒ¨åˆ†æ˜¯ç”¨Javaå®ç°çš„ï¼Œå®ƒä¹Ÿé€šè¿‡ä¸€äº›æœ¬åœ°æ–¹æ³•ä¸å¤–ç•Œäº¤äº’ã€‚</li><li>ä¾‹å¦‚ï¼šç±»java.lang.Threadçš„setPriority()æ–¹æ³•æ˜¯ç”¨Javaå®ç°çš„ï¼Œä½†æ˜¯å®ƒå®ç°è°ƒç”¨çš„æ˜¯è¯¥ç±»é‡Œçš„æœ¬åœ°æ–¹æ³•setPriority0()ã€‚è¿™ä¸ªæœ¬åœ°æ–¹æ³•æ˜¯ç”¨Cå®ç°çš„ï¼Œå¹¶è¢«æ¤å…¥JVMå†…éƒ¨åœ¨Windows 95çš„å¹³å°ä¸Šï¼Œè¿™ä¸ªæœ¬åœ°æ–¹æ³•æœ€ç»ˆå°†è°ƒç”¨Win32 setpriority() APIã€‚è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•çš„å…·ä½“å®ç°ç”±JVMç›´æ¥æä¾›ï¼Œæ›´å¤šçš„æƒ…å†µæ˜¯æœ¬åœ°æ–¹æ³•ç”±å¤–éƒ¨çš„åŠ¨æ€é“¾æ¥åº“ï¼ˆexternal dynamic link libraryï¼‰æä¾›ï¼Œç„¶åè¢«JVMè°ƒç”¨ã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">Java è™šæ‹Ÿæœºçš„å®ç°å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„æ ˆ(é€šå¸¸ç§°ä¸ºâ€œ c æ ˆâ€)æ¥æ”¯æŒæœ¬æœºæ–¹æ³•(ç”¨ Java ç¼–ç¨‹è¯­è¨€ä»¥å¤–çš„è¯­è¨€ç¼–å†™çš„æ–¹æ³•)ã€‚æœ¬æœºæ–¹æ³•å †æ ˆä¹Ÿå¯ä»¥ç”¨äº Java è™šæ‹ŸæœºæŒ‡ä»¤é›†çš„è§£é‡Šå™¨çš„å®ç°ï¼Œå¦‚ c è¯­è¨€çš„ Java è™šæ‹Ÿæœºå®ç°ï¼Œä¸èƒ½åŠ è½½æœ¬æœºæ–¹æ³•ï¼Œä¹Ÿä¸ä¾èµ–äºä¼ ç»Ÿçš„å †æ ˆï¼Œä¸éœ€è¦æä¾›æœ¬æœºæ–¹æ³•å †æ ˆã€‚å¦‚æœæä¾›ï¼Œé€šå¸¸åœ¨åˆ›å»ºæ¯ä¸ªçº¿ç¨‹æ—¶ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æœ¬æœºæ–¹æ³•å †æ ˆã€‚</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(ä¸‰)**ç±»åŠ è½½å™¨çš„åˆ†ç±»</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%B8%89)%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%88%86%E7%B1%BB/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%B8%89)%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%88%86%E7%B1%BB/</id>
    <published>2023-02-02T16:00:00.000Z</published>
    <updated>2025-09-03T14:49:45.704Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-ä¸‰-ç±»åŠ è½½å™¨çš„åˆ†ç±»"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-ä¸‰-ç±»åŠ è½½å™¨çš„åˆ†ç±»" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(ä¸‰)ç±»åŠ è½½å™¨çš„åˆ†ç±»"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(ä¸‰)<strong>ç±»åŠ è½½å™¨çš„åˆ†ç±»</strong></h2><h3 id="1-ç±»åŠ è½½å™¨æ¦‚è¿°"><a href="#1-ç±»åŠ è½½å™¨æ¦‚è¿°" class="headerlink" title="1. ç±»åŠ è½½å™¨æ¦‚è¿°"></a>1. <strong>ç±»åŠ è½½å™¨æ¦‚è¿°</strong></h3><ol><li>JVMä¸¥æ ¼æ¥è®²æ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ ã€‚åˆ†åˆ«ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰å’Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆUser-Defined ClassLoaderï¼‰</li><li>ä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯ç¨‹åºä¸­ç”±å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ä¸€ç±»ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒå´æ²¡æœ‰è¿™ä¹ˆå®šä¹‰ï¼Œè€Œæ˜¯<strong>å°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></li><li>æ— è®ºç±»åŠ è½½å™¨çš„ç±»å‹å¦‚ä½•åˆ’åˆ†ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬æœ€å¸¸è§çš„ç±»åŠ è½½å™¨å§‹ç»ˆåªæœ‰3ä¸ªï¼Œå¦‚ä¸‹æ‰€ç¤º</li></ol><p><img src="/images/jvm_virtual_machine/chapter3/image.png" alt="Untitled"></p><p>è¿™é‡Œçš„å››è€…ä¹‹é—´æ˜¯åŒ…å«å…³ç³»ï¼Œä¸æ˜¯ä¸Šå±‚å’Œä¸‹å±‚ï¼Œä¹Ÿä¸æ˜¯å­ç³»ç»Ÿçš„ç»§æ‰¿å…³ç³»ã€‚</p><p><img src="/images/jvm_virtual_machine/chapter3/image1.png" alt="Untitled"></p><ul><li><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç±»ï¼Œè·å–å®ƒä¸åŒçš„åŠ è½½å™¨</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.classloader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-10 11:25:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ç³»ç»Ÿç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">systemClassLoader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        System.out.println(systemClassLoader);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å…¶ä¸Šå±‚çš„ï¼šæ‰©å±•ç±»åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">extClassLoader</span> <span class="operator">=</span> systemClassLoader.getParent();</span><br><span class="line">        System.out.println(extClassLoader);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯•å›¾è·å– æ ¹åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">bootstrapClassLoader</span> <span class="operator">=</span> extClassLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapClassLoader);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–è‡ªå®šä¹‰åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ClassLoaderTest.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–Stringç±»å‹çš„åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader1</span> <span class="operator">=</span> String.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç»“æœï¼š</span></span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line">sun.misc.Launcher$ExtClassLoader@1b6d3586</span><br><span class="line"><span class="literal">null</span></span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line"><span class="literal">null</span></span><br></pre></td></tr></table></figure><p>  å¾—åˆ°çš„ç»“æœï¼Œä»ç»“æœå¯ä»¥çœ‹å‡º æ ¹åŠ è½½å™¨æ— æ³•ç›´æ¥é€šè¿‡ä»£ç è·å–ï¼ŒåŒæ—¶ç›®å‰ç”¨æˆ·ä»£ç æ‰€ä½¿ç”¨çš„åŠ è½½å™¨ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚åŒæ—¶æˆ‘ä»¬é€šè¿‡è·å–Stringç±»å‹çš„åŠ è½½å™¨ï¼Œå‘ç°æ˜¯nullï¼Œé‚£ä¹ˆè¯´æ˜Stringç±»å‹æ˜¯é€šè¿‡æ ¹åŠ è½½å™¨è¿›è¡ŒåŠ è½½çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Javaçš„æ ¸å¿ƒç±»åº“éƒ½æ˜¯ä½¿ç”¨æ ¹åŠ è½½å™¨è¿›è¡ŒåŠ è½½çš„ã€‚</p><p>  æˆ‘ä»¬å°è¯•è·å–å¼•å¯¼ç±»åŠ è½½å™¨ï¼Œè·å–åˆ°çš„å€¼ä¸º null ï¼Œè¿™å¹¶ä¸ä»£è¡¨å¼•å¯¼ç±»åŠ è½½å™¨ä¸å­˜åœ¨ï¼Œ<strong>å› ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨å³ C&#x2F;C++ è¯­è¨€ï¼Œæˆ‘ä»¬è·å–ä¸åˆ°</strong></p><p>  ä¸¤æ¬¡è·å–ç³»ç»Ÿç±»åŠ è½½å™¨çš„å€¼éƒ½ç›¸åŒï¼šsun.misc.Launcher$AppClassLoader@18b4aac2 ï¼Œè¿™è¯´æ˜<strong>ç³»ç»Ÿç±»åŠ è½½å™¨æ˜¯å…¨å±€å”¯ä¸€çš„</strong></p></li></ul><h3 id="2-è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨"><a href="#2-è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨" class="headerlink" title="2.è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨"></a>2.<strong>è™šæ‹Ÿæœºè‡ªå¸¦çš„åŠ è½½å™¨</strong></h3><ul><li><p><strong>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼ŒBootstrap ClassLoaderï¼‰</strong></p><ul><li>è¿™ä¸ªç±»åŠ è½½ä½¿ç”¨C&#x2F;C++è¯­è¨€å®ç°çš„ï¼ŒåµŒå¥—åœ¨JVMå†…éƒ¨ã€‚</li><li>å®ƒç”¨æ¥åŠ è½½Javaçš„æ ¸å¿ƒåº“ï¼ˆJAVAHOME&#x2F;jre&#x2F;1ib&#x2F;rt.jarã€resources.jaræˆ–sun.boot.class.pathè·¯å¾„ä¸‹çš„å†…å®¹ï¼‰ï¼Œç”¨äºæä¾›JVMè‡ªèº«éœ€è¦çš„ç±»</li><li>å¹¶ä¸ç»§æ‰¿è‡ªava.lang.ClassLoaderï¼Œæ²¡æœ‰çˆ¶åŠ è½½å™¨ã€‚</li><li>åŠ è½½æ‰©å±•ç±»å’Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå¹¶æŒ‡å®šä¸ºä»–ä»¬çš„çˆ¶ç±»åŠ è½½å™¨ã€‚</li><li>å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrapå¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸ºjavaã€javaxã€sunç­‰å¼€å¤´çš„ç±»</li></ul></li><li><p><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</strong></p><ul><li>Javaè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.Launcher$ExtClassLoaderå®ç°ã€‚</li><li>æ´¾ç”ŸäºClassLoaderç±»</li><li>çˆ¶ç±»åŠ è½½å™¨ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨</li><li>ä»java.ext.dirsç³»ç»Ÿå±æ€§æ‰€æŒ‡å®šçš„ç›®å½•ä¸­åŠ è½½ç±»åº“ï¼Œæˆ–ä»JDKçš„å®‰è£…ç›®å½•çš„jre&#x2F;1ib&#x2F;extå­ç›®å½•ï¼ˆæ‰©å±•ç›®å½•ï¼‰ä¸‹åŠ è½½ç±»åº“ã€‚å¦‚æœç”¨æˆ·åˆ›å»ºçš„JARæ”¾åœ¨æ­¤ç›®å½•ä¸‹ï¼Œä¹Ÿä¼šè‡ªåŠ¨ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ã€‚</li></ul></li><li><p><strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼ŒAppClassLoaderï¼‰</strong></p><ul><li>javIè¯­è¨€ç¼–å†™ï¼Œç”±sun.misc.LaunchersAppClassLoaderå®ç°</li><li>æ´¾ç”ŸäºClassLoaderç±»</li><li>çˆ¶ç±»åŠ è½½å™¨ä¸ºæ‰©å±•ç±»åŠ è½½å™¨</li><li>å®ƒè´Ÿè´£åŠ è½½ç¯å¢ƒå˜é‡classpathæˆ–ç³»ç»Ÿå±æ€§java.class.pathæŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“</li><li>è¯¥ç±»åŠ è½½æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒJavaåº”ç”¨çš„ç±»éƒ½æ˜¯ç”±å®ƒæ¥å®ŒæˆåŠ è½½</li><li>é€šè¿‡classLoader#getSystemclassLoaderï¼ˆï¼‰æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨</li></ul></li><li><p><strong>ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong></p><p>  åœ¨Javaçš„æ—¥å¸¸åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç±»çš„åŠ è½½å‡ ä¹æ˜¯ç”±ä¸Šè¿°3ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆæ‰§è¡Œçš„ï¼Œåœ¨å¿…è¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œæ¥å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ã€‚ ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ</p><ul><li>éš”ç¦»åŠ è½½ç±»</li><li>ä¿®æ”¹ç±»åŠ è½½çš„æ–¹å¼</li><li>æ‰©å±•åŠ è½½æº</li><li>é˜²æ­¢æºç æ³„æ¼</li></ul><p>  ç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°æ­¥éª¤ï¼š</p><ul><li>å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±»ava.1ang.ClassLoaderç±»çš„æ–¹å¼ï¼Œå®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä»¥æ»¡è¶³ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚</li><li>åœ¨JDK1.2ä¹‹å‰ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œæ€»ä¼šå»ç»§æ‰¿ClassLoaderç±»å¹¶é‡å†™1oadClassï¼ˆï¼‰æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½ç±»ï¼Œä½†æ˜¯åœ¨JDK1.2ä¹‹åå·²ä¸å†å»ºè®®ç”¨æˆ·å»è¦†ç›–1oadclassï¼ˆï¼‰æ–¹æ³•ï¼Œè€Œæ˜¯å»ºè®®æŠŠè‡ªå®šä¹‰çš„ç±»åŠ è½½é€»è¾‘å†™åœ¨findclassï¼ˆï¼‰æ–¹æ³•ä¸­</li><li>åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¤ªè¿‡äºå¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿URIClassLoaderç±»ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…è‡ªå·±å»ç¼–å†™findclassï¼ˆï¼‰æ–¹æ³•åŠå…¶è·å–å­—èŠ‚ç æµçš„æ–¹å¼ï¼Œä½¿è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¼–å†™æ›´åŠ ç®€æ´ã€‚</li></ul></li></ul><h3 id="3-æŸ¥çœ‹æ ¹åŠ è½½å™¨æ‰€èƒ½åŠ è½½çš„ç›®å½•"><a href="#3-æŸ¥çœ‹æ ¹åŠ è½½å™¨æ‰€èƒ½åŠ è½½çš„ç›®å½•" class="headerlink" title="3.æŸ¥çœ‹æ ¹åŠ è½½å™¨æ‰€èƒ½åŠ è½½çš„ç›®å½•"></a>3.<strong>æŸ¥çœ‹æ ¹åŠ è½½å™¨æ‰€èƒ½åŠ è½½çš„ç›®å½•</strong></h3><p>åˆšåˆšæˆ‘ä»¬é€šè¿‡æ¦‚å¿µäº†è§£åˆ°äº†ï¼Œæ ¹åŠ è½½å™¨åªèƒ½å¤ŸåŠ è½½ java &#x2F;libç›®å½•ä¸‹çš„classï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢ä»£ç éªŒè¯ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.security.Provider;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-10 11:42:4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderPathTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*********å¯åŠ¨ç±»åŠ è½½å™¨************&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–BootstrapClassLoader èƒ½å¤ŸåŠ è½½çš„APIçš„è·¯å¾„</span></span><br><span class="line">        URL[] urls = sun.misc.Launcher.getBootstrapClassPath().getURLs();</span><br><span class="line">        <span class="keyword">for</span> (URL url : urls) &#123;</span><br><span class="line">            System.out.println(url.toExternalForm());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»ä¸Šé¢è·¯å¾„ä¸­ï¼Œéšæ„é€‰æ‹©ä¸€ä¸ªç±»ï¼Œæ¥çœ‹çœ‹ä»–çš„ç±»åŠ è½½å™¨æ˜¯ä»€ä¹ˆï¼šå¾—åˆ°çš„æ˜¯nullï¼Œè¯´æ˜æ˜¯  æ ¹åŠ è½½å™¨</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Provider.class.getClassLoader();</span><br><span class="line">        System.out.println(<span class="string">&quot;classLoader ==&gt;&quot;</span>+classLoader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾—åˆ°çš„ç»“æœ</span></span><br><span class="line">*********å¯åŠ¨ç±»åŠ è½½å™¨************</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/lib/resources.jar</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/lib/rt.jar</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/lib/sunrsasign.jar</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/lib/jsse.jar</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/lib/jce.jar</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/lib/charsets.jar</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/lib/jfr.jar</span><br><span class="line">file:/D:/software/Java/jdk1<span class="number">.8</span>/jdk1<span class="number">.8</span><span class="number">.0_241</span>/jre/classes</span><br><span class="line">classLoader ==&gt;<span class="literal">null</span></span><br></pre></td></tr></table></figure><h3 id="4-å…³äºClassLoader"><a href="#4-å…³äºClassLoader" class="headerlink" title="4. å…³äºClassLoader"></a>4. <strong>å…³äºClassLoader</strong></h3><ul><li><p><strong>ClassLoader ç±»ä»‹ç»</strong></p><p>  ClassLoaderç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶åæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½ç»§æ‰¿è‡ªClassLoaderï¼ˆä¸åŒ…æ‹¬å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰</p><p>  <img src="/images/jvm_virtual_machine/chapter3/image2.png" alt="Untitled"></p></li><li><p>sun.misc.Launcher å®ƒæ˜¯ä¸€ä¸ªjavaè™šæ‹Ÿæœºçš„å…¥å£åº”ç”¨</p></li></ul><p><img src="/images/jvm_virtual_machine/chapter3/image3.png" alt="Untitled"></p><ul><li>è·å–ClassLoaderçš„é€”å¾„<ul><li>è·å–å½“å‰ClassLoaderï¼šclazz.getClassLoader()</li><li>è·å–å½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„ClassLoaderï¼šThread.currentThread().getContextClassLoader()</li><li>è·å–ç³»ç»Ÿçš„ClassLoaderï¼šClassLoader.getSystemClassLoader()</li><li>è·å–è°ƒç”¨è€…çš„ClassLoaderï¼šDriverManager.getCallerClassLoader()</li></ul></li></ul><h3 id="5-åŒäº²å§”æ´¾æœºåˆ¶"><a href="#5-åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="5.åŒäº²å§”æ´¾æœºåˆ¶"></a>5.<strong>åŒäº²å§”æ´¾æœºåˆ¶</strong></h3><p>Javaè™šæ‹Ÿæœºå¯¹classæ–‡ä»¶é‡‡ç”¨çš„æ˜¯æŒ‰éœ€åŠ è½½çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦ä½¿ç”¨è¯¥ç±»æ—¶æ‰ä¼šå°†å®ƒçš„classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç”Ÿæˆclasså¯¹è±¡ã€‚è€Œä¸”åŠ è½½æŸä¸ªç±»çš„classæ–‡ä»¶æ—¶ï¼ŒJavaè™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³æŠŠè¯·æ±‚äº¤ç”±çˆ¶ç±»å¤„ç†ï¼Œå®ƒæ˜¯ä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ã€‚</p><ol><li>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼›</li><li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼›</li><li>å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ã€‚</li><li>çˆ¶ç±»åŠ è½½å™¨ä¸€å±‚ä¸€å±‚å¾€ä¸‹åˆ†é…ä»»åŠ¡ï¼Œå¦‚æœå­ç±»åŠ è½½å™¨èƒ½åŠ è½½ï¼Œåˆ™åŠ è½½æ­¤ç±»ï¼Œå¦‚æœå°†åŠ è½½ä»»åŠ¡åˆ†é…è‡³ç³»ç»Ÿç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½æ­¤ç±»ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li></ol><p><img src="/images/jvm_virtual_machine/chapter3/image4.png" alt="Untitled"></p><ul><li><p><strong>åŒäº²å§”æ´¾æœºåˆ¶ä¸¾ä¾‹</strong></p><p>  å½“æˆ‘ä»¬åŠ è½½jdbc.jar ç”¨äºå®ç°æ•°æ®åº“è¿æ¥çš„æ—¶å€™ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ jdbc.jaræ˜¯åŸºäºSPIæ¥å£è¿›è¡Œå®ç°çš„ï¼Œæ‰€ä»¥åœ¨åŠ è½½çš„æ—¶å€™ï¼Œä¼šè¿›è¡ŒåŒäº²å§”æ´¾ï¼Œæœ€ç»ˆä»æ ¹åŠ è½½å™¨ä¸­åŠ è½½ SPIæ ¸å¿ƒç±»ï¼Œç„¶ååœ¨åŠ è½½SPIæ¥å£ç±»ï¼Œæ¥ç€åœ¨è¿›è¡Œåå‘å§”æ´¾ï¼Œé€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è¿›è¡Œå®ç°ç±» jdbc.jarçš„åŠ è½½ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter3/image5.png" alt="Untitled"></p></li><li><p><strong>æ²™ç®±å®‰å…¨æœºåˆ¶</strong></p><p>  è‡ªå®šä¹‰stringç±»ï¼Œä½†æ˜¯åœ¨åŠ è½½è‡ªå®šä¹‰Stringç±»çš„æ—¶å€™ä¼šç‡å…ˆä½¿ç”¨å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨åœ¨åŠ è½½çš„è¿‡ç¨‹ä¸­ä¼šå…ˆåŠ è½½jdkè‡ªå¸¦çš„æ–‡ä»¶ï¼ˆrt.jaråŒ…ä¸­java\lang\String.classï¼‰ï¼ŒæŠ¥é”™ä¿¡æ¯è¯´æ²¡æœ‰mainæ–¹æ³•ï¼Œå°±æ˜¯å› ä¸ºåŠ è½½çš„æ˜¯rt.jaråŒ…ä¸­çš„stringç±»ã€‚è¿™æ ·å¯ä»¥ä¿è¯å¯¹javaæ ¸å¿ƒæºä»£ç çš„ä¿æŠ¤ï¼Œè¿™å°±æ˜¯æ²™ç®±å®‰å…¨æœºåˆ¶ã€‚</p></li><li><p><strong>åŒäº²å§”æ´¾æœºåˆ¶çš„ä¼˜åŠ¿</strong></p><p>  é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒåŒäº²æœºåˆ¶å¯ä»¥</p><ul><li>é¿å…ç±»çš„é‡å¤åŠ è½½</li><li>ä¿æŠ¤ç¨‹åºå®‰å…¨ï¼Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹<ul><li>è‡ªå®šä¹‰ç±»ï¼šjava.lang.String</li><li>è‡ªå®šä¹‰ç±»ï¼šjava.lang.ShkStartï¼ˆæŠ¥é”™ï¼šé˜»æ­¢åˆ›å»º java.langå¼€å¤´çš„ç±»ï¼‰</li></ul></li></ul></li><li><p><strong>å…¶ä»–</strong></p><ul><li><p><strong>å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªclasså¯¹è±¡æ˜¯å¦ç›¸åŒï¼Ÿ</strong></p><p>  åœ¨JVMä¸­è¡¨ç¤ºä¸¤ä¸ªclasså¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªå¿…è¦æ¡ä»¶ï¼š</p><ol><li>ç±»çš„å®Œæ•´ç±»åå¿…é¡»ä¸€è‡´ï¼ŒåŒ…æ‹¬åŒ…å</li><li><strong>åŠ è½½è¿™ä¸ªç±»çš„ClassLoaderï¼ˆæŒ‡ClassLoaderå®ä¾‹å¯¹è±¡ï¼‰å¿…é¡»ç›¸åŒ</strong></li><li>æ¢å¥è¯è¯´ï¼Œåœ¨JVMä¸­ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»å¯¹è±¡ï¼ˆclasså¯¹è±¡ï¼‰æ¥æºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹Ÿæœºæ‰€åŠ è½½ï¼Œä½†åªè¦åŠ è½½å®ƒä»¬çš„ClassLoaderå®ä¾‹å¯¹è±¡ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å¯¹è±¡ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„</li></ol></li><li><p><strong>å¯¹ç±»åŠ è½½å™¨çš„å¼•ç”¨</strong></p><ol><li>JVMå¿…é¡»çŸ¥é“ä¸€ä¸ªç±»å‹æ˜¯ç”±å¯åŠ¨åŠ è½½å™¨åŠ è½½çš„è¿˜æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½å™¨åŠ è½½çš„</li><li><strong>å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ç”±ç”¨æˆ·ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œé‚£ä¹ˆJVMä¼šå°†è¿™ä¸ªç±»åŠ è½½å™¨çš„ä¸€ä¸ªå¼•ç”¨ä½œä¸ºç±»å‹ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ä¿å­˜åœ¨æ–¹æ³•åŒºä¸­</strong></li></ol></li></ul></li></ul>]]></content>
    
    
    <summary type="html">JVMä¸¥æ ¼æ¥è®²æ”¯æŒä¸¤ç§ç±»å‹çš„ç±»åŠ è½½å™¨ ã€‚åˆ†åˆ«ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰å’Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆUser-Defined ClassLoaderï¼‰ä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œè‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬æŒ‡çš„æ˜¯ç¨‹åºä¸­ç”±å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ä¸€ç±»ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒå´æ²¡æœ‰è¿™ä¹ˆå®šä¹‰ï¼Œè€Œæ˜¯**å°†æ‰€æœ‰æ´¾ç”ŸäºæŠ½è±¡ç±»ClassLoaderçš„ç±»åŠ è½½å™¨éƒ½åˆ’åˆ†ä¸ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(äº”)**ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)PCÂ Register</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%BA%94)%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8(PC%E5%AF%84%E5%AD%98%E5%99%A8)PC%20Register/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%BA%94)%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8(PC%E5%AF%84%E5%AD%98%E5%99%A8)PC%20Register/</id>
    <published>2023-02-01T16:00:00.000Z</published>
    <updated>2025-09-03T15:12:50.631Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-äº”-ç¨‹åºè®¡æ•°å™¨-PCå¯„å­˜å™¨-PC-Register"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-äº”-ç¨‹åºè®¡æ•°å™¨-PCå¯„å­˜å™¨-PC-Register" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(äº”)ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)PCÂ Register"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(äº”)<strong>ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)PCÂ Register</strong></h2><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h3><p>Java è™šæ‹Ÿæœºå¯ä»¥åŒæ—¶æ”¯æŒå¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œ(jls17)ã€‚æ¯ä¸ª Java è™šæ‹Ÿæœºçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ pc (ç¨‹åºè®¡æ•°å™¨)å¯„å­˜å™¨ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œæ¯ä¸ª Java è™šæ‹Ÿæœºçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œå•ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œå³è¯¥çº¿ç¨‹çš„å½“å‰æ–¹æ³•(2.6)ã€‚å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸æ˜¯æœ¬æœºçš„ï¼Œé‚£ä¹ˆ pc å¯„å­˜å™¨å°±ä¼šåŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„ Java è™šæ‹ŸæŒ‡ä»¤çš„åœ°å€ã€‚å¦‚æœå½“å‰ç”±çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•æ˜¯æœ¬æœºçš„ï¼Œé‚£ä¹ˆ Java è™šæ‹Ÿæœºçš„ pc å¯„å­˜å™¨çš„å€¼æ˜¯æœªå®šä¹‰çš„ã€‚Java è™šæ‹Ÿæœºçš„ pc å¯„å­˜å™¨è¶³å¤Ÿå®½ï¼Œå¯ä»¥åœ¨ç‰¹å®šå¹³å°ä¸Šä¿å­˜ returnAddress æˆ–æœ¬æœºæŒ‡é’ˆã€‚</p><p>å®˜ç½‘ï¼š<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/index.html">The JavaÂ® Virtual Machine Specification (oracle.com)</a></p><p><img src="/images/jvm_virtual_machine/chapter5/image.png" alt="Untitled"></p><ol><li>JVMä¸­çš„ç¨‹åºè®¡æ•°å¯„å­˜å™¨ï¼ˆProgram Counter Registerï¼‰ä¸­ï¼ŒRegisterçš„å‘½åæºäºCPUçš„å¯„å­˜å™¨ï¼Œ<strong>å¯„å­˜å™¨å­˜å‚¨æŒ‡ä»¤ç›¸å…³çš„ç°åœºä¿¡æ¯</strong>ã€‚CPUåªæœ‰æŠŠæ•°æ®è£…è½½åˆ°å¯„å­˜å™¨æ‰èƒ½å¤Ÿè¿è¡Œã€‚</li><li>è¿™é‡Œï¼Œå¹¶éæ˜¯å¹¿ä¹‰ä¸Šæ‰€æŒ‡çš„ç‰©ç†å¯„å­˜å™¨ï¼Œæˆ–è®¸å°†å…¶ç¿»è¯‘ä¸ºPCè®¡æ•°å™¨ï¼ˆæˆ–æŒ‡ä»¤è®¡æ•°å™¨ï¼‰ä¼šæ›´åŠ è´´åˆ‡ï¼ˆä¹Ÿç§°ä¸ºç¨‹åºé’©å­ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿä¸å®¹æ˜“å¼•èµ·ä¸€äº›ä¸å¿…è¦çš„è¯¯ä¼šã€‚<strong>JVMä¸­çš„PCå¯„å­˜å™¨æ˜¯å¯¹ç‰©ç†PCå¯„å­˜å™¨çš„ä¸€ç§æŠ½è±¡æ¨¡æ‹Ÿ</strong>ã€‚</li><li>å®ƒæ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®°ã€‚ä¹Ÿæ˜¯è¿è¡Œé€Ÿåº¦æœ€å¿«çš„å­˜å‚¨åŒºåŸŸã€‚</li><li>åœ¨JVMè§„èŒƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ã€‚</li><li>ä»»ä½•æ—¶é—´ä¸€ä¸ªçº¿ç¨‹éƒ½åªæœ‰ä¸€ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„<strong>å½“å‰æ–¹æ³•</strong>ã€‚ç¨‹åºè®¡æ•°å™¨ä¼šå­˜å‚¨å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„Javaæ–¹æ³•çš„JVMæŒ‡ä»¤åœ°å€ï¼›æˆ–è€…ï¼Œå¦‚æœæ˜¯åœ¨æ‰§è¡Œnativeæ–¹æ³•ï¼Œåˆ™æ˜¯æœªæŒ‡å®šå€¼ï¼ˆundefnedï¼‰ã€‚</li><li>å®ƒæ˜¯<strong>ç¨‹åºæ§åˆ¶æµ</strong>çš„æŒ‡ç¤ºå™¨ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚</li><li>å­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li><li>å®ƒæ˜¯<strong>å”¯ä¸€ä¸€ä¸ª</strong>åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutofMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</li></ol><ul><li><p><strong>ä½œç”¨</strong></p><p>  PCå¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œä¹Ÿå³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤ä»£ç ã€‚ç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter5/image1.png" alt="Untitled"></p><p>  å†…å­˜æ˜¯éå¸¸é‡è¦çš„ç³»ç»Ÿèµ„æºï¼Œæ˜¯ç¡¬ç›˜å’ŒCPUçš„ä¸­é—´ä»“åº“åŠæ¡¥æ¢ï¼Œæ‰¿è½½ç€æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„å®æ—¶è¿è¡ŒJVMå†…å­˜å¸ƒå±€è§„å®šäº†Javaåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ã€åˆ†é…ã€ç®¡ç†çš„ç­–ç•¥ï¼Œä¿è¯äº†JVMçš„é«˜æ•ˆç¨³å®šè¿è¡Œã€‚ä¸åŒçš„JVMå¯¹äºå†…å­˜çš„åˆ’åˆ†æ–¹å¼å’Œç®¡ç†æœºåˆ¶å­˜åœ¨ç€éƒ¨åˆ†å·®å¼‚ã€‚ç»“åˆJVMè™šæ‹Ÿæœºè§„èŒƒï¼Œæ¥æ¢è®¨ä¸€ä¸‹ç»å…¸çš„JVMå†…å­˜å¸ƒå±€ã€‚</p></li><li><p>ä»£ç å®ç°</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa.register;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**ç¨‹åºè®¡æ•°å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-02-10 13:25:3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PCRegisterTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i + j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  ç„¶åå°†ä»£ç è¿›è¡Œç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹ ï¼Œå‘ç°åœ¨å­—èŠ‚ç çš„å·¦è¾¹æœ‰ä¸€ä¸ªè¡Œå·æ ‡è¯†ï¼Œå®ƒå…¶å®å°±æ˜¯æŒ‡ä»¤åœ°å€ï¼Œç”¨äºæŒ‡å‘å½“å‰æ‰§è¡Œåˆ°å“ªé‡Œã€‚</p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line"><span class="number">2</span>: istore_1</span><br><span class="line"><span class="number">3</span>: bipush        <span class="number">20</span></span><br><span class="line"><span class="number">5</span>: istore_2</span><br><span class="line"><span class="number">6</span>: iload_1</span><br><span class="line"><span class="number">7</span>: iload_2</span><br><span class="line"><span class="number">8</span>: iadd</span><br><span class="line"><span class="number">9</span>: istore_3</span><br><span class="line"><span class="number">10</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>  é€šè¿‡PCå¯„å­˜å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å½“å‰ç¨‹åºæ‰§è¡Œåˆ°å“ªä¸€æ­¥äº†</p><p>  <img src="/images/jvm_virtual_machine/chapter5/image2.png" alt="Untitled"></p><p>  <img src="/images/jvm_virtual_machine/chapter5/image3.png" alt="Untitled"></p></li><li><p><strong>ä½¿ç”¨PCå¯„å­˜å™¨å­˜å‚¨å­—èŠ‚ç æŒ‡ä»¤åœ°å€æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</strong></p><p>  å› ä¸ºCPUéœ€è¦ä¸åœçš„åˆ‡æ¢å„ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶å€™åˆ‡æ¢å›æ¥ä»¥åï¼Œå°±å¾—çŸ¥é“æ¥ç€ä»å“ªå¼€å§‹ç»§ç»­æ‰§è¡Œã€‚</p><p>  JVMçš„å­—èŠ‚ç è§£é‡Šå™¨å°±éœ€è¦é€šè¿‡æ”¹å˜PCå¯„å­˜å™¨çš„å€¼æ¥æ˜ç¡®ä¸‹ä¸€æ¡åº”è¯¥æ‰§è¡Œä»€ä¹ˆæ ·çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p><p>  <img src="/images/jvm_virtual_machine/chapter5/image4.png" alt="Untitled"></p></li><li><p><strong>PCå¯„å­˜å™¨ä¸ºä»€ä¹ˆè¢«è®¾å®šä¸ºç§æœ‰çš„ï¼Ÿ</strong></p><ol><li>æˆ‘ä»¬éƒ½çŸ¥é“æ‰€è°“çš„å¤šçº¿ç¨‹åœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´æ®µå†…åªä¼šæ‰§è¡Œå…¶ä¸­æŸä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•ï¼ŒCPUä¼šä¸åœåœ°åšä»»åŠ¡åˆ‡æ¢ï¼Œè¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«æ— å·®å‘¢ï¼Ÿ<strong>ä¸ºäº†èƒ½å¤Ÿå‡†ç¡®åœ°è®°å½•å„ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å½“å‰å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œæœ€å¥½çš„åŠæ³•è‡ªç„¶æ˜¯ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªPCå¯„å­˜å™¨</strong>ï¼Œè¿™æ ·ä¸€æ¥å„ä¸ªçº¿ç¨‹ä¹‹é—´ä¾¿å¯ä»¥è¿›è¡Œç‹¬ç«‹è®¡ç®—ï¼Œä»è€Œä¸ä¼šå‡ºç°ç›¸äº’å¹²æ‰°çš„æƒ…å†µã€‚</li><li>ç”±äºCPUæ—¶é—´ç‰‡è½®é™åˆ¶ï¼Œä¼—å¤šçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨æˆ–è€…å¤šæ ¸å¤„ç†å™¨ä¸­çš„ä¸€ä¸ªå†…æ ¸ï¼Œåªä¼šæ‰§è¡ŒæŸä¸ªçº¿ç¨‹ä¸­çš„ä¸€æ¡æŒ‡ä»¤ã€‚</li><li>è¿™æ ·å¿…ç„¶å¯¼è‡´ç»å¸¸ä¸­æ–­æˆ–æ¢å¤ï¼Œå¦‚ä½•ä¿è¯åˆ†æ¯«æ— å·®å‘¢ï¼Ÿæ¯ä¸ªçº¿ç¨‹åœ¨åˆ›å»ºåï¼Œéƒ½ä¼šäº§ç”Ÿè‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆå¸§ï¼Œç¨‹åºè®¡æ•°å™¨åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“ã€‚</li></ol></li></ul><h3 id="2-CPU-æ—¶é—´ç‰‡"><a href="#2-CPU-æ—¶é—´ç‰‡" class="headerlink" title="2.CPU æ—¶é—´ç‰‡"></a>2.<strong>CPU æ—¶é—´ç‰‡</strong></h3><ol><li>CPUæ—¶é—´ç‰‡å³CPUåˆ†é…ç»™å„ä¸ªç¨‹åºçš„æ—¶é—´ï¼Œæ¯ä¸ªçº¿ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ã€‚</li><li>åœ¨å®è§‚ä¸Šï¼šæˆ‘ä»¬å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªç¨‹åºå¹¶è¡Œä¸æ‚–ï¼ŒåŒæ—¶è¿è¡Œã€‚</li><li>ä½†åœ¨å¾®è§‚ä¸Šï¼šç”±äºåªæœ‰ä¸€ä¸ªCPUï¼Œä¸€æ¬¡åªèƒ½å¤„ç†ç¨‹åºè¦æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ä½•å¤„ç†å…¬å¹³ï¼Œä¸€ç§æ–¹æ³•å°±æ˜¯å¼•å…¥æ—¶é—´ç‰‡ï¼Œ<strong>æ¯ä¸ªç¨‹åºè½®æµæ‰§è¡Œ</strong>ã€‚</li></ol><p><img src="/images/jvm_virtual_machine/chapter5/image5.png" alt="Untitled"></p>]]></content>
    
    
    <summary type="html">Java è™šæ‹Ÿæœºå¯ä»¥åŒæ—¶æ”¯æŒå¤šä¸ªçº¿ç¨‹çš„æ‰§è¡Œ(jls17)ã€‚æ¯ä¸ª Java è™šæ‹Ÿæœºçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ pc (ç¨‹åºè®¡æ•°å™¨)å¯„å­˜å™¨ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œæ¯ä¸ª Java è™šæ‹Ÿæœºçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œå•ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œå³è¯¥çº¿ç¨‹çš„å½“å‰æ–¹æ³•(2.6)ã€‚å¦‚æœè¿™ä¸ªæ–¹æ³•ä¸æ˜¯æœ¬æœºçš„ï¼Œé‚£ä¹ˆ pc å¯„å­˜å™¨å°±ä¼šåŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„ Java è™šæ‹ŸæŒ‡ä»¤çš„åœ°å€ã€‚å¦‚æœå½“å‰ç”±çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•æ˜¯æœ¬æœºçš„ï¼Œé‚£ä¹ˆ Java è™šæ‹Ÿæœºçš„ pc å¯„å­˜å™¨çš„å€¼æ˜¯æœªå®šä¹‰çš„ã€‚Java è™šæ‹Ÿæœºçš„ pc å¯„å­˜å™¨è¶³å¤Ÿå®½ï¼Œå¯ä»¥åœ¨ç‰¹å®šå¹³å°ä¸Šä¿å­˜ returnAddress æˆ–æœ¬æœºæŒ‡é’ˆã€‚</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>JVMè™šæ‹Ÿæœºè¯¦è§£(äºŒ)**ç±»åŠ è½½å­ç³»ç»Ÿ</title>
    <link href="https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%BA%8C)%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/"/>
    <id>https://yuanxw.github.io/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3(%E4%BA%8C)%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/</id>
    <published>2023-01-31T16:00:00.000Z</published>
    <updated>2025-09-03T14:43:10.302Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JVMè™šæ‹Ÿæœºè¯¦è§£-äºŒ-ç±»åŠ è½½å­ç³»ç»Ÿ"><a href="#JVMè™šæ‹Ÿæœºè¯¦è§£-äºŒ-ç±»åŠ è½½å­ç³»ç»Ÿ" class="headerlink" title="JVMè™šæ‹Ÿæœºè¯¦è§£(äºŒ)ç±»åŠ è½½å­ç³»ç»Ÿ"></a>JVMè™šæ‹Ÿæœºè¯¦è§£(äºŒ)<strong>ç±»åŠ è½½å­ç³»ç»Ÿ</strong></h2><h3 id="1-å†…å­˜ç»“æ„æ¦‚è¿°"><a href="#1-å†…å­˜ç»“æ„æ¦‚è¿°" class="headerlink" title="1. å†…å­˜ç»“æ„æ¦‚è¿°"></a>1. <strong>å†…å­˜ç»“æ„æ¦‚è¿°</strong></h3><p><img src="/images/jvm_virtual_machine/chapter2/image.png" alt="Untitled"></p><aside>ğŸ’¡ æ³¨æ„ï¼šæ–¹æ³•åŒºåªæœ‰HotSpotè™šæ‹Ÿæœºæœ‰ï¼ŒJ9ï¼ŒJRockitéƒ½æ²¡æœ‰</aside><p><img src="/images/jvm_virtual_machine/chapter2/image1.png" alt="Untitled"></p><h3 id="2-ç±»åŠ è½½å™¨å­ç³»ç»Ÿ"><a href="#2-ç±»åŠ è½½å™¨å­ç³»ç»Ÿ" class="headerlink" title="2.ç±»åŠ è½½å™¨å­ç³»ç»Ÿ"></a>2.<strong>ç±»åŠ è½½å™¨å­ç³»ç»Ÿ</strong></h3><ul><li><p><strong>ç±»åŠ è½½å™¨å­ç³»ç»Ÿä½œç”¨ï¼š</strong></p><ul><li>ç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç½‘ç»œä¸­åŠ è½½Classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†ã€‚</li><li>ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”±Execution Engineå†³å®šã€‚</li><li><strong>åŠ è½½çš„ç±»ä¿¡æ¯å­˜æ”¾äºä¸€å—ç§°ä¸ºæ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´</strong>ã€‚é™¤äº†ç±»çš„ä¿¡æ¯å¤–ï¼Œæ–¹æ³•åŒºä¸­è¿˜ä¼šå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ä¿¡æ¯ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬å­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—å¸¸é‡ï¼ˆè¿™éƒ¨åˆ†å¸¸é‡ä¿¡æ¯æ˜¯Classæ–‡ä»¶ä¸­å¸¸é‡æ± éƒ¨åˆ†çš„å†…å­˜æ˜ å°„ï¼‰</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter2/image2.png" alt="Untitled"></p></li></ul><h3 id="3-ç±»åŠ è½½å™¨ClassLoaderè§’è‰²"><a href="#3-ç±»åŠ è½½å™¨ClassLoaderè§’è‰²" class="headerlink" title="3. ç±»åŠ è½½å™¨ClassLoaderè§’è‰²"></a>3. <strong>ç±»åŠ è½½å™¨ClassLoaderè§’è‰²</strong></h3><ul><li>class fileï¼ˆåœ¨ä¸‹å›¾ä¸­å°±æ˜¯Car.classæ–‡ä»¶ï¼‰å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºè®¾è®¡å¸ˆç”»åœ¨çº¸ä¸Šçš„æ¨¡æ¿ï¼Œè€Œæœ€ç»ˆè¿™ä¸ªæ¨¡æ¿åœ¨æ‰§è¡Œçš„æ—¶å€™æ˜¯è¦åŠ è½½åˆ°JVMå½“ä¸­æ¥æ ¹æ®è¿™ä¸ªæ–‡ä»¶å®ä¾‹åŒ–å‡ºnä¸ªä¸€æ¨¡ä¸€æ ·çš„å®ä¾‹ã€‚</li><li>class fileåŠ è½½åˆ°JVMä¸­ï¼Œè¢«ç§°ä¸ºDNAå…ƒæ•°æ®æ¨¡æ¿ï¼ˆåœ¨ä¸‹å›¾ä¸­å°±æ˜¯å†…å­˜ä¸­çš„Car Classï¼‰ï¼Œæ”¾åœ¨æ–¹æ³•åŒºã€‚</li><li>åœ¨.classæ–‡ä»¶â€“&gt;JVMâ€“&gt;æœ€ç»ˆæˆä¸ºå…ƒæ•°æ®æ¨¡æ¿ï¼Œæ­¤è¿‡ç¨‹å°±è¦ä¸€ä¸ªè¿è¾“å·¥å…·ï¼ˆç±»è£…è½½å™¨Class Loaderï¼‰ï¼Œæ‰®æ¼”ä¸€ä¸ªå¿«é€’å‘˜çš„è§’è‰²ã€‚</li></ul><p><img src="/images/jvm_virtual_machine/chapter2/image3.png" alt="Untitled"></p><h3 id="4-ç±»åŠ è½½è¿‡ç¨‹"><a href="#4-ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="4.ç±»åŠ è½½è¿‡ç¨‹"></a>4.<strong>ç±»åŠ è½½è¿‡ç¨‹</strong></h3><p>ä¾‹å¦‚ä¸‹é¢çš„ä¸€æ®µç®€å•çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç±»åŠ è½½å­ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-08 16:51:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘å·²ç»è¢«åŠ è½½å•¦...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å®ƒçš„åŠ è½½è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢?</p><ul><li>æ‰§è¡Œ main() æ–¹æ³•ï¼ˆé™æ€æ–¹æ³•ï¼‰å°±éœ€è¦å…ˆåŠ è½½mainæ–¹æ³•æ‰€åœ¨ç±» HelloLoader</li><li>åŠ è½½æˆåŠŸï¼Œåˆ™è¿›è¡Œé“¾æ¥ã€åˆå§‹åŒ–ç­‰æ“ä½œã€‚å®Œæˆåè°ƒç”¨ HelloLoader ç±»ä¸­çš„é™æ€æ–¹æ³• main</li><li>åŠ è½½å¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter2/image4.png" alt="Untitled"></p><p>  å®Œæ•´çš„æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤º</p><p>  <img src="/images/jvm_virtual_machine/chapter2/image5.png" alt="Untitled"></p></li></ul><h3 id="5-åŠ è½½é˜¶æ®µ"><a href="#5-åŠ è½½é˜¶æ®µ" class="headerlink" title="5. åŠ è½½é˜¶æ®µ"></a>5. <strong>åŠ è½½é˜¶æ®µ</strong></h3><ul><li><p><strong>åŠ è½½ï¼š</strong></p><ol><li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li><li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li><li><strong>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡</strong>ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£</li></ol></li><li><p><strong>åŠ è½½classæ–‡ä»¶çš„æ–¹å¼</strong></p><ol><li>ä»æœ¬åœ°ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½</li><li>é€šè¿‡ç½‘ç»œè·å–ï¼Œå…¸å‹åœºæ™¯ï¼šWeb Applet</li><li>ä»zipå‹ç¼©åŒ…ä¸­è¯»å–ï¼Œæˆä¸ºæ—¥åjarã€waræ ¼å¼çš„åŸºç¡€</li><li>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œä½¿ç”¨æœ€å¤šçš„æ˜¯ï¼šåŠ¨æ€ä»£ç†æŠ€æœ¯</li><li>ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œå…¸å‹åœºæ™¯ï¼šJSPåº”ç”¨ä»ä¸“æœ‰æ•°æ®åº“ä¸­æå–.classæ–‡ä»¶ï¼Œæ¯”è¾ƒå°‘è§</li><li>ä»åŠ å¯†æ–‡ä»¶ä¸­è·å–ï¼Œå…¸å‹çš„é˜²Classæ–‡ä»¶è¢«åç¼–è¯‘çš„ä¿æŠ¤æªæ–½</li></ol></li></ul><h3 id="6-é“¾æ¥é˜¶æ®µ"><a href="#6-é“¾æ¥é˜¶æ®µ" class="headerlink" title="6. é“¾æ¥é˜¶æ®µ"></a>6. <strong>é“¾æ¥é˜¶æ®µ</strong></h3><p>é“¾æ¥åˆ†ä¸ºä¸‰ä¸ªå­é˜¶æ®µï¼šéªŒè¯ -&gt; å‡†å¤‡ -&gt; è§£æ</p><ul><li><p><strong>éªŒè¯(Verify)</strong></p><ol><li>ç›®çš„åœ¨äºç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œä¿è¯è¢«åŠ è½½ç±»çš„æ­£ç¡®æ€§ï¼Œä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨</li><li>ä¸»è¦åŒ…æ‹¬å››ç§éªŒè¯ï¼Œæ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œå…ƒæ•°æ®éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯ï¼Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</li></ol><ul><li><p><strong>ä¸¾ä¾‹</strong></p><p>  ä½¿ç”¨ BinaryViewerè½¯ä»¶æŸ¥çœ‹å­—èŠ‚ç æ–‡ä»¶ï¼Œå…¶å¼€å¤´å‡ä¸º CAFE BABE ï¼Œå¦‚æœå‡ºç°ä¸åˆæ³•çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé‚£ä¹ˆå°†ä¼šéªŒè¯ä¸é€šè¿‡ã€‚</p><p>  <em>å·¥å…·ï¼šBinary VieweræŸ¥çœ‹ï¼Œå·¥å…·ä¸‹è½½åœ°å€ï¼š</em><a href="https://www.proxoft.com/BinaryViewer.aspx">Binary Viewer Page (proxoft.com)</a></p><p>  <img src="/images/jvm_virtual_machine/chapter2/image6.png" alt="Untitled"></p><p>  å¦‚æœå‡ºç°ä¸åˆæ³•çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œé‚£ä¹ˆå°†ä¼šéªŒè¯ä¸é€šè¿‡ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…IDEAçš„æ’ä»¶ï¼Œæ¥æŸ¥çœ‹æˆ‘ä»¬çš„Classæ–‡ä»¶</p></li><li><p>å®‰è£…<em>Binary Viewer</em></p><p>  åŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…IDEAçš„æ’ä»¶ï¼Œæ¥æŸ¥çœ‹æˆ‘ä»¬çš„Classæ–‡ä»¶</p><p>  <img src="/images/jvm_virtual_machine/chapter2/image7.png" alt="Untitled"></p></li><li><p>é…ç½®æ’ä»¶å‚æ•°</p><p>  ç‚¹å‡»<code>Help</code>ï¼Œç‚¹å‡»<code>Edit Custom Vm Optionsâ€¦</code>ï¼Œå¢åŠ ä»¥ä¸‹é…ç½®åé‡å¯<code>IDEA</code>ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-Duser.language=en</span><br><span class="line">-Duser.region=CN</span><br></pre></td></tr></table></figure><p>  å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬ç¼–è¯‘å®Œä¸€ä¸ªclassæ–‡ä»¶åï¼Œç‚¹å‡»viewå³å¯æ˜¾ç¤ºæˆ‘ä»¬å®‰è£…çš„æ’ä»¶æ¥æŸ¥çœ‹å­—èŠ‚ç æ–¹æ³•äº†</p><p>  <img src="/images/jvm_virtual_machine/chapter2/image8.png" alt="Untitled"></p></li></ul></li><li><p><strong>å‡†å¤‡(Prepare)</strong></p><ol><li>ä¸ºç±»å˜é‡ï¼ˆstaticå˜é‡ï¼‰åˆ†é…å†…å­˜å¹¶ä¸”è®¾ç½®è¯¥ç±»å˜é‡çš„é»˜è®¤åˆå§‹å€¼ï¼Œå³é›¶å€¼</li><li>è¿™é‡Œä¸åŒ…å«ç”¨finalä¿®é¥°çš„staticï¼Œå› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…å¥½äº†é»˜è®¤å€¼ï¼Œå‡†å¤‡é˜¶æ®µä¼šæ˜¾å¼åˆå§‹åŒ–</li><li>æ³¨æ„ï¼šè¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­</li></ol><ul><li><strong>ä¸¾ä¾‹</strong></li></ul><p>  ä»£ç ï¼šå˜é‡aåœ¨å‡†å¤‡é˜¶æ®µä¼šèµ‹åˆå§‹å€¼ï¼Œä½†ä¸æ˜¯1ï¼Œè€Œæ˜¯0ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µä¼šè¢«èµ‹å€¼ä¸º 1</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-08 17:36:28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">// å‡†å¤‡é˜¶æ®µä¸º0ï¼Œåœ¨ä¸‹ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–çš„æ—¶å€™æ‰æ˜¯1</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>è§£æ(Resolve)</strong></p><ol><li><strong>å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</strong></li><li>äº‹å®ä¸Šï¼Œè§£ææ“ä½œå¾€å¾€ä¼šä¼´éšç€JVMåœ¨æ‰§è¡Œå®Œåˆå§‹åŒ–ä¹‹åå†æ‰§è¡Œ</li><li>ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ã€‚ç¬¦å·å¼•ç”¨çš„å­—é¢é‡å½¢å¼æ˜ç¡®å®šä¹‰åœ¨ã€Šjavaè™šæ‹Ÿæœºè§„èŒƒã€‹çš„classæ–‡ä»¶æ ¼å¼ä¸­ã€‚ç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„</li><li>è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ç­‰ã€‚å¯¹åº”å¸¸é‡æ± ä¸­çš„CONSTANT Class infoã€CONSTANT Fieldref infoã€CONSTANT Methodref infoç­‰</li></ol><ul><li><p><strong>ç¬¦å·å¼•ç”¨</strong></p><ul><li>åç¼–è¯‘ class æ–‡ä»¶åå¯ä»¥æŸ¥çœ‹ç¬¦å·å¼•ç”¨ï¼Œä¸‹é¢å¸¦# çš„å°±æ˜¯ç¬¦å·å¼•ç”¨</li></ul><p>  <img src="/images/jvm_virtual_machine/chapter2/image9.png" alt="Untitled"></p></li></ul></li></ul><h3 id="7-åˆå§‹åŒ–é˜¶æ®µ"><a href="#7-åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="7.åˆå§‹åŒ–é˜¶æ®µ"></a>7.<strong>åˆå§‹åŒ–é˜¶æ®µ</strong></h3><ul><li><p><strong>ç±»çš„åˆå§‹åŒ–æ—¶æœº</strong></p><ol><li>åˆ›å»ºç±»çš„å®ä¾‹</li><li>è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</li><li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</li><li>åå°„ï¼ˆæ¯”å¦‚ï¼šClass.forName(â€œcom.atguigu.Testâ€)ï¼‰</li><li>åˆå§‹åŒ–ä¸€ä¸ªç±»çš„å­ç±»</li><li>Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»</li><li>JDK7å¼€å§‹æä¾›çš„åŠ¨æ€è¯­è¨€æ”¯æŒï¼šjava.lang.invoke.MethodHandleå®ä¾‹çš„è§£æç»“æœREF_getStaticã€REF putStaticã€REF_invokeStaticå¥æŸ„å¯¹åº”çš„ç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–</li></ol><p>  é™¤äº†ä»¥ä¸Šä¸ƒç§æƒ…å†µï¼Œå…¶ä»–ä½¿ç”¨Javaç±»çš„æ–¹å¼éƒ½è¢«çœ‹ä½œæ˜¯å¯¹ç±»çš„è¢«åŠ¨ä½¿ç”¨ï¼Œéƒ½ä¸ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ï¼Œå³ä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–é˜¶æ®µï¼ˆä¸ä¼šè°ƒç”¨ clinit() æ–¹æ³•å’Œ init() æ–¹æ³•ï¼‰  </p></li><li><p>æ„é€ å™¨æ–¹æ³•<code>&lt;clinit&gt;()</code>æ–¹æ³•</p><ol><li>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•<code>&lt;clinit&gt;()</code>çš„è¿‡ç¨‹</li><li>æ­¤æ–¹æ³•ä¸éœ€å®šä¹‰ï¼Œæ˜¯javacç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰<strong>ç±»å˜é‡</strong>çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ä¸­çš„è¯­å¥åˆå¹¶è€Œæ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬ä»£ç ä¸­åŒ…å«staticå˜é‡çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰clinitæ–¹æ³•</li><li><code>&lt;clinit&gt;()</code>æ–¹æ³•ä¸­çš„æŒ‡ä»¤æŒ‰è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œ</li><li><code>&lt;clinit&gt;()</code>ä¸åŒäºç±»çš„æ„é€ å™¨ã€‚ï¼ˆå…³è”ï¼šæ„é€ å™¨æ˜¯è™šæ‹Ÿæœºè§†è§’ä¸‹çš„<code>&lt;init&gt;()</code>ï¼‰</li><li>è‹¥è¯¥ç±»å…·æœ‰çˆ¶ç±»ï¼ŒJVMä¼šä¿è¯å­ç±»çš„<code>&lt;clinit&gt;()</code>æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>å·²ç»æ‰§è¡Œå®Œæ¯•</li><li>è™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸‹è¢«åŒæ­¥åŠ é”</li></ol></li><li><p><strong>æ¡ˆä¾‹1ï¼šæœ‰staticå˜é‡</strong></p><p>  æŸ¥çœ‹ä¸‹é¢è¿™ä¸ªä»£ç çš„å­—èŠ‚ç ï¼Œå¯ä»¥å‘ç°æœ‰ä¸€ä¸ª<code>&lt;clinit&gt;()</code>æ–¹æ³•ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-09 20:38:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassInitTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        age = <span class="number">2</span>;</span><br><span class="line">        number = <span class="number">20</span>;</span><br><span class="line">        System.out.println(age);</span><br><span class="line">        <span class="comment">// System.out.println(number);  //æŠ¥é”™ï¼šIllegal forward reference éæ³•çš„å‰å‘å¼•ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1ã€linkingä¹‹prepare: number = 0 --&gt; initial: 20 --&gt; 10</span></span><br><span class="line"><span class="comment">     * 2ã€è¿™é‡Œå› ä¸ºé™æ€ä»£ç å—å‡ºç°åœ¨å£°æ˜å˜é‡è¯­å¥å‰é¢ï¼Œæ‰€ä»¥ä¹‹å‰è¢«å‡†å¤‡é˜¶æ®µä¸º0çš„numberå˜é‡ä¼š</span></span><br><span class="line"><span class="comment">     * é¦–å…ˆè¢«åˆå§‹åŒ–ä¸º20ï¼Œå†æ¥ç€è¢«åˆå§‹åŒ–æˆ10ï¼ˆè¿™ä¹Ÿæ˜¯é¢è¯•æ—¶å¸¸è€ƒçš„é—®é¢˜å“¦ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(ClassInitTest.age); <span class="comment">// 2</span></span><br><span class="line">        System.out.println(ClassInitTest.number); <span class="comment">// 10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <img src="/images/jvm_virtual_machine/chapter2/image10.png" alt="Untitled"></p><ul><li>&lt;clintå­—èŠ‚ç &gt;ï¼šå½“æˆ‘ä»¬ä»£ç ä¸­åŒ…å«staticå˜é‡çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰clinitæ–¹æ³•</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: iconst_1</span><br><span class="line"><span class="number">1</span>: putstatic     #<span class="number">3</span>                   <span class="comment">// Field age:I</span></span><br><span class="line"><span class="number">4</span>: iconst_2</span><br><span class="line"><span class="number">5</span>: putstatic     #<span class="number">3</span>                   <span class="comment">// Field age:I</span></span><br><span class="line"><span class="number">8</span>: bipush        <span class="number">20</span>                   <span class="comment">// å…ˆèµ‹20                    </span></span><br><span class="line"><span class="number">10</span>: putstatic     #<span class="number">5</span>                  <span class="comment">// Field number:I</span></span><br><span class="line"><span class="number">13</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line"><span class="number">16</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field age:I</span></span><br><span class="line"><span class="number">19</span>: invokevirtual #<span class="number">4</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line"><span class="number">22</span>: bipush        <span class="number">10</span>                  <span class="comment">// å†èµ‹10       </span></span><br><span class="line"><span class="number">24</span>: putstatic     #<span class="number">5</span>                  <span class="comment">// Field number:I</span></span><br><span class="line"><span class="number">27</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ¡ˆä¾‹2ï¼šæ— staticå˜é‡</strong></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-09 20:38:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NonStaticClassInitTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;this is NonStaticClassInitTest.class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/jvm_virtual_machine/chapter2/image11.png" alt="Untitled"></p><ul><li><p><strong>æ¡ˆä¾‹3ï¼šå…³äºæ¶‰åŠåˆ°çˆ¶ç±»æ—¶å€™çš„å˜é‡èµ‹å€¼è¿‡ç¨‹</strong></p><ul><li>è‹¥è¯¥ç±»å…·æœ‰çˆ¶ç±»ï¼ŒJVMä¼šä¿è¯å­ç±»çš„<code>&lt;clinit&gt;()</code>æ‰§è¡Œå‰ï¼Œçˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>å·²ç»æ‰§è¡Œå®Œæ¯•</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> peppa</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-02-09 22:32:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubClassInitTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">A</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            A = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">B</span> <span class="operator">=</span> A;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Dog.B);  <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  å¦‚ä¸Šä»£ç ï¼ŒåŠ è½½æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>é¦–å…ˆï¼Œæ‰§è¡Œ main() æ–¹æ³•éœ€è¦åŠ è½½ SubClassInitTest ç±»</li><li>è·å– Dog .B é™æ€å˜é‡ï¼Œéœ€è¦åŠ è½½ Dog ç±»</li><li>Dog ç±»çš„çˆ¶ç±»æ˜¯ Animal ç±»ï¼Œæ‰€ä»¥éœ€è¦å…ˆæ‰§è¡Œ Animal ç±»çš„åŠ è½½ï¼Œå†æ‰§è¡Œ Dog ç±»çš„åŠ è½½</li></ul></li><li><p><strong>æ¡ˆä¾‹4ï¼šè™šæ‹Ÿæœºå¿…é¡»ä¿è¯ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸‹è¢«åŒæ­¥åŠ é”</strong></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.peppa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å¼€å§‹&quot;</span>);</span><br><span class="line">            <span class="type">DeadThread</span> <span class="variable">dead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadThread</span>();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r,<span class="string">&quot;çº¿ç¨‹1&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r,<span class="string">&quot;çº¿ç¨‹2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DeadThread</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;åˆå§‹åŒ–å½“å‰ç±»&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œç»“æœ:</span></span><br><span class="line">çº¿ç¨‹<span class="number">2</span>å¼€å§‹</span><br><span class="line">çº¿ç¨‹<span class="number">1</span>å¼€å§‹</span><br><span class="line">çº¿ç¨‹<span class="number">2</span>åˆå§‹åŒ–å½“å‰ç±»</span><br><span class="line"></span><br><span class="line"><span class="comment">/**ç„¶åç¨‹åºå¡æ­»äº†**/</span></span><br></pre></td></tr></table></figure><p>  ç¨‹åºå¡æ­»ï¼Œåˆ†æåŸå› ï¼š</p><ul><li>ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å»åŠ è½½ DeadThread ç±»ï¼Œè€Œ DeadThread ç±»ä¸­é™æ€ä»£ç å—ä¸­æœ‰ä¸€å¤„æ­»å¾ªç¯</li><li>å…ˆåŠ è½½ DeadThread ç±»çš„çº¿ç¨‹æŠ¢åˆ°äº†åŒæ­¥é”ï¼Œç„¶ååœ¨ç±»çš„é™æ€ä»£ç å—ä¸­æ‰§è¡Œæ­»å¾ªç¯ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åŒæ­¥é”çš„é‡Šæ”¾</li><li>æ‰€ä»¥æ— è®ºå“ªä¸ªçº¿ç¨‹å…ˆæ‰§è¡Œ DeadThread ç±»çš„åŠ è½½ï¼Œå¦å¤–ä¸€ä¸ªç±»ä¹Ÿä¸ä¼šç»§ç»­æ‰§è¡Œã€‚ï¼ˆä¸€ä¸ªç±»åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼‰</li></ul></li></ul><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    
    <summary type="html">ç±»åŠ è½½å™¨å­ç³»ç»Ÿä½œç”¨ï¼šç±»åŠ è½½å™¨å­ç³»ç»Ÿè´Ÿè´£ä»æ–‡ä»¶ç³»ç»Ÿæˆ–è€…ç½‘ç»œä¸­åŠ è½½Classæ–‡ä»¶ï¼Œclassæ–‡ä»¶åœ¨æ–‡ä»¶å¼€å¤´æœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡è¯†ã€‚ClassLoaderåªè´Ÿè´£classæ–‡ä»¶çš„åŠ è½½ï¼Œè‡³äºå®ƒæ˜¯å¦å¯ä»¥è¿è¡Œï¼Œåˆ™ç”±Execution Engineå†³å®šã€‚åŠ è½½çš„ç±»ä¿¡æ¯å­˜æ”¾äºä¸€å—ç§°ä¸ºæ–¹æ³•åŒºçš„å†…å­˜ç©ºé—´**ã€‚é™¤äº†ç±»çš„ä¿¡æ¯å¤–ï¼Œæ–¹æ³•åŒºä¸­è¿˜ä¼šå­˜æ”¾è¿è¡Œæ—¶å¸¸é‡æ± ä¿¡æ¯ï¼Œå¯èƒ½è¿˜åŒ…æ‹¬å­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—å¸¸é‡ï¼ˆè¿™éƒ¨åˆ†å¸¸é‡ä¿¡æ¯æ˜¯Classæ–‡ä»¶ä¸­å¸¸é‡æ± éƒ¨åˆ†çš„å†…å­˜æ˜ å°„ï¼‰</summary>
    
    
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/categories/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
    
    <category term="JVM" scheme="https://yuanxw.github.io/tags/JVM/"/>
    
    <category term="JVMè™šæ‹Ÿæœºè¯¦è§£" scheme="https://yuanxw.github.io/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AF%A6%E8%A7%A3/"/>
    
  </entry>
  
</feed>
